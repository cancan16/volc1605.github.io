<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[websocket]]></title>
      <url>https://volc1605.github.io/2018/01/01/websocket/</url>
      <content type="html"><![CDATA[<h3 id="1-spring整合websocket通信"><a href="#1-spring整合websocket通信" class="headerlink" title="1. spring整合websocket通信"></a>1. spring整合websocket通信</h3><h4 id="1-1-引入依赖"><a href="#1-1-引入依赖" class="headerlink" title="1.1 引入依赖"></a>1.1 引入依赖</h4><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 使用spring websocket依赖的jar包 --&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-websocket&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;4.3.3.RELEASE&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-messaging&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;4.3.3.RELEASE&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;!-- 使用spring websocket依赖的jar包 --&gt;</div><div class="line"></div><div class="line">        &lt;!-- websocket兼容ie9测试 --&gt;</div><div class="line">        &lt;!-- https://mvnrepository.com/artifact/javax.websocket/javax.websocket-api --&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;javax.websocket&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;javax.websocket-api&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;1.1&lt;/version&gt;</div><div class="line">            &lt;scope&gt;provided&lt;/scope&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;!-- websocket兼容ie9测试 --&gt;</div></pre></td></tr></table></figure>
<p>项目启动加载websocket初始化 SpringWebSocketConfig<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">import org.springframework.context.annotation.Bean;</div><div class="line">import org.springframework.context.annotation.Configuration;</div><div class="line">import org.springframework.web.servlet.config.annotation.EnableWebMvc;</div><div class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</div><div class="line">import org.springframework.web.socket.config.annotation.EnableWebSocket;</div><div class="line">import org.springframework.web.socket.config.annotation.WebSocketConfigurer;</div><div class="line">import org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</div><div class="line">import org.springframework.web.socket.handler.TextWebSocketHandler;</div><div class="line"></div><div class="line">@Configuration</div><div class="line">@EnableWebMvc</div><div class="line">@EnableWebSocket</div><div class="line">public class SpringWebSocketConfig extends WebMvcConfigurerAdapter implements WebSocketConfigurer &#123;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 项目启动初始化websocket，可以添加拦截器</div><div class="line">     * @param registry</div><div class="line">     */</div><div class="line">    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) &#123;</div><div class="line">        // 用来注册websocket server实现类，第二个参数是访问websocket的地址</div><div class="line">        registry.addHandler(webSocketHandler(), &quot;/webSocket&quot;).addInterceptors(new SpringWebSocketHandlerInterceptor()).setAllowedOrigins(&quot;*&quot;);</div><div class="line">        // 这个是使用Sockjs的注册方法</div><div class="line">        registry.addHandler(webSocketHandler(), &quot;/webSocket/socketJs&quot;).addInterceptors(new SpringWebSocketHandlerInterceptor()).withSockJS();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public TextWebSocketHandler webSocketHandler() &#123;</div><div class="line">        return new SpringWebSocketHandler();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>SpringWebSocketHandlerInterceptorwebsocket拦截器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">import org.springframework.http.server.ServerHttpRequest;</div><div class="line">import org.springframework.http.server.ServerHttpResponse;</div><div class="line">import org.springframework.http.server.ServletServerHttpRequest;</div><div class="line">import org.springframework.web.socket.WebSocketHandler;</div><div class="line">import org.springframework.web.socket.server.support.HttpSessionHandshakeInterceptor;</div><div class="line"></div><div class="line">import javax.servlet.http.HttpSession;</div><div class="line">import java.util.Map;</div><div class="line"></div><div class="line">/**</div><div class="line"> * WebSocket拦截器</div><div class="line"> *</div><div class="line"> * @author WANG</div><div class="line"> */</div><div class="line">public class SpringWebSocketHandlerInterceptor extends HttpSessionHandshakeInterceptor &#123;</div><div class="line"></div><div class="line"></div><div class="line">    // 注入httpRequest用于获取cookies;</div><div class="line">    @Override</div><div class="line">    public boolean beforeHandshake(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler,</div><div class="line">                                   Map&lt;String, Object&gt; attributes) throws Exception &#123;</div><div class="line">        System.out.println(&quot;Before Handshake&quot;);</div><div class="line">        // 从session中回去用户信息</div><div class="line">        ServletServerHttpRequest servletRequest = (ServletServerHttpRequest) request;</div><div class="line">        HttpSession session = servletRequest.getServletRequest().getSession(false);</div><div class="line">        // 在这里设置用户信息，用于和连接时创建的websocket对象进行关联，一个websession对应一个用户</div><div class="line">        attributes.put(&quot;user&quot;, &quot;userid&quot;);</div><div class="line">        System.out.println(session);</div><div class="line">        // 建立连接时websocketsession中包含该用户的userId用于定向发送</div><div class="line">        String userId = null;</div><div class="line">        if (request instanceof ServletServerHttpRequest) &#123;</div><div class="line">        &#125;</div><div class="line">        return super.beforeHandshake(request, response, wsHandler, attributes);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void afterHandshake(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler,</div><div class="line">                               Exception ex) &#123;</div><div class="line">        // TODO Auto-generated method stub</div><div class="line">        super.afterHandshake(request, response, wsHandler, ex);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>处理发送和接收消息核心类 SpringWebSocketHandler<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line">import org.slf4j.Logger;</div><div class="line">import org.slf4j.LoggerFactory;</div><div class="line">import org.springframework.web.socket.CloseStatus;</div><div class="line">import org.springframework.web.socket.TextMessage;</div><div class="line">import org.springframework.web.socket.WebSocketSession;</div><div class="line">import org.springframework.web.socket.handler.TextWebSocketHandler;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line">import java.util.HashMap;</div><div class="line">import java.util.Map;</div><div class="line">import java.util.Set;</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> * @Author: volc</div><div class="line"> * @Description: 处理发送和接收消息核心类</div><div class="line"> * @Date: 16:19 2017/9/22</div><div class="line"> */</div><div class="line">public class SpringWebSocketHandler extends TextWebSocketHandler &#123;</div><div class="line">    private static final Map&lt;String, WebSocketSession&gt; usersMap;//这个会出现性能问题，最好用Map来存储，key用userid</div><div class="line">    private static Logger logger = LoggerFactory.getLogger(SpringWebSocketHandler.class);</div><div class="line"></div><div class="line">    static &#123;</div><div class="line">        usersMap = new HashMap&lt;String, WebSocketSession&gt;();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public SpringWebSocketHandler() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * @Author: volc</div><div class="line">     * @Description: 连接成功时候，会触发页面上onopen方法</div><div class="line">     * @Date: 16:19 2017/9/22</div><div class="line">     */</div><div class="line">    public void afterConnectionEstablished(WebSocketSession session) throws Exception &#123;</div><div class="line"></div><div class="line">        System.out.println(&quot;connect to the websocket success......当前数量:&quot; + usersMap.size() + &quot; 并触发页面的onOpen方法&quot;);</div><div class="line">        //这块会实现自己业务，比如，当用户登录后，会把离线消息推送给用户</div><div class="line">        //TextMessage returnMessage = new TextMessage(&quot;你将收到的离线&quot;);</div><div class="line">        //session.sendMessage(returnMessage);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * @Author: volc</div><div class="line">     * @Description: 关闭连接时销毁用户(客户端)和服务的websocket连接</div><div class="line">     * @Date: 16:27 2017/9/22</div><div class="line">     */</div><div class="line">    public void afterConnectionClosed(WebSocketSession session, CloseStatus closeStatus) throws Exception &#123;</div><div class="line">        logger.debug(&quot;websocket connection closed......&quot;);</div><div class="line">        String userId = (String) session.getAttributes().get(&quot;WEBSOCKET_USERID&quot;);</div><div class="line">        System.out.println(&quot;用户&quot; + userId + &quot;已退出！&quot;);</div><div class="line">        usersMap.remove(userId);</div><div class="line">        System.out.println(&quot;剩余在线用户&quot; + usersMap.size());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * @Author: volc</div><div class="line">     * @Description: 获取客户端发送到服务端的信息</div><div class="line">     * @Date: 16:28 2017/9/22</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    protected void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception &#123;</div><div class="line">        String userId = message.getPayload();</div><div class="line">        // 保存用户和websokcetsession对象关系,用用户</div><div class="line">        session.getAttributes().put(&quot;WEBSOCKET_USERID&quot;, userId);</div><div class="line">        usersMap.put(userId, session);</div><div class="line">        super.handleTextMessage(session, message);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void handleTransportError(WebSocketSession session, Throwable exception) throws Exception &#123;</div><div class="line">        if (session.isOpen()) &#123;</div><div class="line">            session.close();</div><div class="line">        &#125;</div><div class="line">        logger.debug(&quot;websocket connection closed......&quot;);</div><div class="line">        usersMap.remove((String) session.getAttributes().get(&quot;WEBSOCKET_USERID&quot;));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public boolean supportsPartialMessages() &#123;</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * @Author: volc</div><div class="line">     * @Description: 给指定的用户发送消息</div><div class="line">     * @Date: 16:27 2017/9/22</div><div class="line">     */</div><div class="line">    public void sendMessageToUser(String userName, TextMessage message) &#123;</div><div class="line">        Set&lt;Map.Entry&lt;String, WebSocketSession&gt;&gt; entries = usersMap.entrySet();</div><div class="line">        for (Map.Entry&lt;String, WebSocketSession&gt; user : entries) &#123;</div><div class="line">            if (user.getKey().equals(userName)) &#123;</div><div class="line">                try &#123;</div><div class="line">                    if (user.getValue().isOpen()) &#123;</div><div class="line">                        user.getValue().sendMessage(message);</div><div class="line">                    &#125;</div><div class="line">                &#125; catch (IOException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * @Author: volc</div><div class="line">     * @Description: 给所有的用户发送消息</div><div class="line">     * @Date: 16:26 2017/9/22</div><div class="line">     */</div><div class="line">    public void sendMessageToUsers(TextMessage message) &#123;</div><div class="line">        Set&lt;Map.Entry&lt;String, WebSocketSession&gt;&gt; entries = usersMap.entrySet();</div><div class="line">        for (Map.Entry&lt;String, WebSocketSession&gt; user : entries) &#123;</div><div class="line">            try &#123;</div><div class="line">                if (user.getValue().isOpen()) &#123;</div><div class="line">                    user.getValue().sendMessage(message);</div><div class="line">                &#125;</div><div class="line">            &#125; catch (IOException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>页面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line">&lt;!--&lt;script type=&quot;text/javascript&quot; src=&quot;http://cdn.bootcss.com/sockjs-client/1.1.1/sockjs.js&quot;&gt;&lt;/script&gt;--&gt;</div><div class="line">&lt;script src=&quot;#springUrl(&apos;/static/pushstatic/js/socketjs/sockjs.js&apos;)&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;section&gt;</div><div class="line">    &lt;div class=&quot;row&quot;&gt;</div><div class="line">        &lt;article class=&quot;col-xs-12 col-sm-12 col-md-12 col-lg-12&quot;&gt;</div><div class="line">            &lt;div class=&quot;jarviswidget jarviswidget-color-blueDark&quot; id=&quot;wid-id-0&quot; data-widget-editbutton=&quot;false&quot;&gt;</div><div class="line">                &lt;header&gt;</div><div class="line">                    &lt;span class=&quot;widget-icon&quot;&gt; &lt;i class=&quot;fa fa-table&quot;&gt;&lt;/i&gt; &lt;/span&gt;</div><div class="line">                    &lt;h2&gt;webscoket推送测试&lt;/h2&gt;</div><div class="line">                &lt;/header&gt;</div><div class="line">                &lt;div&gt;</div><div class="line">                    &lt;div class=&quot;widget-body&quot;&gt;</div><div class="line">                        &lt;div class=&quot;row&quot;&gt;</div><div class="line">                            &lt;div class=&quot;col-xs-12&quot; style=&quot;margin-bottom:10px;&quot;&gt;</div><div class="line">                                &lt;div class=&quot;form-inline&quot;&gt;</div><div class="line">                                    &lt;div class=&quot;input-group&quot;&gt;</div><div class="line">                                        &lt;input class=&quot;form-control&quot; placeholder=&quot;推送内容&quot; id=&quot;contentId&quot;/&gt;</div><div class="line">                                        &lt;div class=&quot;input-group-btn&quot;&gt;</div><div class="line">                                            &lt;button onclick=&quot;doSend();&quot; class=&quot;btn btn-primary&quot; type=&quot;button&quot;&gt;</div><div class="line">                                                &lt;i class=&quot;fa fa-search&quot;&gt;&lt;/i&gt; 测试</div><div class="line">                                            &lt;/button&gt;</div><div class="line"></div><div class="line">                                        &lt;/div&gt;</div><div class="line">                                    &lt;/div&gt;</div><div class="line">                                &lt;/div&gt;</div><div class="line">                            &lt;/div&gt;</div><div class="line">                        &lt;/div&gt;</div><div class="line">                        &lt;div class=&quot;row&quot;&gt;</div><div class="line">                            &lt;div class=&quot;col-xs-12&quot; style=&quot;margin-bottom:10px;&quot;&gt;</div><div class="line">                                &lt;div class=&quot;form-inline&quot;&gt;</div><div class="line">                                    &lt;div class=&quot;input-group&quot;&gt;</div><div class="line">                                        &lt;div&gt;F12查看控制台，经过测试ie9及以下不兼容。原理以实现，功能尚未开发&lt;/div&gt;</div><div class="line">                                    &lt;/div&gt;</div><div class="line">                                &lt;/div&gt;</div><div class="line">                            &lt;/div&gt;</div><div class="line">                        &lt;/div&gt;</div><div class="line">                    &lt;/div&gt;</div><div class="line">                &lt;/div&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">        &lt;/article&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;/section&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    $(document).ready(function () &#123;</div><div class="line">    &#125;);</div><div class="line">    var websocket = null;</div><div class="line">    if (&apos;WebSocket&apos; in window) &#123;</div><div class="line">        websocket = new WebSocket(&quot;ws://localhost:8081/pushmanage/webSocket&quot;);</div><div class="line">    &#125;</div><div class="line">    else if (&apos;MozWebSocket&apos; in window) &#123;</div><div class="line">        websocket = new MozWebSocket(&quot;ws://localhost:8081/pushmanage/websocket/socketServer&quot;);</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        websocket = new SockJS(&quot;http://localhost:8081/pushmanage/sockjs/socketServer&quot;);</div><div class="line">    &#125;</div><div class="line">    websocket.onopen = onOpen;</div><div class="line">    websocket.onmessage = onMessage;</div><div class="line">    websocket.onerror = onError;</div><div class="line">    websocket.onclose = onClose;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * @Author: volc</div><div class="line">     * @Description: 连接成功后会触发onOpen方法并，关联用户与session之间的连接</div><div class="line">     * @Date: 10:26 2017/9/25</div><div class="line">     */</div><div class="line">    function onOpen(openEvt) &#123;</div><div class="line">        var userId = &quot;$&#123;userId&#125;&quot;;</div><div class="line">        websocket.send(userId); //调用后台handleTextMessage方法</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function onMessage(evt) &#123;</div><div class="line">        console.log(evt.data);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function onError() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function onClose() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function doSend() &#123;</div><div class="line">        if (websocket.readyState == websocket.OPEN) &#123; // 连接成功发送发送消息</div><div class="line">            // 使用controller发送消息</div><div class="line">            testToMsg();</div><div class="line">        &#125; else &#123;</div><div class="line">            alert(&quot;连接失败!&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    window.close = function () &#123;</div><div class="line">        websocket.onclose();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 测试通过请求controller发送消息到该页面</div><div class="line">    function testToMsg() &#123;</div><div class="line">        var reqData = &#123;userId: &quot;$&#123;userId&#125;&quot;&#125;;</div><div class="line">        reqData.msg = $(&quot;#contentId&quot;).val();</div><div class="line">        $.ajax(&#123;</div><div class="line">            type: &apos;POST&apos;,</div><div class="line">            url: &quot;ws/websocket/send&quot;,</div><div class="line">            contentType: &quot;application/json; charset=utf-8&quot;,</div><div class="line">            data: JSON.stringify(reqData),</div><div class="line">            success: function (data) &#123;</div><div class="line">                console.log(data);</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SpringBoot]]></title>
      <url>https://volc1605.github.io/2017/12/28/SpringBoot/</url>
      <content type="html"><![CDATA[<h3 id="1-SpringBoot"><a href="#1-SpringBoot" class="headerlink" title="1. SpringBoot"></a>1. SpringBoot</h3><p><img src="https://volc1605.github.io/images/springboot/springboot.png" alt="desktop"></p>
<p>springboot应用启动方式有两种：</p>
<blockquote>
<p>1 main方法启动<br>2 借助插件启动</p>
</blockquote>
<p><img src="https://volc1605.github.io/images/springboot/springboot2.png" alt="desktop"></p>
<h4 id="1-1-组合注解"><a href="#1-1-组合注解" class="headerlink" title="1.1 组合注解"></a>1.1 组合注解</h4><p>@SpringBootApplication注解是Spring Boot的核心注解，它其实是一个组合注解，组合了一下注解：</p>
<ol>
<li><p>@SpringBootConfiguration：<br> 这是Spring Boot项目的配置注解，这也是一个组合注解<br>在Spring Boot项目中推荐使用@ SpringBootConfiguration替代@Configuration</p>
</li>
<li><p>@EnableAutoConfiguration：<br> 启用自动配置，该注解会使Spring Boot根据项目中依赖的jar包自动配置项目的配置项：<br>a)    如：我们添加了spring-boot-starter-web的依赖，项目中也就会引入SpringMVC的依赖，Spring Boot就会自动配置tomcat和SpringMVC<br>添加了spring-boot-starter-web的依赖，项目中也就会引入SpringMVC的依赖，Spring Boot就会自动配置tomcat和SpringMVC</p>
</li>
<li><p>@ComponentScan：默认扫描@SpringBootApplication所在类的同级目录以及它的子目录</p>
</li>
</ol>
<p>如果我们不需要Spring Boot自动配置，想关闭某一项的自动配置，该如何设置呢？<br>比如：我们不想自动配置Redis，想手动配置。<br><img src="https://volc1605.github.io/images/springboot/springboot3.png" alt="desktop"></p>
<h4 id="1-2-设置项目启动banner图片"><a href="#1-2-设置项目启动banner图片" class="headerlink" title="1.2 设置项目启动banner图片"></a>1.2 设置项目启动banner图片</h4><p>默认是这样的<br><img src="https://volc1605.github.io/images/springboot/springboot2.png" alt="desktop"><br>可以通过，在resources目录下创建一个banner.txt文件，这个文件中保存自定义启动banner就可以了</p>
<ol>
<li>banner生成网址:<a href="http://patorjk.com/software/taag/#p=display&amp;f=Graffiti&amp;t=Type%20Something%20" target="_blank" rel="external">http://patorjk.com/software/taag/#p=display&amp;f=Graffiti&amp;t=Type%20Something%20</a></li>
<li>拷贝生成的字符到一个文本文件中，并且将该文件命名为banner.txt</li>
<li>将banner.txt拷贝到项目的resources目录中：</li>
</ol>
<p>通过设置属性关闭springboot启动时banner的隐藏<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public static void main(String[] args) &#123; // 一个springboot应用的入口</div><div class="line">	// SpringApplication.run(HelloApplication.class, args);</div><div class="line">	SpringApplication app = new SpringApplication(HelloApplication.class);</div><div class="line">	app.setBannerMode(Banner.Mode.OFF); // 关闭启动是的springbootbanner</div><div class="line">	app.run(args);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="1-3-全局变量配置"><a href="#1-3-全局变量配置" class="headerlink" title="1.3 全局变量配置"></a>1.3 全局变量配置</h4><p>在resource下创建application.properties文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">### 修改tomcat启动端口号</div><div class="line">server.port=8088</div><div class="line">### 修改进入DispatcherServlet的规则为：*.html</div><div class="line">server.servlet-path=*.html</div><div class="line">###设置日志级别</div><div class="line">logging.level.org.springframework=DEBUG</div></pre></td></tr></table></figure></p>
<p>更多的配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div><div class="line">1053</div><div class="line">1054</div><div class="line">1055</div><div class="line">1056</div><div class="line">1057</div><div class="line">1058</div><div class="line">1059</div><div class="line">1060</div><div class="line">1061</div><div class="line">1062</div><div class="line">1063</div><div class="line">1064</div><div class="line">1065</div><div class="line">1066</div><div class="line">1067</div><div class="line">1068</div><div class="line">1069</div><div class="line">1070</div><div class="line">1071</div><div class="line">1072</div><div class="line">1073</div><div class="line">1074</div><div class="line">1075</div><div class="line">1076</div><div class="line">1077</div><div class="line">1078</div><div class="line">1079</div><div class="line">1080</div><div class="line">1081</div><div class="line">1082</div><div class="line">1083</div><div class="line">1084</div><div class="line">1085</div><div class="line">1086</div><div class="line">1087</div><div class="line">1088</div><div class="line">1089</div><div class="line">1090</div><div class="line">1091</div><div class="line">1092</div><div class="line">1093</div><div class="line">1094</div><div class="line">1095</div><div class="line">1096</div><div class="line">1097</div><div class="line">1098</div><div class="line">1099</div><div class="line">1100</div><div class="line">1101</div><div class="line">1102</div><div class="line">1103</div><div class="line">1104</div><div class="line">1105</div><div class="line">1106</div><div class="line">1107</div><div class="line">1108</div><div class="line">1109</div><div class="line">1110</div><div class="line">1111</div><div class="line">1112</div><div class="line">1113</div><div class="line">1114</div><div class="line">1115</div><div class="line">1116</div><div class="line">1117</div><div class="line">1118</div><div class="line">1119</div><div class="line">1120</div><div class="line">1121</div><div class="line">1122</div><div class="line">1123</div><div class="line">1124</div><div class="line">1125</div><div class="line">1126</div><div class="line">1127</div><div class="line">1128</div><div class="line">1129</div><div class="line">1130</div><div class="line">1131</div><div class="line">1132</div><div class="line">1133</div><div class="line">1134</div><div class="line">1135</div><div class="line">1136</div><div class="line">1137</div><div class="line">1138</div><div class="line">1139</div><div class="line">1140</div><div class="line">1141</div><div class="line">1142</div><div class="line">1143</div><div class="line">1144</div><div class="line">1145</div><div class="line">1146</div><div class="line">1147</div><div class="line">1148</div><div class="line">1149</div><div class="line">1150</div><div class="line">1151</div><div class="line">1152</div><div class="line">1153</div><div class="line">1154</div><div class="line">1155</div><div class="line">1156</div><div class="line">1157</div><div class="line">1158</div><div class="line">1159</div><div class="line">1160</div><div class="line">1161</div><div class="line">1162</div><div class="line">1163</div><div class="line">1164</div><div class="line">1165</div><div class="line">1166</div><div class="line">1167</div><div class="line">1168</div><div class="line">1169</div><div class="line">1170</div><div class="line">1171</div><div class="line">1172</div><div class="line">1173</div><div class="line">1174</div><div class="line">1175</div><div class="line">1176</div><div class="line">1177</div><div class="line">1178</div><div class="line">1179</div><div class="line">1180</div><div class="line">1181</div><div class="line">1182</div><div class="line">1183</div><div class="line">1184</div><div class="line">1185</div></pre></td><td class="code"><pre><div class="line"># ===================================================================</div><div class="line"># COMMON SPRING BOOT PROPERTIES</div><div class="line">#</div><div class="line"># This sample file is provided as a guideline. Do NOT copy it in its</div><div class="line"># entirety to your own application.               ^^^</div><div class="line"># ===================================================================</div><div class="line"></div><div class="line"></div><div class="line"># ----------------------------------------</div><div class="line"># CORE PROPERTIES</div><div class="line"># ----------------------------------------</div><div class="line"></div><div class="line"># BANNER</div><div class="line">banner.charset=UTF-8 # Banner file encoding.</div><div class="line">banner.location=classpath:banner.txt # Banner file location.</div><div class="line">banner.image.location=classpath:banner.gif # Banner image file location (jpg/png can also be used).</div><div class="line">banner.image.width= # Width of the banner image in chars (default 76)</div><div class="line">banner.image.height= # Height of the banner image in chars (default based on image height)</div><div class="line">banner.image.margin= # Left hand image margin in chars (default 2)</div><div class="line">banner.image.invert= # If images should be inverted for dark terminal themes (default false)</div><div class="line"></div><div class="line"># LOGGING</div><div class="line">logging.config= # Location of the logging configuration file. For instance `classpath:logback.xml` for Logback</div><div class="line">logging.exception-conversion-word=%wEx # Conversion word used when logging exceptions.</div><div class="line">logging.file= # Log file name. For instance `myapp.log`</div><div class="line">logging.level.*= # Log levels severity mapping. For instance `logging.level.org.springframework=DEBUG`</div><div class="line">logging.path= # Location of the log file. For instance `/var/log`</div><div class="line">logging.pattern.console= # Appender pattern for output to the console. Only supported with the default logback setup.</div><div class="line">logging.pattern.file= # Appender pattern for output to the file. Only supported with the default logback setup.</div><div class="line">logging.pattern.level= # Appender pattern for log level (default %5p). Only supported with the default logback setup.</div><div class="line">logging.register-shutdown-hook=false # Register a shutdown hook for the logging system when it is initialized.</div><div class="line"></div><div class="line"># AOP</div><div class="line">spring.aop.auto=true # Add @EnableAspectJAutoProxy.</div><div class="line">spring.aop.proxy-target-class=false # Whether subclass-based (CGLIB) proxies are to be created (true) as opposed to standard Java interface-based proxies (false).</div><div class="line"></div><div class="line"># IDENTITY (ContextIdApplicationContextInitializer)</div><div class="line">spring.application.index= # Application index.</div><div class="line">spring.application.name= # Application name.</div><div class="line"></div><div class="line"># ADMIN (SpringApplicationAdminJmxAutoConfiguration)</div><div class="line">spring.application.admin.enabled=false # Enable admin features for the application.</div><div class="line">spring.application.admin.jmx-name=org.springframework.boot:type=Admin,name=SpringApplication # JMX name of the application admin MBean.</div><div class="line"></div><div class="line"># AUTO-CONFIGURATION</div><div class="line">spring.autoconfigure.exclude= # Auto-configuration classes to exclude.</div><div class="line"></div><div class="line"># SPRING CORE</div><div class="line">spring.beaninfo.ignore=true # Skip search of BeanInfo classes.</div><div class="line"></div><div class="line"># SPRING CACHE (CacheProperties)</div><div class="line">spring.cache.cache-names= # Comma-separated list of cache names to create if supported by the underlying cache manager.</div><div class="line">spring.cache.caffeine.spec= # The spec to use to create caches. Check CaffeineSpec for more details on the spec format.</div><div class="line">spring.cache.couchbase.expiration=0 # Entry expiration in milliseconds. By default the entries never expire.</div><div class="line">spring.cache.ehcache.config= # The location of the configuration file to use to initialize EhCache.</div><div class="line">spring.cache.guava.spec= # The spec to use to create caches. Check CacheBuilderSpec for more details on the spec format.</div><div class="line">spring.cache.infinispan.config= # The location of the configuration file to use to initialize Infinispan.</div><div class="line">spring.cache.jcache.config= # The location of the configuration file to use to initialize the cache manager.</div><div class="line">spring.cache.jcache.provider= # Fully qualified name of the CachingProvider implementation to use to retrieve the JSR-107 compliant cache manager. Only needed if more than one JSR-107 implementation is available on the classpath.</div><div class="line">spring.cache.type= # Cache type, auto-detected according to the environment by default.</div><div class="line"></div><div class="line"># SPRING CONFIG - using environment property only (ConfigFileApplicationListener)</div><div class="line">spring.config.location= # Config file locations.</div><div class="line">spring.config.name=application # Config file name.</div><div class="line"></div><div class="line"># HAZELCAST (HazelcastProperties)</div><div class="line">spring.hazelcast.config= # The location of the configuration file to use to initialize Hazelcast.</div><div class="line"></div><div class="line"># PROJECT INFORMATION (ProjectInfoProperties)</div><div class="line">spring.info.build.location=classpath:META-INF/build-info.properties # Location of the generated build-info.properties file.</div><div class="line">spring.info.git.location=classpath:git.properties # Location of the generated git.properties file.</div><div class="line"></div><div class="line"># JMX</div><div class="line">spring.jmx.default-domain= # JMX domain name.</div><div class="line">spring.jmx.enabled=true # Expose management beans to the JMX domain.</div><div class="line">spring.jmx.server=mbeanServer # MBeanServer bean name.</div><div class="line"></div><div class="line"># Email (MailProperties)</div><div class="line">spring.mail.default-encoding=UTF-8 # Default MimeMessage encoding.</div><div class="line">spring.mail.host= # SMTP server host. For instance `smtp.example.com`</div><div class="line">spring.mail.jndi-name= # Session JNDI name. When set, takes precedence to others mail settings.</div><div class="line">spring.mail.password= # Login password of the SMTP server.</div><div class="line">spring.mail.port= # SMTP server port.</div><div class="line">spring.mail.properties.*= # Additional JavaMail session properties.</div><div class="line">spring.mail.protocol=smtp # Protocol used by the SMTP server.</div><div class="line">spring.mail.test-connection=false # Test that the mail server is available on startup.</div><div class="line">spring.mail.username= # Login user of the SMTP server.</div><div class="line"></div><div class="line"># APPLICATION SETTINGS (SpringApplication)</div><div class="line">spring.main.banner-mode=console # Mode used to display the banner when the application runs.</div><div class="line">spring.main.sources= # Sources (class name, package name or XML resource location) to include in the ApplicationContext.</div><div class="line">spring.main.web-environment= # Run the application in a web environment (auto-detected by default).</div><div class="line"></div><div class="line"># FILE ENCODING (FileEncodingApplicationListener)</div><div class="line">spring.mandatory-file-encoding= # Expected character encoding the application must use.</div><div class="line"></div><div class="line"># INTERNATIONALIZATION (MessageSourceAutoConfiguration)</div><div class="line">spring.messages.always-use-message-format=false # Set whether to always apply the MessageFormat rules, parsing even messages without arguments.</div><div class="line">spring.messages.basename=messages # Comma-separated list of basenames, each following the ResourceBundle convention.</div><div class="line">spring.messages.cache-seconds=-1 # Loaded resource bundle files cache expiration, in seconds. When set to -1, bundles are cached forever.</div><div class="line">spring.messages.encoding=UTF-8 # Message bundles encoding.</div><div class="line">spring.messages.fallback-to-system-locale=true # Set whether to fall back to the system Locale if no files for a specific Locale have been found.</div><div class="line"></div><div class="line"># OUTPUT</div><div class="line">spring.output.ansi.enabled=detect # Configure the ANSI output.</div><div class="line"></div><div class="line"># PID FILE (ApplicationPidFileWriter)</div><div class="line">spring.pid.fail-on-write-error= # Fail if ApplicationPidFileWriter is used but it cannot write the PID file.</div><div class="line">spring.pid.file= # Location of the PID file to write (if ApplicationPidFileWriter is used).</div><div class="line"></div><div class="line"># PROFILES</div><div class="line">spring.profiles.active= # Comma-separated list (or list if using YAML) of active profiles.</div><div class="line">spring.profiles.include= # Unconditionally activate the specified comma separated profiles (or list of profiles if using YAML).</div><div class="line"></div><div class="line"># SENDGRID (SendGridAutoConfiguration)</div><div class="line">spring.sendgrid.api-key= # SendGrid api key (alternative to username/password)</div><div class="line">spring.sendgrid.username= # SendGrid account username</div><div class="line">spring.sendgrid.password= # SendGrid account password</div><div class="line">spring.sendgrid.proxy.host= # SendGrid proxy host</div><div class="line">spring.sendgrid.proxy.port= # SendGrid proxy port</div><div class="line"></div><div class="line"></div><div class="line"># ----------------------------------------</div><div class="line"># WEB PROPERTIES</div><div class="line"># ----------------------------------------</div><div class="line"></div><div class="line"># EMBEDDED SERVER CONFIGURATION (ServerProperties)</div><div class="line">server.address= # Network address to which the server should bind to.</div><div class="line">server.compression.enabled=false # If response compression is enabled.</div><div class="line">server.compression.excluded-user-agents= # List of user-agents to exclude from compression.</div><div class="line">server.compression.mime-types= # Comma-separated list of MIME types that should be compressed. For instance `text/html,text/css,application/json`</div><div class="line">server.compression.min-response-size= # Minimum response size that is required for compression to be performed. For instance 2048</div><div class="line">server.connection-timeout= # Time in milliseconds that connectors will wait for another HTTP request before closing the connection. When not set, the connector&apos;s container-specific default will be used. Use a value of -1 to indicate no (i.e. infinite) timeout.</div><div class="line">server.context-parameters.*= # Servlet context init parameters. For instance `server.context-parameters.a=alpha`</div><div class="line">server.context-path= # Context path of the application.</div><div class="line">server.display-name=application # Display name of the application.</div><div class="line">server.max-http-header-size=0 # Maximum size in bytes of the HTTP message header.</div><div class="line">server.error.include-stacktrace=never # When to include a &quot;stacktrace&quot; attribute.</div><div class="line">server.error.path=/error # Path of the error controller.</div><div class="line">server.error.whitelabel.enabled=true # Enable the default error page displayed in browsers in case of a server error.</div><div class="line">server.jetty.acceptors= # Number of acceptor threads to use.</div><div class="line">server.jetty.max-http-post-size=0 # Maximum size in bytes of the HTTP post or put content.</div><div class="line">server.jetty.selectors= # Number of selector threads to use.</div><div class="line">server.jsp-servlet.class-name=org.apache.jasper.servlet.JspServlet # The class name of the JSP servlet.</div><div class="line">server.jsp-servlet.init-parameters.*= # Init parameters used to configure the JSP servlet</div><div class="line">server.jsp-servlet.registered=true # Whether or not the JSP servlet is registered</div><div class="line">server.port=8080 # Server HTTP port.</div><div class="line">server.server-header= # Value to use for the Server response header (no header is sent if empty)</div><div class="line">server.servlet-path=/ # Path of the main dispatcher servlet.</div><div class="line">server.use-forward-headers= # If X-Forwarded-* headers should be applied to the HttpRequest.</div><div class="line">server.session.cookie.comment= # Comment for the session cookie.</div><div class="line">server.session.cookie.domain= # Domain for the session cookie.</div><div class="line">server.session.cookie.http-only= # &quot;HttpOnly&quot; flag for the session cookie.</div><div class="line">server.session.cookie.max-age= # Maximum age of the session cookie in seconds.</div><div class="line">server.session.cookie.name= # Session cookie name.</div><div class="line">server.session.cookie.path= # Path of the session cookie.</div><div class="line">server.session.cookie.secure= # &quot;Secure&quot; flag for the session cookie.</div><div class="line">server.session.persistent=false # Persist session data between restarts.</div><div class="line">server.session.store-dir= # Directory used to store session data.</div><div class="line">server.session.timeout= # Session timeout in seconds.</div><div class="line">server.session.tracking-modes= # Session tracking modes (one or more of the following: &quot;cookie&quot;, &quot;url&quot;, &quot;ssl&quot;).</div><div class="line">server.ssl.ciphers= # Supported SSL ciphers.</div><div class="line">server.ssl.client-auth= # Whether client authentication is wanted (&quot;want&quot;) or needed (&quot;need&quot;). Requires a trust store.</div><div class="line">server.ssl.enabled= # Enable SSL support.</div><div class="line">server.ssl.enabled-protocols= # Enabled SSL protocols.</div><div class="line">server.ssl.key-alias= # Alias that identifies the key in the key store.</div><div class="line">server.ssl.key-password= # Password used to access the key in the key store.</div><div class="line">server.ssl.key-store= # Path to the key store that holds the SSL certificate (typically a jks file).</div><div class="line">server.ssl.key-store-password= # Password used to access the key store.</div><div class="line">server.ssl.key-store-provider= # Provider for the key store.</div><div class="line">server.ssl.key-store-type= # Type of the key store.</div><div class="line">server.ssl.protocol=TLS # SSL protocol to use.</div><div class="line">server.ssl.trust-store= # Trust store that holds SSL certificates.</div><div class="line">server.ssl.trust-store-password= # Password used to access the trust store.</div><div class="line">server.ssl.trust-store-provider= # Provider for the trust store.</div><div class="line">server.ssl.trust-store-type= # Type of the trust store.</div><div class="line">server.tomcat.accept-count= # Maximum queue length for incoming connection requests when all possible request processing threads are in use.</div><div class="line">server.tomcat.accesslog.buffered=true # Buffer output such that it is only flushed periodically.</div><div class="line">server.tomcat.accesslog.directory=logs # Directory in which log files are created. Can be relative to the tomcat base dir or absolute.</div><div class="line">server.tomcat.accesslog.enabled=false # Enable access log.</div><div class="line">server.tomcat.accesslog.pattern=common # Format pattern for access logs.</div><div class="line">server.tomcat.accesslog.prefix=access_log # Log file name prefix.</div><div class="line">server.tomcat.accesslog.rename-on-rotate=false # Defer inclusion of the date stamp in the file name until rotate time.</div><div class="line">server.tomcat.accesslog.request-attributes-enabled=false # Set request attributes for IP address, Hostname, protocol and port used for the request.</div><div class="line">server.tomcat.accesslog.rotate=true # Enable access log rotation.</div><div class="line">server.tomcat.accesslog.suffix=.log # Log file name suffix.</div><div class="line">server.tomcat.additional-tld-skip-patterns= # Comma-separated list of additional patterns that match jars to ignore for TLD scanning.</div><div class="line">server.tomcat.background-processor-delay=30 # Delay in seconds between the invocation of backgroundProcess methods.</div><div class="line">server.tomcat.basedir= # Tomcat base directory. If not specified a temporary directory will be used.</div><div class="line">server.tomcat.internal-proxies=10\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</div><div class="line">        192\\.168\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</div><div class="line">        169\\.254\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</div><div class="line">        127\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</div><div class="line">        172\\.1[6-9]&#123;1&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</div><div class="line">        172\\.2[0-9]&#123;1&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</div><div class="line">        172\\.3[0-1]&#123;1&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125; # regular expression matching trusted IP addresses.</div><div class="line">server.tomcat.max-connections= # Maximum number of connections that the server will accept and process at any given time.</div><div class="line">server.tomcat.max-http-post-size=0 # Maximum size in bytes of the HTTP post content.</div><div class="line">server.tomcat.max-threads=0 # Maximum amount of worker threads.</div><div class="line">server.tomcat.min-spare-threads=0 # Minimum amount of worker threads.</div><div class="line">server.tomcat.port-header=X-Forwarded-Port # Name of the HTTP header used to override the original port value.</div><div class="line">server.tomcat.protocol-header= # Header that holds the incoming protocol, usually named &quot;X-Forwarded-Proto&quot;.</div><div class="line">server.tomcat.protocol-header-https-value=https # Value of the protocol header that indicates that the incoming request uses SSL.</div><div class="line">server.tomcat.redirect-context-root= # Whether requests to the context root should be redirected by appending a / to the path.</div><div class="line">server.tomcat.remote-ip-header= # Name of the http header from which the remote ip is extracted. For instance `X-FORWARDED-FOR`</div><div class="line">server.tomcat.uri-encoding=UTF-8 # Character encoding to use to decode the URI.</div><div class="line">server.undertow.accesslog.dir= # Undertow access log directory.</div><div class="line">server.undertow.accesslog.enabled=false # Enable access log.</div><div class="line">server.undertow.accesslog.pattern=common # Format pattern for access logs.</div><div class="line">server.undertow.accesslog.prefix=access_log. # Log file name prefix.</div><div class="line">server.undertow.accesslog.rotate=true # Enable access log rotation.</div><div class="line">server.undertow.accesslog.suffix=log # Log file name suffix.</div><div class="line">server.undertow.buffer-size= # Size of each buffer in bytes.</div><div class="line">server.undertow.buffers-per-region= # Number of buffer per region.</div><div class="line">server.undertow.direct-buffers= # Allocate buffers outside the Java heap.</div><div class="line">server.undertow.io-threads= # Number of I/O threads to create for the worker.</div><div class="line">server.undertow.max-http-post-size=0 # Maximum size in bytes of the HTTP post content.</div><div class="line">server.undertow.worker-threads= # Number of worker threads.</div><div class="line"></div><div class="line"># FREEMARKER (FreeMarkerAutoConfiguration)</div><div class="line">spring.freemarker.allow-request-override=false # Set whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name.</div><div class="line">spring.freemarker.allow-session-override=false # Set whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name.</div><div class="line">spring.freemarker.cache=false # Enable template caching.</div><div class="line">spring.freemarker.charset=UTF-8 # Template encoding.</div><div class="line">spring.freemarker.check-template-location=true # Check that the templates location exists.</div><div class="line">spring.freemarker.content-type=text/html # Content-Type value.</div><div class="line">spring.freemarker.enabled=true # Enable MVC view resolution for this technology.</div><div class="line">spring.freemarker.expose-request-attributes=false # Set whether all request attributes should be added to the model prior to merging with the template.</div><div class="line">spring.freemarker.expose-session-attributes=false # Set whether all HttpSession attributes should be added to the model prior to merging with the template.</div><div class="line">spring.freemarker.expose-spring-macro-helpers=true # Set whether to expose a RequestContext for use by Spring&apos;s macro library, under the name &quot;springMacroRequestContext&quot;.</div><div class="line">spring.freemarker.prefer-file-system-access=true # Prefer file system access for template loading. File system access enables hot detection of template changes.</div><div class="line">spring.freemarker.prefix= # Prefix that gets prepended to view names when building a URL.</div><div class="line">spring.freemarker.request-context-attribute= # Name of the RequestContext attribute for all views.</div><div class="line">spring.freemarker.settings.*= # Well-known FreeMarker keys which will be passed to FreeMarker&apos;s Configuration.</div><div class="line">spring.freemarker.suffix= # Suffix that gets appended to view names when building a URL.</div><div class="line">spring.freemarker.template-loader-path=classpath:/templates/ # Comma-separated list of template paths.</div><div class="line">spring.freemarker.view-names= # White list of view names that can be resolved.</div><div class="line"></div><div class="line"># GROOVY TEMPLATES (GroovyTemplateAutoConfiguration)</div><div class="line">spring.groovy.template.allow-request-override=false # Set whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name.</div><div class="line">spring.groovy.template.allow-session-override=false # Set whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name.</div><div class="line">spring.groovy.template.cache= # Enable template caching.</div><div class="line">spring.groovy.template.charset=UTF-8 # Template encoding.</div><div class="line">spring.groovy.template.check-template-location=true # Check that the templates location exists.</div><div class="line">spring.groovy.template.configuration.*= # See GroovyMarkupConfigurer</div><div class="line">spring.groovy.template.content-type=test/html # Content-Type value.</div><div class="line">spring.groovy.template.enabled=true # Enable MVC view resolution for this technology.</div><div class="line">spring.groovy.template.expose-request-attributes=false # Set whether all request attributes should be added to the model prior to merging with the template.</div><div class="line">spring.groovy.template.expose-session-attributes=false # Set whether all HttpSession attributes should be added to the model prior to merging with the template.</div><div class="line">spring.groovy.template.expose-spring-macro-helpers=true # Set whether to expose a RequestContext for use by Spring&apos;s macro library, under the name &quot;springMacroRequestContext&quot;.</div><div class="line">spring.groovy.template.prefix= # Prefix that gets prepended to view names when building a URL.</div><div class="line">spring.groovy.template.request-context-attribute= # Name of the RequestContext attribute for all views.</div><div class="line">spring.groovy.template.resource-loader-path=classpath:/templates/ # Template path.</div><div class="line">spring.groovy.template.suffix=.tpl # Suffix that gets appended to view names when building a URL.</div><div class="line">spring.groovy.template.view-names= # White list of view names that can be resolved.</div><div class="line"></div><div class="line"># SPRING HATEOAS (HateoasProperties)</div><div class="line">spring.hateoas.use-hal-as-default-json-media-type=true # Specify if application/hal+json responses should be sent to requests that accept application/json.</div><div class="line"></div><div class="line"># HTTP message conversion</div><div class="line">spring.http.converters.preferred-json-mapper=jackson # Preferred JSON mapper to use for HTTP message conversion. Set to &quot;gson&quot; to force the use of Gson when both it and Jackson are on the classpath.</div><div class="line"></div><div class="line"># HTTP encoding (HttpEncodingProperties)</div><div class="line">spring.http.encoding.charset=UTF-8 # Charset of HTTP requests and responses. Added to the &quot;Content-Type&quot; header if not set explicitly.</div><div class="line">spring.http.encoding.enabled=true # Enable http encoding support.</div><div class="line">spring.http.encoding.force= # Force the encoding to the configured charset on HTTP requests and responses.</div><div class="line">spring.http.encoding.force-request= # Force the encoding to the configured charset on HTTP requests. Defaults to true when &quot;force&quot; has not been specified.</div><div class="line">spring.http.encoding.force-response= # Force the encoding to the configured charset on HTTP responses.</div><div class="line">spring.http.encoding.mapping= # Locale to Encoding mapping.</div><div class="line"></div><div class="line"># MULTIPART (MultipartProperties)</div><div class="line">spring.http.multipart.enabled=true # Enable support of multi-part uploads.</div><div class="line">spring.http.multipart.file-size-threshold=0 # Threshold after which files will be written to disk. Values can use the suffixed &quot;MB&quot; or &quot;KB&quot; to indicate a Megabyte or Kilobyte size.</div><div class="line">spring.http.multipart.location= # Intermediate location of uploaded files.</div><div class="line">spring.http.multipart.max-file-size=1MB # Max file size. Values can use the suffixed &quot;MB&quot; or &quot;KB&quot; to indicate a Megabyte or Kilobyte size.</div><div class="line">spring.http.multipart.max-request-size=10MB # Max request size. Values can use the suffixed &quot;MB&quot; or &quot;KB&quot; to indicate a Megabyte or Kilobyte size.</div><div class="line">spring.http.multipart.resolve-lazily=false # Whether to resolve the multipart request lazily at the time of file or parameter access.</div><div class="line"></div><div class="line"># JACKSON (JacksonProperties)</div><div class="line">spring.jackson.date-format= # Date format string or a fully-qualified date format class name. For instance `yyyy-MM-dd HH:mm:ss`.</div><div class="line">spring.jackson.default-property-inclusion= # Controls the inclusion of properties during serialization.</div><div class="line">spring.jackson.deserialization.*= # Jackson on/off features that affect the way Java objects are deserialized.</div><div class="line">spring.jackson.generator.*= # Jackson on/off features for generators.</div><div class="line">spring.jackson.joda-date-time-format= # Joda date time format string. If not configured, &quot;date-format&quot; will be used as a fallback if it is configured with a format string.</div><div class="line">spring.jackson.locale= # Locale used for formatting.</div><div class="line">spring.jackson.mapper.*= # Jackson general purpose on/off features.</div><div class="line">spring.jackson.parser.*= # Jackson on/off features for parsers.</div><div class="line">spring.jackson.property-naming-strategy= # One of the constants on Jackson&apos;s PropertyNamingStrategy. Can also be a fully-qualified class name of a PropertyNamingStrategy subclass.</div><div class="line">spring.jackson.serialization.*= # Jackson on/off features that affect the way Java objects are serialized.</div><div class="line">spring.jackson.time-zone= # Time zone used when formatting dates. For instance `America/Los_Angeles`</div><div class="line"></div><div class="line"># JERSEY (JerseyProperties)</div><div class="line">spring.jersey.application-path= # Path that serves as the base URI for the application. Overrides the value of &quot;@ApplicationPath&quot; if specified.</div><div class="line">spring.jersey.filter.order=0 # Jersey filter chain order.</div><div class="line">spring.jersey.init.*= # Init parameters to pass to Jersey via the servlet or filter.</div><div class="line">spring.jersey.servlet.load-on-startup=-1 # Load on startup priority of the Jersey servlet.</div><div class="line">spring.jersey.type=servlet # Jersey integration type.</div><div class="line"></div><div class="line"># SPRING LDAP (LdapProperties)</div><div class="line">spring.ldap.urls= # LDAP URLs of the server.</div><div class="line">spring.ldap.base= # Base suffix from which all operations should originate.</div><div class="line">spring.ldap.username= # Login user of the server.</div><div class="line">spring.ldap.password= # Login password of the server.</div><div class="line">spring.ldap.base-environment.*= # LDAP specification settings.</div><div class="line"></div><div class="line"># EMBEDDED LDAP (EmbeddedLdapProperties)</div><div class="line">spring.ldap.embedded.base-dn= # The base DN</div><div class="line">spring.ldap.embedded.credential.username= # Embedded LDAP username.</div><div class="line">spring.ldap.embedded.credential.password= # Embedded LDAP password.</div><div class="line">spring.ldap.embedded.ldif=classpath:schema.ldif # Schema (LDIF) script resource reference.</div><div class="line">spring.ldap.embedded.port= # Embedded LDAP port.</div><div class="line">spring.ldap.embedded.validation.enabled=true # Enable LDAP schema validation.</div><div class="line">spring.ldap.embedded.validation.schema= # Path to the custom schema.</div><div class="line"></div><div class="line"># SPRING MOBILE DEVICE VIEWS (DeviceDelegatingViewResolverAutoConfiguration)</div><div class="line">spring.mobile.devicedelegatingviewresolver.enable-fallback=false # Enable support for fallback resolution.</div><div class="line">spring.mobile.devicedelegatingviewresolver.enabled=false # Enable device view resolver.</div><div class="line">spring.mobile.devicedelegatingviewresolver.mobile-prefix=mobile/ # Prefix that gets prepended to view names for mobile devices.</div><div class="line">spring.mobile.devicedelegatingviewresolver.mobile-suffix= # Suffix that gets appended to view names for mobile devices.</div><div class="line">spring.mobile.devicedelegatingviewresolver.normal-prefix= # Prefix that gets prepended to view names for normal devices.</div><div class="line">spring.mobile.devicedelegatingviewresolver.normal-suffix= # Suffix that gets appended to view names for normal devices.</div><div class="line">spring.mobile.devicedelegatingviewresolver.tablet-prefix=tablet/ # Prefix that gets prepended to view names for tablet devices.</div><div class="line">spring.mobile.devicedelegatingviewresolver.tablet-suffix= # Suffix that gets appended to view names for tablet devices.</div><div class="line"></div><div class="line"># SPRING MOBILE SITE PREFERENCE (SitePreferenceAutoConfiguration)</div><div class="line">spring.mobile.sitepreference.enabled=true # Enable SitePreferenceHandler.</div><div class="line"></div><div class="line"># MUSTACHE TEMPLATES (MustacheAutoConfiguration)</div><div class="line">spring.mustache.allow-request-override= # Set whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name.</div><div class="line">spring.mustache.allow-session-override= # Set whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name.</div><div class="line">spring.mustache.cache= # Enable template caching.</div><div class="line">spring.mustache.charset= # Template encoding.</div><div class="line">spring.mustache.check-template-location= # Check that the templates location exists.</div><div class="line">spring.mustache.content-type= # Content-Type value.</div><div class="line">spring.mustache.enabled= # Enable MVC view resolution for this technology.</div><div class="line">spring.mustache.expose-request-attributes= # Set whether all request attributes should be added to the model prior to merging with the template.</div><div class="line">spring.mustache.expose-session-attributes= # Set whether all HttpSession attributes should be added to the model prior to merging with the template.</div><div class="line">spring.mustache.expose-spring-macro-helpers= # Set whether to expose a RequestContext for use by Spring&apos;s macro library, under the name &quot;springMacroRequestContext&quot;.</div><div class="line">spring.mustache.prefix=classpath:/templates/ # Prefix to apply to template names.</div><div class="line">spring.mustache.request-context-attribute= # Name of the RequestContext attribute for all views.</div><div class="line">spring.mustache.suffix=.html # Suffix to apply to template names.</div><div class="line">spring.mustache.view-names= # White list of view names that can be resolved.</div><div class="line"></div><div class="line"># SPRING MVC (WebMvcProperties)</div><div class="line">spring.mvc.async.request-timeout= # Amount of time (in milliseconds) before asynchronous request handling times out.</div><div class="line">spring.mvc.date-format= # Date format to use. For instance `dd/MM/yyyy`.</div><div class="line">spring.mvc.dispatch-trace-request=false # Dispatch TRACE requests to the FrameworkServlet doService method.</div><div class="line">spring.mvc.dispatch-options-request=true # Dispatch OPTIONS requests to the FrameworkServlet doService method.</div><div class="line">spring.mvc.favicon.enabled=true # Enable resolution of favicon.ico.</div><div class="line">spring.mvc.formcontent.putfilter.enabled=true # Enable Spring&apos;s HttpPutFormContentFilter.</div><div class="line">spring.mvc.ignore-default-model-on-redirect=true # If the content of the &quot;default&quot; model should be ignored during redirect scenarios.</div><div class="line">spring.mvc.locale= # Locale to use. By default, this locale is overridden by the &quot;Accept-Language&quot; header.</div><div class="line">spring.mvc.locale-resolver=accept-header # Define how the locale should be resolved.</div><div class="line">spring.mvc.log-resolved-exception=false # Enable warn logging of exceptions resolved by a &quot;HandlerExceptionResolver&quot;.</div><div class="line">spring.mvc.media-types.*= # Maps file extensions to media types for content negotiation.</div><div class="line">spring.mvc.message-codes-resolver-format= # Formatting strategy for message codes. For instance `PREFIX_ERROR_CODE`.</div><div class="line">spring.mvc.servlet.load-on-startup=-1 # Load on startup priority of the Spring Web Services servlet.</div><div class="line">spring.mvc.static-path-pattern=/** # Path pattern used for static resources.</div><div class="line">spring.mvc.throw-exception-if-no-handler-found=false # If a &quot;NoHandlerFoundException&quot; should be thrown if no Handler was found to process a request.</div><div class="line">spring.mvc.view.prefix= # Spring MVC view prefix.</div><div class="line">spring.mvc.view.suffix= # Spring MVC view suffix.</div><div class="line"></div><div class="line"># SPRING RESOURCES HANDLING (ResourceProperties)</div><div class="line">spring.resources.add-mappings=true # Enable default resource handling.</div><div class="line">spring.resources.cache-period= # Cache period for the resources served by the resource handler, in seconds.</div><div class="line">spring.resources.chain.cache=true # Enable caching in the Resource chain.</div><div class="line">spring.resources.chain.enabled= # Enable the Spring Resource Handling chain. Disabled by default unless at least one strategy has been enabled.</div><div class="line">spring.resources.chain.gzipped=false # Enable resolution of already gzipped resources.</div><div class="line">spring.resources.chain.html-application-cache=false # Enable HTML5 application cache manifest rewriting.</div><div class="line">spring.resources.chain.strategy.content.enabled=false # Enable the content Version Strategy.</div><div class="line">spring.resources.chain.strategy.content.paths=/** # Comma-separated list of patterns to apply to the Version Strategy.</div><div class="line">spring.resources.chain.strategy.fixed.enabled=false # Enable the fixed Version Strategy.</div><div class="line">spring.resources.chain.strategy.fixed.paths=/** # Comma-separated list of patterns to apply to the Version Strategy.</div><div class="line">spring.resources.chain.strategy.fixed.version= # Version string to use for the Version Strategy.</div><div class="line">spring.resources.static-locations=classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/ # Locations of static resources.</div><div class="line"></div><div class="line"># SPRING SESSION (SessionProperties)</div><div class="line">spring.session.hazelcast.flush-mode=on-save # Sessions flush mode.</div><div class="line">spring.session.hazelcast.map-name=spring:session:sessions # Name of the map used to store sessions.</div><div class="line">spring.session.jdbc.initializer.enabled= # Create the required session tables on startup if necessary. Enabled automatically if the default table name is set or a custom schema is configured.</div><div class="line">spring.session.jdbc.schema=classpath:org/springframework/session/jdbc/schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema.</div><div class="line">spring.session.jdbc.table-name=SPRING_SESSION # Name of database table used to store sessions.</div><div class="line">spring.session.mongo.collection-name=sessions # Collection name used to store sessions.</div><div class="line">spring.session.redis.flush-mode=on-save # Sessions flush mode.</div><div class="line">spring.session.redis.namespace= # Namespace for keys used to store sessions.</div><div class="line">spring.session.store-type= # Session store type.</div><div class="line"></div><div class="line"># SPRING SOCIAL (SocialWebAutoConfiguration)</div><div class="line">spring.social.auto-connection-views=false # Enable the connection status view for supported providers.</div><div class="line"></div><div class="line"># SPRING SOCIAL FACEBOOK (FacebookAutoConfiguration)</div><div class="line">spring.social.facebook.app-id= # your application&apos;s Facebook App ID</div><div class="line">spring.social.facebook.app-secret= # your application&apos;s Facebook App Secret</div><div class="line"></div><div class="line"># SPRING SOCIAL LINKEDIN (LinkedInAutoConfiguration)</div><div class="line">spring.social.linkedin.app-id= # your application&apos;s LinkedIn App ID</div><div class="line">spring.social.linkedin.app-secret= # your application&apos;s LinkedIn App Secret</div><div class="line"></div><div class="line"># SPRING SOCIAL TWITTER (TwitterAutoConfiguration)</div><div class="line">spring.social.twitter.app-id= # your application&apos;s Twitter App ID</div><div class="line">spring.social.twitter.app-secret= # your application&apos;s Twitter App Secret</div><div class="line"></div><div class="line"># THYMELEAF (ThymeleafAutoConfiguration)</div><div class="line">spring.thymeleaf.cache=true # Enable template caching.</div><div class="line">spring.thymeleaf.check-template=true # Check that the template exists before rendering it.</div><div class="line">spring.thymeleaf.check-template-location=true # Check that the templates location exists.</div><div class="line">spring.thymeleaf.content-type=text/html # Content-Type value.</div><div class="line">spring.thymeleaf.enabled=true # Enable MVC Thymeleaf view resolution.</div><div class="line">spring.thymeleaf.encoding=UTF-8 # Template encoding.</div><div class="line">spring.thymeleaf.excluded-view-names= # Comma-separated list of view names that should be excluded from resolution.</div><div class="line">spring.thymeleaf.mode=HTML5 # Template mode to be applied to templates. See also StandardTemplateModeHandlers.</div><div class="line">spring.thymeleaf.prefix=classpath:/templates/ # Prefix that gets prepended to view names when building a URL.</div><div class="line">spring.thymeleaf.suffix=.html # Suffix that gets appended to view names when building a URL.</div><div class="line">spring.thymeleaf.template-resolver-order= # Order of the template resolver in the chain.</div><div class="line">spring.thymeleaf.view-names= # Comma-separated list of view names that can be resolved.</div><div class="line"></div><div class="line"># SPRING WEB SERVICES (WebServicesProperties)</div><div class="line">spring.webservices.path=/services # Path that serves as the base URI for the services.</div><div class="line">spring.webservices.servlet.init= # Servlet init parameters to pass to Spring Web Services.</div><div class="line">spring.webservices.servlet.load-on-startup=-1 # Load on startup priority of the Spring Web Services servlet.</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># ----------------------------------------</div><div class="line"># SECURITY PROPERTIES</div><div class="line"># ----------------------------------------</div><div class="line"># SECURITY (SecurityProperties)</div><div class="line">security.basic.authorize-mode=role # Security authorize mode to apply.</div><div class="line">security.basic.enabled=true # Enable basic authentication.</div><div class="line">security.basic.path=/** # Comma-separated list of paths to secure.</div><div class="line">security.basic.realm=Spring # HTTP basic realm name.</div><div class="line">security.enable-csrf=false # Enable Cross Site Request Forgery support.</div><div class="line">security.filter-order=0 # Security filter chain order.</div><div class="line">security.filter-dispatcher-types=ASYNC, FORWARD, INCLUDE, REQUEST # Security filter chain dispatcher types.</div><div class="line">security.headers.cache=true # Enable cache control HTTP headers.</div><div class="line">security.headers.content-security-policy= # Value for content security policy header.</div><div class="line">security.headers.content-security-policy-mode=default # Content security policy mode.</div><div class="line">security.headers.content-type=true # Enable &quot;X-Content-Type-Options&quot; header.</div><div class="line">security.headers.frame=true # Enable &quot;X-Frame-Options&quot; header.</div><div class="line">security.headers.hsts=all # HTTP Strict Transport Security (HSTS) mode (none, domain, all).</div><div class="line">security.headers.xss=true # Enable cross site scripting (XSS) protection.</div><div class="line">security.ignored= # Comma-separated list of paths to exclude from the default secured paths.</div><div class="line">security.require-ssl=false # Enable secure channel for all requests.</div><div class="line">security.sessions=stateless # Session creation policy (always, never, if_required, stateless).</div><div class="line">security.user.name=user # Default user name.</div><div class="line">security.user.password= # Password for the default user name. A random password is logged on startup by default.</div><div class="line">security.user.role=USER # Granted roles for the default user name.</div><div class="line"></div><div class="line"># SECURITY OAUTH2 CLIENT (OAuth2ClientProperties)</div><div class="line">security.oauth2.client.client-id= # OAuth2 client id.</div><div class="line">security.oauth2.client.client-secret= # OAuth2 client secret. A random secret is generated by default</div><div class="line"></div><div class="line"># SECURITY OAUTH2 RESOURCES (ResourceServerProperties)</div><div class="line">security.oauth2.resource.filter-order= # The order of the filter chain used to authenticate tokens.</div><div class="line">security.oauth2.resource.id= # Identifier of the resource.</div><div class="line">security.oauth2.resource.jwt.key-uri= # The URI of the JWT token. Can be set if the value is not available and the key is public.</div><div class="line">security.oauth2.resource.jwt.key-value= # The verification key of the JWT token. Can either be a symmetric secret or PEM-encoded RSA public key.</div><div class="line">security.oauth2.resource.prefer-token-info=true # Use the token info, can be set to false to use the user info.</div><div class="line">security.oauth2.resource.service-id=resource #</div><div class="line">security.oauth2.resource.token-info-uri= # URI of the token decoding endpoint.</div><div class="line">security.oauth2.resource.token-type= # The token type to send when using the userInfoUri.</div><div class="line">security.oauth2.resource.user-info-uri= # URI of the user endpoint.</div><div class="line"></div><div class="line"># SECURITY OAUTH2 SSO (OAuth2SsoProperties)</div><div class="line">security.oauth2.sso.filter-order= # Filter order to apply if not providing an explicit WebSecurityConfigurerAdapter</div><div class="line">security.oauth2.sso.login-path=/login # Path to the login page, i.e. the one that triggers the redirect to the OAuth2 Authorization Server</div><div class="line"></div><div class="line"></div><div class="line"># ----------------------------------------</div><div class="line"># DATA PROPERTIES</div><div class="line"># ----------------------------------------</div><div class="line"></div><div class="line"># FLYWAY (FlywayProperties)</div><div class="line">flyway.baseline-description= #</div><div class="line">flyway.baseline-version=1 # version to start migration</div><div class="line">flyway.baseline-on-migrate= #</div><div class="line">flyway.check-location=false # Check that migration scripts location exists.</div><div class="line">flyway.clean-on-validation-error= #</div><div class="line">flyway.enabled=true # Enable flyway.</div><div class="line">flyway.encoding= #</div><div class="line">flyway.ignore-failed-future-migration= #</div><div class="line">flyway.init-sqls= # SQL statements to execute to initialize a connection immediately after obtaining it.</div><div class="line">flyway.locations=classpath:db/migration # locations of migrations scripts</div><div class="line">flyway.out-of-order= #</div><div class="line">flyway.password= # JDBC password if you want Flyway to create its own DataSource</div><div class="line">flyway.placeholder-prefix= #</div><div class="line">flyway.placeholder-replacement= #</div><div class="line">flyway.placeholder-suffix= #</div><div class="line">flyway.placeholders.*= #</div><div class="line">flyway.schemas= # schemas to update</div><div class="line">flyway.sql-migration-prefix=V #</div><div class="line">flyway.sql-migration-separator= #</div><div class="line">flyway.sql-migration-suffix=.sql #</div><div class="line">flyway.table= #</div><div class="line">flyway.url= # JDBC url of the database to migrate. If not set, the primary configured data source is used.</div><div class="line">flyway.user= # Login user of the database to migrate.</div><div class="line">flyway.validate-on-migrate= #</div><div class="line"></div><div class="line"># LIQUIBASE (LiquibaseProperties)</div><div class="line">liquibase.change-log=classpath:/db/changelog/db.changelog-master.yaml # Change log configuration path.</div><div class="line">liquibase.check-change-log-location=true # Check the change log location exists.</div><div class="line">liquibase.contexts= # Comma-separated list of runtime contexts to use.</div><div class="line">liquibase.default-schema= # Default database schema.</div><div class="line">liquibase.drop-first=false # Drop the database schema first.</div><div class="line">liquibase.enabled=true # Enable liquibase support.</div><div class="line">liquibase.labels= # Comma-separated list of runtime labels to use.</div><div class="line">liquibase.parameters.*= # Change log parameters.</div><div class="line">liquibase.password= # Login password of the database to migrate.</div><div class="line">liquibase.rollback-file= # File to which rollback SQL will be written when an update is performed.</div><div class="line">liquibase.url= # JDBC url of the database to migrate. If not set, the primary configured data source is used.</div><div class="line">liquibase.user= # Login user of the database to migrate.</div><div class="line"></div><div class="line"># COUCHBASE (CouchbaseProperties)</div><div class="line">spring.couchbase.bootstrap-hosts= # Couchbase nodes (host or IP address) to bootstrap from.</div><div class="line">spring.couchbase.bucket.name=default # Name of the bucket to connect to.</div><div class="line">spring.couchbase.bucket.password=  # Password of the bucket.</div><div class="line">spring.couchbase.env.endpoints.key-value=1 # Number of sockets per node against the Key/value service.</div><div class="line">spring.couchbase.env.endpoints.query=1 # Number of sockets per node against the Query (N1QL) service.</div><div class="line">spring.couchbase.env.endpoints.view=1 # Number of sockets per node against the view service.</div><div class="line">spring.couchbase.env.ssl.enabled= # Enable SSL support. Enabled automatically if a &quot;keyStore&quot; is provided unless specified otherwise.</div><div class="line">spring.couchbase.env.ssl.key-store= # Path to the JVM key store that holds the certificates.</div><div class="line">spring.couchbase.env.ssl.key-store-password= # Password used to access the key store.</div><div class="line">spring.couchbase.env.timeouts.connect=5000 # Bucket connections timeout in milliseconds.</div><div class="line">spring.couchbase.env.timeouts.key-value=2500 # Blocking operations performed on a specific key timeout in milliseconds.</div><div class="line">spring.couchbase.env.timeouts.query=7500 # N1QL query operations timeout in milliseconds.</div><div class="line">spring.couchbase.env.timeouts.socket-connect=1000 # Socket connect connections timeout in milliseconds.</div><div class="line">spring.couchbase.env.timeouts.view=7500 # Regular and geospatial view operations timeout in milliseconds.</div><div class="line"></div><div class="line"># DAO (PersistenceExceptionTranslationAutoConfiguration)</div><div class="line">spring.dao.exceptiontranslation.enabled=true # Enable the PersistenceExceptionTranslationPostProcessor.</div><div class="line"></div><div class="line"># CASSANDRA (CassandraProperties)</div><div class="line">spring.data.cassandra.cluster-name= # Name of the Cassandra cluster.</div><div class="line">spring.data.cassandra.compression=none # Compression supported by the Cassandra binary protocol.</div><div class="line">spring.data.cassandra.connect-timeout-millis= # Socket option: connection time out.</div><div class="line">spring.data.cassandra.consistency-level= # Queries consistency level.</div><div class="line">spring.data.cassandra.contact-points=localhost # Comma-separated list of cluster node addresses.</div><div class="line">spring.data.cassandra.fetch-size= # Queries default fetch size.</div><div class="line">spring.data.cassandra.keyspace-name= # Keyspace name to use.</div><div class="line">spring.data.cassandra.load-balancing-policy= # Class name of the load balancing policy.</div><div class="line">spring.data.cassandra.port= # Port of the Cassandra server.</div><div class="line">spring.data.cassandra.password= # Login password of the server.</div><div class="line">spring.data.cassandra.read-timeout-millis= # Socket option: read time out.</div><div class="line">spring.data.cassandra.reconnection-policy= # Reconnection policy class.</div><div class="line">spring.data.cassandra.retry-policy= # Class name of the retry policy.</div><div class="line">spring.data.cassandra.serial-consistency-level= # Queries serial consistency level.</div><div class="line">spring.data.cassandra.schema-action=none # Schema action to take at startup.</div><div class="line">spring.data.cassandra.ssl=false # Enable SSL support.</div><div class="line">spring.data.cassandra.username= # Login user of the server.</div><div class="line"></div><div class="line"># DATA COUCHBASE (CouchbaseDataProperties)</div><div class="line">spring.data.couchbase.auto-index=false # Automatically create views and indexes.</div><div class="line">spring.data.couchbase.consistency=read-your-own-writes # Consistency to apply by default on generated queries.</div><div class="line">spring.data.couchbase.repositories.enabled=true # Enable Couchbase repositories.</div><div class="line"></div><div class="line"># ELASTICSEARCH (ElasticsearchProperties)</div><div class="line">spring.data.elasticsearch.cluster-name=elasticsearch # Elasticsearch cluster name.</div><div class="line">spring.data.elasticsearch.cluster-nodes= # Comma-separated list of cluster node addresses. If not specified, starts a client node.</div><div class="line">spring.data.elasticsearch.properties.*= # Additional properties used to configure the client.</div><div class="line">spring.data.elasticsearch.repositories.enabled=true # Enable Elasticsearch repositories.</div><div class="line"></div><div class="line"># DATA LDAP</div><div class="line">spring.data.ldap.repositories.enabled=true # Enable LDAP repositories.</div><div class="line"></div><div class="line"># MONGODB (MongoProperties)</div><div class="line">spring.data.mongodb.authentication-database= # Authentication database name.</div><div class="line">spring.data.mongodb.database=test # Database name.</div><div class="line">spring.data.mongodb.field-naming-strategy= # Fully qualified name of the FieldNamingStrategy to use.</div><div class="line">spring.data.mongodb.grid-fs-database= # GridFS database name.</div><div class="line">spring.data.mongodb.host=localhost # Mongo server host. Cannot be set with uri.</div><div class="line">spring.data.mongodb.password= # Login password of the mongo server. Cannot be set with uri.</div><div class="line">spring.data.mongodb.port=27017 # Mongo server port. Cannot be set with uri.</div><div class="line">spring.data.mongodb.repositories.enabled=true # Enable Mongo repositories.</div><div class="line">spring.data.mongodb.uri=mongodb://localhost/test # Mongo database URI. Cannot be set with host, port and credentials.</div><div class="line">spring.data.mongodb.username= # Login user of the mongo server. Cannot be set with uri.</div><div class="line"></div><div class="line"># DATA REDIS</div><div class="line">spring.data.redis.repositories.enabled=true # Enable Redis repositories.</div><div class="line"></div><div class="line"># NEO4J (Neo4jProperties)</div><div class="line">spring.data.neo4j.compiler= # Compiler to use.</div><div class="line">spring.data.neo4j.embedded.enabled=true # Enable embedded mode if the embedded driver is available.</div><div class="line">spring.data.neo4j.open-in-view=false # Register OpenSessionInViewInterceptor. Binds a Neo4j Session to the thread for the entire processing of the request.</div><div class="line">spring.data.neo4j.password= # Login password of the server.</div><div class="line">spring.data.neo4j.repositories.enabled=true # Enable Neo4j repositories.</div><div class="line">spring.data.neo4j.uri= # URI used by the driver. Auto-detected by default.</div><div class="line">spring.data.neo4j.username= # Login user of the server.</div><div class="line"></div><div class="line"># DATA REST (RepositoryRestProperties)</div><div class="line">spring.data.rest.base-path= # Base path to be used by Spring Data REST to expose repository resources.</div><div class="line">spring.data.rest.default-page-size= # Default size of pages.</div><div class="line">spring.data.rest.detection-strategy=default # Strategy to use to determine which repositories get exposed.</div><div class="line">spring.data.rest.enable-enum-translation= # Enable enum value translation via the Spring Data REST default resource bundle.</div><div class="line">spring.data.rest.limit-param-name= # Name of the URL query string parameter that indicates how many results to return at once.</div><div class="line">spring.data.rest.max-page-size= # Maximum size of pages.</div><div class="line">spring.data.rest.page-param-name= # Name of the URL query string parameter that indicates what page to return.</div><div class="line">spring.data.rest.return-body-on-create= # Return a response body after creating an entity.</div><div class="line">spring.data.rest.return-body-on-update= # Return a response body after updating an entity.</div><div class="line">spring.data.rest.sort-param-name= # Name of the URL query string parameter that indicates what direction to sort results.</div><div class="line"></div><div class="line"># SOLR (SolrProperties)</div><div class="line">spring.data.solr.host=http://127.0.0.1:8983/solr # Solr host. Ignored if &quot;zk-host&quot; is set.</div><div class="line">spring.data.solr.repositories.enabled=true # Enable Solr repositories.</div><div class="line">spring.data.solr.zk-host= # ZooKeeper host address in the form HOST:PORT.</div><div class="line"></div><div class="line"># DATASOURCE (DataSourceAutoConfiguration &amp; DataSourceProperties)</div><div class="line">spring.datasource.continue-on-error=false # Do not stop if an error occurs while initializing the database.</div><div class="line">spring.datasource.data= # Data (DML) script resource references.</div><div class="line">spring.datasource.data-username= # User of the database to execute DML scripts (if different).</div><div class="line">spring.datasource.data-password= # Password of the database to execute DML scripts (if different).</div><div class="line">spring.datasource.dbcp2.*= # Commons DBCP2 specific settings</div><div class="line">spring.datasource.driver-class-name= # Fully qualified name of the JDBC driver. Auto-detected based on the URL by default.</div><div class="line">spring.datasource.generate-unique-name=false # Generate a random datasource name.</div><div class="line">spring.datasource.hikari.*= # Hikari specific settings</div><div class="line">spring.datasource.initialize=true # Populate the database using &apos;data.sql&apos;.</div><div class="line">spring.datasource.jmx-enabled=false # Enable JMX support (if provided by the underlying pool).</div><div class="line">spring.datasource.jndi-name= # JNDI location of the datasource. Class, url, username &amp; password are ignored when set.</div><div class="line">spring.datasource.name=testdb # Name of the datasource.</div><div class="line">spring.datasource.password= # Login password of the database.</div><div class="line">spring.datasource.platform=all # Platform to use in the schema resource (schema-$&#123;platform&#125;.sql).</div><div class="line">spring.datasource.schema= # Schema (DDL) script resource references.</div><div class="line">spring.datasource.schema-username= # User of the database to execute DDL scripts (if different).</div><div class="line">spring.datasource.schema-password= # Password of the database to execute DDL scripts (if different).</div><div class="line">spring.datasource.separator=; # Statement separator in SQL initialization scripts.</div><div class="line">spring.datasource.sql-script-encoding= # SQL scripts encoding.</div><div class="line">spring.datasource.tomcat.*= # Tomcat datasource specific settings</div><div class="line">spring.datasource.type= # Fully qualified name of the connection pool implementation to use. By default, it is auto-detected from the classpath.</div><div class="line">spring.datasource.url= # JDBC url of the database.</div><div class="line">spring.datasource.username=</div><div class="line"></div><div class="line"># JEST (Elasticsearch HTTP client) (JestProperties)</div><div class="line">spring.elasticsearch.jest.connection-timeout=3000 # Connection timeout in milliseconds.</div><div class="line">spring.elasticsearch.jest.multi-threaded=true # Enable connection requests from multiple execution threads.</div><div class="line">spring.elasticsearch.jest.password= # Login password.</div><div class="line">spring.elasticsearch.jest.proxy.host= # Proxy host the HTTP client should use.</div><div class="line">spring.elasticsearch.jest.proxy.port= # Proxy port the HTTP client should use.</div><div class="line">spring.elasticsearch.jest.read-timeout=3000 # Read timeout in milliseconds.</div><div class="line">spring.elasticsearch.jest.uris=http://localhost:9200 # Comma-separated list of the Elasticsearch instances to use.</div><div class="line">spring.elasticsearch.jest.username= # Login user.</div><div class="line"></div><div class="line"># H2 Web Console (H2ConsoleProperties)</div><div class="line">spring.h2.console.enabled=false # Enable the console.</div><div class="line">spring.h2.console.path=/h2-console # Path at which the console will be available.</div><div class="line">spring.h2.console.settings.trace=false # Enable trace output.</div><div class="line">spring.h2.console.settings.web-allow-others=false # Enable remote access.</div><div class="line"></div><div class="line"># JOOQ (JooqAutoConfiguration)</div><div class="line">spring.jooq.sql-dialect= # SQLDialect JOOQ used when communicating with the configured datasource. For instance `POSTGRES`</div><div class="line"></div><div class="line"># JPA (JpaBaseConfiguration, HibernateJpaAutoConfiguration)</div><div class="line">spring.data.jpa.repositories.enabled=true # Enable JPA repositories.</div><div class="line">spring.jpa.database= # Target database to operate on, auto-detected by default. Can be alternatively set using the &quot;databasePlatform&quot; property.</div><div class="line">spring.jpa.database-platform= # Name of the target database to operate on, auto-detected by default. Can be alternatively set using the &quot;Database&quot; enum.</div><div class="line">spring.jpa.generate-ddl=false # Initialize the schema on startup.</div><div class="line">spring.jpa.hibernate.ddl-auto= # DDL mode. This is actually a shortcut for the &quot;hibernate.hbm2ddl.auto&quot; property. Default to &quot;create-drop&quot; when using an embedded database, &quot;none&quot; otherwise.</div><div class="line">spring.jpa.hibernate.naming.implicit-strategy= # Hibernate 5 implicit naming strategy fully qualified name.</div><div class="line">spring.jpa.hibernate.naming.physical-strategy= # Hibernate 5 physical naming strategy fully qualified name.</div><div class="line">spring.jpa.hibernate.naming.strategy= # Hibernate 4 naming strategy fully qualified name. Not supported with Hibernate 5.</div><div class="line">spring.jpa.hibernate.use-new-id-generator-mappings= # Use Hibernate&apos;s newer IdentifierGenerator for AUTO, TABLE and SEQUENCE.</div><div class="line">spring.jpa.open-in-view=true # Register OpenEntityManagerInViewInterceptor. Binds a JPA EntityManager to the thread for the entire processing of the request.</div><div class="line">spring.jpa.properties.*= # Additional native properties to set on the JPA provider.</div><div class="line">spring.jpa.show-sql=false # Enable logging of SQL statements.</div><div class="line"></div><div class="line"># JTA (JtaAutoConfiguration)</div><div class="line">spring.jta.enabled=true # Enable JTA support.</div><div class="line">spring.jta.log-dir= # Transaction logs directory.</div><div class="line">spring.jta.transaction-manager-id= # Transaction manager unique identifier.</div><div class="line"></div><div class="line"># ATOMIKOS (AtomikosProperties)</div><div class="line">spring.jta.atomikos.connectionfactory.borrow-connection-timeout=30 # Timeout, in seconds, for borrowing connections from the pool.</div><div class="line">spring.jta.atomikos.connectionfactory.ignore-session-transacted-flag=true # Whether or not to ignore the transacted flag when creating session.</div><div class="line">spring.jta.atomikos.connectionfactory.local-transaction-mode=false # Whether or not local transactions are desired.</div><div class="line">spring.jta.atomikos.connectionfactory.maintenance-interval=60 # The time, in seconds, between runs of the pool&apos;s maintenance thread.</div><div class="line">spring.jta.atomikos.connectionfactory.max-idle-time=60 # The time, in seconds, after which connections are cleaned up from the pool.</div><div class="line">spring.jta.atomikos.connectionfactory.max-lifetime=0 # The time, in seconds, that a connection can be pooled for before being destroyed. 0 denotes no limit.</div><div class="line">spring.jta.atomikos.connectionfactory.max-pool-size=1 # The maximum size of the pool.</div><div class="line">spring.jta.atomikos.connectionfactory.min-pool-size=1 # The minimum size of the pool.</div><div class="line">spring.jta.atomikos.connectionfactory.reap-timeout=0 # The reap timeout, in seconds, for borrowed connections. 0 denotes no limit.</div><div class="line">spring.jta.atomikos.connectionfactory.unique-resource-name=jmsConnectionFactory # The unique name used to identify the resource during recovery.</div><div class="line">spring.jta.atomikos.datasource.borrow-connection-timeout=30 # Timeout, in seconds, for borrowing connections from the pool.</div><div class="line">spring.jta.atomikos.datasource.default-isolation-level= # Default isolation level of connections provided by the pool.</div><div class="line">spring.jta.atomikos.datasource.login-timeout= # Timeout, in seconds, for establishing a database connection.</div><div class="line">spring.jta.atomikos.datasource.maintenance-interval=60 # The time, in seconds, between runs of the pool&apos;s maintenance thread.</div><div class="line">spring.jta.atomikos.datasource.max-idle-time=60 # The time, in seconds, after which connections are cleaned up from the pool.</div><div class="line">spring.jta.atomikos.datasource.max-lifetime=0 # The time, in seconds, that a connection can be pooled for before being destroyed. 0 denotes no limit.</div><div class="line">spring.jta.atomikos.datasource.max-pool-size=1 # The maximum size of the pool.</div><div class="line">spring.jta.atomikos.datasource.min-pool-size=1 # The minimum size of the pool.</div><div class="line">spring.jta.atomikos.datasource.reap-timeout=0 # The reap timeout, in seconds, for borrowed connections. 0 denotes no limit.</div><div class="line">spring.jta.atomikos.datasource.test-query= # SQL query or statement used to validate a connection before returning it.</div><div class="line">spring.jta.atomikos.datasource.unique-resource-name=dataSource # The unique name used to identify the resource during recovery.</div><div class="line">spring.jta.atomikos.properties.checkpoint-interval=500 # Interval between checkpoints.</div><div class="line">spring.jta.atomikos.properties.console-file-count=1 # Number of debug logs files that can be created.</div><div class="line">spring.jta.atomikos.properties.console-file-limit=-1 # How many bytes can be stored at most in debug logs files.</div><div class="line">spring.jta.atomikos.properties.console-file-name=tm.out # Debug logs file name.</div><div class="line">spring.jta.atomikos.properties.console-log-level=warn # Console log level.</div><div class="line">spring.jta.atomikos.properties.default-jta-timeout=10000 # Default timeout for JTA transactions.</div><div class="line">spring.jta.atomikos.properties.enable-logging=true # Enable disk logging.</div><div class="line">spring.jta.atomikos.properties.force-shutdown-on-vm-exit=false # Specify if a VM shutdown should trigger forced shutdown of the transaction core.</div><div class="line">spring.jta.atomikos.properties.log-base-dir= # Directory in which the log files should be stored.</div><div class="line">spring.jta.atomikos.properties.log-base-name=tmlog # Transactions log file base name.</div><div class="line">spring.jta.atomikos.properties.max-actives=50 # Maximum number of active transactions.</div><div class="line">spring.jta.atomikos.properties.max-timeout=300000 # Maximum timeout (in milliseconds) that can be allowed for transactions.</div><div class="line">spring.jta.atomikos.properties.output-dir= # Directory in which to store the debug log files.</div><div class="line">spring.jta.atomikos.properties.serial-jta-transactions=true # Specify if sub-transactions should be joined when possible.</div><div class="line">spring.jta.atomikos.properties.service= # Transaction manager implementation that should be started.</div><div class="line">spring.jta.atomikos.properties.threaded-two-phase-commit=true # Use different (and concurrent) threads for two-phase commit on the participating resources.</div><div class="line">spring.jta.atomikos.properties.transaction-manager-unique-name= # Transaction manager&apos;s unique name.</div><div class="line"></div><div class="line"># BITRONIX</div><div class="line">spring.jta.bitronix.connectionfactory.acquire-increment=1 # Number of connections to create when growing the pool.</div><div class="line">spring.jta.bitronix.connectionfactory.acquisition-interval=1 # Time, in seconds, to wait before trying to acquire a connection again after an invalid connection was acquired.</div><div class="line">spring.jta.bitronix.connectionfactory.acquisition-timeout=30 # Timeout, in seconds, for acquiring connections from the pool.</div><div class="line">spring.jta.bitronix.connectionfactory.allow-local-transactions=true # Whether or not the transaction manager should allow mixing XA and non-XA transactions.</div><div class="line">spring.jta.bitronix.connectionfactory.apply-transaction-timeout=false # Whether or not the transaction timeout should be set on the XAResource when it is enlisted.</div><div class="line">spring.jta.bitronix.connectionfactory.automatic-enlisting-enabled=true # Whether or not resources should be enlisted and delisted automatically.</div><div class="line">spring.jta.bitronix.connectionfactory.cache-producers-consumers=true # Whether or not produces and consumers should be cached.</div><div class="line">spring.jta.bitronix.connectionfactory.defer-connection-release=true # Whether or not the provider can run many transactions on the same connection and supports transaction interleaving.</div><div class="line">spring.jta.bitronix.connectionfactory.ignore-recovery-failures=false # Whether or not recovery failures should be ignored.</div><div class="line">spring.jta.bitronix.connectionfactory.max-idle-time=60 # The time, in seconds, after which connections are cleaned up from the pool.</div><div class="line">spring.jta.bitronix.connectionfactory.max-pool-size=10 # The maximum size of the pool. 0 denotes no limit.</div><div class="line">spring.jta.bitronix.connectionfactory.min-pool-size=0 # The minimum size of the pool.</div><div class="line">spring.jta.bitronix.connectionfactory.password= # The password to use to connect to the JMS provider.</div><div class="line">spring.jta.bitronix.connectionfactory.share-transaction-connections=false #  Whether or not connections in the ACCESSIBLE state can be shared within the context of a transaction.</div><div class="line">spring.jta.bitronix.connectionfactory.test-connections=true # Whether or not connections should be tested when acquired from the pool.</div><div class="line">spring.jta.bitronix.connectionfactory.two-pc-ordering-position=1 # The position that this resource should take during two-phase commit (always first is Integer.MIN_VALUE, always last is Integer.MAX_VALUE).</div><div class="line">spring.jta.bitronix.connectionfactory.unique-name=jmsConnectionFactory # The unique name used to identify the resource during recovery.</div><div class="line">spring.jta.bitronix.connectionfactory.use-tm-join=true Whether or not TMJOIN should be used when starting XAResources.</div><div class="line">spring.jta.bitronix.connectionfactory.user= # The user to use to connect to the JMS provider.</div><div class="line">spring.jta.bitronix.datasource.acquire-increment=1 # Number of connections to create when growing the pool.</div><div class="line">spring.jta.bitronix.datasource.acquisition-interval=1 # Time, in seconds, to wait before trying to acquire a connection again after an invalid connection was acquired.</div><div class="line">spring.jta.bitronix.datasource.acquisition-timeout=30 # Timeout, in seconds, for acquiring connections from the pool.</div><div class="line">spring.jta.bitronix.datasource.allow-local-transactions=true # Whether or not the transaction manager should allow mixing XA and non-XA transactions.</div><div class="line">spring.jta.bitronix.datasource.apply-transaction-timeout=false # Whether or not the transaction timeout should be set on the XAResource when it is enlisted.</div><div class="line">spring.jta.bitronix.datasource.automatic-enlisting-enabled=true # Whether or not resources should be enlisted and delisted automatically.</div><div class="line">spring.jta.bitronix.datasource.cursor-holdability= # The default cursor holdability for connections.</div><div class="line">spring.jta.bitronix.datasource.defer-connection-release=true # Whether or not the database can run many transactions on the same connection and supports transaction interleaving.</div><div class="line">spring.jta.bitronix.datasource.enable-jdbc4-connection-test= # Whether or not Connection.isValid() is called when acquiring a connection from the pool.</div><div class="line">spring.jta.bitronix.datasource.ignore-recovery-failures=false # Whether or not recovery failures should be ignored.</div><div class="line">spring.jta.bitronix.datasource.isolation-level= # The default isolation level for connections.</div><div class="line">spring.jta.bitronix.datasource.local-auto-commit= # The default auto-commit mode for local transactions.</div><div class="line">spring.jta.bitronix.datasource.login-timeout= # Timeout, in seconds, for establishing a database connection.</div><div class="line">spring.jta.bitronix.datasource.max-idle-time=60 # The time, in seconds, after which connections are cleaned up from the pool.</div><div class="line">spring.jta.bitronix.datasource.max-pool-size=10 # The maximum size of the pool. 0 denotes no limit.</div><div class="line">spring.jta.bitronix.datasource.min-pool-size=0 # The minimum size of the pool.</div><div class="line">spring.jta.bitronix.datasource.prepared-statement-cache-size=0 # The target size of the prepared statement cache. 0 disables the cache.</div><div class="line">spring.jta.bitronix.datasource.share-transaction-connections=false #  Whether or not connections in the ACCESSIBLE state can be shared within the context of a transaction.</div><div class="line">spring.jta.bitronix.datasource.test-query= # SQL query or statement used to validate a connection before returning it.</div><div class="line">spring.jta.bitronix.datasource.two-pc-ordering-position=1 # The position that this resource should take during two-phase commit (always first is Integer.MIN_VALUE, always last is Integer.MAX_VALUE).</div><div class="line">spring.jta.bitronix.datasource.unique-name=dataSource # The unique name used to identify the resource during recovery.</div><div class="line">spring.jta.bitronix.datasource.use-tm-join=true Whether or not TMJOIN should be used when starting XAResources.</div><div class="line">spring.jta.bitronix.properties.allow-multiple-lrc=false # Allow multiple LRC resources to be enlisted into the same transaction.</div><div class="line">spring.jta.bitronix.properties.asynchronous2-pc=false # Enable asynchronously execution of two phase commit.</div><div class="line">spring.jta.bitronix.properties.background-recovery-interval-seconds=60 # Interval in seconds at which to run the recovery process in the background.</div><div class="line">spring.jta.bitronix.properties.current-node-only-recovery=true # Recover only the current node.</div><div class="line">spring.jta.bitronix.properties.debug-zero-resource-transaction=false # Log the creation and commit call stacks of transactions executed without a single enlisted resource.</div><div class="line">spring.jta.bitronix.properties.default-transaction-timeout=60 # Default transaction timeout in seconds.</div><div class="line">spring.jta.bitronix.properties.disable-jmx=false # Enable JMX support.</div><div class="line">spring.jta.bitronix.properties.exception-analyzer= # Set the fully qualified name of the exception analyzer implementation to use.</div><div class="line">spring.jta.bitronix.properties.filter-log-status=false # Enable filtering of logs so that only mandatory logs are written.</div><div class="line">spring.jta.bitronix.properties.force-batching-enabled=true #  Set if disk forces are batched.</div><div class="line">spring.jta.bitronix.properties.forced-write-enabled=true # Set if logs are forced to disk.</div><div class="line">spring.jta.bitronix.properties.graceful-shutdown-interval=60 # Maximum amount of seconds the TM will wait for transactions to get done before aborting them at shutdown time.</div><div class="line">spring.jta.bitronix.properties.jndi-transaction-synchronization-registry-name= # JNDI name of the TransactionSynchronizationRegistry.</div><div class="line">spring.jta.bitronix.properties.jndi-user-transaction-name= # JNDI name of the UserTransaction.</div><div class="line">spring.jta.bitronix.properties.journal=disk # Name of the journal. Can be &apos;disk&apos;, &apos;null&apos; or a class name.</div><div class="line">spring.jta.bitronix.properties.log-part1-filename=btm1.tlog # Name of the first fragment of the journal.</div><div class="line">spring.jta.bitronix.properties.log-part2-filename=btm2.tlog # Name of the second fragment of the journal.</div><div class="line">spring.jta.bitronix.properties.max-log-size-in-mb=2 # Maximum size in megabytes of the journal fragments.</div><div class="line">spring.jta.bitronix.properties.resource-configuration-filename= # ResourceLoader configuration file name.</div><div class="line">spring.jta.bitronix.properties.server-id= # ASCII ID that must uniquely identify this TM instance. Default to the machine&apos;s IP address.</div><div class="line">spring.jta.bitronix.properties.skip-corrupted-logs=false # Skip corrupted transactions log entries.</div><div class="line">spring.jta.bitronix.properties.warn-about-zero-resource-transaction=true # Log a warning for transactions executed without a single enlisted resource.</div><div class="line"></div><div class="line"># NARAYANA (NarayanaProperties)</div><div class="line">spring.jta.narayana.default-timeout=60 # Transaction timeout in seconds.</div><div class="line">spring.jta.narayana.expiry-scanners=com.arjuna.ats.internal.arjuna.recovery.ExpiredTransactionStatusManagerScanner # Comma-separated list of expiry scanners.</div><div class="line">spring.jta.narayana.log-dir= # Transaction object store directory.</div><div class="line">spring.jta.narayana.one-phase-commit=true # Enable one phase commit optimisation.</div><div class="line">spring.jta.narayana.periodic-recovery-period=120 # Interval in which periodic recovery scans are performed in seconds.</div><div class="line">spring.jta.narayana.recovery-backoff-period=10 # Back off period between first and second phases of the recovery scan in seconds.</div><div class="line">spring.jta.narayana.recovery-db-pass= # Database password to be used by recovery manager.</div><div class="line">spring.jta.narayana.recovery-db-user= # Database username to be used by recovery manager.</div><div class="line">spring.jta.narayana.recovery-jms-pass= # JMS password to be used by recovery manager.</div><div class="line">spring.jta.narayana.recovery-jms-user= # JMS username to be used by recovery manager.</div><div class="line">spring.jta.narayana.recovery-modules= # Comma-separated list of recovery modules.</div><div class="line">spring.jta.narayana.transaction-manager-id=1 # Unique transaction manager id.</div><div class="line">spring.jta.narayana.xa-resource-orphan-filters= # Comma-separated list of orphan filters.</div><div class="line"></div><div class="line"># EMBEDDED MONGODB (EmbeddedMongoProperties)</div><div class="line">spring.mongodb.embedded.features=SYNC_DELAY # Comma-separated list of features to enable.</div><div class="line">spring.mongodb.embedded.storage.database-dir= # Directory used for data storage.</div><div class="line">spring.mongodb.embedded.storage.oplog-size= # Maximum size of the oplog in megabytes.</div><div class="line">spring.mongodb.embedded.storage.repl-set-name= # Name of the replica set.</div><div class="line">spring.mongodb.embedded.version=2.6.10 # Version of Mongo to use.</div><div class="line"></div><div class="line"># REDIS (RedisProperties)</div><div class="line">spring.redis.cluster.max-redirects= # Maximum number of redirects to follow when executing commands across the cluster.</div><div class="line">spring.redis.cluster.nodes= # Comma-separated list of &quot;host:port&quot; pairs to bootstrap from.</div><div class="line">spring.redis.database=0 # Database index used by the connection factory.</div><div class="line">spring.redis.url= # Connection URL, will override host, port and password (user will be ignored), e.g. redis://user:password@example.com:6379</div><div class="line">spring.redis.host=localhost # Redis server host.</div><div class="line">spring.redis.password= # Login password of the redis server.</div><div class="line">spring.redis.ssl=false # Enable SSL support.</div><div class="line">spring.redis.pool.max-active=8 # Max number of connections that can be allocated by the pool at a given time. Use a negative value for no limit.</div><div class="line">spring.redis.pool.max-idle=8 # Max number of &quot;idle&quot; connections in the pool. Use a negative value to indicate an unlimited number of idle connections.</div><div class="line">spring.redis.pool.max-wait=-1 # Maximum amount of time (in milliseconds) a connection allocation should block before throwing an exception when the pool is exhausted. Use a negative value to block indefinitely.</div><div class="line">spring.redis.pool.min-idle=0 # Target for the minimum number of idle connections to maintain in the pool. This setting only has an effect if it is positive.</div><div class="line">spring.redis.port=6379 # Redis server port.</div><div class="line">spring.redis.sentinel.master= # Name of Redis server.</div><div class="line">spring.redis.sentinel.nodes= # Comma-separated list of host:port pairs.</div><div class="line">spring.redis.timeout=0 # Connection timeout in milliseconds.</div><div class="line"></div><div class="line"># TRANSACTION (TransactionProperties)</div><div class="line">spring.transaction.default-timeout= # Default transaction timeout in seconds.</div><div class="line">spring.transaction.rollback-on-commit-failure= # Perform the rollback on commit failures.</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># ----------------------------------------</div><div class="line"># INTEGRATION PROPERTIES</div><div class="line"># ----------------------------------------</div><div class="line"></div><div class="line"># ACTIVEMQ (ActiveMQProperties)</div><div class="line">spring.activemq.broker-url= # URL of the ActiveMQ broker. Auto-generated by default. For instance `tcp://localhost:61616`</div><div class="line">spring.activemq.in-memory=true # Specify if the default broker URL should be in memory. Ignored if an explicit broker has been specified.</div><div class="line">spring.activemq.password= # Login password of the broker.</div><div class="line">spring.activemq.user= # Login user of the broker.</div><div class="line">spring.activemq.packages.trust-all=false # Trust all packages.</div><div class="line">spring.activemq.packages.trusted= # Comma-separated list of specific packages to trust (when not trusting all packages).</div><div class="line">spring.activemq.pool.configuration.*= # See PooledConnectionFactory.</div><div class="line">spring.activemq.pool.enabled=false # Whether a PooledConnectionFactory should be created instead of a regular ConnectionFactory.</div><div class="line">spring.activemq.pool.expiry-timeout=0 # Connection expiration timeout in milliseconds.</div><div class="line">spring.activemq.pool.idle-timeout=30000 # Connection idle timeout in milliseconds.</div><div class="line">spring.activemq.pool.max-connections=1 # Maximum number of pooled connections.</div><div class="line"></div><div class="line"># ARTEMIS (ArtemisProperties)</div><div class="line">spring.artemis.embedded.cluster-password= # Cluster password. Randomly generated on startup by default.</div><div class="line">spring.artemis.embedded.data-directory= # Journal file directory. Not necessary if persistence is turned off.</div><div class="line">spring.artemis.embedded.enabled=true # Enable embedded mode if the Artemis server APIs are available.</div><div class="line">spring.artemis.embedded.persistent=false # Enable persistent store.</div><div class="line">spring.artemis.embedded.queues= # Comma-separated list of queues to create on startup.</div><div class="line">spring.artemis.embedded.server-id= # Server id. By default, an auto-incremented counter is used.</div><div class="line">spring.artemis.embedded.topics= # Comma-separated list of topics to create on startup.</div><div class="line">spring.artemis.host=localhost # Artemis broker host.</div><div class="line">spring.artemis.mode= # Artemis deployment mode, auto-detected by default.</div><div class="line">spring.artemis.password= # Login password of the broker.</div><div class="line">spring.artemis.port=61616 # Artemis broker port.</div><div class="line">spring.artemis.user= # Login user of the broker.</div><div class="line"></div><div class="line"># SPRING BATCH (BatchProperties)</div><div class="line">spring.batch.initializer.enabled= # Create the required batch tables on startup if necessary. Enabled automatically if no custom table prefix is set or if a custom schema is configured.</div><div class="line">spring.batch.job.enabled=true # Execute all Spring Batch jobs in the context on startup.</div><div class="line">spring.batch.job.names= # Comma-separated list of job names to execute on startup (For instance `job1,job2`). By default, all Jobs found in the context are executed.</div><div class="line">spring.batch.schema=classpath:org/springframework/batch/core/schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema.</div><div class="line">spring.batch.table-prefix= # Table prefix for all the batch meta-data tables.</div><div class="line"></div><div class="line"># JMS (JmsProperties)</div><div class="line">spring.jms.jndi-name= # Connection factory JNDI name. When set, takes precedence to others connection factory auto-configurations.</div><div class="line">spring.jms.listener.acknowledge-mode= # Acknowledge mode of the container. By default, the listener is transacted with automatic acknowledgment.</div><div class="line">spring.jms.listener.auto-startup=true # Start the container automatically on startup.</div><div class="line">spring.jms.listener.concurrency= # Minimum number of concurrent consumers.</div><div class="line">spring.jms.listener.max-concurrency= # Maximum number of concurrent consumers.</div><div class="line">spring.jms.pub-sub-domain=false # Specify if the default destination type is topic.</div><div class="line">spring.jms.template.default-destination= # Default destination to use on send/receive operations that do not have a destination parameter.</div><div class="line">spring.jms.template.delivery-delay= # Delivery delay to use for send calls in milliseconds.</div><div class="line">spring.jms.template.delivery-mode= # Delivery mode. Enable QoS when set.</div><div class="line">spring.jms.template.priority= # Priority of a message when sending. Enable QoS when set.</div><div class="line">spring.jms.template.qos-enabled= # Enable explicit QoS when sending a message.</div><div class="line">spring.jms.template.receive-timeout= # Timeout to use for receive calls in milliseconds.</div><div class="line">spring.jms.template.time-to-live= # Time-to-live of a message when sending in milliseconds. Enable QoS when set.</div><div class="line"></div><div class="line"># APACHE KAFKA (KafkaProperties)</div><div class="line">spring.kafka.bootstrap-servers= # Comma-delimited list of host:port pairs to use for establishing the initial connection to the Kafka cluster.</div><div class="line">spring.kafka.client-id= # Id to pass to the server when making requests; used for server-side logging.</div><div class="line">spring.kafka.consumer.auto-commit-interval= # Frequency in milliseconds that the consumer offsets are auto-committed to Kafka if &apos;enable.auto.commit&apos; true.</div><div class="line">spring.kafka.consumer.auto-offset-reset= # What to do when there is no initial offset in Kafka or if the current offset does not exist any more on the server.</div><div class="line">spring.kafka.consumer.bootstrap-servers= # Comma-delimited list of host:port pairs to use for establishing the initial connection to the Kafka cluster.</div><div class="line">spring.kafka.consumer.client-id= # Id to pass to the server when making requests; used for server-side logging.</div><div class="line">spring.kafka.consumer.enable-auto-commit= # If true the consumer&apos;s offset will be periodically committed in the background.</div><div class="line">spring.kafka.consumer.fetch-max-wait= # Maximum amount of time in milliseconds the server will block before answering the fetch request if there isn&apos;t sufficient data to immediately satisfy the requirement given by &quot;fetch.min.bytes&quot;.</div><div class="line">spring.kafka.consumer.fetch-min-size= # Minimum amount of data the server should return for a fetch request in bytes.</div><div class="line">spring.kafka.consumer.group-id= # Unique string that identifies the consumer group this consumer belongs to.</div><div class="line">spring.kafka.consumer.heartbeat-interval= # Expected time in milliseconds between heartbeats to the consumer coordinator.</div><div class="line">spring.kafka.consumer.key-deserializer= # Deserializer class for keys.</div><div class="line">spring.kafka.consumer.max-poll-records= # Maximum number of records returned in a single call to poll().</div><div class="line">spring.kafka.consumer.value-deserializer= # Deserializer class for values.</div><div class="line">spring.kafka.listener.ack-count= # Number of records between offset commits when ackMode is &quot;COUNT&quot; or &quot;COUNT_TIME&quot;.</div><div class="line">spring.kafka.listener.ack-mode= # Listener AckMode; see the spring-kafka documentation.</div><div class="line">spring.kafka.listener.ack-time= # Time in milliseconds between offset commits when ackMode is &quot;TIME&quot; or &quot;COUNT_TIME&quot;.</div><div class="line">spring.kafka.listener.concurrency= # Number of threads to run in the listener containers.</div><div class="line">spring.kafka.listener.poll-timeout= # Timeout in milliseconds to use when polling the consumer.</div><div class="line">spring.kafka.producer.acks= # Number of acknowledgments the producer requires the leader to have received before considering a request complete.</div><div class="line">spring.kafka.producer.batch-size= # Number of records to batch before sending.</div><div class="line">spring.kafka.producer.bootstrap-servers= # Comma-delimited list of host:port pairs to use for establishing the initial connection to the Kafka cluster.</div><div class="line">spring.kafka.producer.buffer-memory= # Total bytes of memory the producer can use to buffer records waiting to be sent to the server.</div><div class="line">spring.kafka.producer.client-id= # Id to pass to the server when making requests; used for server-side logging.</div><div class="line">spring.kafka.producer.compression-type= # Compression type for all data generated by the producer.</div><div class="line">spring.kafka.producer.key-serializer= # Serializer class for keys.</div><div class="line">spring.kafka.producer.retries= # When greater than zero, enables retrying of failed sends.</div><div class="line">spring.kafka.producer.value-serializer= # Serializer class for values.</div><div class="line">spring.kafka.properties.*= # Additional properties used to configure the client.</div><div class="line">spring.kafka.ssl.key-password= # Password of the private key in the key store file.</div><div class="line">spring.kafka.ssl.keystore-location= # Location of the key store file.</div><div class="line">spring.kafka.ssl.keystore-password= # Store password for the key store file.</div><div class="line">spring.kafka.ssl.truststore-location= # Location of the trust store file.</div><div class="line">spring.kafka.ssl.truststore-password= # Store password for the trust store file.</div><div class="line">spring.kafka.template.default-topic= # Default topic to which messages will be sent.</div><div class="line"></div><div class="line"># RABBIT (RabbitProperties)</div><div class="line">spring.rabbitmq.addresses= # Comma-separated list of addresses to which the client should connect.</div><div class="line">spring.rabbitmq.cache.channel.checkout-timeout= # Number of milliseconds to wait to obtain a channel if the cache size has been reached.</div><div class="line">spring.rabbitmq.cache.channel.size= # Number of channels to retain in the cache.</div><div class="line">spring.rabbitmq.cache.connection.mode=channel # Connection factory cache mode.</div><div class="line">spring.rabbitmq.cache.connection.size= # Number of connections to cache.</div><div class="line">spring.rabbitmq.connection-timeout= # Connection timeout, in milliseconds; zero for infinite.</div><div class="line">spring.rabbitmq.dynamic=true # Create an AmqpAdmin bean.</div><div class="line">spring.rabbitmq.host=localhost # RabbitMQ host.</div><div class="line">spring.rabbitmq.listener.acknowledge-mode= # Acknowledge mode of container.</div><div class="line">spring.rabbitmq.listener.auto-startup=true # Start the container automatically on startup.</div><div class="line">spring.rabbitmq.listener.concurrency= # Minimum number of consumers.</div><div class="line">spring.rabbitmq.listener.default-requeue-rejected= # Whether or not to requeue delivery failures; default `true`.</div><div class="line">spring.rabbitmq.listener.idle-event-interval= # How often idle container events should be published in milliseconds.</div><div class="line">spring.rabbitmq.listener.max-concurrency= # Maximum number of consumers.</div><div class="line">spring.rabbitmq.listener.prefetch= # Number of messages to be handled in a single request. It should be greater than or equal to the transaction size (if used).</div><div class="line">spring.rabbitmq.listener.retry.enabled=false # Whether or not publishing retries are enabled.</div><div class="line">spring.rabbitmq.listener.retry.initial-interval=1000 # Interval between the first and second attempt to deliver a message.</div><div class="line">spring.rabbitmq.listener.retry.max-attempts=3 # Maximum number of attempts to deliver a message.</div><div class="line">spring.rabbitmq.listener.retry.max-interval=10000 # Maximum interval between attempts.</div><div class="line">spring.rabbitmq.listener.retry.multiplier=1.0 # A multiplier to apply to the previous delivery retry interval.</div><div class="line">spring.rabbitmq.listener.retry.stateless=true # Whether or not retry is stateless or stateful.</div><div class="line">spring.rabbitmq.listener.transaction-size= # Number of messages to be processed in a transaction. For best results it should be less than or equal to the prefetch count.</div><div class="line">spring.rabbitmq.password= # Login to authenticate against the broker.</div><div class="line">spring.rabbitmq.port=5672 # RabbitMQ port.</div><div class="line">spring.rabbitmq.publisher-confirms=false # Enable publisher confirms.</div><div class="line">spring.rabbitmq.publisher-returns=false # Enable publisher returns.</div><div class="line">spring.rabbitmq.requested-heartbeat= # Requested heartbeat timeout, in seconds; zero for none.</div><div class="line">spring.rabbitmq.ssl.enabled=false # Enable SSL support.</div><div class="line">spring.rabbitmq.ssl.key-store= # Path to the key store that holds the SSL certificate.</div><div class="line">spring.rabbitmq.ssl.key-store-password= # Password used to access the key store.</div><div class="line">spring.rabbitmq.ssl.trust-store= # Trust store that holds SSL certificates.</div><div class="line">spring.rabbitmq.ssl.trust-store-password= # Password used to access the trust store.</div><div class="line">spring.rabbitmq.ssl.algorithm= # SSL algorithm to use. By default configure by the rabbit client library.</div><div class="line">spring.rabbitmq.template.mandatory=false # Enable mandatory messages.</div><div class="line">spring.rabbitmq.template.receive-timeout=0 # Timeout for `receive()` methods.</div><div class="line">spring.rabbitmq.template.reply-timeout=5000 # Timeout for `sendAndReceive()` methods.</div><div class="line">spring.rabbitmq.template.retry.enabled=false # Set to true to enable retries in the `RabbitTemplate`.</div><div class="line">spring.rabbitmq.template.retry.initial-interval=1000 # Interval between the first and second attempt to publish a message.</div><div class="line">spring.rabbitmq.template.retry.max-attempts=3 # Maximum number of attempts to publish a message.</div><div class="line">spring.rabbitmq.template.retry.max-interval=10000 # Maximum number of attempts to publish a message.</div><div class="line">spring.rabbitmq.template.retry.multiplier=1.0 # A multiplier to apply to the previous publishing retry interval.</div><div class="line">spring.rabbitmq.username= # Login user to authenticate to the broker.</div><div class="line">spring.rabbitmq.virtual-host= # Virtual host to use when connecting to the broker.</div><div class="line"></div><div class="line"></div><div class="line"># ----------------------------------------</div><div class="line"># ACTUATOR PROPERTIES</div><div class="line"># ----------------------------------------</div><div class="line"></div><div class="line"># ENDPOINTS (AbstractEndpoint subclasses)</div><div class="line">endpoints.enabled=true # Enable endpoints.</div><div class="line">endpoints.sensitive= # Default endpoint sensitive setting.</div><div class="line">endpoints.actuator.enabled=true # Enable the endpoint.</div><div class="line">endpoints.actuator.path= # Endpoint URL path.</div><div class="line">endpoints.actuator.sensitive=false # Enable security on the endpoint.</div><div class="line">endpoints.auditevents.enabled= # Enable the endpoint.</div><div class="line">endpoints.auditevents.path= # Endpoint path.</div><div class="line">endpoints.auditevents.sensitive=false # Enable security on the endpoint.</div><div class="line">endpoints.autoconfig.enabled= # Enable the endpoint.</div><div class="line">endpoints.autoconfig.id= # Endpoint identifier.</div><div class="line">endpoints.autoconfig.path= # Endpoint path.</div><div class="line">endpoints.autoconfig.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.beans.enabled= # Enable the endpoint.</div><div class="line">endpoints.beans.id= # Endpoint identifier.</div><div class="line">endpoints.beans.path= # Endpoint path.</div><div class="line">endpoints.beans.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.configprops.enabled= # Enable the endpoint.</div><div class="line">endpoints.configprops.id= # Endpoint identifier.</div><div class="line">endpoints.configprops.keys-to-sanitize=password,secret,key,token,.*credentials.*,vcap_services # Keys that should be sanitized. Keys can be simple strings that the property ends with or regex expressions.</div><div class="line">endpoints.configprops.path= # Endpoint path.</div><div class="line">endpoints.configprops.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.docs.curies.enabled=false # Enable the curie generation.</div><div class="line">endpoints.docs.enabled=true # Enable actuator docs endpoint.</div><div class="line">endpoints.docs.path=/docs #</div><div class="line">endpoints.docs.sensitive=false #</div><div class="line">endpoints.dump.enabled= # Enable the endpoint.</div><div class="line">endpoints.dump.id= # Endpoint identifier.</div><div class="line">endpoints.dump.path= # Endpoint path.</div><div class="line">endpoints.dump.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.env.enabled= # Enable the endpoint.</div><div class="line">endpoints.env.id= # Endpoint identifier.</div><div class="line">endpoints.env.keys-to-sanitize=password,secret,key,token,.*credentials.*,vcap_services # Keys that should be sanitized. Keys can be simple strings that the property ends with or regex expressions.</div><div class="line">endpoints.env.path= # Endpoint path.</div><div class="line">endpoints.env.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.flyway.enabled= # Enable the endpoint.</div><div class="line">endpoints.flyway.id= # Endpoint identifier.</div><div class="line">endpoints.flyway.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.health.enabled= # Enable the endpoint.</div><div class="line">endpoints.health.id= # Endpoint identifier.</div><div class="line">endpoints.health.mapping.*= # Mapping of health statuses to HttpStatus codes. By default, registered health statuses map to sensible defaults (i.e. UP maps to 200).</div><div class="line">endpoints.health.path= # Endpoint path.</div><div class="line">endpoints.health.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.health.time-to-live=1000 # Time to live for cached result, in milliseconds.</div><div class="line">endpoints.heapdump.enabled= # Enable the endpoint.</div><div class="line">endpoints.heapdump.path= # Endpoint path.</div><div class="line">endpoints.heapdump.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.hypermedia.enabled=false # Enable hypermedia support for endpoints.</div><div class="line">endpoints.info.enabled= # Enable the endpoint.</div><div class="line">endpoints.info.id= # Endpoint identifier.</div><div class="line">endpoints.info.path= # Endpoint path.</div><div class="line">endpoints.info.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.jolokia.enabled=true # Enable Jolokia endpoint.</div><div class="line">endpoints.jolokia.path=/jolokia # Endpoint URL path.</div><div class="line">endpoints.jolokia.sensitive=true # Enable security on the endpoint.</div><div class="line">endpoints.liquibase.enabled= # Enable the endpoint.</div><div class="line">endpoints.liquibase.id= # Endpoint identifier.</div><div class="line">endpoints.liquibase.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.logfile.enabled=true # Enable the endpoint.</div><div class="line">endpoints.logfile.external-file= # External Logfile to be accessed.</div><div class="line">endpoints.logfile.path=/logfile # Endpoint URL path.</div><div class="line">endpoints.logfile.sensitive=true # Enable security on the endpoint.</div><div class="line">endpoints.loggers.enabled=true # Enable the endpoint.</div><div class="line">endpoints.loggers.id= # Endpoint identifier.</div><div class="line">endpoints.loggers.path=/logfile # Endpoint path.</div><div class="line">endpoints.loggers.sensitive=true # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.mappings.enabled= # Enable the endpoint.</div><div class="line">endpoints.mappings.id= # Endpoint identifier.</div><div class="line">endpoints.mappings.path= # Endpoint path.</div><div class="line">endpoints.mappings.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.metrics.enabled= # Enable the endpoint.</div><div class="line">endpoints.metrics.filter.enabled=true # Enable the metrics servlet filter.</div><div class="line">endpoints.metrics.filter.gauge-submissions=merged # Http filter gauge submissions (merged, per-http-method)</div><div class="line">endpoints.metrics.filter.counter-submissions=merged # Http filter counter submissions (merged, per-http-method)</div><div class="line">endpoints.metrics.id= # Endpoint identifier.</div><div class="line">endpoints.metrics.path= # Endpoint path.</div><div class="line">endpoints.metrics.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.shutdown.enabled= # Enable the endpoint.</div><div class="line">endpoints.shutdown.id= # Endpoint identifier.</div><div class="line">endpoints.shutdown.path= # Endpoint path.</div><div class="line">endpoints.shutdown.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line">endpoints.trace.enabled= # Enable the endpoint.</div><div class="line">endpoints.trace.id= # Endpoint identifier.</div><div class="line">endpoints.trace.path= # Endpoint path.</div><div class="line">endpoints.trace.sensitive= # Mark if the endpoint exposes sensitive information.</div><div class="line"></div><div class="line"># ENDPOINTS CORS CONFIGURATION (EndpointCorsProperties)</div><div class="line">endpoints.cors.allow-credentials= # Set whether credentials are supported. When not set, credentials are not supported.</div><div class="line">endpoints.cors.allowed-headers= # Comma-separated list of headers to allow in a request. &apos;*&apos; allows all headers.</div><div class="line">endpoints.cors.allowed-methods=GET # Comma-separated list of methods to allow. &apos;*&apos; allows all methods.</div><div class="line">endpoints.cors.allowed-origins= # Comma-separated list of origins to allow. &apos;*&apos; allows all origins. When not set, CORS support is disabled.</div><div class="line">endpoints.cors.exposed-headers= # Comma-separated list of headers to include in a response.</div><div class="line">endpoints.cors.max-age=1800 # How long, in seconds, the response from a pre-flight request can be cached by clients.</div><div class="line"></div><div class="line"># JMX ENDPOINT (EndpointMBeanExportProperties)</div><div class="line">endpoints.jmx.domain= # JMX domain name. Initialized with the value of &apos;spring.jmx.default-domain&apos; if set.</div><div class="line">endpoints.jmx.enabled=true # Enable JMX export of all endpoints.</div><div class="line">endpoints.jmx.static-names= # Additional static properties to append to all ObjectNames of MBeans representing Endpoints.</div><div class="line">endpoints.jmx.unique-names=false # Ensure that ObjectNames are modified in case of conflict.</div><div class="line"></div><div class="line"># JOLOKIA (JolokiaProperties)</div><div class="line">jolokia.config.*= # See Jolokia manual</div><div class="line"></div><div class="line"># MANAGEMENT HTTP SERVER (ManagementServerProperties)</div><div class="line">management.add-application-context-header=true # Add the &quot;X-Application-Context&quot; HTTP header in each response.</div><div class="line">management.address= # Network address that the management endpoints should bind to.</div><div class="line">management.context-path= # Management endpoint context-path. For instance `/actuator`</div><div class="line">management.cloudfoundry.enabled= # Enable extended Cloud Foundry actuator endpoints</div><div class="line">management.cloudfoundry.skip-ssl-validation= # Skip SSL verification for Cloud Foundry actuator endpoint security calls</div><div class="line">management.port= # Management endpoint HTTP port. Uses the same port as the application by default. Configure a different port to use management-specific SSL.</div><div class="line">management.security.enabled=true # Enable security.</div><div class="line">management.security.roles=ACTUATOR # Comma-separated list of roles that can access the management endpoint.</div><div class="line">management.security.sessions=stateless # Session creating policy to use (always, never, if_required, stateless).</div><div class="line">management.ssl.ciphers= # Supported SSL ciphers. Requires a custom management.port.</div><div class="line">management.ssl.client-auth= # Whether client authentication is wanted (&quot;want&quot;) or needed (&quot;need&quot;). Requires a trust store. Requires a custom management.port.</div><div class="line">management.ssl.enabled= # Enable SSL support. Requires a custom management.port.</div><div class="line">management.ssl.enabled-protocols= # Enabled SSL protocols. Requires a custom management.port.</div><div class="line">management.ssl.key-alias= # Alias that identifies the key in the key store. Requires a custom management.port.</div><div class="line">management.ssl.key-password= # Password used to access the key in the key store. Requires a custom management.port.</div><div class="line">management.ssl.key-store= # Path to the key store that holds the SSL certificate (typically a jks file). Requires a custom management.port.</div><div class="line">management.ssl.key-store-password= # Password used to access the key store. Requires a custom management.port.</div><div class="line">management.ssl.key-store-provider= # Provider for the key store. Requires a custom management.port.</div><div class="line">management.ssl.key-store-type= # Type of the key store. Requires a custom management.port.</div><div class="line">management.ssl.protocol=TLS # SSL protocol to use. Requires a custom management.port.</div><div class="line">management.ssl.trust-store= # Trust store that holds SSL certificates. Requires a custom management.port.</div><div class="line">management.ssl.trust-store-password= # Password used to access the trust store. Requires a custom management.port.</div><div class="line">management.ssl.trust-store-provider= # Provider for the trust store. Requires a custom management.port.</div><div class="line">management.ssl.trust-store-type= # Type of the trust store. Requires a custom management.port.</div><div class="line"></div><div class="line"># HEALTH INDICATORS</div><div class="line">management.health.db.enabled=true # Enable database health check.</div><div class="line">management.health.cassandra.enabled=true # Enable cassandra health check.</div><div class="line">management.health.couchbase.enabled=true # Enable couchbase health check.</div><div class="line">management.health.defaults.enabled=true # Enable default health indicators.</div><div class="line">management.health.diskspace.enabled=true # Enable disk space health check.</div><div class="line">management.health.diskspace.path= # Path used to compute the available disk space.</div><div class="line">management.health.diskspace.threshold=0 # Minimum disk space that should be available, in bytes.</div><div class="line">management.health.elasticsearch.enabled=true # Enable elasticsearch health check.</div><div class="line">management.health.elasticsearch.indices= # Comma-separated index names.</div><div class="line">management.health.elasticsearch.response-timeout=100 # The time, in milliseconds, to wait for a response from the cluster.</div><div class="line">management.health.jms.enabled=true # Enable JMS health check.</div><div class="line">management.health.ldap.enabled=true # Enable LDAP health check.</div><div class="line">management.health.mail.enabled=true # Enable Mail health check.</div><div class="line">management.health.mongo.enabled=true # Enable MongoDB health check.</div><div class="line">management.health.rabbit.enabled=true # Enable RabbitMQ health check.</div><div class="line">management.health.redis.enabled=true # Enable Redis health check.</div><div class="line">management.health.solr.enabled=true # Enable Solr health check.</div><div class="line">management.health.status.order=DOWN, OUT_OF_SERVICE, UP, UNKNOWN # Comma-separated list of health statuses in order of severity.</div><div class="line"></div><div class="line"># INFO CONTRIBUTORS (InfoContributorProperties)</div><div class="line">management.info.build.enabled=true # Enable build info.</div><div class="line">management.info.defaults.enabled=true # Enable default info contributors.</div><div class="line">management.info.env.enabled=true # Enable environment info.</div><div class="line">management.info.git.enabled=true # Enable git info.</div><div class="line">management.info.git.mode=simple # Mode to use to expose git information.</div><div class="line"></div><div class="line"># REMOTE SHELL (ShellProperties)</div><div class="line">management.shell.auth.type=simple # Authentication type. Auto-detected according to the environment.</div><div class="line">management.shell.auth.jaas.domain=my-domain # JAAS domain.</div><div class="line">management.shell.auth.key.path= # Path to the authentication key. This should point to a valid &quot;.pem&quot; file.</div><div class="line">management.shell.auth.simple.user.name=user # Login user.</div><div class="line">management.shell.auth.simple.user.password= # Login password.</div><div class="line">management.shell.auth.spring.roles=ACTUATOR # Comma-separated list of required roles to login to the CRaSH console.</div><div class="line">management.shell.command-path-patterns=classpath*:/commands/**,classpath*:/crash/commands/** # Patterns to use to look for commands.</div><div class="line">management.shell.command-refresh-interval=-1 # Scan for changes and update the command if necessary (in seconds).</div><div class="line">management.shell.config-path-patterns=classpath*:/crash/* # Patterns to use to look for configurations.</div><div class="line">management.shell.disabled-commands=jpa*,jdbc*,jndi* # Comma-separated list of commands to disable.</div><div class="line">management.shell.disabled-plugins= # Comma-separated list of plugins to disable. Certain plugins are disabled by default based on the environment.</div><div class="line">management.shell.ssh.auth-timeout = # Number of milliseconds after user will be prompted to login again.</div><div class="line">management.shell.ssh.enabled=true # Enable CRaSH SSH support.</div><div class="line">management.shell.ssh.idle-timeout = # Number of milliseconds after which unused connections are closed.</div><div class="line">management.shell.ssh.key-path= # Path to the SSH server key.</div><div class="line">management.shell.ssh.port=2000 # SSH port.</div><div class="line">management.shell.telnet.enabled=false # Enable CRaSH telnet support. Enabled by default if the TelnetPlugin is  available.</div><div class="line">management.shell.telnet.port=5000 # Telnet port.</div><div class="line"></div><div class="line"># TRACING (TraceProperties)</div><div class="line">management.trace.include=request-headers,response-headers,cookies,errors # Items to be included in the trace.</div><div class="line"></div><div class="line"># METRICS EXPORT (MetricExportProperties)</div><div class="line">spring.metrics.export.aggregate.key-pattern= # Pattern that tells the aggregator what to do with the keys from the source repository.</div><div class="line">spring.metrics.export.aggregate.prefix= # Prefix for global repository if active.</div><div class="line">spring.metrics.export.delay-millis=5000 # Delay in milliseconds between export ticks. Metrics are exported to external sources on a schedule with this delay.</div><div class="line">spring.metrics.export.enabled=true # Flag to enable metric export (assuming a MetricWriter is available).</div><div class="line">spring.metrics.export.excludes= # List of patterns for metric names to exclude. Applied after the includes.</div><div class="line">spring.metrics.export.includes= # List of patterns for metric names to include.</div><div class="line">spring.metrics.export.redis.key=keys.spring.metrics # Key for redis repository export (if active).</div><div class="line">spring.metrics.export.redis.prefix=spring.metrics # Prefix for redis repository if active.</div><div class="line">spring.metrics.export.send-latest= # Flag to switch off any available optimizations based on not exporting unchanged metric values.</div><div class="line">spring.metrics.export.statsd.host= # Host of a statsd server to receive exported metrics.</div><div class="line">spring.metrics.export.statsd.port=8125 # Port of a statsd server to receive exported metrics.</div><div class="line">spring.metrics.export.statsd.prefix= # Prefix for statsd exported metrics.</div><div class="line">spring.metrics.export.triggers.*= # Specific trigger properties per MetricWriter bean name.</div><div class="line"></div><div class="line"></div><div class="line"># ----------------------------------------</div><div class="line"># DEVTOOLS PROPERTIES</div><div class="line"># ----------------------------------------</div><div class="line"></div><div class="line"># DEVTOOLS (DevToolsProperties)</div><div class="line">spring.devtools.livereload.enabled=true # Enable a livereload.com compatible server.</div><div class="line">spring.devtools.livereload.port=35729 # Server port.</div><div class="line">spring.devtools.restart.additional-exclude= # Additional patterns that should be excluded from triggering a full restart.</div><div class="line">spring.devtools.restart.additional-paths= # Additional paths to watch for changes.</div><div class="line">spring.devtools.restart.enabled=true # Enable automatic restart.</div><div class="line">spring.devtools.restart.exclude=META-INF/maven/**,META-INF/resources/**,resources/**,static/**,public/**,templates/**,**/*Test.class,**/*Tests.class,git.properties # Patterns that should be excluded from triggering a full restart.</div><div class="line">spring.devtools.restart.poll-interval=1000 # Amount of time (in milliseconds) to wait between polling for classpath changes.</div><div class="line">spring.devtools.restart.quiet-period=400 # Amount of quiet time (in milliseconds) required without any classpath changes before a restart is triggered.</div><div class="line">spring.devtools.restart.trigger-file= # Name of a specific file that when changed will trigger the restart check. If not specified any classpath file change will trigger the restart.</div><div class="line"></div><div class="line"># REMOTE DEVTOOLS (RemoteDevToolsProperties)</div><div class="line">spring.devtools.remote.context-path=/.~~spring-boot!~ # Context path used to handle the remote connection.</div><div class="line">spring.devtools.remote.debug.enabled=true # Enable remote debug support.</div><div class="line">spring.devtools.remote.debug.local-port=8000 # Local remote debug server port.</div><div class="line">spring.devtools.remote.proxy.host= # The host of the proxy to use to connect to the remote application.</div><div class="line">spring.devtools.remote.proxy.port= # The port of the proxy to use to connect to the remote application.</div><div class="line">spring.devtools.remote.restart.enabled=true # Enable remote restart.</div><div class="line">spring.devtools.remote.secret= # A shared secret required to establish a connection (required to enable remote support).</div><div class="line">spring.devtools.remote.secret-header-name=X-AUTH-TOKEN # HTTP header used to transfer the shared secret.</div><div class="line"></div><div class="line"></div><div class="line"># ----------------------------------------</div><div class="line"># TESTING PROPERTIES</div><div class="line"># ----------------------------------------</div><div class="line"></div><div class="line">spring.test.database.replace=any # Type of existing DataSource to replace.</div><div class="line">spring.test.mockmvc.print=default # MVC Print option.</div></pre></td></tr></table></figure></p>
<p>可以通过@ImportResource({“classpath:same-context.xml”,”classpath:same-context2.xml”}) // 可以通过ImportResource导入xml配置文件<br>导入引入xml配置文件</p>
<h4 id="1-4-Spring-Boot的自动配置的原理"><a href="#1-4-Spring-Boot的自动配置的原理" class="headerlink" title="1.4 Spring Boot的自动配置的原理"></a>1.4 Spring Boot的自动配置的原理</h4><p>Spring Boot在进行SpringApplication对象实例化时会加载META-INF/spring.factories文件，将该配置文件中的配置载入到Spring容器。</p>
<p>@SpringBootApplication(exclude={RedisAutoConfiguration.class}) // 手动引入redis，不使用springboot自动引入redis配置</p>
<p>自动配置类RedisAutoConfiguration(可以自己创建自动配置类，引入配置)</p>
<p>在SpringApplication类加载时-&gt;加载它的 initialize 方法-&gt;调用SpringFactoriesLoader类加载-&gt;spring.factories文件，并创建spring.factories中配置的配置类对象<br>举例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@ConditionalOnClass</span>(&#123;JedisConnection.class, RedisOperations.class, Jedis.class&#125;) <span class="comment">// 条件注解，如果运行环境中包含了这些class，才会加载RedisAutoConfiguration对象</span></div><div class="line"><span class="meta">@EnableConfigurationProperties</span>(&#123;RedisProperties.class&#125;) <span class="comment">// 这个类里包含 COMMON SPRING BOOT PROPERTIES 文件中的redis字段</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;&#125;</div></pre></td></tr></table></figure></p>
<h4 id="1-5-自动配置静态资源"><a href="#1-5-自动配置静态资源" class="headerlink" title="1.5 自动配置静态资源"></a>1.5 自动配置静态资源</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">### 配置静态资源路径在public目录下</div><div class="line"># 默认配置目录是在resources/public目录下，以下是默认配置静态资源目录</div><div class="line">spring.resources.static-locations=classpath:/public/</div></pre></td></tr></table></figure>
<h3 id="2-自定义消息转化器"><a href="#2-自定义消息转化器" class="headerlink" title="2 自定义消息转化器"></a>2 自定义消息转化器</h3><h4 id="2-1-自定义消息转化器"><a href="#2-1-自定义消息转化器" class="headerlink" title="2.1 自定义消息转化器"></a>2.1 自定义消息转化器</h4><p>自定义消息转化器，只需要在@Configuration的类中添加消息转化器的@bean加入到Spring容器，就会被Spring Boot自动加入到容器中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function"><span class="keyword">public</span> StringHttpMessageConverter <span class="title">stringHttpMessageConverter</span><span class="params">()</span></span>&#123;</div><div class="line">	StringHttpMessageConverter converter  = <span class="keyword">new</span> StringHttpMessageConverter(Charset.forName(<span class="string">"UTF-8"</span>));</div><div class="line">	<span class="keyword">return</span> converter;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</div><div class="line"><span class="keyword">import</span> org.springframework.http.converter.StringHttpMessageConverter;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.nio.charset.Charset;</div><div class="line"></div><div class="line"><span class="meta">@Controller</span> <span class="comment">// 配置spring的配置类注解</span></div><div class="line"><span class="meta">@SpringBootApplication</span> <span class="comment">// springboot项目核心注解 目的是开始自动配置</span></div><div class="line"><span class="meta">@Configuration</span> <span class="comment">// springmvc的controller控制层注解</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApplication</span> </span>&#123;</div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"hello"</span>)</div><div class="line">    <span class="meta">@ResponseBody</span> <span class="comment">// 消息转化器，可以返回数据</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"hello world！你好"</span>;</div><div class="line">    &#125; <span class="comment">// springmvc默认是IS0-8859-1编码，返回中文时，如果没有消息转化器会出现乱码，但是springboot默认消息转化器就是utf-8,所以不会出现乱码</span></div><div class="line"></div><div class="line"><span class="comment">//    @Bean</span></div><div class="line"><span class="comment">//    public StringHttpMessageConverter stringHttpMessageConverter() &#123;</span></div><div class="line"><span class="comment">//        StringHttpMessageConverter converter = new StringHttpMessageConverter(Charset.forName("UTF-8"));</span></div><div class="line"><span class="comment">//        return converter;</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; <span class="comment">// 一个springboot应用的入口</span></div><div class="line">        <span class="comment">// SpringApplication.run(HelloApplication.class, args);</span></div><div class="line">        SpringApplication app = <span class="keyword">new</span> SpringApplication(HelloApplication.class);</div><div class="line">        app.setBannerMode(Banner.Mode.OFF); <span class="comment">// 关闭启动是的springbootbanner</span></div><div class="line">        app.run(args);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="2-2-配置拦截器"><a href="#2-2-配置拦截器" class="headerlink" title="2.2 配置拦截器"></a>2.2 配置拦截器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.nio.charset.Charset;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</div><div class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</div><div class="line"><span class="keyword">import</span> org.springframework.http.converter.StringHttpMessageConverter;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</div><div class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</div><div class="line"></div><div class="line"><span class="meta">@Configuration</span> <span class="comment">//申明这是一个配置</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySrpingMVCConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 自定义拦截器</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</div><div class="line">        HandlerInterceptor handlerInterceptor = <span class="keyword">new</span> HandlerInterceptor() &#123; <span class="comment">// 匿名实现类</span></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></div><div class="line">                    <span class="keyword">throws</span> Exception &#123;</div><div class="line">                System.out.println(<span class="string">"自定义拦截器............"</span>);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></div><div class="line">                                   ModelAndView modelAndView) <span class="keyword">throws</span> Exception &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></div><div class="line">                                        Exception ex) <span class="keyword">throws</span> Exception &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        registry.addInterceptor(handlerInterceptor).addPathPatterns(<span class="string">"/**"</span>); <span class="comment">// 进入拦截器的规则，改规则是所有的请求都会走这个拦截器</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 自定义消息转化器的第二种方法</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</div><div class="line">        StringHttpMessageConverter converter = <span class="keyword">new</span> StringHttpMessageConverter(Charset.forName(<span class="string">"UTF-8"</span>));</div><div class="line">        converters.add(converter);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一个springboot应用加载拦截器流程：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</div><div class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</div><div class="line"><span class="keyword">import</span> org.springframework.http.converter.StringHttpMessageConverter;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.nio.charset.Charset;</div><div class="line"></div><div class="line"><span class="meta">@Controller</span> <span class="comment">// 配置spring的配置类注解</span></div><div class="line"><span class="meta">@SpringBootApplication</span> <span class="comment">// springboot项目核心注解 目的是开始自动配置</span></div><div class="line"><span class="meta">@Configuration</span> <span class="comment">// springmvc的controller控制层注解</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApplication</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"hello"</span>)</div><div class="line">    <span class="meta">@ResponseBody</span> <span class="comment">// 消息转化器，可以返回数据</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"hello world！你好"</span>;</div><div class="line">    &#125; <span class="comment">// springmvc默认是IS0-8859-1编码，返回中文时，如果没有消息转化器会出现乱码，但是springboot默认消息转化器就是utf-8,所以不会出现乱码</span></div><div class="line"></div><div class="line"><span class="comment">//    @Bean</span></div><div class="line"><span class="comment">//    public StringHttpMessageConverter stringHttpMessageConverter() &#123;</span></div><div class="line"><span class="comment">//        StringHttpMessageConverter converter = new StringHttpMessageConverter(Charset.forName("UTF-8"));</span></div><div class="line"><span class="comment">//        return converter;</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; <span class="comment">// 一个springboot应用的入口</span></div><div class="line">        <span class="comment">// SpringApplication.run(HelloApplication.class, args);</span></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 1. 注入 HelloApplication 类</div><div class="line">         * 2. 加载 <span class="doctag">@SpringBootApplication</span> 注解，加载注入 SpringBootApplication 对象</div><div class="line">         * 3. 加载 <span class="doctag">@ComponentScan</span> 注解，扫描默认目录(当前注入类 SpringBootApplication 所在的目录下所有的类)</div><div class="line">         * 4. 注入 MySrpingMVCConfig 类， 注入了 自定义的拦截器</div><div class="line">         */</div><div class="line">        SpringApplication app = <span class="keyword">new</span> SpringApplication(HelloApplication.class);</div><div class="line">        app.setBannerMode(Banner.Mode.OFF); <span class="comment">// 关闭启动是的springbootbanner</span></div><div class="line">        app.run(args);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[layer]]></title>
      <url>https://volc1605.github.io/2017/12/11/layer/</url>
      <content type="html"><![CDATA[<h3 id="1-等待加载样式，手动关闭"><a href="#1-等待加载样式，手动关闭" class="headerlink" title="1 等待加载样式，手动关闭"></a>1 等待加载样式，手动关闭</h3><a id="more"></a>
<p><img src="https://volc1605.github.io/images/layer/layer.png" alt="desktop"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var id = layer.msg(&apos;处理中&apos;, &#123;</div><div class="line">	icon: 16,</div><div class="line">	shade: 0.4,</div><div class="line">	time: false</div><div class="line">&#125;);</div><div class="line">layer.close(id);//手动关闭</div></pre></td></tr></table></figure></p>
<h3 id="2-弹窗"><a href="#2-弹窗" class="headerlink" title="2 弹窗"></a>2 弹窗</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">layer.open(&#123;</div><div class="line">  title: &quot;使用问题解答&quot;,</div><div class="line">  type: 2, </div><div class="line">  closeBtn: false,</div><div class="line">  shadeClose: true,</div><div class="line">  anim: 5,</div><div class="line">  area: [&apos;70%&apos;, &apos;70%&apos;],</div><div class="line">  offset:[&apos;50px&apos;,&apos;200px&apos;],</div><div class="line">  content: [&apos;/cloud/sys/cloud/getProblem&apos;, &apos;true&apos;]</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="3-前端分页"><a href="#3-前端分页" class="headerlink" title="3 前端分页"></a>3 前端分页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;demo20&quot;&gt;&lt;/div&gt;</div><div class="line"></div><div class="line">js</div><div class="line">// 填充数据和分页</div><div class="line">function getPage(data) &#123;</div><div class="line">	layui.use([&apos;laypage&apos;, &apos;layer&apos;], function () &#123;</div><div class="line">		var laypage = layui.laypage</div><div class="line">			, layer = layui.layer;</div><div class="line">		//调用分页</div><div class="line">		laypage.render(&#123;</div><div class="line">			elem: &apos;demo20&apos;</div><div class="line">			, count: data.length</div><div class="line">			, jump: function (obj) &#123;</div><div class="line">				//模拟渲染</div><div class="line">				document.getElementById(&apos;biuuu_city_list&apos;).innerHTML = function () &#123;</div><div class="line">					var arr = []</div><div class="line">						, thisData = data.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);</div><div class="line">					var recordListHtml = &quot;&quot;;</div><div class="line">					layui.each(thisData, function (index, item) &#123;</div><div class="line">						var status = &quot;&quot;; // 推送状态</div><div class="line">						status = &quot;推送成功&quot;; // 客户端收到推送信息</div><div class="line">						if (item.status == &apos;1&apos;)</div><div class="line">							status = &quot;已推送&quot;; // 已推送</div><div class="line">						recordListHtml = recordListHtml;</div><div class="line">					&#125;);</div><div class="line">					$(&apos;#recordRowId&apos;).html(recordListHtml);</div><div class="line">					return arr.join(&apos;&apos;);</div><div class="line">				&#125;();</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-layer后端分页"><a href="#4-layer后端分页" class="headerlink" title="4 layer后端分页"></a>4 layer后端分页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;pageOpId&quot;&gt;&lt;/div&gt;</div><div class="line">// 查询数据列表</div><div class="line">function getList(dataParam) &#123;</div><div class="line">	$.ajax(&#123;</div><div class="line">		type: &quot;POST&quot;,</div><div class="line">		url: &apos;stationDevice/getListInfo&apos;,</div><div class="line">		data: JSON.stringify(dataParam),</div><div class="line">		contentType: &quot;application/json; charset=utf-8&quot;,</div><div class="line">		success: function (data) &#123;</div><div class="line">			if (data.success == &apos;0&apos;) &#123; // 查询成功赋值</div><div class="line">				var html = &quot;&quot;;</div><div class="line">				if (data.resultList != null) &#123;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			// 对数据进行分页处理</div><div class="line">			initList(dataParam, data);</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 对数据进行分页处理</div><div class="line">function initList(param, resultData) &#123;</div><div class="line">	layui.use([&apos;laypage&apos;, &apos;layer&apos;], function () &#123;</div><div class="line">		var laypage = layui.laypage;</div><div class="line">		//完整功能</div><div class="line">		laypage.render(&#123;</div><div class="line">			elem: &apos;pageOpId&apos;,</div><div class="line">			count: resultData.count, // 总条数</div><div class="line">			curr: resultData.curr,</div><div class="line">			layout: [&apos;count&apos;, &apos;prev&apos;, &apos;page&apos;, &apos;next&apos;, &apos;skip&apos;],</div><div class="line">			jump: function (obj, first) &#123; // (分页数据，是否第一次执行)</div><div class="line">				// 查询数据并分页</div><div class="line">				if (first) &#123; // 第一次执行不做任何处理</div><div class="line">				&#125; else &#123; // 第二次查询做处理</div><div class="line">					param.curr = obj.curr;</div><div class="line">					// 查询数据</div><div class="line">					getList(param);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[idea提交代码到GIT]]></title>
      <url>https://volc1605.github.io/2017/12/03/idea%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%88%B0GIT/</url>
      <content type="html"><![CDATA[<h3 id="idea提交代码到GIT"><a href="#idea提交代码到GIT" class="headerlink" title="idea提交代码到GIT"></a>idea提交代码到GIT</h3><p>注意：首先在git上创建空的项目仓库</p>
<p>VCS-&gt;Enable Version Control…，然后选择Git<br>右键点击src或代码文件，Git – Add – Commit（先Add再Commit）<br>首次提交会选择提交的url，点击Define remote填写仓库url</p>
<h3 id="使用命令提交文件夹到git"><a href="#使用命令提交文件夹到git" class="headerlink" title="使用命令提交文件夹到git"></a>使用命令提交文件夹到git</h3><p>1、进入需要提交的文件的目录，右击选择git bash here<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git init</div></pre></td></tr></table></figure></p>
<p>2、把文件添加到版本库中，使用命令 git add .添加到暂存区里面去，不要忘记后面的小数点“.”，意为添加文件夹下的所有文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git add .</div></pre></td></tr></table></figure></p>
<p>3、用命令 git commit告诉Git，把文件提交到仓库。引号内为提交说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git commit -m &apos;first commit&apos;</div></pre></td></tr></table></figure></p>
<p>4、关联到远程库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git remote add origin 你的远程库地址</div></pre></td></tr></table></figure></p>
<p>如：<br>git remote add origin <a href="https://github.com/cade8800/ionic-demo.git" target="_blank" rel="external">https://github.com/cade8800/ionic-demo.git</a><br>5、获取远程库与本地同步合并（如果远程库不为空必须做这一步，否则后面的提交会失败）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git pull --rebase origin master</div></pre></td></tr></table></figure></p>
<p>6、把本地库的内容推送到远程，使用 git push命令，实际上是把当前分支master推送到远程。执行此命令后会要求输入用户名、密码，验证通过后即开始上传。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push -u origin master</div></pre></td></tr></table></figure></p>
<p>7、状态查询命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git status</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[页面获取静态资源properties配置文件中的key值]]></title>
      <url>https://volc1605.github.io/2017/08/24/%E9%A1%B5%E9%9D%A2%E8%8E%B7%E5%8F%96%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90properties%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84key%E5%80%BC/</url>
      <content type="html"><![CDATA[<h3 id="1-页面获取配置文件中的key值"><a href="#1-页面获取配置文件中的key值" class="headerlink" title="1. 页面获取配置文件中的key值"></a>1. 页面获取配置文件中的key值</h3><a id="more"></a>
<p>登录成功后，加载index.html页面，在index页面中引入获取资源的getProperties.js<br>getProperties.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> configParam = <span class="literal">null</span>;</div><div class="line">$.ajax(&#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'POST'</span>,</div><div class="line">    <span class="attr">url</span>: <span class="string">"readProperties/properties"</span>,</div><div class="line">	<span class="comment">// async: false, // 同步请求会出现以下警告</span></div><div class="line">    data: <span class="built_in">JSON</span>.stringify(&#123;&#125;),</div><div class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">        configParam = data;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>index.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- S 获取resource中配置文件中的request.properties中的key值 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"#springUrl('/static/pushstatic/js/definejs/getProperties.js')"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- E --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="comment">// console.log(configParam); </span></div><div class="line">		<span class="comment">// 这样是获取不到configParam的值的。</span></div><div class="line">		<span class="comment">// index.html加载顺序:getProperties.js(ajax并没有请求)-&gt;ready方法中的console.log(configParam);-&gt; getProperties.js中的请求</span></div><div class="line">    &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>警告：<br><img src="https://volc1605.github.io/images/async/async.png" alt="async"><br>出现的场景：<br>后台返回index.html视图，浏览器加载，index引入的getProperties.js,而在js中同步请求资源，才会出现警告。<br>这句警告意思是：<br>XMLHttpRequest  【ajax】发送请求，是在浏览器js的主线程上(加载index.html页面)，ajax同步发送请求引起的，这样会引起很不好的用户体验，可能导致浏览器卡死等等！<br>警告是针对HTML5说的，因为在html5以前，JavaScript是完全的单线程方式，主线程之外不存在其他线程。但在Html5中增加了Worker对象，每个Worker运行在一个独立的线程中，Worker线程被阻塞一般是不会影响主线程和浏览器的。因此，如果非要使用同步的Ajax（这种情况应该很少见），那就放到Worker线程中吧，千万千万不要放到主线程里。<br>解决方法：</p>
<ol>
<li>子页面中获取console.log(configParam)是可行的。</li>
<li>加载index.html时后台返回model到页面中。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@Author</span>: volc</div><div class="line"> * <span class="doctag">@Description</span>: 获取配置文件工具类</div><div class="line"> * <span class="doctag">@Date</span>: 17:14 2017/8/23</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigProperties</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Properties props;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Properties <span class="title">getProperties</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (props == <span class="keyword">null</span>) &#123;</div><div class="line">            props = <span class="keyword">new</span> Properties();</div><div class="line">            InputStream in;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                in = getClass().getResourceAsStream(<span class="string">"/properties/request.properties"</span>);</div><div class="line">                props.load(in);</div><div class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> props;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        ConfigProperties configProperties = <span class="keyword">new</span> ConfigProperties();</div><div class="line">        Properties properties = configProperties.getProperties();</div><div class="line">        System.out.println(properties);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[goeasy实时web端推送]]></title>
      <url>https://volc1605.github.io/2017/08/18/goeasy%E5%AE%9E%E6%97%B6web%E7%AB%AF%E6%8E%A8%E9%80%81/</url>
      <content type="html"><![CDATA[<h3 id="1-goeasy实时web端推送"><a href="#1-goeasy实时web端推送" class="headerlink" title="1 goeasy实时web端推送"></a>1 goeasy实时web端推送</h3><p>兼容IE浏览器<br>原理：用户登录系统(客户端)和服务端(推送端)建立websocket连接，服务端推送消息，客户端实时接收到，客户端不在线则接收不到。<br><a id="more"></a></p>
<h4 id="1-1-注册需要推送的应用客户端"><a href="#1-1-注册需要推送的应用客户端" class="headerlink" title="1.1 注册需要推送的应用客户端"></a>1.1 注册需要推送的应用客户端</h4><h5 id="1-1-1-注册goeasy账号"><a href="#1-1-1-注册goeasy账号" class="headerlink" title="1.1.1 注册goeasy账号"></a>1.1.1 注册goeasy账号</h5><h5 id="1-1-2-创建应用"><a href="#1-1-2-创建应用" class="headerlink" title="1.1.2 创建应用"></a>1.1.2 创建应用</h5><p><img src="https://volc1605.github.io/images/goeasy/app.png" alt="测试"></p>
<h3 id="1-2-服务端"><a href="#1-2-服务端" class="headerlink" title="1.2 服务端"></a>1.2 服务端</h3><p>引入依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;io.goeasy&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;goeasy-sdk&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;0.3.1&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>使用api方式向web端实时推送<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.baomidou.framework.annotations.Log;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.common.enums.ServerParam;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.entity.push.PushContent;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.entity.push.Record;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.entity.push.Server;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.mapper.IPush.PushMapper;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.mapper.IPush.RecordMapper;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.mapper.IPush.ServerMapper;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.service.IPushService.IPushService;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.service.support.BaseServiceImpl;</div><div class="line"><span class="keyword">import</span> com.baomidou.springwind.utils.HttpClientUtils;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@Author</span>: volc</div><div class="line"> * <span class="doctag">@Description</span>: 推送业务处理类</div><div class="line"> * <span class="doctag">@Date</span>: 16:19 2017/8/17</div><div class="line"> */</div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PushServiceImpl</span> <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span>&lt;<span class="title">PushMapper</span>, <span class="title">Record</span>&gt; <span class="keyword">implements</span> <span class="title">IPushService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> PushMapper pushMapper;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ServerMapper serverMapper;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> RecordMapper recordMapper;</div><div class="line"></div><div class="line">	<span class="comment">// GOEASY_PUSH_URL=https://goeasy.io/goeasy/publish</span></div><div class="line">	<span class="comment">// String APPKEY = "appkey"; goeasy服务中注册应用时生成，客户端和推送端保持一致</span></div><div class="line">    <span class="comment">// String CHANNEL = "channel"; 推送端自行创建，客户端和推送端保持一致</span></div><div class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;GOEASY_PUSH_URL&#125;"</span>)</div><div class="line">    <span class="keyword">private</span> String GOEASY_PUSH_URL;</div><div class="line"></div><div class="line">    <span class="meta">@Log</span>(<span class="string">"推送Web端"</span>)</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">pushWeb</span><span class="params">(Map&lt;String, Object&gt; reqMap)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">        Map&lt;String, String&gt; pushParamMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</div><div class="line">        HttpClientUtils httpClientUtils = <span class="keyword">new</span> HttpClientUtils();</div><div class="line">        <span class="comment">// 根据sysId获取channel和appkey</span></div><div class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty((String) reqMap.get(<span class="string">"sysId"</span>))) &#123;</div><div class="line">            Map&lt;String, Object&gt; serMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">            serMap.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</div><div class="line">            <span class="keyword">int</span> sysId = Integer.parseInt((String) reqMap.get(<span class="string">"sysId"</span>));</div><div class="line">            serMap.put(<span class="string">"sysId"</span>, sysId);</div><div class="line">            List&lt;Server&gt; serversList = serverMapper.selectByMap(serMap);</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != serversList &amp;&amp; serversList.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">                pushParamMap.put(ServerParam.APPKEY, serversList.get(<span class="number">0</span>).getAppKey());</div><div class="line">                pushParamMap.put(ServerParam.CHANNEL, serversList.get(<span class="number">0</span>).getChannel());</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                resultMap.put(<span class="string">"info"</span>, <span class="string">"该客户端没有注册"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 保存推送记录</span></div><div class="line">        Record record = <span class="keyword">new</span> Record();</div><div class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty((String) reqMap.get(<span class="string">"sysId"</span>))) &#123;</div><div class="line">            <span class="keyword">int</span> sysId = Integer.parseInt((String) reqMap.get(<span class="string">"sysId"</span>));</div><div class="line">            record.setSysId(sysId);</div><div class="line">        &#125;</div><div class="line">        record.setContent((String) reqMap.get(<span class="string">"content"</span>));</div><div class="line">        Date date = <span class="keyword">new</span> Date();</div><div class="line">        record.setCreateTime(date);</div><div class="line">        pushMapper.insertReId(record);</div><div class="line">        PushContent pushContent = <span class="keyword">new</span> PushContent();</div><div class="line">        pushContent.setContent((String) reqMap.get(<span class="string">"content"</span>));</div><div class="line">        pushContent.setMsgId(record.getId());</div><div class="line">        pushContent.setUserId((String) reqMap.get(<span class="string">"userId"</span>)); <span class="comment">// 接收人ID</span></div><div class="line">        pushContent.setType((String) reqMap.get(<span class="string">"type"</span>)); <span class="comment">// 消息类型，0 公告， 1 指定用户</span></div><div class="line">        String content = objectMapper.writeValueAsString(pushContent);</div><div class="line">        pushParamMap.put(<span class="string">"content"</span>, content);</div><div class="line">        String resultJson = httpClientUtils.postUrlencoded(GOEASY_PUSH_URL, pushParamMap);</div><div class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(resultJson)) &#123;</div><div class="line">            JsonNode jsonNode = objectMapper.readTree(resultJson);</div><div class="line">            String code = jsonNode.get(<span class="string">"code"</span>).asText();</div><div class="line">            <span class="keyword">if</span> (!code.equals(<span class="string">"200"</span>)) &#123;</div><div class="line">                resultMap.put(<span class="string">"info"</span>, <span class="string">"网络原因，推送失败"</span>);</div><div class="line">                resultMap.put(<span class="string">"success"</span>, <span class="string">"1"</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                resultMap.put(<span class="string">"info"</span>, <span class="string">"推送成功"</span>);</div><div class="line">                resultMap.put(<span class="string">"success"</span>, <span class="string">"0"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            resultMap.put(<span class="string">"info"</span>, <span class="string">"网络原因，推送失败"</span>);</div><div class="line">            resultMap.put(<span class="string">"success"</span>, <span class="string">"1"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> resultMap;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Author</span>: volc</div><div class="line">     * <span class="doctag">@Description</span>: 客户端反馈消息</div><div class="line">     * <span class="doctag">@Date</span>: 18:27 2017/8/18</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushMsg</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        Record record = <span class="keyword">new</span> Record();</div><div class="line">        record.setId(id);</div><div class="line">        record.setStatus(<span class="string">"0"</span>);</div><div class="line">        pushMapper.updateById(record);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="1-3-客户端前台引入js"><a href="#1-3-客户端前台引入js" class="headerlink" title="1.3 客户端前台引入js"></a>1.3 客户端前台引入js</h3><p>getMessage.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> goEasy = <span class="keyword">new</span> GoEasy(&#123;<span class="attr">appkey</span>: Common key&#125;);</div><div class="line">goEasy.subscribe(&#123;</div><div class="line">    <span class="attr">channel</span>: <span class="string">'channel'</span>, <span class="comment">// 服务端生成，需保持一致，客户端才能接收到服务端推送的消息</span></div><div class="line">    onMessage: <span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123;</div><div class="line">        alert(<span class="string">'接收到消息:'</span> + message.content);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[webuploader上传附件插件]]></title>
      <url>https://volc1605.github.io/2017/08/08/webuploader%E4%B8%8A%E4%BC%A0%E9%99%84%E4%BB%B6%E6%8F%92%E4%BB%B6/</url>
      <content type="html"><![CDATA[<h3 id="1-webuploader上传插件"><a href="#1-webuploader上传插件" class="headerlink" title="1 webuploader上传插件"></a>1 webuploader上传插件</h3><p>插件下载地址：<br><a href="http://fex.baidu.com/webuploader/" target="_blank" rel="external">http://fex.baidu.com/webuploader/</a></p>
<a id="more"></a>
<h3 id="2-上传页面"><a href="#2-上传页面" class="headerlink" title="2 上传页面"></a>2 上传页面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 引入资源 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"$&#123;ctxStatic&#125;/webuploader/webuploader.css"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"$&#123;ctxStatic&#125;/webuploader/webuploader.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 弹出上传附件页面 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0);"</span> <span class="attr">id</span>=<span class="string">"annexId"</span> <span class="attr">style</span>=<span class="string">"text-decoration:underline;margin-left:18px;"</span>&gt;</span>添加附件<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 上传附件页面 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"annexContentid"</span> <span class="attr">style</span>=<span class="string">"display:none;"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"closeAnnexContentId"</span> <span class="attr">herf</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"close-a"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">a</span> &gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"pushId"</span> <span class="attr">class</span>=<span class="string">"push"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"uploader"</span>&gt;</span></div><div class="line">	            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"text-align: center;padding-bottom: 4px;"</span>&gt;</span></div><div class="line">	              <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"attach"</span> <span class="attr">style</span>=<span class="string">"text-align: center;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"开始上传"</span> <span class="attr">id</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">style</span>=<span class="string">"padding: 8px;margin-top: 2px;color: #00b7ee;border-radius: 3px;"</span> /&gt;</span></div><div class="line">	            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"thelist"</span> <span class="attr">style</span>=<span class="string">"padding:10px;text-align: center;height: 227px;overflow-y: auto;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="comment">// 加载上传附件页面</span></div><div class="line">	$(<span class="string">'#annexId'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> $list = $(<span class="string">"#thelist"</span>);</div><div class="line">		<span class="comment">// 每次点击上传附件创建新的上传的实例对象</span></div><div class="line">	  	uploader = WebUploader.create(&#123;</div><div class="line">	      <span class="attr">auto</span>:<span class="literal">false</span>, <span class="comment">//是否自动上传</span></div><div class="line">	      dnd: <span class="string">'#pushId'</span>, <span class="comment">// 拖拽容器</span></div><div class="line">	      pick: &#123;</div><div class="line">	        <span class="attr">id</span>: <span class="string">'#attach'</span>, </div><div class="line">	        <span class="attr">name</span>:<span class="string">"multiFile"</span>, <span class="comment">//这个地方 name 没什么用，和fileVal 配合使用。 </span></div><div class="line">	        label: <span class="string">'点击选择文件'</span>,</div><div class="line">	        <span class="attr">multiple</span>:<span class="literal">true</span></div><div class="line">	      &#125;,</div><div class="line">	      <span class="attr">swf</span>: <span class="string">'$&#123;ctxStatic&#125;/webuploader/Uploader.swf'</span>,</div><div class="line">	      <span class="attr">fileVal</span>:<span class="string">'multiFile'</span>, <span class="comment">//提交到到后台，是要用"multiFile"这个名称属性来取文件的 </span></div><div class="line">	      server: <span class="string">"/cloud/sys/cloud/stream/uploadServlet"</span>, <span class="comment">// 后台web.xml中配置servlet</span></div><div class="line">	      duplicate:<span class="literal">false</span>,</div><div class="line">	      <span class="attr">resize</span>: <span class="literal">false</span>,</div><div class="line">	      <span class="attr">chunked</span>: <span class="literal">true</span>, <span class="comment">// 大附件分片处理</span></div><div class="line">	      chunkSize: <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>, <span class="comment">// 每片1M</span></div><div class="line">	      chunkRetry:<span class="number">2</span>, <span class="comment">//如果失败，则不重试</span></div><div class="line">	      threads:<span class="number">1</span>,<span class="comment">//上传并发数。允许同时最大上传进程数。</span></div><div class="line">	      fileNumLimit:<span class="number">10</span>,<span class="comment">//上传的文件总数</span></div><div class="line">	      <span class="comment">// 禁掉全局的拖拽功能</span></div><div class="line">	      disableGlobalDnd: <span class="literal">true</span></div><div class="line">	    &#125;);</div><div class="line">	    <span class="comment">// 当有文件添加进来的时候 </span></div><div class="line">	    uploader.on( <span class="string">"fileQueued"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> file </span>) </span>&#123;</div><div class="line">	      $list.append( <span class="string">"&lt;div id='"</span>+ file.id + <span class="string">"' class='item'&gt;"</span> + </div><div class="line">	        <span class="string">"&lt;h4 class='info'&gt;"</span> + file.name + <span class="string">"&lt;/h4&gt;&lt;input id='delete"</span>+ file.id +<span class="string">"' type='button' onclick=removeFile('"</span>+file.id+<span class="string">"') style='float:right;' value='刪除'/&gt;"</span> + </div><div class="line">	        <span class="string">"&lt;p class='state'&gt;&lt;/p&gt;"</span> + </div><div class="line">	      <span class="string">"&lt;/div&gt;"</span> );</div><div class="line">	    &#125;);</div><div class="line">    	<span class="comment">// 文件上传过程中创建进度条实时显示。</span></div><div class="line">		uploader.on( <span class="string">'uploadProgress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> file, percentage </span>) </span>&#123;</div><div class="line">		    <span class="keyword">var</span> $li = $( <span class="string">'#'</span>+file.id ),</div><div class="line">		        $percent = $li.find(<span class="string">'.progress .progress-bar'</span>);</div><div class="line">		    <span class="comment">// 避免重复创建</span></div><div class="line">		    <span class="keyword">if</span> ( !$percent.length ) &#123;</div><div class="line">		        $percent = $(<span class="string">'&lt;div class="progress progress-striped active" style="width:100%;"&gt;'</span> +</div><div class="line">		          <span class="string">'&lt;div class="progress-bar" role="progressbar" style="width: 0%"&gt;'</span> +</div><div class="line">		          <span class="string">'&lt;/div&gt;'</span> +</div><div class="line">		        <span class="string">'&lt;/div&gt;'</span>).appendTo( $li ).find(<span class="string">'.progress-bar'</span>);</div><div class="line">		    &#125;</div><div class="line"></div><div class="line">		    $li.find(<span class="string">'p.state'</span>).text(<span class="string">'上传中'</span>);</div><div class="line"></div><div class="line">		    $percent.css( <span class="string">'width'</span>, percentage * <span class="number">100</span> + <span class="string">'%'</span> );</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">	    <span class="comment">//当所有文件上传结束时触发 </span></div><div class="line">	    uploader.on(<span class="string">"uploadFinished"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	    &#125;);</div><div class="line">	    <span class="comment">//当文件上传成功时触发。 </span></div><div class="line">	    uploader.on( <span class="string">"uploadSuccess"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">file ,response</span>) </span>&#123;</div><div class="line">	      	$( <span class="string">"#"</span>+file.id ).find(<span class="string">"p.state"</span>).text(<span class="string">"已上传"</span>);</div><div class="line">	      	$( <span class="string">'#'</span>+file.id ).find(<span class="string">'.progress'</span>).fadeOut();</div><div class="line">	      	<span class="comment">// layer.msg('上传成功');</span></div><div class="line">	      	$( <span class="string">"#delete"</span>+file.id ).attr(<span class="string">"style"</span>,<span class="string">"display:none;"</span>);</div><div class="line">			parent.saveAnnexInfo(file, response);</div><div class="line">	    &#125;);</div><div class="line">	    uploader.on( <span class="string">"uploadError"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> file </span>) </span>&#123;</div><div class="line">	      $( <span class="string">"#"</span>+file.id ).find(<span class="string">"p.state"</span>).text(<span class="string">"上传出错"</span>);</div><div class="line">	      uploader.cancelFile(file);</div><div class="line">	      uploader.removeFile(file,<span class="literal">true</span>);</div><div class="line">	      uploader.reset();</div><div class="line">	    &#125;);</div><div class="line">	    </div><div class="line">	   $(<span class="string">"#upload"</span>).on(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	     uploader.upload();</div><div class="line">	   &#125;);</div><div class="line"></div><div class="line"></div><div class="line">		<span class="comment">// 弹出上传附件页面</span></div><div class="line">		<span class="keyword">var</span> mes = $(<span class="string">"#annexContentid"</span>);</div><div class="line">		mes.slideDown();</div><div class="line">		<span class="comment">// 关闭上传页面</span></div><div class="line">		$(<span class="string">"#closeAnnexContentId"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			mes.slideUp();</div><div class="line">		&#125;);</div><div class="line">	&#125;);</div><div class="line">	<span class="comment">// 附件页面上传成功后调用此方法用户</span></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">saveAnnexInfo</span>(<span class="params">file, response</span>)</span>&#123;</div><div class="line">		<span class="comment">// 默认第一个附件为主题</span></div><div class="line">		<span class="keyword">if</span>($(<span class="string">'#title'</span>).val().length &lt;= <span class="number">0</span>)</div><div class="line">			$(<span class="string">'#title'</span>).val(file.name.substring(<span class="number">0</span>,file.name.lastIndexOf(<span class="string">'.'</span>)));</div><div class="line">		<span class="comment">// 保存附件信息</span></div><div class="line">		$.ajax(&#123;</div><div class="line">			<span class="attr">type</span> : <span class="string">"POST"</span>,</div><div class="line">			<span class="attr">url</span> : dbmailServer + <span class="string">"/annex/saveAnnexInfo"</span>,</div><div class="line">			<span class="attr">data</span> : <span class="built_in">JSON</span>.stringify(&#123;</div><div class="line">				<span class="attr">url</span>: response.url,</div><div class="line">				<span class="attr">name</span>: file.name,</div><div class="line">				<span class="attr">size</span>: file.size</div><div class="line">			&#125;),</div><div class="line">			<span class="attr">contentType</span> : <span class="string">"application/json; charset=utf-8"</span>,</div><div class="line">			<span class="attr">success</span> : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">				<span class="keyword">if</span>(data.success == <span class="string">'0'</span>)&#123;</div><div class="line">					<span class="keyword">var</span> fileSize = file.size;</div><div class="line">					<span class="keyword">var</span> bigInfo = <span class="string">""</span>;</div><div class="line">					<span class="keyword">if</span>(fileSize / (<span class="number">1024</span> * <span class="number">1024</span>) &gt; <span class="number">20</span>)&#123;</div><div class="line">						bigInfo =  <span class="string">"&amp;nbsp;&amp;nbsp;(已超过20M，大附件)"</span>;</div><div class="line">					&#125;</div><div class="line">					$(<span class="string">"#files"</span>).html(</div><div class="line">					$(<span class="string">"#files"</span>).html()</div><div class="line">					+ <span class="string">"&lt;div id='"</span>+data.annexId+<span class="string">"'&gt;&lt;a href="</span> + dbmailServer + <span class="string">"/annex/download?id="</span>+ data.annexId + <span class="string">"&gt;"</span></div><div class="line">					+ file.name</div><div class="line">					+ <span class="string">"  &lt;/a&gt;&lt;a onclick=removeSpan('"</span></div><div class="line">					+ data.annexId</div><div class="line">					+ <span class="string">"') href='javascript:void(0)'&gt;&amp;nbsp;&amp;nbsp;删除 &lt;/a&gt;"</span> + bigInfo + <span class="string">"&lt;/div&gt;"</span>);</div><div class="line">					<span class="keyword">var</span> annexIds =  $(<span class="string">'#upid'</span>).val();</div><div class="line">					<span class="keyword">if</span>(annexIds.length &gt; <span class="number">0</span> &amp;&amp; annexIds.substring(annexIds.length<span class="number">-1</span>,annexIds.length) != <span class="string">';'</span>) &#123;</div><div class="line">						$(<span class="string">'#upid'</span>).val($(<span class="string">'#upid'</span>).val() + <span class="string">';'</span> + data.annexId + <span class="string">';'</span>);</div><div class="line">					&#125; <span class="keyword">else</span> &#123;</div><div class="line">						$(<span class="string">'#upid'</span>).val($(<span class="string">'#upid'</span>).val() + data.annexId + <span class="string">';'</span>);	</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">// 在上传文件列表中为文件添加移除文件点击事件</span></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">removeFile</span>(<span class="params">fileId</span>) </span>&#123;</div><div class="line">		uploader.on(<span class="string">"uploadStart"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">file</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> nowDay = getNowFormatDate();</div><div class="line">	    	$.ajax(&#123;</div><div class="line">				<span class="attr">type</span> : <span class="string">"POST"</span>,</div><div class="line">				<span class="attr">url</span> : <span class="string">'$&#123;fns:getConfig("cloud.link")&#125;'</span></div><div class="line">						+ <span class="string">'/stream/deleteFile'</span>,</div><div class="line">				<span class="attr">data</span> : <span class="built_in">JSON</span>.stringify(&#123;</div><div class="line">					<span class="attr">path</span>: <span class="string">'$&#123;fns:getConfig("ewmfiles.mail.basedir")&#125;'</span> + nowDay</div><div class="line">				&#125;),</div><div class="line">				<span class="attr">contentType</span> : <span class="string">"application/json; charset=utf-8"</span>,</div><div class="line">				<span class="attr">async</span> : <span class="literal">false</span></div><div class="line">			&#125;);</div><div class="line">	    &#125;);</div><div class="line">		$(<span class="string">'#'</span> + fileId).remove();</div><div class="line">		uploader.removeFile(fileId);</div><div class="line">	 	uploader.cancelFile(fileId);</div><div class="line">	&#125;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="3-上传处理类"><a href="#3-上传处理类" class="headerlink" title="3 上传处理类"></a>3 上传处理类</h3><p>在web.xml中配置servlet，UploadServlet为处理类<br>上传工具类ErmftpUtil<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.Closeable;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.net.SocketException;</div><div class="line"><span class="keyword">import</span> java.util.StringTokenizer;</div><div class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTP;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPClient;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPClientConfig;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPFile;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPReply;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.common.config.Global;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@param</span> &lt;FtpClient&gt;</div><div class="line"> * <span class="doctag">@ClassName</span> ERMFTPUtil</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 上传文件</div><div class="line"> * <span class="doctag">@Date</span> 2017年6月27日 下午5:38:50</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ERMFTPUtil</span> </span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BUFFER_LENGTH = <span class="number">10240</span>;</div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String strencoding;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> FTPClient ftpClient;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String ip; <span class="comment">// 服务器IP地址</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String userName; <span class="comment">// 用户名</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String userPwd; <span class="comment">// 密码</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String port; <span class="comment">// 端口号</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String path; <span class="comment">// 读取文件的存放目录</span></div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> ftpClient</div><div class="line">	 * <span class="doctag">@param</span> ip</div><div class="line">	 * <span class="doctag">@param</span> userName</div><div class="line">	 * <span class="doctag">@param</span> userPwd</div><div class="line">	 * <span class="doctag">@param</span> port</div><div class="line">	 * <span class="doctag">@param</span> path</div><div class="line">	 *            默认连接/mail/files/email/email目录</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ERMFTPUtil</span><span class="params">(String path)</span> </span>&#123;</div><div class="line">		ip = Global.getConfig(<span class="string">"ewmftp.ip"</span>);</div><div class="line">		userName = Global.getConfig(<span class="string">"ewmftp.username"</span>);</div><div class="line">		userPwd = Global.getConfig(<span class="string">"ewmftp.password"</span>);</div><div class="line">		port = Global.getConfig(<span class="string">"ewmftp.port"</span>);</div><div class="line">		ERMFTPUtil.path = path;</div><div class="line">		connectServer(ip, port, userName, userPwd, path);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 连接ftp</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ERMFTPUtil</span><span class="params">()</span> </span>&#123;</div><div class="line">		ip = Global.getConfig(<span class="string">"ewmftp.ip"</span>);</div><div class="line">		userName = Global.getConfig(<span class="string">"ewmftp.username"</span>);</div><div class="line">		userPwd = Global.getConfig(<span class="string">"ewmftp.password"</span>);</div><div class="line">		port = Global.getConfig(<span class="string">"ewmftp.port"</span>);</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> == ftpClient || !ftpClient.isConnected()) &#123;</div><div class="line">			reSet();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> connectServer</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 连接ftp</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午11:55:30</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">connectServer</span><span class="params">(String ip, String port, String userName, String userPwd, String path)</span> </span>&#123;</div><div class="line">		ftpClient = <span class="keyword">new</span> FTPClient();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">// 连接</span></div><div class="line">			ftpClient.connect(ip, Integer.valueOf(port));</div><div class="line">			<span class="comment">// 设置连接属性</span></div><div class="line">			ftpClient.setControlEncoding(<span class="string">"GBK"</span>);</div><div class="line">			FTPClientConfig conf = <span class="keyword">new</span> FTPClientConfig(FTPClientConfig.SYST_NT);</div><div class="line">			conf.setServerLanguageCode(<span class="string">"zh"</span>);</div><div class="line">			<span class="comment">// 登录</span></div><div class="line">			ftpClient.login(userName, userPwd);</div><div class="line">			<span class="comment">// 检测连接是否成功</span></div><div class="line">			<span class="keyword">int</span> reply = ftpClient.getReplyCode();</div><div class="line"></div><div class="line">			<span class="keyword">if</span> (!FTPReply.isPositiveCompletion(reply)) &#123;</div><div class="line">				ftpClient.disconnect();</div><div class="line">				System.err.println(<span class="string">"FTP server refused connection."</span>);</div><div class="line">			&#125;</div><div class="line">			<span class="comment">// 设置二进制方式传输</span></div><div class="line">			ftpClient.setFileType(FTP.BINARY_FILE_TYPE);</div><div class="line">			ftpClient.enterLocalPassiveMode();</div><div class="line">			<span class="keyword">if</span> (StringUtils.isNotBlank(path)) &#123;</div><div class="line">				<span class="comment">// 跳转到指定目录</span></div><div class="line">				ftpClient.changeWorkingDirectory(path);</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (SocketException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> close</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 关闭连接</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午11:59:30</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (ftpClient.isConnected()) &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				ftpClient.logout();</div><div class="line">				ftpClient.disconnect();</div><div class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> reSet</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 重新连接ftp</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午11:55:46</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reSet</span><span class="params">()</span> </span>&#123;</div><div class="line">		strencoding = <span class="string">"GBK"</span>;</div><div class="line">		connectServer(ip, port, userName, userPwd, path);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> upload</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 上传文件 PATH: /mail/files/email/email/20170628</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月27日 下午5:38:31</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(InputStream input, String fileName, String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		<span class="comment">// OutputStream out = null;</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (!ftpClient.isConnected()) &#123;</div><div class="line">				reSet();</div><div class="line">			&#125;</div><div class="line">			ftpClient.makeDirectory(path);</div><div class="line">			ftpClient.changeWorkingDirectory(path);</div><div class="line">			<span class="comment">// ftpClient.storeFile(fileName, input);</span></div><div class="line">			ftpClient.appendFile(fileName, input);</div><div class="line">			<span class="comment">// out = ftpClient.appendFileStream(fileName);</span></div><div class="line">			<span class="comment">// final byte[] bytes = new byte[BUFFER_LENGTH];</span></div><div class="line">			<span class="comment">// int read = 0;</span></div><div class="line">			<span class="comment">// while ((read = input.read(bytes)) != -1) &#123;</span></div><div class="line">			<span class="comment">// out.write(bytes, 0, read);</span></div><div class="line">			<span class="comment">// &#125;</span></div><div class="line">			close(input);</div><div class="line">			<span class="comment">// close(out);</span></div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125; <span class="keyword">finally</span> &#123;</div><div class="line">			<span class="comment">// 上传后先不断开连接</span></div><div class="line">			<span class="comment">// if (ftpClient != null ) &#123;</span></div><div class="line">			<span class="comment">// &#125;</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> <span class="doctag">@MethodName</span></div><div class="line">	 *             isDirExist</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 判断目录是否存在 path :/mail/files/email/email/20170627</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午11:58:07</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isDirExist</span><span class="params">(String path)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			FTPFile[] listFiles = ftpClient.listFiles(path);</div><div class="line">			<span class="keyword">int</span> length = listFiles.length;</div><div class="line">			<span class="keyword">if</span> (length == <span class="number">0</span>) &#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> IOException</div><div class="line">	 * <span class="doctag">@MethodName</span> isFileExist</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 判断文件是否存在</div><div class="line">	 * <span class="doctag">@Date</span> 2017年7月12日 下午6:04:40</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isFileExist</span><span class="params">(String path, String fileName)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		ftpClient.changeWorkingDirectory(path);</div><div class="line">		InputStream inputStream = ftpClient.retrieveFileStream(fileName);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span> == inputStream ? <span class="keyword">false</span> : <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createDir</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		StringTokenizer s = <span class="keyword">new</span> StringTokenizer(path, <span class="string">"/"</span>);</div><div class="line">		s.countTokens();</div><div class="line">		String pathName = <span class="string">""</span>;</div><div class="line">		<span class="keyword">while</span> (s.hasMoreElements()) &#123;</div><div class="line">			pathName = pathName + <span class="string">"/"</span> + (String) s.nextElement();</div><div class="line">			<span class="keyword">if</span> (!isDirExist(pathName.replace(<span class="string">"\\"</span>, <span class="string">"/"</span>))) &#123;</div><div class="line">				System.out.println(<span class="string">"创建文件夹:"</span> + pathName);</div><div class="line">				ftpClient.makeDirectory(pathName);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> createFolder</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 每次上传上传附件时，单独创建新对象调用此方法用来创建新的文件夹 这里的上传不需要执行此方法</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月15日 下午9:58:32</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createFolder</span><span class="params">(String path)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (path.length() != <span class="number">0</span>) &#123;</div><div class="line">			<span class="keyword">if</span> (!isDirExist(path.replace(<span class="string">"\\"</span>, <span class="string">"/"</span>))) &#123;</div><div class="line">				<span class="keyword">try</span> &#123;</div><div class="line">					createDir(path.replace(<span class="string">"\\"</span>, <span class="string">"/"</span>));</div><div class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> IOException</div><div class="line">	 * <span class="doctag">@throws</span> FtpProtocolException</div><div class="line">	 * <span class="doctag">@MethodName</span> createFile</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 向ftp创建空文件 name 文件名称 path文件,返回该文件</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午9:48:48</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createFile</span><span class="params">(String name, String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		<span class="comment">// ERMFTPUtil fptUtil = new ERMFTPUtil();</span></div><div class="line">		ftpClient.makeDirectory(path);</div><div class="line">		ftpClient.changeWorkingDirectory(path);</div><div class="line">		ftpClient.appendFileStream(name);</div><div class="line">		<span class="comment">// fptUtil.close();</span></div><div class="line">		<span class="comment">// this.connectServer(Global.getConfig("ewmftp.ip"),</span></div><div class="line">		<span class="comment">// Global.getConfig("ewmftp.port"),</span></div><div class="line">		<span class="comment">// Global.getConfig("ewmftp.username"),</span></div><div class="line">		<span class="comment">// Global.getConfig("ewmftp.password"), path);</span></div><div class="line">		<span class="comment">// OutputStreamWriter out = new</span></div><div class="line">		<span class="comment">// OutputStreamWriter(ftpClient.appendFileStream(name));</span></div><div class="line">		<span class="comment">// BufferedWriter pw = new BufferedWriter(out);</span></div><div class="line">		<span class="comment">// pw.flush();</span></div><div class="line">		<span class="comment">// pw.close();</span></div><div class="line">		<span class="comment">// File file = new File(path + File.separator + name);</span></div><div class="line">		<span class="comment">// return file;</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> IOException</div><div class="line">	 * <span class="doctag">@throws</span> FtpProtocolException</div><div class="line">	 * <span class="doctag">@MethodName</span> getFile</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 获取指定目录下所有文件大小 path :mail/files/email/email/20170623</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午10:54:08</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">getFileSize</span><span class="params">(String path, String filName)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		ftpClient.changeWorkingDirectory(path);</div><div class="line">		FTPFile[] listFiles = ftpClient.listFiles(filName);</div><div class="line">		<span class="keyword">long</span> fileSize = <span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> != listFiles &amp;&amp; listFiles.length &gt; <span class="number">0</span>) &#123;</div><div class="line">			fileSize = listFiles[<span class="number">0</span>].getSize();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> fileSize;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * </div><div class="line">	 * <span class="doctag">@MethodName</span> main</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 关闭流</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 下午9:26:37</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Closeable stream)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (stream != <span class="keyword">null</span>)</div><div class="line">				stream.close();</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> deleteFile</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 删除文件</div><div class="line">	 * <span class="doctag">@Date</span> 2017年7月13日 下午1:06:31</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteFile</span><span class="params">(String path, String fileName)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			ftpClient.changeWorkingDirectory(path);</div><div class="line">			ftpClient.deleteFile(fileName);</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"static-access"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String agrs[])</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		ERMFTPUtil fptUtil = <span class="keyword">new</span> ERMFTPUtil();</div><div class="line">		<span class="comment">// /*</span></div><div class="line">		<span class="comment">// * 1.先创建文件夹 2.再上传文件</span></div><div class="line">		<span class="comment">// */</span></div><div class="line">		<span class="comment">// String localfile =</span></div><div class="line">		<span class="comment">// "C://Users//Administrator//Desktop//8f1b5a64ee0645408fc4f5cb990ce59.png";</span></div><div class="line">		<span class="comment">// InputStream inputStream = new FileInputStream(localfile);</span></div><div class="line">		<span class="comment">// fptUtil.upload(inputStream, "12345",</span></div><div class="line">		<span class="comment">// "/mail/files/email/email/20170703");</span></div><div class="line">		<span class="comment">// /**</span></div><div class="line">		<span class="comment">// * 2.创建一个空文件</span></div><div class="line">		<span class="comment">// */</span></div><div class="line">		<span class="comment">// // fptUtil.createFile("123", "/mail/files/email/email/20170628");</span></div><div class="line">		<span class="comment">// fptUtil.close();</span></div><div class="line">		fptUtil.deleteFile(<span class="string">"/mail/files/email/email/20170714"</span>, <span class="string">"9c136347404045698b68a735aee93d83.zip"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>UploadServlet上传处理类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> java.util.UUID;</div><div class="line"><span class="keyword">import</span> javax.servlet.ServletException;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</div><div class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItemFactory;</div><div class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</div><div class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</div><div class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</div><div class="line"><span class="keyword">import</span> org.apache.commons.lang3.math.NumberUtils;</div><div class="line"><span class="keyword">import</span> org.slf4j.Logger;</div><div class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.common.config.Global;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.stream.utils.ERMFTPUtil;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> UploadServlet</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 上传处理</div><div class="line"> * <span class="doctag">@Date</span> 2017年7月9日 下午4:50:00</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">8619685235661387895L</span>;</div><div class="line">	<span class="keyword">private</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(UploadServlet.class);</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ERMFTPUtil ermftpUtil = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></div><div class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</div><div class="line">		doOptions(request, response);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"static-access"</span>)</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></div><div class="line">			<span class="keyword">throws</span> ServletException, IOException &#123;</div><div class="line">		InputStream content = <span class="keyword">null</span>;</div><div class="line">		doOptions(request, response);</div><div class="line">		<span class="keyword">this</span>.ermftpUtil = <span class="keyword">new</span> ERMFTPUtil();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">boolean</span> isMultipart = ServletFileUpload.isMultipartContent(request);</div><div class="line">			<span class="keyword">if</span> (isMultipart) &#123;</div><div class="line">				FileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</div><div class="line">				ServletFileUpload upload = <span class="keyword">new</span> ServletFileUpload(factory);</div><div class="line">				<span class="comment">// 得到所有的表单域，它们目前都被当作FileItem</span></div><div class="line">				List&lt;FileItem&gt; fileItems = upload.parseRequest(request);</div><div class="line">				<span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</div><div class="line">				String id = <span class="string">""</span>;</div><div class="line">				String fileName = <span class="string">""</span>;</div><div class="line">				<span class="comment">// 如果大于1说明是分片处理,分片个数(当个文件需要上传的次数)</span></div><div class="line">				<span class="keyword">int</span> chunks = <span class="number">1</span>;</div><div class="line">				<span class="keyword">int</span> chunk = <span class="number">0</span>;</div><div class="line">				FileItem tempFileItem = <span class="keyword">null</span>;</div><div class="line">				<span class="keyword">for</span> (FileItem fileItem : fileItems) &#123;</div><div class="line">					<span class="keyword">if</span> (fileItem.getFieldName().equals(<span class="string">"id"</span>)) &#123;</div><div class="line">						<span class="comment">// 生成的文件ID</span></div><div class="line">						id = fileItem.getString();</div><div class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (fileItem.getFieldName().equals(<span class="string">"name"</span>)) &#123;</div><div class="line">						fileName = <span class="keyword">new</span> String(fileItem.getString().getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</div><div class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (fileItem.getFieldName().equals(<span class="string">"chunks"</span>)) &#123;</div><div class="line">						chunks = NumberUtils.toInt(fileItem.getString());</div><div class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (fileItem.getFieldName().equals(<span class="string">"chunk"</span>)) &#123;</div><div class="line">						chunk = NumberUtils.toInt(fileItem.getString());</div><div class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (fileItem.getFieldName().equals(<span class="string">"multiFile"</span>)) &#123;</div><div class="line">						tempFileItem = fileItem;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="comment">// 将需要分片文件名称存放到session中</span></div><div class="line">				<span class="comment">// 保存在服务上传文件名称</span></div><div class="line">				String yfileName = (String) request.getSession().getAttribute(<span class="string">"fileName"</span>);</div><div class="line">				<span class="keyword">if</span> (StringUtils.isEmpty(yfileName)) &#123; <span class="comment">// 新文件</span></div><div class="line">					yfileName = UUID.randomUUID().toString().replaceAll(<span class="string">"-"</span>, <span class="string">""</span>)</div><div class="line">							+ fileName.subSequence(fileName.lastIndexOf(<span class="string">"."</span>), fileName.length());</div><div class="line">					request.getSession().setAttribute(<span class="string">"fileName"</span>, yfileName);</div><div class="line">				&#125;</div><div class="line">				<span class="comment">// String filePath = Global.getConfig("ewmfiles.mail.basedir") +</span></div><div class="line">				<span class="comment">// "/" + "20170714";</span></div><div class="line">				String filePath = Global.getConfig(<span class="string">"ewmfiles.mail.basedir"</span>) + <span class="string">"/"</span></div><div class="line">						+ <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMdd"</span>).format(<span class="keyword">new</span> Date());</div><div class="line">				content = tempFileItem.getInputStream();</div><div class="line">				<span class="comment">// 上传文件</span></div><div class="line">				ermftpUtil.upload(content, yfileName, filePath);</div><div class="line">				ermftpUtil.close();</div><div class="line">				<span class="comment">// 返回结果</span></div><div class="line">				Map&lt;String, Object&gt; rMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">				<span class="keyword">if</span> (chunk == chunks - <span class="number">1</span>) &#123; <span class="comment">// 判断是否是最后一片</span></div><div class="line">					request.getSession().setAttribute(<span class="string">"fileName"</span>, <span class="string">""</span>);</div><div class="line">					rMap.put(<span class="string">"success"</span>, <span class="string">"0"</span>);</div><div class="line">					rMap.put(<span class="string">"fileName"</span>, yfileName); <span class="comment">// 资源文件名称</span></div><div class="line">					rMap.put(<span class="string">"url"</span>, filePath + <span class="string">"/"</span> + yfileName);</div><div class="line">					response.getWriter().write(objectMapper.writeValueAsString(rMap));</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			ermftpUtil.close();</div><div class="line">			LOGGER.error(e.getMessage(), e);</div><div class="line">			Map&lt;String, Object&gt; rMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">			rMap.put(<span class="string">"success"</span>, <span class="string">"1"</span>);</div><div class="line">			response.getWriter().write(objectMapper.writeValueAsString(rMap));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.destroy();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="4-FTP处理上传下载"><a href="#4-FTP处理上传下载" class="headerlink" title="4 FTP处理上传下载"></a>4 FTP处理上传下载</h3><p>引入jar包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import sun.net.ftp.FtpClient;</div><div class="line">import sun.net.ftp.FtpProtocolException;</div></pre></td></tr></table></figure></p>
<p>上传工具类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">public void upload(String localfilename, String remotefilename, String path) throws IOException &#123;</div><div class="line">	OutputStream os = null;</div><div class="line">	FileInputStream is = null;</div><div class="line">	try &#123;</div><div class="line">		this.connectServer(Global.getConfig(&quot;ewmftp.ip&quot;), Global.getConfig(&quot;ewmftp.port&quot;),</div><div class="line">				Global.getConfig(&quot;ewmftp.username&quot;), Global.getConfig(&quot;ewmftp.password&quot;));</div><div class="line">		if (path.length() != 0) &#123;</div><div class="line">			if (!isDirExist(path.replace(&quot;\\&quot;, &quot;/&quot;))) &#123;</div><div class="line">				createDir(path.replace(&quot;\\&quot;, &quot;/&quot;));</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		try &#123;</div><div class="line">			os = ftpClient.putFileStream(path + &quot;/&quot; + remotefilename);</div><div class="line">		&#125; catch (FtpProtocolException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		File file_in = new File(localfilename);</div><div class="line">		is = new FileInputStream(file_in);</div><div class="line">		byte[] bytes = new byte[1024];</div><div class="line">		int c;</div><div class="line">		while ((c = is.read(bytes)) != -1) &#123;</div><div class="line">			os.write(bytes, 0, c);</div><div class="line">		&#125;</div><div class="line">	&#125; catch (Exception ex) &#123;</div><div class="line">		ex.printStackTrace();</div><div class="line">		throw new RuntimeException(ex);</div><div class="line">	&#125; finally &#123;</div><div class="line">		is.close();</div><div class="line">		os.close();</div><div class="line">		ftpClient.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>下载工具类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">public void download(String path, String fileName, HttpServletResponse response) throws IOException &#123;</div><div class="line">	InputStream is = null;</div><div class="line">	ServletOutputStream os = null;</div><div class="line">	try &#123;</div><div class="line">		this.connectServer(Global.getConfig(&quot;ewmftp.ip&quot;), Global.getConfig(&quot;ewmftp.port&quot;),</div><div class="line">				Global.getConfig(&quot;ewmftp.username&quot;), Global.getConfig(&quot;ewmftp.password&quot;));</div><div class="line">		try &#123;</div><div class="line">			is = ftpClient.getFileStream(path);</div><div class="line">		&#125; catch (FtpProtocolException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		response.setContentType(&quot;application/x-msdownload&quot;);</div><div class="line">		response.setHeader(&quot;Content-Disposition&quot;,</div><div class="line">				&quot;attachment;&quot; + &quot; filename=&quot; + new String(fileName.getBytes(&quot;GBK&quot;), &quot;ISO8859-1&quot;));</div><div class="line"></div><div class="line">		os = response.getOutputStream();</div><div class="line">		byte[] bytes = new byte[1024];</div><div class="line">		int c;</div><div class="line">		while ((c = is.read(bytes)) != -1) &#123;</div><div class="line">			os.write(bytes, 0, c);</div><div class="line">		&#125;</div><div class="line">	&#125; catch (Exception ex) &#123;</div><div class="line">		ex.printStackTrace();</div><div class="line">		throw new RuntimeException(ex);</div><div class="line">	&#125; finally &#123;</div><div class="line">		is.close();</div><div class="line">		os.close();</div><div class="line">		ftpClient.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>多文件上传接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">@ResponseBody</div><div class="line">@RequestMapping(value =&quot;/MultiUpload&quot;, method = RequestMethod.POST)</div><div class="line">public Map&lt;String, Object&gt; MultiUpload(HttpServletRequest request, MultipartHttpServletRequest multiRequest) throws IOException &#123;</div><div class="line">	Map&lt;String, Object&gt; responseInfo = new HashMap&lt;String, Object&gt;();</div><div class="line">	try &#123;</div><div class="line">		CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver(request.getSession().getServletContext());</div><div class="line">		//判断 request 是否有文件上传,即多部分请求</div><div class="line">		if (multipartResolver.isMultipart(request)) &#123;</div><div class="line">			List&lt;MultipartFile&gt; files= multiRequest.getFiles(&quot;files&quot;);</div><div class="line">			List&lt;Map&lt;String, String&gt;&gt; resultList = Lists.newArrayList();</div><div class="line">			if(files != null &amp;&amp; !files.isEmpty())&#123;</div><div class="line">				for(int i = 0; i &lt; files.size(); i++)&#123;</div><div class="line">					Map&lt;String, String&gt; map = Maps.newHashMap();</div><div class="line">					MultipartFile file = files.get(i);  </div><div class="line">					//保存文件  </div><div class="line">					String fileId = uploadFile(request, file);</div><div class="line">					map.put(&quot;id&quot;, fileId);</div><div class="line">					resultList.add(map);</div><div class="line">				&#125; </div><div class="line">			&#125; </div><div class="line">			if(resultList.size() &gt; 0)&#123;</div><div class="line">				responseInfo.put(&quot;objs&quot;, JSONArray.parseArray(JSON.toJSONString(resultList)));</div><div class="line">				responseInfo.put(&quot;msg&quot;, &quot;成功！&quot;);</div><div class="line">				responseInfo.put(&quot;datacount&quot;, resultList.size());</div><div class="line">			&#125;else&#123;</div><div class="line">				responseInfo.put(&quot;objs&quot;, JSONArray.parseArray(JSON.toJSONString(new ArrayList&lt;String&gt;())));</div><div class="line">				responseInfo.put(&quot;msg&quot;, &quot;无数据返回！&quot;);</div><div class="line">				responseInfo.put(&quot;datacount&quot;, 0);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		responseInfo.put(&quot;success&quot;, true);</div><div class="line">	&#125; catch (Exception e) &#123;</div><div class="line">		e.printStackTrace();</div><div class="line">		responseInfo.put(&quot;objs&quot;, JSONArray.parseArray(JSON.toJSONString(new ArrayList&lt;String&gt;())));</div><div class="line">		responseInfo.put(&quot;msg&quot;, &quot;失败!&quot;);</div><div class="line">		responseInfo.put(&quot;success&quot;, false);</div><div class="line">		responseInfo.put(&quot;datacount&quot;, 0);</div><div class="line">	&#125;</div><div class="line">	return responseInfo;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>单文件上传接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">package com.biusoft.core.modules.zhxc.web;</div><div class="line"></div><div class="line">import java.io.File;</div><div class="line">import java.util.Date;</div><div class="line">import java.util.HashMap;</div><div class="line">import java.util.Map;</div><div class="line">import java.util.UUID;</div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import com.biusoft.core.common.utils.ResponseInfo;</div><div class="line">import org.apache.commons.fileupload.disk.DiskFileItem;</div><div class="line">import org.springframework.beans.factory.annotation.Autowired;</div><div class="line">import org.springframework.stereotype.Controller;</div><div class="line">import org.springframework.web.bind.annotation.RequestMapping;</div><div class="line">import org.springframework.web.bind.annotation.RequestMethod;</div><div class="line">import org.springframework.web.bind.annotation.ResponseBody;</div><div class="line">import com.biusoft.core.common.utils.upload.ERMFTPUtil;</div><div class="line">import com.biusoft.core.modules.sys.entity.User;</div><div class="line">import com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line">import org.springframework.web.multipart.MultipartFile;</div><div class="line">import org.springframework.web.multipart.commons.CommonsMultipartFile;</div><div class="line"></div><div class="line">/**</div><div class="line"> * @ClassName AnnexController</div><div class="line"> * @Author volc</div><div class="line"> * @Description 附件操作</div><div class="line"> * @Date 2017年6月30日 上午10:57:54</div><div class="line"> */</div><div class="line">@Controller</div><div class="line">@RequestMapping(value = &quot;annex&quot;)</div><div class="line">public class AnnexController &#123;</div><div class="line">    private static final ObjectMapper MAPPER = new ObjectMapper();</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    private CasFujService casFujService;</div><div class="line"></div><div class="line">    @RequestMapping(value = &quot;uploadfile&quot;, method = RequestMethod.POST, produces = &quot;application/json; charset=utf-8&quot;)</div><div class="line">    @ResponseBody</div><div class="line">    public String uploadMail(MultipartFile upfile, HttpServletRequest request, HttpServletResponse response)</div><div class="line">            throws Exception &#123;</div><div class="line">        request.setCharacterEncoding(&quot;utf-8&quot;);</div><div class="line">        response.setCharacterEncoding(&quot;utf-8&quot;);</div><div class="line">        ERMFTPUtil util = new ERMFTPUtil();</div><div class="line">        String casDir = Global.getConfig(&quot;base.gps&quot;);// ftp地址</div><div class="line">        String oname = upfile.getOriginalFilename();</div><div class="line">        String suffix = oname.substring(oname.indexOf(&apos;.&apos;), oname.length());</div><div class="line">        String nname = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;) + suffix;</div><div class="line">        CommonsMultipartFile cf = (CommonsMultipartFile) upfile;</div><div class="line">        DiskFileItem fi = (DiskFileItem) cf.getFileItem();</div><div class="line">        File f = fi.getStoreLocation();</div><div class="line">        // \2d3bfae9d7fb4538af860ea58bf0f5ed.xls</div><div class="line">        String path = casDir + &quot;/&quot; + nname;</div><div class="line">        util.upload(f.getPath(), nname, casDir);</div><div class="line">        ResponseInfo responseInfo = new ResponseInfo();</div><div class="line">        responseInfo.setInfo(&quot;上传成功&quot;);</div><div class="line">        responseInfo.setSuccess(&quot;true&quot;);</div><div class="line">        Map&lt;String, Object&gt; resultMap = new HashMap&lt;&gt;();</div><div class="line">        resultMap.put(&quot;allurl&quot;, Global.getConfig(&quot;resources.base&quot;) + path);</div><div class="line">        resultMap.put(&quot;url&quot;, path);</div><div class="line">        resultMap.put(&quot;id&quot;, fileId);</div><div class="line">        responseInfo.setMsg(resultMap);</div><div class="line">        return MAPPER.writeValueAsString(responseInfo);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Stream附件上传插件]]></title>
      <url>https://volc1605.github.io/2017/07/27/Stream%E9%99%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%8F%92%E4%BB%B6/</url>
      <content type="html"><![CDATA[<h3 id="1-Stream附件上传插件"><a href="#1-Stream附件上传插件" class="headerlink" title="1 Stream附件上传插件"></a>1 Stream附件上传插件</h3><p>插件下载地址：<a href="https://git.oschina.net/jiangdx/stream.git" target="_blank" rel="external">https://git.oschina.net/jiangdx/stream.git</a><br>使用参考：<a href="http://www.twinkling.cn/" target="_blank" rel="external">http://www.twinkling.cn/</a><br><a id="more"></a><br>引入jar包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;!-- S stream附件上传插件 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.json&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;json&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;20090211&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line"></div><div class="line">&lt;!-- ftp连接包 --&gt;</div><div class="line">&lt;!-- https://mvnrepository.com/artifact/commons-net/commons-net --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;commons-net&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;commons-net&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;3.3&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;!-- E --&gt;</div></pre></td></tr></table></figure>
<h4 id="1-1-ftp上传工具类"><a href="#1-1-ftp上传工具类" class="headerlink" title="1.1 ftp上传工具类"></a>1.1 ftp上传工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.Closeable;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.net.SocketException;</div><div class="line"><span class="keyword">import</span> java.util.StringTokenizer;</div><div class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTP;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPClient;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPClientConfig;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPFile;</div><div class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPReply;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.common.config.Global;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@param</span> &lt;FtpClient&gt;</div><div class="line"> * <span class="doctag">@ClassName</span> ERMFTPUtil</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 上传文件</div><div class="line"> * <span class="doctag">@Date</span> 2017年6月27日 下午5:38:50</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ERMFTPUtil</span> </span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BUFFER_LENGTH = <span class="number">10240</span>;</div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String strencoding;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> FTPClient ftpClient;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String ip; <span class="comment">// 服务器IP地址</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String userName; <span class="comment">// 用户名</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String userPwd; <span class="comment">// 密码</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String port; <span class="comment">// 端口号</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String path; <span class="comment">// 读取文件的存放目录</span></div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> ftpClient</div><div class="line">	 * <span class="doctag">@param</span> ip</div><div class="line">	 * <span class="doctag">@param</span> userName</div><div class="line">	 * <span class="doctag">@param</span> userPwd</div><div class="line">	 * <span class="doctag">@param</span> port</div><div class="line">	 * <span class="doctag">@param</span> path</div><div class="line">	 *            默认连接/mail/files/email/email目录</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ERMFTPUtil</span><span class="params">(String path)</span> </span>&#123;</div><div class="line">		ip = Global.getConfig(<span class="string">"ewmftp.ip"</span>);</div><div class="line">		userName = Global.getConfig(<span class="string">"ewmftp.username"</span>);</div><div class="line">		userPwd = Global.getConfig(<span class="string">"ewmftp.password"</span>);</div><div class="line">		port = Global.getConfig(<span class="string">"ewmftp.port"</span>);</div><div class="line">		ERMFTPUtil.path = path;</div><div class="line">		connectServer(ip, port, userName, userPwd, path);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 连接ftp</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ERMFTPUtil</span><span class="params">()</span> </span>&#123;</div><div class="line">		ip = Global.getConfig(<span class="string">"ewmftp.ip"</span>);</div><div class="line">		userName = Global.getConfig(<span class="string">"ewmftp.username"</span>);</div><div class="line">		userPwd = Global.getConfig(<span class="string">"ewmftp.password"</span>);</div><div class="line">		port = Global.getConfig(<span class="string">"ewmftp.port"</span>);</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> == ftpClient || !ftpClient.isConnected()) &#123;</div><div class="line">			reSet();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> connectServer</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 连接ftp</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午11:55:30</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">connectServer</span><span class="params">(String ip, String port, String userName, String userPwd, String path)</span> </span>&#123;</div><div class="line">		ftpClient = <span class="keyword">new</span> FTPClient();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">// 连接</span></div><div class="line">			ftpClient.connect(ip, Integer.valueOf(port));</div><div class="line">			<span class="comment">// 设置连接属性</span></div><div class="line">			ftpClient.setControlEncoding(<span class="string">"GBK"</span>);</div><div class="line">			FTPClientConfig conf = <span class="keyword">new</span> FTPClientConfig(FTPClientConfig.SYST_NT);</div><div class="line">			conf.setServerLanguageCode(<span class="string">"zh"</span>);</div><div class="line">			<span class="comment">// 登录</span></div><div class="line">			ftpClient.login(userName, userPwd);</div><div class="line">			<span class="comment">// 检测连接是否成功</span></div><div class="line">			<span class="keyword">int</span> reply = ftpClient.getReplyCode();</div><div class="line"></div><div class="line">			<span class="keyword">if</span> (!FTPReply.isPositiveCompletion(reply)) &#123;</div><div class="line">				ftpClient.disconnect();</div><div class="line">				System.err.println(<span class="string">"FTP server refused connection."</span>);</div><div class="line">			&#125;</div><div class="line">			<span class="comment">// 设置二进制方式传输</span></div><div class="line">			ftpClient.setFileType(FTP.BINARY_FILE_TYPE);</div><div class="line">			ftpClient.enterLocalPassiveMode();</div><div class="line">			<span class="keyword">if</span> (StringUtils.isNotBlank(path)) &#123;</div><div class="line">				<span class="comment">// 跳转到指定目录</span></div><div class="line">				ftpClient.changeWorkingDirectory(path);</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (SocketException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> close</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 关闭连接</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午11:59:30</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (ftpClient.isConnected()) &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				ftpClient.logout();</div><div class="line">				ftpClient.disconnect();</div><div class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> reSet</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 重新连接ftp</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午11:55:46</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reSet</span><span class="params">()</span> </span>&#123;</div><div class="line">		strencoding = <span class="string">"GBK"</span>;</div><div class="line">		connectServer(ip, port, userName, userPwd, path);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> upload</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 上传文件 PATH: /mail/files/email/email/20170628</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月27日 下午5:38:31</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(InputStream input, String fileName, String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		<span class="comment">// OutputStream out = null;</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (!ftpClient.isConnected()) &#123;</div><div class="line">				reSet();</div><div class="line">			&#125;</div><div class="line">			ftpClient.makeDirectory(path);</div><div class="line">			ftpClient.changeWorkingDirectory(path);</div><div class="line">			<span class="comment">// ftpClient.storeFile(fileName, input);</span></div><div class="line">			ftpClient.appendFile(fileName, input);</div><div class="line">			<span class="comment">// out = ftpClient.appendFileStream(fileName);</span></div><div class="line">			<span class="comment">// final byte[] bytes = new byte[BUFFER_LENGTH];</span></div><div class="line">			<span class="comment">// int read = 0;</span></div><div class="line">			<span class="comment">// while ((read = input.read(bytes)) != -1) &#123;</span></div><div class="line">			<span class="comment">// out.write(bytes, 0, read);</span></div><div class="line">			<span class="comment">// &#125;</span></div><div class="line">			close(input);</div><div class="line">			<span class="comment">// close(out);</span></div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125; <span class="keyword">finally</span> &#123;</div><div class="line">			<span class="comment">// 上传后先不断开连接</span></div><div class="line">			<span class="comment">// if (ftpClient != null ) &#123;</span></div><div class="line">			<span class="comment">// &#125;</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> <span class="doctag">@MethodName</span></div><div class="line">	 *             isDirExist</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 判断目录是否存在 path :/mail/files/email/email/20170627</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午11:58:07</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isDirExist</span><span class="params">(String path)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			FTPFile[] listFiles = ftpClient.listFiles(path);</div><div class="line">			<span class="keyword">int</span> length = listFiles.length;</div><div class="line">			<span class="keyword">if</span> (length == <span class="number">0</span>) &#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> IOException</div><div class="line">	 * <span class="doctag">@MethodName</span> isFileExist</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 判断文件是否存在</div><div class="line">	 * <span class="doctag">@Date</span> 2017年7月12日 下午6:04:40</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isFileExist</span><span class="params">(String path, String fileName)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		ftpClient.changeWorkingDirectory(path);</div><div class="line">		InputStream inputStream = ftpClient.retrieveFileStream(fileName);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span> == inputStream ? <span class="keyword">false</span> : <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createDir</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		StringTokenizer s = <span class="keyword">new</span> StringTokenizer(path, <span class="string">"/"</span>);</div><div class="line">		s.countTokens();</div><div class="line">		String pathName = <span class="string">""</span>;</div><div class="line">		<span class="keyword">while</span> (s.hasMoreElements()) &#123;</div><div class="line">			pathName = pathName + <span class="string">"/"</span> + (String) s.nextElement();</div><div class="line">			<span class="keyword">if</span> (!isDirExist(pathName.replace(<span class="string">"\\"</span>, <span class="string">"/"</span>))) &#123;</div><div class="line">				System.out.println(<span class="string">"创建文件夹:"</span> + pathName);</div><div class="line">				ftpClient.makeDirectory(pathName);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> createFolder</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 每次上传上传附件时，单独创建新对象调用此方法用来创建新的文件夹 这里的上传不需要执行此方法</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月15日 下午9:58:32</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createFolder</span><span class="params">(String path)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (path.length() != <span class="number">0</span>) &#123;</div><div class="line">			<span class="keyword">if</span> (!isDirExist(path.replace(<span class="string">"\\"</span>, <span class="string">"/"</span>))) &#123;</div><div class="line">				<span class="keyword">try</span> &#123;</div><div class="line">					createDir(path.replace(<span class="string">"\\"</span>, <span class="string">"/"</span>));</div><div class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> IOException</div><div class="line">	 * <span class="doctag">@throws</span> FtpProtocolException</div><div class="line">	 * <span class="doctag">@MethodName</span> createFile</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 向ftp创建空文件 name 文件名称 path文件,返回该文件</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午9:48:48</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createFile</span><span class="params">(String name, String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		<span class="comment">// ERMFTPUtil fptUtil = new ERMFTPUtil();</span></div><div class="line">		ftpClient.makeDirectory(path);</div><div class="line">		ftpClient.changeWorkingDirectory(path);</div><div class="line">		ftpClient.appendFileStream(name);</div><div class="line">		<span class="comment">// fptUtil.close();</span></div><div class="line">		<span class="comment">// this.connectServer(Global.getConfig("ewmftp.ip"),</span></div><div class="line">		<span class="comment">// Global.getConfig("ewmftp.port"),</span></div><div class="line">		<span class="comment">// Global.getConfig("ewmftp.username"),</span></div><div class="line">		<span class="comment">// Global.getConfig("ewmftp.password"), path);</span></div><div class="line">		<span class="comment">// OutputStreamWriter out = new</span></div><div class="line">		<span class="comment">// OutputStreamWriter(ftpClient.appendFileStream(name));</span></div><div class="line">		<span class="comment">// BufferedWriter pw = new BufferedWriter(out);</span></div><div class="line">		<span class="comment">// pw.flush();</span></div><div class="line">		<span class="comment">// pw.close();</span></div><div class="line">		<span class="comment">// File file = new File(path + File.separator + name);</span></div><div class="line">		<span class="comment">// return file;</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> IOException</div><div class="line">	 * <span class="doctag">@throws</span> FtpProtocolException</div><div class="line">	 * <span class="doctag">@MethodName</span> getFile</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 获取指定目录下所有文件大小 path :mail/files/email/email/20170623</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 上午10:54:08</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">getFileSize</span><span class="params">(String path, String filName)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		ftpClient.changeWorkingDirectory(path);</div><div class="line">		FTPFile[] listFiles = ftpClient.listFiles(filName);</div><div class="line">		<span class="keyword">long</span> fileSize = <span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> != listFiles &amp;&amp; listFiles.length &gt; <span class="number">0</span>) &#123;</div><div class="line">			fileSize = listFiles[<span class="number">0</span>].getSize();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> fileSize;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * </div><div class="line">	 * <span class="doctag">@MethodName</span> main</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 关闭流</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月28日 下午9:26:37</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Closeable stream)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (stream != <span class="keyword">null</span>)</div><div class="line">				stream.close();</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> deleteFile</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 删除文件</div><div class="line">	 * <span class="doctag">@Date</span> 2017年7月13日 下午1:06:31</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteFile</span><span class="params">(String path, String fileName)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			ftpClient.changeWorkingDirectory(path);</div><div class="line">			ftpClient.deleteFile(fileName);</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"static-access"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String agrs[])</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		ERMFTPUtil fptUtil = <span class="keyword">new</span> ERMFTPUtil();</div><div class="line">		<span class="comment">// /*</span></div><div class="line">		<span class="comment">// * 1.先创建文件夹 2.再上传文件</span></div><div class="line">		<span class="comment">// */</span></div><div class="line">		<span class="comment">// String localfile =</span></div><div class="line">		<span class="comment">// "C://Users//Administrator//Desktop//8f1b5a64ee0645408fc4f5cb990ce59.png";</span></div><div class="line">		<span class="comment">// InputStream inputStream = new FileInputStream(localfile);</span></div><div class="line">		<span class="comment">// fptUtil.upload(inputStream, "12345",</span></div><div class="line">		<span class="comment">// "/mail/files/email/email/20170703");</span></div><div class="line">		<span class="comment">// /**</span></div><div class="line">		<span class="comment">// * 2.创建一个空文件</span></div><div class="line">		<span class="comment">// */</span></div><div class="line">		<span class="comment">// // fptUtil.createFile("123", "/mail/files/email/email/20170628");</span></div><div class="line">		<span class="comment">// fptUtil.close();</span></div><div class="line">		fptUtil.deleteFile(<span class="string">"/mail/files/email/email/20170714"</span>, <span class="string">"9c136347404045698b68a735aee93d83.zip"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-2-上传核心类StreamServlet"><a href="#1-2-上传核心类StreamServlet" class="headerlink" title="1.2 上传核心类StreamServlet"></a>1.2 上传核心类StreamServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.OutputStream;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> javax.servlet.ServletException;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"><span class="keyword">import</span> org.json.JSONException;</div><div class="line"><span class="keyword">import</span> org.json.JSONObject;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.common.config.Global;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.stream.config.Configurations;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.stream.utils.ERMFTPUtil;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.stream.utils.IoUtil;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * File reserved servlet, mainly reading the request parameter and its file</div><div class="line"> * part, stored it.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">8619685235661387895L</span>;</div><div class="line">	<span class="comment">/** when the has increased to 10kb, then flush it to the hard-disk. */</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BUFFER_LENGTH = <span class="number">10240</span>;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">final</span> String START_FIELD = <span class="string">"start"</span>;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTENT_RANGE_HEADER = <span class="string">"content-range"</span>;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ERMFTPUtil ermftpUtil = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Lookup where's the position of this file?</div><div class="line">	 */</div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"static-access"</span>)</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">		doOptions(req, resp);</div><div class="line">		<span class="comment">// 用户需要上传的文件生成唯一标识(token)，用于断点续传</span></div><div class="line">		String token = req.getParameter(TokenServlet.TOKEN_FIELD);</div><div class="line">		<span class="keyword">final</span> String fileName = req.getParameter(TokenServlet.FILE_NAME_FIELD);</div><div class="line">		<span class="keyword">int</span> lastIndexOf = fileName.lastIndexOf(<span class="string">"."</span>);</div><div class="line">		<span class="keyword">if</span> (lastIndexOf != -<span class="number">1</span>) &#123; <span class="comment">// 含有后缀</span></div><div class="line">			fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>), fileName.length());</div><div class="line">			token = token + fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>), fileName.length());</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// final String size = req.getParameter(TokenServlet.FILE_SIZE_FIELD);</span></div><div class="line">		<span class="comment">// final String fileName =</span></div><div class="line">		<span class="comment">// req.getParameter(TokenServlet.FILE_NAME_FIELD);</span></div><div class="line">		<span class="keyword">final</span> PrintWriter writer = resp.getWriter();</div><div class="line"></div><div class="line">		<span class="comment">/** <span class="doctag">TODO:</span> validate your token. */</span></div><div class="line"></div><div class="line">		JSONObject json = <span class="keyword">new</span> JSONObject();</div><div class="line">		<span class="keyword">long</span> start = <span class="number">0</span>;</div><div class="line">		<span class="keyword">boolean</span> success = <span class="keyword">true</span>;</div><div class="line">		String message = <span class="string">""</span>;</div><div class="line">		String basePath = Global.getConfig(<span class="string">"ewmfiles.mail.basedir"</span>) + <span class="string">"/"</span></div><div class="line">				+ <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMdd"</span>).format(<span class="keyword">new</span> Date());</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">// File f = IoUtil.getTokenedFile(token);</span></div><div class="line">			<span class="comment">// start = f.length();</span></div><div class="line">			<span class="keyword">this</span>.ermftpUtil = <span class="keyword">new</span> ERMFTPUtil();</div><div class="line">			start = ermftpUtil.getFileSize(basePath, token);</div><div class="line">			<span class="comment">/** file size is 0 bytes. */</span></div><div class="line">			<span class="comment">// if (token.endsWith("_0") &amp;&amp; "0".equals(size) &amp;&amp; 0 == start)</span></div><div class="line">			<span class="comment">// f.renameTo(IoUtil.getFile(fileName));</span></div><div class="line">		&#125; <span class="keyword">catch</span> (FileNotFoundException fne) &#123;</div><div class="line">			message = <span class="string">"Error: "</span> + fne.getMessage();</div><div class="line">			success = <span class="keyword">false</span>;</div><div class="line">		&#125; <span class="keyword">finally</span> &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				<span class="keyword">if</span> (success)</div><div class="line">					json.put(START_FIELD, start);</div><div class="line">				json.put(TokenServlet.SUCCESS, success);</div><div class="line">				json.put(TokenServlet.MESSAGE, message);</div><div class="line">				<span class="comment">// 文件访问资存放路径和原始名称</span></div><div class="line">				json.put(<span class="string">"url"</span>, basePath + <span class="string">"/"</span> + token); <span class="comment">// 路径</span></div><div class="line">			&#125; <span class="keyword">catch</span> (JSONException e) &#123;</div><div class="line">			&#125;</div><div class="line">			writer.write(json.toString());</div><div class="line">			IoUtil.close(writer);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"static-access"</span>)</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">		doOptions(req, resp);</div><div class="line">		<span class="comment">// 临时文件名称</span></div><div class="line">		String token = req.getParameter(TokenServlet.TOKEN_FIELD);</div><div class="line">		<span class="comment">// 原始文件名称</span></div><div class="line">		<span class="keyword">final</span> String fileName = req.getParameter(TokenServlet.FILE_NAME_FIELD);</div><div class="line">		<span class="keyword">int</span> lastIndexOf = fileName.lastIndexOf(<span class="string">"."</span>);</div><div class="line">		<span class="keyword">if</span> (lastIndexOf != -<span class="number">1</span>) &#123; <span class="comment">// 含有后缀</span></div><div class="line">			fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>), fileName.length());</div><div class="line">			token = token + fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>), fileName.length());</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		Range range = IoUtil.parseRange(req);</div><div class="line"></div><div class="line">		<span class="comment">//</span></div><div class="line">		OutputStream out = <span class="keyword">null</span>;</div><div class="line">		InputStream content = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">final</span> PrintWriter writer = resp.getWriter();</div><div class="line"></div><div class="line">		<span class="comment">/** <span class="doctag">TODO:</span> validate your token. */</span></div><div class="line"></div><div class="line">		JSONObject json = <span class="keyword">new</span> JSONObject();</div><div class="line">		<span class="keyword">long</span> start = <span class="number">0</span>;</div><div class="line">		<span class="keyword">boolean</span> success = <span class="keyword">true</span>;</div><div class="line">		String message = <span class="string">""</span>;</div><div class="line">		<span class="comment">// S ==========上传至ftp</span></div><div class="line">		<span class="comment">// 用户需要上传的文件</span></div><div class="line">		String basePath = Global.getConfig(<span class="string">"ewmfiles.mail.basedir"</span>) + <span class="string">"/"</span></div><div class="line">				+ <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMdd"</span>).format(<span class="keyword">new</span> Date());</div><div class="line">		String fileName2 = <span class="string">""</span>;</div><div class="line">		<span class="comment">// 在非ftp上生成临时的名称为token的空文件用于存放资源</span></div><div class="line">		<span class="comment">// 根据每个文件的唯一token确定ftp资源的文件，并续传到此文件中</span></div><div class="line">		<span class="comment">// ermftpUtil.createFile(token, basePath);</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">long</span> ftpLength = ermftpUtil.getFileSize(basePath, token);</div><div class="line">			<span class="keyword">if</span> (ftpLength != range.getFrom()) &#123;</div><div class="line">				<span class="comment">/** drop this uploaded data */</span></div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> StreamException(StreamException.ERROR_FILE_RANGE_START);</div><div class="line">			&#125;</div><div class="line">			content = req.getInputStream();</div><div class="line">			<span class="comment">// S 上传至ftp</span></div><div class="line">			ermftpUtil.upload(content, token, basePath);</div><div class="line">			<span class="comment">// E</span></div><div class="line">			start = ermftpUtil.getFileSize(basePath, token);</div><div class="line">			<span class="comment">// E ==========上传至ftp</span></div><div class="line">		&#125; <span class="keyword">catch</span> (StreamException se) &#123;</div><div class="line">			success = StreamException.ERROR_FILE_RANGE_START == se.getCode();</div><div class="line">			message = <span class="string">"Code: "</span> + se.getCode();</div><div class="line">		&#125; <span class="keyword">catch</span> (FileNotFoundException fne) &#123;</div><div class="line">			message = <span class="string">"Code: "</span> + StreamException.ERROR_FILE_NOT_EXIST;</div><div class="line">			success = <span class="keyword">false</span>;</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException io) &#123;</div><div class="line">			message = <span class="string">"IO Error: "</span> + io.getMessage();</div><div class="line">			success = <span class="keyword">false</span>;</div><div class="line">		&#125; <span class="keyword">finally</span> &#123;</div><div class="line">			IoUtil.close(out);</div><div class="line">			IoUtil.close(content);</div><div class="line">			<span class="comment">/** rename the file */</span></div><div class="line">			<span class="keyword">if</span> (range.getSize() == start) &#123;</div><div class="line">				ermftpUtil.close();</div><div class="line">				<span class="comment">/** fix the `renameTo` bug */</span></div><div class="line">				<span class="comment">// File dst = IoUtil.getFile(fileName);</span></div><div class="line">				<span class="comment">// dst.delete();</span></div><div class="line">				<span class="comment">// <span class="doctag">TODO:</span> f.renameTo(dst);</span></div><div class="line">				<span class="comment">// 重命名在Windows平台下可能会失败，stackoverflow建议使用下面这句</span></div><div class="line">				<span class="keyword">try</span> &#123;</div><div class="line">					<span class="comment">// 先删除</span></div><div class="line">					IoUtil.getFile(token).delete();</div><div class="line">					<span class="comment">// 更换token为用户上传的文件名称</span></div><div class="line">					<span class="comment">// Files.move(f.toPath(),</span></div><div class="line">					<span class="comment">// f.toPath().resolveSibling(fileName));</span></div><div class="line">					<span class="comment">// System.out.println("TK: `" + token + "`, NE: `" +</span></div><div class="line">					<span class="comment">// fileName + "`");</span></div><div class="line">					System.out.println(<span class="string">"TK: `"</span> + fileName2 + <span class="string">"`, NE: `"</span> + fileName + <span class="string">"`"</span>);</div><div class="line">					<span class="comment">/** if `STREAM_DELETE_FINISH`, then delete it. */</span></div><div class="line">					<span class="keyword">if</span> (Configurations.isDeleteFinished()) &#123;</div><div class="line">						IoUtil.getFile(fileName).delete();</div><div class="line">					&#125;</div><div class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">					success = <span class="keyword">false</span>;</div><div class="line">					message = <span class="string">"Rename file error: "</span> + e.getMessage();</div><div class="line">				&#125;</div><div class="line"></div><div class="line">			&#125;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				<span class="keyword">if</span> (success)</div><div class="line">					json.put(START_FIELD, start);</div><div class="line">				json.put(TokenServlet.SUCCESS, success);</div><div class="line">				json.put(TokenServlet.MESSAGE, message);</div><div class="line">				<span class="comment">// 文件访问资存放路径和原始名称</span></div><div class="line">				json.put(<span class="string">"url"</span>, basePath + <span class="string">"/"</span> + token); <span class="comment">// 路径</span></div><div class="line">			&#125; <span class="keyword">catch</span> (JSONException e) &#123;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			writer.write(json.toString());</div><div class="line">			IoUtil.close(writer);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doOptions</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">		resp.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</div><div class="line">		resp.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"Content-Range,Content-Type"</span>);</div><div class="line">		resp.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, Configurations.getCrossOrigins());</div><div class="line">		resp.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"POST, GET, OPTIONS"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.destroy();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="1-3-stream配置文件stream-config-properties"><a href="#1-3-stream配置文件stream-config-properties" class="headerlink" title="1.3 stream配置文件stream-config.properties"></a>1.3 stream配置文件stream-config.properties</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># file stored repository (Chinese words need ASCII, help tool @http://tool.oschina.net/encode?type=3)</div><div class="line">STREAM_FILE_REPOSITORY=</div><div class="line"></div><div class="line"># when the file has uploaded, whether delete it.</div><div class="line">STREAM_DELETE_FINISH=false</div><div class="line"></div><div class="line"># this server whether allow other different domain[s] upload file to this server</div><div class="line">STREAM_IS_CROSS=false</div><div class="line"></div><div class="line"># allowed domain (PS: flash method need modifying the `crossdomain.xml`)</div><div class="line">STREAM_CROSS_ORIGIN=*</div><div class="line"></div><div class="line"># when Browser @http:www.A.com, the file will upload to @STREAM_CROSS_SERVER</div><div class="line">STREAM_CROSS_SERVER=http://customers.duapp.com</div></pre></td></tr></table></figure>
<h3 id="1-4-web-xml添加servlet"><a href="#1-4-web-xml添加servlet" class="headerlink" title="1.4 web.xml添加servlet"></a>1.4 web.xml添加servlet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;!-- S stream附件上传 --&gt;</div><div class="line">	&lt;servlet&gt;</div><div class="line">		&lt;servlet-name&gt;TokenServlet&lt;/servlet-name&gt;</div><div class="line">		&lt;servlet-class&gt;com.biusoft.core.stream.servlet.TokenServlet&lt;/servlet-class&gt;</div><div class="line">		&lt;load-on-startup&gt;0&lt;/load-on-startup&gt;</div><div class="line">	&lt;/servlet&gt;</div><div class="line">	&lt;servlet-mapping&gt;</div><div class="line">		&lt;servlet-name&gt;TokenServlet&lt;/servlet-name&gt;</div><div class="line">		&lt;url-pattern&gt;/sys/cloud/stream/tk&lt;/url-pattern&gt;</div><div class="line">	&lt;/servlet-mapping&gt;</div><div class="line">	&lt;servlet&gt;</div><div class="line">		&lt;servlet-name&gt;StreamServlet&lt;/servlet-name&gt;</div><div class="line">		&lt;servlet-class&gt;com.biusoft.core.stream.servlet.StreamServlet&lt;/servlet-class&gt;</div><div class="line">		&lt;load-on-startup&gt;0&lt;/load-on-startup&gt;</div><div class="line">	&lt;/servlet&gt;</div><div class="line">	&lt;servlet-mapping&gt;</div><div class="line">		&lt;servlet-name&gt;StreamServlet&lt;/servlet-name&gt;</div><div class="line">		&lt;url-pattern&gt;/sys/cloud/stream/upload&lt;/url-pattern&gt;</div><div class="line">	&lt;/servlet-mapping&gt;</div><div class="line">	&lt;servlet&gt;</div><div class="line">		&lt;servlet-name&gt;FormDataServlet&lt;/servlet-name&gt;</div><div class="line">		&lt;servlet-class&gt;com.biusoft.core.stream.servlet.FormDataServlet&lt;/servlet-class&gt;</div><div class="line">		&lt;load-on-startup&gt;0&lt;/load-on-startup&gt;</div><div class="line">	&lt;/servlet&gt;</div><div class="line">	&lt;servlet-mapping&gt;</div><div class="line">		&lt;servlet-name&gt;FormDataServlet&lt;/servlet-name&gt;</div><div class="line">		&lt;url-pattern&gt;/sys/cloud/stream/fd&lt;/url-pattern&gt;</div><div class="line">	&lt;/servlet-mapping&gt;</div><div class="line">	&lt;!-- E stream附件上传 --&gt;</div></pre></td></tr></table></figure>
<h3 id="1-5-上传附件页面"><a href="#1-5-上传附件页面" class="headerlink" title="1.5 上传附件页面"></a>1.5 上传附件页面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span>%&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/views/include/taglib.jsp"</span>%&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"$&#123;ctxStatic&#125;/stream/css/stream-v1.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>附件上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"www.cnblogs.com/jihua"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"$&#123;ctxStatic&#125;/jquery/jquery-1.8.3.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"pid"</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">value</span>=<span class="string">"$&#123;param&#125;"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"i_select_files"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"i_stream_files_queue"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"javascript:_t.upload();"</span>&gt;</span>开始上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span>|<span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"javascript:_t.stop();"</span>&gt;</span>停止上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span>|<span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"javascript:_t.cancel();"</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">	Messages:</div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"i_stream_message_container"</span> <span class="attr">class</span>=<span class="string">"stream-main-upload-box"</span> <span class="attr">style</span>=<span class="string">"overflow: auto;height:150px;"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"$&#123;ctxStatic&#125;/stream/js/stream-v1.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 配置文件（如果没有默认字样，说明默认值就是注释下的值）</div><div class="line"> * 但是，on*（onSelect， onMaxSizeExceed...）等函数的默认行为</div><div class="line"> * 是在ID为i_stream_message_container的页面元素中写日志</div><div class="line"> */</div><div class="line">	<span class="keyword">var</span> config = &#123;</div><div class="line">		<span class="attr">browseFileId</span> : <span class="string">"i_select_files"</span>, <span class="comment">/** 选择文件的ID, 默认: i_select_files */</span></div><div class="line">		browseFileBtn : <span class="string">"&lt;div&gt;请选择文件&lt;/div&gt;"</span>, <span class="comment">/** 显示选择文件的样式, 默认: `&lt;div&gt;请选择文件&lt;/div&gt;` */</span></div><div class="line">		dragAndDropArea: <span class="string">"i_select_files"</span>, <span class="comment">/** 拖拽上传区域，Id（字符类型"i_select_files"）或者DOM对象, 默认: `i_select_files` */</span></div><div class="line">		dragAndDropTips: <span class="string">"&lt;span&gt;把文件(文件夹)拖拽到这里&lt;/span&gt;"</span>, <span class="comment">/** 拖拽提示, 默认: `&lt;span&gt;把文件(文件夹)拖拽到这里&lt;/span&gt;` */</span></div><div class="line">		filesQueueId : <span class="string">"i_stream_files_queue"</span>, <span class="comment">/** 文件上传容器的ID, 默认: i_stream_files_queue */</span></div><div class="line">		filesQueueHeight : <span class="number">200</span>, <span class="comment">/** 文件上传容器的高度（px）, 默认: 450 */</span></div><div class="line">		messagerId : <span class="string">"i_stream_message_container"</span>, <span class="comment">/** 消息显示容器的ID, 默认: i_stream_message_container */</span></div><div class="line">		multipleFiles: <span class="literal">true</span>, <span class="comment">/** 多个文件一起上传, 默认: false */</span></div><div class="line">		onRepeatedFile: <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</div><div class="line">			alert(<span class="string">"文件："</span>+f.name +<span class="string">" 大小："</span>+f.size + <span class="string">" 已存在于上传队列中。"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">		&#125;,</div><div class="line">		<span class="attr">autoUploading</span>: <span class="literal">false</span>, <span class="comment">/** 选择文件后是否自动上传, 默认: true */</span></div><div class="line">		<span class="comment">// autoRemoveCompleted : true, /** 是否自动删除容器中已上传完毕的文件, 默认: false */</span></div><div class="line">		<span class="comment">// maxSize: 104857600, /** 单个文件的最大大小，默认:2G */</span></div><div class="line"><span class="comment">//		retryCount : 5, /** HTML5上传失败的重试次数 */</span></div><div class="line"><span class="comment">//		postVarsPerFile : &#123; /** 上传文件时传入的参数，默认: &#123;&#125; */</span></div><div class="line"><span class="comment">//			param1: "val1",</span></div><div class="line"><span class="comment">//			param2: "val2"</span></div><div class="line"><span class="comment">//		&#125;,</span></div><div class="line">		<span class="comment">// swfURL : "$&#123;ctxStatic&#125;/stream/swf/FlashUploader.swf", /** SWF文件的位置 */</span></div><div class="line">		tokenURL : <span class="string">"/cloud/sys/cloud/stream/tk"</span>, <span class="comment">/** 根据文件名、大小等信息获取Token的URI（用于生成断点续传、跨域的令牌） */</span></div><div class="line">		frmUploadURL : <span class="string">"/cloud/sys/cloud/stream/fd;"</span>, <span class="comment">/** Flash上传的URI */</span></div><div class="line">		uploadURL : <span class="string">"/cloud/sys/cloud/stream/upload"</span>,<span class="comment">/** HTML5上传的URI */</span></div><div class="line"><span class="comment">//		simLimit: 200, /** 单次最大上传文件个数 */</span></div><div class="line"><span class="comment">//		extFilters: [".txt", ".rpm", ".rmvb", ".gz", ".rar", ".zip", ".avi", ".mkv", ".mp3"], /** 允许的文件扩展名, 默认: [] */</span></div><div class="line"><span class="comment">//		onSelect: function(list) &#123;alert('onSelect')&#125;, /** 选择文件后的响应事件 */</span></div><div class="line"><span class="comment">//		onMaxSizeExceed: function(size, limited, name) &#123;alert('onMaxSizeExceed')&#125;, /** 文件大小超出的响应事件 */</span></div><div class="line"><span class="comment">//		onFileCountExceed: function(selected, limit) &#123;alert('onFileCountExceed')&#125;, /** 文件数量超出的响应事件 */</span></div><div class="line"><span class="comment">//		onExtNameMismatch: function(name, filters) &#123;alert('onExtNameMismatch')&#125;, /** 文件的扩展名不匹配的响应事件 */</span></div><div class="line">		<span class="comment">//onCancel : function(file) &#123;alert('Canceled:  ' + file.name)&#125; /** 取消上传文件的响应事件 */</span></div><div class="line">		onComplete : <span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</div><div class="line">			saveAnnexInfo(file);</div><div class="line"></div><div class="line">		&#125; <span class="comment">/** 单个文件上传完毕的响应事件 */</span></div><div class="line"><span class="comment">//		onQueueComplete: function() &#123;alert('onQueueComplete')&#125;, /** 所以文件上传完毕的响应事件 */</span></div><div class="line"><span class="comment">//		onUploadError: function(status, msg) &#123;alert('onUploadError')&#125; /** 文件上传出错的响应事件 */</span></div><div class="line"><span class="comment">//		onDestroy: function() &#123;alert('onDestroy')&#125; /** 文件上传出错的响应事件 */</span></div><div class="line">	&#125;;</div><div class="line">	<span class="keyword">var</span> _t = <span class="keyword">new</span> Stream(config);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="xml"></span></div><div class="line"><span class="comment">&lt;!-- 附件上传成功 --&gt;</span></div><div class="line">function saveAnnexInfo(file)&#123;</div><div class="line">	layer.msg('上传成功');</div><div class="line">	parent.saveAnnexInfo(file);</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[个推推送]]></title>
      <url>https://volc1605.github.io/2017/07/27/%E4%B8%AA%E6%8E%A8%E6%8E%A8%E9%80%81/</url>
      <content type="html"><![CDATA[<h3 id="1-个推向Android客户端推送消息"><a href="#1-个推向Android客户端推送消息" class="headerlink" title="1 个推向Android客户端推送消息"></a>1 个推向Android客户端推送消息</h3><a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> com.biusoft.core.common.config.Global;</div><div class="line"><span class="keyword">import</span> com.biusoft.interf.push.mail.pojo.RequestPushBean;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.base.IPushResult;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.base.impl.AppMessage;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.base.impl.SingleMessage;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.base.impl.Target;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.base.uitls.AppConditions;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.exceptions.RequestException;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.http.IGtPush;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.template.LinkTemplate;</div><div class="line"><span class="keyword">import</span> com.gexin.rp.sdk.template.TransmissionTemplate;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> PushSingleToApp</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 不同场景使用推送</div><div class="line"> * <span class="doctag">@Date</span> 2017年6月19日 下午6:18:08</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PushSingleToApp</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String appId = Global.getConfig(<span class="string">"getui.app.id"</span>);</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String appKey = Global.getConfig(<span class="string">"getui.app.key"</span>);</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String masterSecret = Global.getConfig(<span class="string">"getui.master.secret"</span>);</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String host = <span class="string">"http://sdk.open.api.igexin.com/apiex.htm"</span>;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> push</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 对指定用户收到新邮件推送</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月24日 下午3:55:10</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title">push</span><span class="params">(Map&lt;String, Object&gt; hashMap)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		RequestPushBean pushBean = (RequestPushBean) hashMap.get(<span class="string">"requestPush"</span>);</div><div class="line">		IGtPush push = <span class="keyword">new</span> IGtPush(host, appKey, masterSecret);</div><div class="line">		TransmissionTemplate template = transmissionTemplate(hashMap);</div><div class="line">		SingleMessage message = <span class="keyword">new</span> SingleMessage();</div><div class="line">		message.setOffline(<span class="keyword">true</span>);</div><div class="line">		<span class="comment">// 离线有效时间，单位为毫秒，可选</span></div><div class="line">		message.setOfflineExpireTime(<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>);</div><div class="line">		message.setData(template);</div><div class="line">		<span class="comment">// 可选，1为wifi，0为不限制网络环境。根据手机处于的网络情况，决定是否下发</span></div><div class="line">		message.setPushNetWorkType(<span class="number">0</span>);</div><div class="line">		Target target = <span class="keyword">new</span> Target();</div><div class="line">		target.setAppId(appId);</div><div class="line">		target.setAlias(pushBean.getData().getUserId());</div><div class="line">		IPushResult ret = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			ret = push.pushMessageToSingle(message, target);</div><div class="line">		&#125; <span class="keyword">catch</span> (RequestException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">			ret = push.pushMessageToSingle(message, target, e.getRequestId());</div><div class="line">		&#125;</div><div class="line">		Map&lt;String, Object&gt; re = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">		<span class="keyword">if</span> (ret != <span class="keyword">null</span>) &#123;</div><div class="line">			re = ret.getResponse();</div><div class="line">			re.put(<span class="string">"success"</span>, <span class="string">"0"</span>);</div><div class="line">			<span class="keyword">return</span> ret.getResponse();</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			re.put(<span class="string">"success"</span>, <span class="string">"1"</span>);</div><div class="line">			re.put(<span class="string">"info"</span>, <span class="string">"系统服务异常！"</span>);</div><div class="line">			<span class="keyword">return</span> re;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> pushNotice</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 对应用群所有用户通知(公告)，可以推送多个应用</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月24日 下午3:55:10</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title">pushNotice</span><span class="params">(Map&lt;String, Object&gt; hashMap)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		IGtPush push = <span class="keyword">new</span> IGtPush(host, appKey, masterSecret);</div><div class="line"></div><div class="line">		TransmissionTemplate template = transmissionTemplate(hashMap);</div><div class="line">		AppMessage message = <span class="keyword">new</span> AppMessage();</div><div class="line">		message.setData(template);</div><div class="line"></div><div class="line">		message.setOffline(<span class="keyword">true</span>);</div><div class="line">		<span class="comment">// 离线有效时间，单位为毫秒，可选</span></div><div class="line">		message.setOfflineExpireTime(<span class="number">24</span> * <span class="number">1000</span> * <span class="number">3600</span>);</div><div class="line">		<span class="comment">// 推送给App的目标用户需要满足的条件</span></div><div class="line">		AppConditions cdt = <span class="keyword">new</span> AppConditions();</div><div class="line">		List&lt;String&gt; appIdList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">		appIdList.add(appId);</div><div class="line">		message.setAppIdList(appIdList);</div><div class="line">		<span class="comment">// 手机类型</span></div><div class="line">		List&lt;String&gt; phoneTypeList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">		<span class="comment">// 省份</span></div><div class="line">		List&lt;String&gt; provinceList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">		<span class="comment">// 自定义tag</span></div><div class="line">		List&lt;String&gt; tagList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line"></div><div class="line">		cdt.addCondition(AppConditions.PHONE_TYPE, phoneTypeList);</div><div class="line">		cdt.addCondition(AppConditions.REGION, provinceList);</div><div class="line">		cdt.addCondition(AppConditions.TAG, tagList);</div><div class="line">		message.setConditions(cdt);</div><div class="line">		IPushResult ret = push.pushMessageToApp(message);</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">		&#125; <span class="keyword">catch</span> (RequestException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		Map&lt;String, Object&gt; re = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">		<span class="keyword">if</span> (ret != <span class="keyword">null</span>) &#123;</div><div class="line">			re = ret.getResponse();</div><div class="line">			re.put(<span class="string">"success"</span>, <span class="string">"0"</span>);</div><div class="line">			<span class="keyword">return</span> ret.getResponse();</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			re.put(<span class="string">"success"</span>, <span class="string">"1"</span>);</div><div class="line">			re.put(<span class="string">"info"</span>, <span class="string">"系统服务异常！"</span>);</div><div class="line">			<span class="keyword">return</span> re;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@MethodName</span> linkTemplateDemo</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> 点击通知打开网页模板(LinkTemplate)</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月24日 下午4:34:24</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LinkTemplate <span class="title">linkTemplateDemo</span><span class="params">(Map&lt;String, Object&gt; param)</span> </span>&#123;</div><div class="line">		RequestPushBean pushBean = (RequestPushBean) param.get(<span class="string">"requestPush"</span>);</div><div class="line">		String title = pushBean.getData().getTitle();</div><div class="line">		String text = pushBean.getData().getContent();</div><div class="line">		LinkTemplate template = <span class="keyword">new</span> LinkTemplate();</div><div class="line">		<span class="comment">// 设置APPID与APPKEY</span></div><div class="line">		template.setAppId(appId);</div><div class="line">		template.setAppkey(appKey);</div><div class="line">		<span class="comment">// 设置通知栏标题与内容</span></div><div class="line">		template.setTitle(title);</div><div class="line">		template.setText(text);</div><div class="line">		<span class="comment">// 配置通知栏图标</span></div><div class="line">		<span class="comment">// template.setLogo(Global.getConfig("getui.logo"));</span></div><div class="line">		<span class="comment">// 配置通知栏网络图标，填写图标URL地址</span></div><div class="line">		<span class="comment">// template.setLogoUrl(Global.getConfig("getui.logo.url"));</span></div><div class="line">		<span class="comment">// 设置通知是否响铃，震动，或者可清除</span></div><div class="line">		template.setIsRing(<span class="keyword">true</span>);</div><div class="line">		template.setIsVibrate(<span class="keyword">true</span>);</div><div class="line">		template.setIsClearable(<span class="keyword">true</span>);</div><div class="line">		<span class="comment">// 设置打开的网址地址</span></div><div class="line">		<span class="comment">// template.setUrl("http://www.baidu.com");</span></div><div class="line">		<span class="keyword">return</span> template;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@throws</span> Exception</div><div class="line">	 * <span class="doctag">@MethodName</span> transmissionTemplateDemo</div><div class="line">	 * <span class="doctag">@Author</span> volc</div><div class="line">	 * <span class="doctag">@Description</span> (穿透信息模板)文本内容模板，收到通知即可打开通知详情</div><div class="line">	 * <span class="doctag">@Date</span> 2017年6月24日 上午10:54:31</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TransmissionTemplate <span class="title">transmissionTemplate</span><span class="params">(Map&lt;String, Object&gt; param)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		RequestPushBean pushBean = (RequestPushBean) param.get(<span class="string">"requestPush"</span>);</div><div class="line">		TransmissionTemplate template = <span class="keyword">new</span> TransmissionTemplate();</div><div class="line">		template.setAppId(appId);</div><div class="line">		template.setAppkey(appKey);</div><div class="line">		<span class="comment">// 透传消息设置，1为强制启动应用，客户端接收到消息后就会立即启动应用；2为等待应用启动</span></div><div class="line">		template.setTransmissionType(<span class="number">2</span>);</div><div class="line">		String writeValueAsString = objectMapper.writeValueAsString(pushBean);</div><div class="line">		<span class="comment">// writeValueAsString =</span></div><div class="line">		<span class="comment">// "&#123;\"type\":0,\"data\":&#123;\"title\":\"测试通知的标题4\",\"content\":\"测试通知的内容4\",\"timeStamp\":1498111326000&#125;&#125;";</span></div><div class="line">		template.setTransmissionContent(writeValueAsString);</div><div class="line">		<span class="comment">// 设置定时展示时间</span></div><div class="line">		<span class="comment">// template.setDuration("2015-01-16 11:40:00", "2015-01-16 12:24:00");</span></div><div class="line">		<span class="keyword">return</span> template;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[多线程]]></title>
      <url>https://volc1605.github.io/2017/06/12/%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      <content type="html"><![CDATA[<h3 id="1-synchronized同步"><a href="#1-synchronized同步" class="headerlink" title="1 synchronized同步"></a>1 synchronized同步</h3><a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> balance;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(<span class="keyword">int</span> balance)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.balance = balance;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBalance</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> balance;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * add方法和withdraw方法不是同步方法的情况下：</div><div class="line">	 * 两个线程操作同一个Account对象，并访问Account对象中add和withdraw方法时获取到的num值并不是实时的。保证不了数据的安全性。</div><div class="line">	 * 同步方法的情况下：</div><div class="line">	 * 同步方法，方法含有锁，那么这个锁就是该方法所在的Account类对象</div><div class="line">	 * 当同一个Account对象调用add方法时就不会再执行withdraw方法，只有add方法释放掉Account类锁后才能执行withd方法</div><div class="line">	 * 这样保证balance数据的安全性。</div><div class="line">	 * </div><div class="line">	 * 注意：每个对象都可以做为锁，但一个对象做为锁时，应该被多个线程共享，这样才会有意义，</div><div class="line">	 * 在并发环境下，一个没有共享的对象作为锁是没有意义的。</div><div class="line">	 * 例如：每个线程中都创建一个Test对象，而Test对象中的同步方法是不起作用的。</div><div class="line">	 * </div><div class="line">	 * 专业描述synchronized(lock):</div><div class="line">	 * 	每个锁对象都有两个队列，一个是就绪队列，一个是阻塞队列，</div><div class="line">	 * 	就绪队列存储了将要获得锁的线程，阻塞队列存储了被阻塞的线程，</div><div class="line">	 * 	当一个被线程被唤醒 (notify)后，才会进入到就绪队列，等待cpu的调度。</div><div class="line">	 * 	当一开始线程a第一次执行account.add方法时，jvm会检查锁对象account 的就绪队列是否已经有线程在等待，如果有则表明account的锁已经被占用了，由于是第一次运行，account的就绪队列为空，所以线程a获得了锁， 执行account.add方法。</div><div class="line">	 * 	如果恰好在这个时候，线程b要执行account.withdraw方法，因为线程a已经获得了锁还没有释放，所以线程 b要进入account的就绪队列，等到得到锁后才可以执行。</div><div class="line">	 * 	一个线程执行临界区代码过程如下：</div><div class="line">	 *	1 获得同步锁</div><div class="line">	 *	2 清空工作内存</div><div class="line">	 *	3 从主存拷贝变量副本到工作内存</div><div class="line">	 *	4 对这些变量计算</div><div class="line">	 *	5 将变量从工作内存写回到主存</div><div class="line">	 *	6 释放锁</div><div class="line">	 *	可见，synchronized既保证了多线程的并发有序性，又保证了多线程的内存可见性。</div><div class="line">	 * </div><div class="line">	 * </div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</div><div class="line">		balance = balance + num;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">withdraw</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</div><div class="line">		balance = balance - num;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">		Account account = <span class="keyword">new</span> Account(<span class="number">1000</span>);</div><div class="line">		Thread a = <span class="keyword">new</span> Thread(<span class="keyword">new</span> AddThread(account, <span class="number">20</span>), <span class="string">"add"</span>);</div><div class="line">		Thread b = <span class="keyword">new</span> Thread(<span class="keyword">new</span> WithdrawThread(account, <span class="number">20</span>), <span class="string">"withdraw"</span>);</div><div class="line">		a.start();</div><div class="line">		b.start();</div><div class="line">		a.join();</div><div class="line">		b.join();</div><div class="line">		System.out.println(account.getBalance());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AddThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">		Account account;</div><div class="line">		<span class="keyword">int</span> amount;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">AddThread</span><span class="params">(Account account, <span class="keyword">int</span> amount)</span> </span>&#123;</div><div class="line">			<span class="keyword">this</span>.account = account;</div><div class="line">			<span class="keyword">this</span>.amount = amount;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200000</span>; i++) &#123;</div><div class="line">				account.add(amount);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WithdrawThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">		Account account;</div><div class="line">		<span class="keyword">int</span> amount;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">WithdrawThread</span><span class="params">(Account account, <span class="keyword">int</span> amount)</span> </span>&#123;</div><div class="line">			<span class="keyword">this</span>.account = account;</div><div class="line">			<span class="keyword">this</span>.amount = amount;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</div><div class="line">				account.withdraw(amount);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-join用法"><a href="#2-join用法" class="headerlink" title="2 join用法"></a>2 join用法</h3><p>线程的join方法：<br>    子线程执行join方法，后主线程必须等待子线程执行完之后才能继续往下执行。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadJoin</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		Thread aThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Son());</div><div class="line">		Thread bThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Son());</div><div class="line">		aThread.start();</div><div class="line">		bThread.start();</div><div class="line"><span class="comment">//		try &#123;</span></div><div class="line"><span class="comment">//			aThread.join();</span></div><div class="line"><span class="comment">//			bThread.join();</span></div><div class="line"><span class="comment">//		&#125; catch (InterruptedException e) &#123;</span></div><div class="line"><span class="comment">//			e.printStackTrace();</span></div><div class="line"><span class="comment">//		&#125;</span></div><div class="line">		System.out.println(<span class="string">"主线程结束"</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		ThreadJoin threadJoin = <span class="keyword">new</span> ThreadJoin();</div><div class="line">		threadJoin.start();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"子线程执行"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>子线程不使用join结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">主线程结束</div><div class="line">子线程执行</div><div class="line">子线程执行</div></pre></td></tr></table></figure></p>
<p>子线程使用join结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">子线程执行</div><div class="line">子线程执行</div><div class="line">主线程结束</div></pre></td></tr></table></figure></p>
<h3 id="3-多线程保证数据安全性-生产者与消费者模式经典案例"><a href="#3-多线程保证数据安全性-生产者与消费者模式经典案例" class="headerlink" title="3 多线程保证数据安全性(生产者与消费者模式经典案例)"></a>3 多线程保证数据安全性(生产者与消费者模式经典案例)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Plate</span> </span>&#123;</div><div class="line"></div><div class="line">	List&lt;Object&gt; eggs = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Object <span class="title">getEgg</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (eggs.size() == <span class="number">0</span>) &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				wait();</div><div class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		Object egg = eggs.get(<span class="number">0</span>);</div><div class="line">		eggs.clear();<span class="comment">// 清空盘子</span></div><div class="line">		notify();</div><div class="line">		System.out.println(<span class="string">"拿到鸡蛋"</span>);</div><div class="line">		<span class="keyword">return</span> egg;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">putEgg</span><span class="params">(Object egg)</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (eggs.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				System.out.println(<span class="string">"执行了putEgg中的wait方法"</span>);</div><div class="line">				wait();</div><div class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		eggs.add(egg);<span class="comment">// 往盘子里放鸡蛋</span></div><div class="line">		System.out.println(<span class="string">"执行了putEgg中的notify方法"</span>);</div><div class="line">		notify();</div><div class="line">		System.out.println(<span class="string">"putEgg中的notfy方法执行结束"</span>);</div><div class="line">		System.out.println(<span class="string">"放入鸡蛋"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AddThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">		<span class="keyword">private</span> Plate plate;</div><div class="line">		<span class="keyword">private</span> Object egg = <span class="keyword">new</span> Object();</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">AddThread</span><span class="params">(Plate plate)</span> </span>&#123;</div><div class="line">			<span class="keyword">this</span>.plate = plate;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">				plate.putEgg(egg);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">GetThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">		<span class="keyword">private</span> Plate plate;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">GetThread</span><span class="params">(Plate plate)</span> </span>&#123;</div><div class="line">			<span class="keyword">this</span>.plate = plate;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">				plate.getEgg();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			Plate plate = <span class="keyword">new</span> Plate();</div><div class="line">			Thread add = <span class="keyword">new</span> Thread(<span class="keyword">new</span> AddThread(plate));</div><div class="line">			Thread get = <span class="keyword">new</span> Thread(<span class="keyword">new</span> GetThread(plate));</div><div class="line">			<span class="comment">/**</span></div><div class="line">			 * 线程执行过程：</div><div class="line">			 * 	有两个线程add线程和get线程同时共享Plate类对象。</div><div class="line">			 * 	add.start(); // add线程首先进入就绪队列，等待执行</div><div class="line">				get.start(); // get线程进入就绪队列，等待执行</div><div class="line">			 * 	add线程执行putEgg方法：</div><div class="line">			 * 	add线程启动，执行putEgg方法时获取Plate类对象锁，此时get线程不能获取Plate类对象锁,因此执行不了getEgg方法。</div><div class="line">			 * 	当add线程执行putEgg方法中的notify()方法后，add线程的锁并没有释放掉，而是唤醒锁(Plate类对象)的阻塞队列的线程(程序开始并没有阻塞队列的线程)到就绪队列，putEgg继续执行，打印出放入鸡蛋</div><div class="line">			 * 	当add线程执行完putEgg方法方法后，释放掉Plate类锁对象，此时盘子中有一个鸡蛋。这时get线程有可能获取锁对象开始执行(要不要执行取决于cpu会不会分配资源给get线程)。</div><div class="line">			 *	add线程执行getEgg方法：</div><div class="line">			 *	当add线程释放掉锁后，不一定执行get线程</div><div class="line">			 *		1.如果仍然执行get线程，get线程获取锁执行getEgg方法，此时盘子中有鸡蛋，会执行clear方法，盘子中鸡蛋被清空，继续执行notify方法，将会唤醒add线程进入就绪队列，get线程继续执行，打印出拿到鸡蛋。释放掉锁，get线程执行结束。</div><div class="line">			 *		2.如果执行add线程，add线程获取锁执行putEgg方法，此时盘子中有鸡蛋，会执行wait方法，这时add线程释放掉锁，进入阻塞队列等待get线程唤醒add线程，此时盘子中有鸡蛋，add线程执行结束。</div><div class="line">			 *			这时get线程获取锁执行getEgg方法，清空盘子中的鸡蛋后，继续执行notify方法，add线程进入就绪队列，等待执行，get线程继续执行getEgg方法，打印出拿到鸡蛋，并释放掉锁，此时盘子清空了。</div><div class="line">			 */</div><div class="line">			add.start();</div><div class="line">			get.start();</div><div class="line">			add.join();</div><div class="line">			get.join();</div><div class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		System.out.println(<span class="string">"测试结束"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行结果是有序的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">执行了putEgg中的notify方法</div><div class="line">putEgg中的notfy方法执行结束</div><div class="line">放入鸡蛋</div><div class="line">拿到鸡蛋</div><div class="line">执行了putEgg中的notify方法</div><div class="line">putEgg中的notfy方法执行结束</div><div class="line">放入鸡蛋</div><div class="line">拿到鸡蛋</div><div class="line">执行了putEgg中的notify方法</div><div class="line">putEgg中的notfy方法执行结束</div><div class="line">放入鸡蛋</div><div class="line">拿到鸡蛋</div><div class="line">执行了putEgg中的notify方法</div><div class="line">putEgg中的notfy方法执行结束</div><div class="line">放入鸡蛋</div><div class="line">拿到鸡蛋</div><div class="line">执行了putEgg中的notify方法</div><div class="line">putEgg中的notfy方法执行结束</div><div class="line">放入鸡蛋</div><div class="line">拿到鸡蛋</div><div class="line">测试结束</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SSO]]></title>
      <url>https://volc1605.github.io/2017/06/02/SSO/</url>
      <content type="html"><![CDATA[<h3 id="1-单点登录"><a href="#1-单点登录" class="headerlink" title="1 单点登录"></a>1 单点登录</h3><h4 id="1-1-单点登录特点"><a href="#1-1-单点登录特点" class="headerlink" title="1.1 单点登录特点"></a>1.1 单点登录特点</h4><p>之前实现的登录和注册是在同一个tomcat内部完成，我们现在的系统架构是每一个系统都是由一个团队0进行维护，每个系统都是单独部署运行一个单独的tomcat，所以，不能将用户的登录信息保存到session中（多个tomcat的session是不能共享的），所以我们需要一个单独的系统来维护用户的登录信息。</p>
<p>普通登录：用户数据保存在session中，下次登录获取cookie的sessionId对应的值再去从session中获取用户数据。<br>单点登录(SSO<a href="http://blog.csdn.net/cutesource/article/details/5838693" target="_blank" rel="external">参考</a>):<br>流程和普通登录类似，不同的是用户数据存放在系统外部redis缓存中，从而实现多系统数据的共享。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Redis]]></title>
      <url>https://volc1605.github.io/2017/06/02/Redis/</url>
      <content type="html"><![CDATA[<p>Redis特性<br><img src="https://volc1605.github.io/images/Redis/texing.png" alt="texing"><br><a id="more"></a></p>
<h3 id="1-windows-64-环境下解压安装包redis-2-8-9-zip"><a href="#1-windows-64-环境下解压安装包redis-2-8-9-zip" class="headerlink" title="1 windows(64)环境下解压安装包redis-2.8.9.zip"></a>1 windows(64)环境下解压安装包redis-2.8.9.zip</h3><p>感兴趣的点击 -&gt;&gt; <a href="http://volcfamily.cn/2017/03/05/linux%E4%B8%8B%E5%AE%89%E8%A3%85Redis/" target="_blank" rel="external">linux下安装Redis</a></p>
<h4 id="1-1-删除Redis服务"><a href="#1-1-删除Redis服务" class="headerlink" title="1.1 删除Redis服务"></a>1.1 删除Redis服务</h4><p>管理员命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">C:\windows\system32&gt;sc delete Redis</div><div class="line">[SC] DeleteService 成功</div><div class="line"></div><div class="line">C:\windows\system32&gt;</div></pre></td></tr></table></figure></p>
<h4 id="1-2-双击redis-server-exe"><a href="#1-2-双击redis-server-exe" class="headerlink" title="1.2 双击redis-server.exe"></a>1.2 双击redis-server.exe</h4><p><img src="https://volc1605.github.io/images/Redis/redis.png" alt="redis"></p>
<h4 id="1-3-注册到系统服务中"><a href="#1-3-注册到系统服务中" class="headerlink" title="1.3 注册到系统服务中"></a>1.3 注册到系统服务中</h4><p>执行以下命令即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">D:\redis-2.8.9&gt;redis-server --service-install redis.windows.conf --loglevel verbose</div><div class="line">[13828] 02 Jun 14:17:18.824 # Redis successfully installed as a service.</div><div class="line">D:\redis-2.8.9&gt;</div></pre></td></tr></table></figure></p>
<p>找到Redis服务并启动</p>
<h4 id="1-4-测试"><a href="#1-4-测试" class="headerlink" title="1.4 测试"></a>1.4 测试</h4><p>双击D:\redis-2.8.9\redis-cli.exe</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; ping</div><div class="line">PONG  -- 成功</div><div class="line">127.0.0.1:6379&gt;</div></pre></td></tr></table></figure>
<h4 id="1-5-优化内存"><a href="#1-5-优化内存" class="headerlink" title="1.5 优化内存"></a>1.5 优化内存</h4><p>修改D:\redis-2.8.9\redis.windows.conf文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># maxmemory &lt;bytes&gt;</div><div class="line">maxmemory 200mb          # 200M</div></pre></td></tr></table></figure></p>
<p>重启Redis服务,可以看到D:\redis-2.8.9&gt;\RedisQFork_1004.dat这个文件大小控制在300M左右，节省了内存资源。</p>
<h4 id="1-5-总结"><a href="#1-5-总结" class="headerlink" title="1.5 总结"></a>1.5 总结</h4><p>可连接外部服务器上的Redis<br><img src="https://volc1605.github.io/images/Redis/cl.png" alt="cl"></p>
<h3 id="2-redis-cli的使用之命令返回值"><a href="#2-redis-cli的使用之命令返回值" class="headerlink" title="2 redis-cli的使用之命令返回值"></a>2 redis-cli的使用之命令返回值</h3><p><img src="https://volc1605.github.io/images/Redis/re.png" alt="cl"></p>
<h3 id="3-多数据库"><a href="#3-多数据库" class="headerlink" title="3 多数据库"></a>3 多数据库</h3><p><img src="https://volc1605.github.io/images/Redis/many.png" alt="many"></p>
<p>FLUSHALL  – 清空所有数据库的所有数据<br>FLUSHDB   –  清空当前所在数据库的数据</p>
<h3 id="4-Redis的基本命令"><a href="#4-Redis的基本命令" class="headerlink" title="4 Redis的基本命令"></a>4 Redis的基本命令</h3><h4 id="4-1-KEYS"><a href="#4-1-KEYS" class="headerlink" title="4.1 KEYS"></a>4.1 KEYS</h4><p><img src="https://volc1605.github.io/images/Redis/p1.png" alt="cl"></p>
<h4 id="4-2-EXISTS"><a href="#4-2-EXISTS" class="headerlink" title="4.2 EXISTS"></a>4.2 EXISTS</h4><p><img src="https://volc1605.github.io/images/Redis/p2.png" alt="cl"></p>
<h4 id="4-3-DEL"><a href="#4-3-DEL" class="headerlink" title="4.3 DEL"></a>4.3 DEL</h4><p><img src="https://volc1605.github.io/images/Redis/p3.png" alt="cl"><br>删除key为a、b、c、d的数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">key a b c d</div></pre></td></tr></table></figure></p>
<h4 id="4-4-TYPE"><a href="#4-4-TYPE" class="headerlink" title="4.4 TYPE"></a>4.4 TYPE</h4><p><img src="https://volc1605.github.io/images/Redis/p4.png" alt="p4"></p>
<h4 id="4-5-HELP"><a href="#4-5-HELP" class="headerlink" title="4.5 HELP"></a>4.5 HELP</h4><p>HELP 空格 tab键<br><img src="https://volc1605.github.io/images/Redis/p5.png" alt="cl"></p>
<h3 id="5-Redis的字符串数据类型"><a href="#5-Redis的字符串数据类型" class="headerlink" title="5 Redis的字符串数据类型"></a>5 Redis的字符串数据类型</h3><h4 id="5-1-字符串类型"><a href="#5-1-字符串类型" class="headerlink" title="5.1 字符串类型"></a>5.1 字符串类型</h4><p><img src="https://volc1605.github.io/images/Redis/d1.png" alt="d1"></p>
<h4 id="5-2-GET、SET"><a href="#5-2-GET、SET" class="headerlink" title="5.2 GET、SET"></a>5.2 GET、SET</h4><p><img src="https://volc1605.github.io/images/Redis/d2.png" alt="d1"></p>
<h4 id="5-3-INCR"><a href="#5-3-INCR" class="headerlink" title="5.3 INCR"></a>5.3 INCR</h4><p><img src="https://volc1605.github.io/images/Redis/d3.png" alt="d1"></p>
<h4 id="5-3-INCRBY"><a href="#5-3-INCRBY" class="headerlink" title="5.3 INCRBY"></a>5.3 INCRBY</h4><p><img src="https://volc1605.github.io/images/Redis/d4.png" alt="d1"></p>
<h4 id="5-3-DECR、DECRBY"><a href="#5-3-DECR、DECRBY" class="headerlink" title="5.3 DECR、DECRBY"></a>5.3 DECR、DECRBY</h4><p><img src="https://volc1605.github.io/images/Redis/d5.png" alt="d1"></p>
<h4 id="5-3-APPEND"><a href="#5-3-APPEND" class="headerlink" title="5.3 APPEND"></a>5.3 APPEND</h4><p><img src="https://volc1605.github.io/images/Redis/d6.png" alt="d1"></p>
<h4 id="5-3-STRLEN"><a href="#5-3-STRLEN" class="headerlink" title="5.3 STRLEN"></a>5.3 STRLEN</h4><p><img src="https://volc1605.github.io/images/Redis/d7.png" alt="d1"></p>
<h4 id="5-3-MSET、MGET"><a href="#5-3-MSET、MGET" class="headerlink" title="5.3 MSET、MGET"></a>5.3 MSET、MGET</h4><p><img src="https://volc1605.github.io/images/Redis/d8.png" alt="d1"></p>
<h3 id="6-Redis之生存时间-用于缓存"><a href="#6-Redis之生存时间-用于缓存" class="headerlink" title="6 Redis之生存时间(用于缓存)"></a>6 Redis之生存时间(用于缓存)</h3><h4 id="6-1-设置生存时间"><a href="#6-1-设置生存时间" class="headerlink" title="6.1 设置生存时间"></a>6.1 设置生存时间</h4><p><img src="https://volc1605.github.io/images/Redis/s1.png" alt="s"><br>TTL返回值：<br>大于0的数字：剩余生存时间，单位为秒<br>-1 ： 没有生存时间，永久存储<br>-2 ： 数据已经被删除</p>
<h4 id="6-1-清除生存时间"><a href="#6-1-清除生存时间" class="headerlink" title="6.1 清除生存时间"></a>6.1 清除生存时间</h4><p><img src="https://volc1605.github.io/images/Redis/s2.png" alt="s"><br>生存时间是针对值的，并不是key。</p>
<h4 id="6-2-设置毫秒"><a href="#6-2-设置毫秒" class="headerlink" title="6.2 设置毫秒"></a>6.2 设置毫秒</h4><p><img src="https://volc1605.github.io/images/Redis/s3.png" alt="s"></p>
<h3 id="7-spring整合Redis"><a href="#7-spring整合Redis" class="headerlink" title="7 spring整合Redis"></a>7 spring整合Redis</h3><h4 id="7-1-引用依赖"><a href="#7-1-引用依赖" class="headerlink" title="7.1 引用依赖"></a>7.1 引用依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;redis.clients&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;jedis&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;2.6.0&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>使用Redis要确定一点是，缓存逻辑要写在后台。</p>
<p>导入依赖的原则：<br>1、在使用依赖的最底层导入。Redis业务是在聚合工程中的service项目中，所以要在service项目中引入依赖<br>2、运行时所需要的依赖在(聚合工程中的)web项目中加入。(系统加载时就需要依赖)<br>3、所有的工程都需要的依赖应该在聚合工程（taotao-manage）中导入。</p>
<h4 id="7-2-spring整合Redis文件"><a href="#7-2-spring整合Redis文件" class="headerlink" title="7.2 spring整合Redis文件"></a>7.2 spring整合Redis文件</h4><p>applicationContext-redis.xml(聚合工程web项目中)<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 定义分片式连接池 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shardedJedisPool"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.ShardedJedisPool"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span>&gt;</span> <span class="comment">&lt;!-- 第一个参数 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.maxTotal&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span>&gt;</span> <span class="comment">&lt;!-- 第二个参数 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span><span class="comment">&lt;!-- 可定义多个redis节点分片式集群 --&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisShardInfo"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.node1.host&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.node1.port&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>	</div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 结束 --&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="7-3-Redis配置属性文件"><a href="#7-3-Redis配置属性文件" class="headerlink" title="7.3 Redis配置属性文件"></a>7.3 Redis配置属性文件</h4><p>redis.properties((聚合工程web项目中))<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">redis.maxTotal=100</div><div class="line">redis.node1.host=127.0.0.1</div><div class="line">redis.node1.port=6379</div></pre></td></tr></table></figure></p>
<h4 id="7-4-封装RedisService类"><a href="#7-4-封装RedisService类" class="headerlink" title="7.4 封装RedisService类"></a>7.4 封装RedisService类</h4><p>处理代码复用的问题，面向接口编程。<br>公用的代码逻辑放在同一个方法中，而不同的逻辑需要具体实现。这里就要使用接口处理。</p>
<p>接口类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">E</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">callback</span><span class="params">(E e)</span></span>; <span class="comment">// 具体的业务实现方法</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>RedisService类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</div><div class="line"><span class="keyword">import</span> redis.clients.jedis.ShardedJedis;</div><div class="line"><span class="keyword">import</span> redis.clients.jedis.ShardedJedisPool;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> RedisService</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 封住用于redis缓存的数据操作，通用方法</div><div class="line"> * <span class="doctag">@Date</span> 2017年2月27日 下午8:42:36</div><div class="line"> */</div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 保证common的通用性，如果spring容器中没有ShardedJedisPool bean就不使用redis如果有就使用</span></div><div class="line">    <span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</div><div class="line">    <span class="keyword">private</span> ShardedJedisPool shardedJedisPool;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> execute </div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 泛型方法用于处理存入缓存和从缓存中取数据</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月27日 下午9:04:59</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> &lt;T&gt; <span class="function">T <span class="title">execute</span><span class="params">(Function&lt;T, ShardedJedis&gt; fun)</span> </span>&#123;</div><div class="line">	ShardedJedis shardedJedis = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// 从连接池中获取到jedis分片对象</span></div><div class="line">	    shardedJedis = shardedJedisPool.getResource();</div><div class="line">	    <span class="comment">// 数据放入到redis中</span></div><div class="line">	    <span class="keyword">return</span> fun.callback(shardedJedis); <span class="comment">// insert成功返回OK</span></div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">if</span> (<span class="keyword">null</span> != shardedJedis) &#123;</div><div class="line">		<span class="comment">// 关闭，检测连接是否有效，有效则放回到连接池中，无效则重置状态</span></div><div class="line">		shardedJedis.close();</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> set </div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 缓存数据到redis</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月27日 下午8:45:51</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String value)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.execute(<span class="keyword">new</span> Function&lt;String, ShardedJedis&gt;() &#123; <span class="comment">// 匿名实现类存在作用域，不能使用非final参数</span></div><div class="line">	    <span class="meta">@Override</span></div><div class="line">	    <span class="function"><span class="keyword">public</span> String <span class="title">callback</span><span class="params">(ShardedJedis e)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> e.set(key, value); <span class="comment">// 添加成功返回OK</span></div><div class="line">	    &#125;</div><div class="line">	&#125;);</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * ShardedJedis shardedJedis = null; try &#123; // 从连接池中获取到jedis分片对象</div><div class="line">	 * shardedJedis = shardedJedisPool.getResource(); // 数据放入到redis中 return</div><div class="line">	 * shardedJedis.set(key, value); // insert成功返回OK &#125; catch (Exception e) &#123;</div><div class="line">	 * e.printStackTrace(); &#125; finally &#123; if (null != shardedJedis) &#123; //</div><div class="line">	 * 关闭，检测连接是否有效，有效则放回到连接池中，无效则重置状态 shardedJedis.close(); &#125; &#125; return null;</div><div class="line">	 */</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> get </div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 从redis缓存中取数据</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月27日 下午8:48:47</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(<span class="keyword">final</span> String key)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.execute(<span class="keyword">new</span> Function&lt;String, ShardedJedis&gt;() &#123;</div><div class="line">	    <span class="meta">@Override</span></div><div class="line">	    <span class="function"><span class="keyword">public</span> String <span class="title">callback</span><span class="params">(ShardedJedis e)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> e.get(key); <span class="comment">// 返回key对应的value值</span></div><div class="line">	    &#125;</div><div class="line">	&#125;);</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * ShardedJedis shardedJedis = null; try &#123; // 从连接池中获取到jedis分片对象</div><div class="line">	 * shardedJedis = shardedJedisPool.getResource(); // 从redis中取数据 return</div><div class="line">	 * shardedJedis.get(key); // 返回key对应的value值 &#125; catch (Exception e) &#123;</div><div class="line">	 * e.printStackTrace(); &#125; finally &#123; if (null != shardedJedis) &#123; //</div><div class="line">	 * 关闭，检测连接是否有效，有效则放回到连接池中，无效则重置状态 shardedJedis.close(); &#125; &#125; return null;</div><div class="line">	 */</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> del</div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 根据key删除缓存</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月27日 下午9:21:09</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">del</span><span class="params">(<span class="keyword">final</span> String key)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.execute(<span class="keyword">new</span> Function&lt;Long, ShardedJedis&gt;() &#123;</div><div class="line">	    <span class="meta">@Override</span></div><div class="line">	    <span class="function"><span class="keyword">public</span> Long <span class="title">callback</span><span class="params">(ShardedJedis e)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> e.del(key); <span class="comment">// 根据key删除redis缓存</span></div><div class="line">	    &#125;</div><div class="line">	&#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> expire</div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 设置缓存的生存时间，到期会从缓存中移除</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月27日 下午9:24:18</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> Integer seconds)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.execute(<span class="keyword">new</span> Function&lt;Long, ShardedJedis&gt;() &#123;</div><div class="line">	    <span class="meta">@Override</span></div><div class="line">	    <span class="function"><span class="keyword">public</span> Long <span class="title">callback</span><span class="params">(ShardedJedis e)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> e.expire(key, seconds);</div><div class="line">	    &#125;</div><div class="line">	&#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> set</div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 设置String类型的值，存入缓存时设置缓存数据的生存时间</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月27日 下午9:26:10</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String value, <span class="keyword">final</span> Integer seconds)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.execute(<span class="keyword">new</span> Function&lt;String, ShardedJedis&gt;() &#123;</div><div class="line">	    <span class="meta">@Override</span></div><div class="line">	    <span class="function"><span class="keyword">public</span> String <span class="title">callback</span><span class="params">(ShardedJedis e)</span> </span>&#123;</div><div class="line">		String result = e.set(key, value);</div><div class="line">		<span class="comment">// 设置这个缓存数据的生存时间</span></div><div class="line">		e.expire(key, seconds);</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	    &#125;</div><div class="line">	&#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>以上的方法是Redis缓存通用方法，需要放到common项目中，以便其他项目调用。</p>
<h4 id="7-5-项目添加缓存逻辑"><a href="#7-5-项目添加缓存逻辑" class="headerlink" title="7.5 项目添加缓存逻辑"></a>7.5 项目添加缓存逻辑</h4><p><strong>原则：不能影响原来的业务逻辑的正常执行</strong>，通常使用trycatch处理。<br>目的：提高查询速度，减少数据库压力<br>项目中添加缓存的逻辑：<br>前后台交互：<br>    查询之前先从缓存中命中，如果命中就返回。没有命中才去数据库中查询(程序继续执行)，再把数据存放到缓存中。<br>后台：<br>    问题：当后台改变数据时，应该通知前台数据改变了，否则前台查出来的数据仍是缓存中未改变的数据。<br>    实现：前台系统应该为后台提供一个删除该缓存的接口，当后台系统改变数据时，调用前台的这个接口，删除该缓存，保证数据的准确性。<br>    注意：</p>
<pre><code>&gt;1.service层中不能使用trycatch，一旦捕获异常，事物将会失效。
&gt;2.而后台请求前台的删除缓存接口逻辑和后台的其他逻辑不属于同一业务，这里是可以进行trycatch处理的。
&gt;3.这一机制没有考虑到系统之间的耦合度，也就是前台需求改变，后台也要去跟着改变逻辑适应前台。
&gt;4.以上是临时解决方法，可采用rabbitmq(消息队列)代替，实现业务并降低系统之间的耦合度。
</code></pre><p>部分代码：</p>
<p>接受json数据的bean<br>ItemCatResult<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemCatResult</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"data"</span>) <span class="comment">// 指定序列化json数据后的名称</span></div><div class="line">    <span class="keyword">private</span> List&lt;ItemCatData&gt; itemCats = <span class="keyword">new</span> ArrayList&lt;ItemCatData&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;ItemCatData&gt; <span class="title">getItemCats</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> itemCats;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItemCats</span><span class="params">(List&lt;ItemCatData&gt; itemCats)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.itemCats = itemCats;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ItemCatData<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemCatData</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"u"</span>) <span class="comment">// 序列化成json数据时为 u</span></div><div class="line">    <span class="keyword">private</span> String url;</div><div class="line"></div><div class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"n"</span>)</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"i"</span>)</div><div class="line">    <span class="keyword">private</span> List&lt;?&gt; items;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> url;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUrl</span><span class="params">(String url)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.url = url;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> List&lt;?&gt; getItems() &#123;</div><div class="line">	<span class="keyword">return</span> items;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItems</span><span class="params">(List&lt;?&gt; items)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.items = items;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>访问接口的逻辑处理类ItemCatService<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"><span class="keyword">import</span> com.taotao.common.bean.ItemCatData;</div><div class="line"><span class="keyword">import</span> com.taotao.common.bean.ItemCatResult;</div><div class="line"><span class="keyword">import</span> com.taotao.common.service.RedisService;</div><div class="line"><span class="keyword">import</span> com.taotao.manage.pojo.ItemCat;</div><div class="line"></div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemCatService</span> <span class="keyword">extends</span> <span class="title">BaseService</span>&lt;<span class="title">ItemCat</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> RedisService redisService;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectMapper MAPPER = <span class="keyword">new</span> ObjectMapper();</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REDIS_KEY = <span class="string">"TAOTAO_MANAGE_ITEM_CAT_ALL"</span>; <span class="comment">// 最佳实践，项目名+模块名+业务名</span></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer REDIS_TIME = <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">3</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 全部查询，并且生成树状结构</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> ItemCatResult <span class="title">queryAllToTree</span><span class="params">()</span> </span>&#123;</div><div class="line">	ItemCatResult result = <span class="keyword">new</span> ItemCatResult();</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 先从缓存中命中，如果命中就返回，如果没有命中执行以下程序 ，这里加入缓存有可能影响业务逻辑的正常执行，这里需要进行优化处理</div><div class="line">	 * 进行trycatch，出现异常捕获后继续向下进行</div><div class="line">	 */</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    String cacheData = <span class="keyword">this</span>.redisService.get(REDIS_KEY);</div><div class="line">	    <span class="comment">/**</span></div><div class="line">	     * cacheData格式</div><div class="line">	        &#123;</div><div class="line">	          "data": [</div><div class="line">	            &#123;</div><div class="line">	              "u": "/products/1.html",</div><div class="line">	              "n": "&lt;a href='/products/1.html'&gt;图书、音像、电子书刊&lt;/a&gt;",</div><div class="line">	              "i": [</div><div class="line">	                &#123;</div><div class="line">	                  "u": "/products/2.html",</div><div class="line">	                  "n": "电子书刊",</div><div class="line">	                  "i": [</div><div class="line">	                    "/products/3.html|电子书",</div><div class="line">	                    "/products/4.html|网络原创",</div><div class="line">	                    "/products/5.html|数字杂志",</div><div class="line">	                    "/products/6.html|多媒体图书"</div><div class="line">	                  ]</div><div class="line">	                &#125;,</div><div class="line">	                &#123;</div><div class="line">	                  "u": "/products/7.html",</div><div class="line">	                  "n": "音像",</div><div class="line">	                  "i": [</div><div class="line">	                    "/products/8.html|音乐",</div><div class="line">	                    "/products/9.html|影视",</div><div class="line">	                    "/products/10.html|教育音像"</div><div class="line">	                  ]</div><div class="line">	                &#125;</div><div class="line">	              ]</div><div class="line">	            &#125;</div><div class="line">	          ]</div><div class="line">	        &#125;</div><div class="line">	     */</div><div class="line">	    <span class="keyword">if</span> (StringUtils.isNotEmpty(cacheData)) &#123;</div><div class="line">		<span class="comment">// 命中,进行反序列化，ItemCatData中items是个泛型的list，并不会转成具体的对象</span></div><div class="line">		<span class="keyword">return</span> MAPPER.readValue(cacheData, ItemCatResult.class);</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 全部查出，并且在内存中生成树形结构</span></div><div class="line">	List&lt;ItemCat&gt; cats = <span class="keyword">super</span>.queryAll();</div><div class="line">	<span class="comment">// 转为map存储，key为父节点ID，value为数据集合</span></div><div class="line">	Map&lt;Long, List&lt;ItemCat&gt;&gt; itemCatMap = <span class="keyword">new</span> HashMap&lt;Long, List&lt;ItemCat&gt;&gt;();</div><div class="line">	<span class="keyword">for</span> (ItemCat itemCat : cats) &#123;</div><div class="line">	    <span class="keyword">if</span> (!itemCatMap.containsKey(itemCat.getParentId())) &#123;</div><div class="line">		itemCatMap.put(itemCat.getParentId(), <span class="keyword">new</span> ArrayList&lt;ItemCat&gt;());</div><div class="line">	    &#125;</div><div class="line">	    itemCatMap.get(itemCat.getParentId()).add(itemCat);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 封装一级对象</span></div><div class="line">	List&lt;ItemCat&gt; itemCatList1 = itemCatMap.get(<span class="number">0L</span>);</div><div class="line">	<span class="keyword">for</span> (ItemCat itemCat : itemCatList1) &#123;</div><div class="line">	    ItemCatData itemCatData = <span class="keyword">new</span> ItemCatData();</div><div class="line">	    itemCatData.setUrl(<span class="string">"/products/"</span> + itemCat.getId() + <span class="string">".html"</span>);</div><div class="line">	    itemCatData.setName(<span class="string">"&lt;a href='"</span> + itemCatData.getUrl() + <span class="string">"'&gt;"</span> + itemCat.getName() + <span class="string">"&lt;/a&gt;"</span>);</div><div class="line">	    result.getItemCats().add(itemCatData);</div><div class="line">	    <span class="keyword">if</span> (!itemCat.getIsParent()) &#123;</div><div class="line">		<span class="keyword">continue</span>;</div><div class="line">	    &#125;</div><div class="line"></div><div class="line">	    <span class="comment">// 封装二级对象</span></div><div class="line">	    List&lt;ItemCat&gt; itemCatList2 = itemCatMap.get(itemCat.getId());</div><div class="line">	    List&lt;ItemCatData&gt; itemCatData2 = <span class="keyword">new</span> ArrayList&lt;ItemCatData&gt;();</div><div class="line">	    itemCatData.setItems(itemCatData2);</div><div class="line">	    <span class="keyword">for</span> (ItemCat itemCat2 : itemCatList2) &#123;</div><div class="line">		ItemCatData id2 = <span class="keyword">new</span> ItemCatData();</div><div class="line">		id2.setName(itemCat2.getName());</div><div class="line">		id2.setUrl(<span class="string">"/products/"</span> + itemCat2.getId() + <span class="string">".html"</span>);</div><div class="line">		itemCatData2.add(id2);</div><div class="line">		<span class="keyword">if</span> (itemCat2.getIsParent()) &#123;</div><div class="line">		    <span class="comment">// 封装三级对象</span></div><div class="line">		    List&lt;ItemCat&gt; itemCatList3 = itemCatMap.get(itemCat2.getId());</div><div class="line">		    List&lt;String&gt; itemCatData3 = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">		    id2.setItems(itemCatData3);</div><div class="line">		    <span class="keyword">for</span> (ItemCat itemCat3 : itemCatList3) &#123;</div><div class="line">			itemCatData3.add(<span class="string">"/products/"</span> + itemCat3.getId() + <span class="string">".html|"</span> + itemCat3.getName());</div><div class="line">		    &#125;</div><div class="line">		&#125;</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">if</span> (result.getItemCats().size() &gt;= <span class="number">14</span>) &#123;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 这里不能用JsonProcessingException进行捕获，需要使用Exception大的异常进行获取添加缓存时的异常</div><div class="line">	 */</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// 将结果集写入到缓存中</span></div><div class="line">	    <span class="keyword">this</span>.redisService.set(REDIS_KEY, MAPPER.writeValueAsString(result), REDIS_TIME);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="8-linux安装Redis"><a href="#8-linux安装Redis" class="headerlink" title="8 linux安装Redis"></a>8 linux安装Redis</h3><p><img src="https://volc1605.github.io/images/Redis/anzhuang.png" alt="anzhaung"><br>注意：需要开放6379端口</p>
<h3 id="9-缓存三暖男"><a href="#9-缓存三暖男" class="headerlink" title="9 缓存三暖男"></a>9 缓存三暖男</h3><p>ehcache memcache redis<br><a href="http://www.cnblogs.com/duanxz/p/5215274.html" target="_blank" rel="external">http://www.cnblogs.com/duanxz/p/5215274.html</a></p>
<p>关于redis和memcache的不同，下面罗列了一些相关说法，供记录：<br>    redis和memecache的不同在于[2]：<br>    1、存储方式：<br>    memecache 把数据全部存在内存之中，断电后会挂掉，数据不能超过内存大小<br>    redis有部份存在硬盘上，这样能保证数据的持久性，支持数据的持久化（笔者注：有快照和AOF日志两种持久化方式，在实际应用的时候，要特别注意配置文件快照参数，要不就很有可能服务器频繁满载做dump）。<br>    2、数据支持类型：<br>    redis在数据支持上要比memecache多的多。<br>    3、使用底层模型不同：<br>    新版本的redis直接自己构建了VM 机制 ，因为一般的系统调用系统函数的话，会浪费一定的时间去移动和请求。<br>    4、运行环境不同：<br>    redis目前官方只支持LINUX 上去行，从而省去了对于其它系统的支持，这样的话可以更好的把精力用于本系统 环境上的优化，虽然后来微软有一个小组为其写了补丁。但是没有放到主干上<br>个人总结一下，有持久化需求或者对数据结构和处理有高级要求的应用，选择redis，其他简单的key/value存储，选择memcache。</p>
<p>关系型与非关系型数据库<br><a href="https://www.zhihu.com/question/24225007" target="_blank" rel="external">https://www.zhihu.com/question/24225007</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[从github拉取项目]]></title>
      <url>https://volc1605.github.io/2017/06/02/%E4%BB%8Egithub%E6%8B%89%E5%8F%96%E9%A1%B9%E7%9B%AE/</url>
      <content type="html"><![CDATA[<h3 id="1-使用github客户端windows-powershell操作项目"><a href="#1-使用github客户端windows-powershell操作项目" class="headerlink" title="1 使用github客户端windows powershell操作项目"></a>1 使用github客户端windows powershell操作项目</h3><a id="more"></a>
<h4 id="1-1-初始化本地仓库"><a href="#1-1-初始化本地仓库" class="headerlink" title="1.1 初始化本地仓库"></a>1.1 初始化本地仓库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PS E:\githubrepository\volc-quartz&gt; git init</div></pre></td></tr></table></figure>
<h4 id="1-2-clone项目到本地"><a href="#1-2-clone项目到本地" class="headerlink" title="1.2 clone项目到本地"></a>1.2 clone项目到本地</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PS E:\githubrepository\volc-quartz&gt; git clone git@github.com:volc1605/volc-quartz.git</div></pre></td></tr></table></figure>
<h4 id="1-3-拉取项目"><a href="#1-3-拉取项目" class="headerlink" title="1.3 拉取项目"></a>1.3 拉取项目</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">PS E:\githubrepository\volc-quartz&gt; git pull</div><div class="line">fatal: No remote repository specified.  Please, specify either a URL or a</div><div class="line">remote name from which new revisions should be fetched.</div></pre></td></tr></table></figure>
<p>存在错误，解决方法，修改volc-quartz目录下的.git目录中config配置文件<br>内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[core]</div><div class="line">	bare = false</div><div class="line">	repositoryformatversion = 0</div><div class="line">	filemode = false</div><div class="line">	symlinks = false</div><div class="line">	ignorecase = true</div><div class="line">	logallrefupdates = true</div><div class="line">[remote &quot;origin&quot;]</div><div class="line">	url = https://github.com/volc1605/volc-quartz.git</div><div class="line">	fetch = +refs/heads/*:refs/remotes/origin/*</div><div class="line">[branch &quot;master&quot;]</div><div class="line">	remote = origin</div><div class="line">	merge = refs/heads/master</div></pre></td></tr></table></figure>
<p>url换成自己的github中volc-quartz项目的访问地址(<a href="https://github.com/volc1605/volc-quartz)，再加上.git" target="_blank" rel="external">https://github.com/volc1605/volc-quartz)，再加上.git</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">PS E:\githubrepository\volc-quartz&gt; git pull             		-- 1.同步项目</div><div class="line">Your configuration specifies to merge with the ref &apos;refs/heads/master&apos;</div><div class="line">from the remote, but no such ref was fetched.</div><div class="line">PS E:\githubrepository\volc-quartz&gt; git add --all        		-- 2.添加本地仓库(volc-quartz)改变的文件</div><div class="line">PS E:\githubrepository\volc-quartz&gt; git commit -m &apos;说明备注&apos;    -- 3.提交文件到github中的volc-quartz项目</div><div class="line">[master (root-commit) a312267] j</div><div class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 &quot;volc-quartz/\346\226\260\345\273\272\346\226\207\346\234\254\346\226\207\346\241\243.txt&quot;</div><div class="line">PS E:\githubrepository\volc-quartz&gt; git push                    -- 4.推送到github中volc-quartz项目</div><div class="line">Counting objects: 4, done.</div></pre></td></tr></table></figure>
<h3 id="2-忽略文件或文件夹提交到github-git"><a href="#2-忽略文件或文件夹提交到github-git" class="headerlink" title="2 忽略文件或文件夹提交到github(git)"></a>2 忽略文件或文件夹提交到github(git)</h3><h4 id="2-1-创建-gitignore"><a href="#2-1-创建-gitignore" class="headerlink" title="2.1 创建.gitignore"></a>2.1 创建.gitignore</h4><p>在项目根目录下创建.gitignore文件<br>进入项目跟目录<br>右击 Git Bash Here<br>执行以下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch .gitignore</div></pre></td></tr></table></figure></p>
<h4 id="2-2-编辑忽略文件"><a href="#2-2-编辑忽略文件" class="headerlink" title="2.2 编辑忽略文件"></a>2.2 编辑忽略文件</h4><p>.gitignore</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 忽略test.txt文件</div><div class="line">test.txt</div><div class="line"># 忽略项目更目录下的test目录下的所有文件</div><div class="line">/test/*</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[spring整合httpclient]]></title>
      <url>https://volc1605.github.io/2017/06/02/spring%E6%95%B4%E5%90%88httpclient/</url>
      <content type="html"><![CDATA[<h3 id="1-spring整合httpclient"><a href="#1-spring整合httpclient" class="headerlink" title="1 spring整合httpclient"></a>1 spring整合httpclient</h3><a id="more"></a>
<h4 id="1-1-导入依赖"><a href="#1-1-导入依赖" class="headerlink" title="1.1 导入依赖"></a>1.1 导入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- httpclient --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="1-2-httpclient配置文件"><a href="#1-2-httpclient配置文件" class="headerlink" title="1.2 httpclient配置文件"></a>1.2 httpclient配置文件</h4><h5 id="1-2-1-httpclient-properties属性值配置文件"><a href="#1-2-1-httpclient-properties属性值配置文件" class="headerlink" title="1.2.1 httpclient.properties属性值配置文件"></a>1.2.1 httpclient.properties属性值配置文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">http.maxTotal=200</div><div class="line">http.defaultMaxPerRoute=50</div><div class="line">http.connectTimeout=1000</div><div class="line">http.connectionRequestTimeout=500</div><div class="line">http.socketTimeout=1000</div><div class="line">http.staleConnectionCheckEnabled=true</div></pre></td></tr></table></figure>
<h5 id="1-2-2-applicationContext-xml配置加载配置文件，spring配置文件中就可以使用-来获取httpclient-properties属性值"><a href="#1-2-2-applicationContext-xml配置加载配置文件，spring配置文件中就可以使用-来获取httpclient-properties属性值" class="headerlink" title="1.2.2 applicationContext.xml配置加载配置文件，spring配置文件中就可以使用${}来获取httpclient.properties属性值"></a>1.2.2 applicationContext.xml配置加载配置文件，spring配置文件中就可以使用${}来获取httpclient.properties属性值</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 使用spring自带的占位符替换功能 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</div><div class="line">		<span class="comment">&lt;!-- 允许JVM参数覆盖 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"systemPropertiesModeName"</span> <span class="attr">value</span>=<span class="string">"SYSTEM_PROPERTIES_MODE_OVERRIDE"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 忽略没有找到的资源文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ignoreResourceNotFound"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置资源文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:env.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:httpclient.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:redis.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:rabbitmq.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 扫描包 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.taotao"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="1-2-3-applicationContext-httpclient-xml"><a href="#1-2-3-applicationContext-httpclient-xml" class="headerlink" title="1.2.3 applicationContext-httpclient.xml"></a>1.2.3 applicationContext-httpclient.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义http链接管理器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"httpClientConnectionManager"</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.apache.http.impl.conn.PoolingHttpClientConnectionManager"</span>&gt;</div><div class="line">		<span class="comment">&lt;!-- 值写到配置文件中 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"$&#123;http.maxTotal&#125;"</span> /&gt;</span><span class="comment">&lt;!-- 最大连接数,主机链接量 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultMaxPerRoute"</span> <span class="attr">value</span>=<span class="string">"$&#123;http.defaultMaxPerRoute&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 每个主机的最大并发数 --&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 定义httpclient构建器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"httpClientBuilder"</span> <span class="attr">class</span>=<span class="string">"org.apache.http.impl.client.HttpClientBuilder"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionManager"</span> <span class="attr">ref</span>=<span class="string">"httpClientConnectionManager"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 定义httpclient对象 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 指定通过httpClientBuilder对象的build方法获取到httpclient对象, scope允许多例创建不同的httpclient对象 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 该对象是多例的 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"closeableHttpClient"</span> <span class="attr">class</span>=<span class="string">"org.apache.http.impl.client.CloseableHttpClient"</span></span></div><div class="line">		<span class="attr">factory-bean</span>=<span class="string">"httpClientBuilder"</span> <span class="attr">factory-method</span>=<span class="string">"build"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span> /&gt;</div><div class="line">	<span class="comment">&lt;!-- 请求参数的构建器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"requestConfigBuilder"</span> <span class="attr">class</span>=<span class="string">"org.apache.http.client.config.RequestConfig.Builder"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 建立连接的最长时间 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectTimeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;http.connectTimeout&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 从连接池获取到连接的最长时间 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionRequestTimeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;http.connectionRequestTimeout&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据传输的最长时间 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"socketTimeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;http.socketTimeout&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 请求连接时测试连接是否可用 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"staleConnectionCheckEnabled"</span> <span class="attr">value</span>=<span class="string">"$&#123;http.staleConnectionCheckEnabled&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 定义请求参数对象，是单利对象 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"requestConfig"</span> <span class="attr">class</span>=<span class="string">"org.apache.http.client.config.RequestConfig"</span></span></div><div class="line">		<span class="attr">factory-bean</span>=<span class="string">"requestConfigBuilder"</span> <span class="attr">factory-method</span>=<span class="string">"build"</span> /&gt;</div><div class="line">	<span class="comment">&lt;!-- 定期关闭无效的连接 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"idleConnectionEvictor"</span> <span class="attr">class</span>=<span class="string">"com.taotao.common.httpclient.IdleConnectionEvictor"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"httpClientConnectionManager"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="1-2-4-定时关闭httpclient对象无效链接"><a href="#1-2-4-定时关闭httpclient对象无效链接" class="headerlink" title="1.2.4 定时关闭httpclient对象无效链接"></a>1.2.4 定时关闭httpclient对象无效链接</h5><p>IdleConnectionEvictor.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.http.conn.HttpClientConnectionManager;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> IdleConnectionEvictor</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 定期关闭绑定线程的httpclient对象</div><div class="line"> * <span class="doctag">@Date</span> 2017年2月27日 下午8:20:22</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdleConnectionEvictor</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HttpClientConnectionManager connMgr;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> shutdown;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IdleConnectionEvictor</span><span class="params">(HttpClientConnectionManager connMgr)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.connMgr = connMgr;</div><div class="line">		<span class="comment">// 加载applicationContext-httpclient.xml，启动当前线程</span></div><div class="line">		<span class="keyword">this</span>.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="keyword">while</span> (!shutdown) &#123;</div><div class="line">		<span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">		    wait(<span class="number">5000</span>);</div><div class="line">		    <span class="comment">// 关闭失效的连接</span></div><div class="line">		    connMgr.closeExpiredConnections();</div><div class="line">		&#125;</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</div><div class="line">	    <span class="comment">// 结束</span></div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</div><div class="line">	shutdown = <span class="keyword">true</span>;</div><div class="line">	<span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">	    notifyAll();</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="1-2-4-请求bean"><a href="#1-2-4-请求bean" class="headerlink" title="1.2.4 请求bean"></a>1.2.4 请求bean</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.taotao.common.httpclient;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> HttpResult</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> http请求结果</div><div class="line"> * <span class="doctag">@Date</span> 2017年2月25日 上午10:29:07</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpResult</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Integer code; <span class="comment">// 状态码</span></div><div class="line">    <span class="keyword">private</span> String data; <span class="comment">// 返回数据</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">"HttpResult [code="</span> + code + <span class="string">", data="</span> + data + <span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpResult</span><span class="params">(Integer code, String data)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.code = code;</div><div class="line">	<span class="keyword">this</span>.data = data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpResult</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> code;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.code = code;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.data = data;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="1-2-5-封装请求通用方法ApiService"><a href="#1-2-5-封装请求通用方法ApiService" class="headerlink" title="1.2.5 封装请求通用方法ApiService"></a>1.2.5 封装请求通用方法ApiService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.URISyntaxException;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.ClientProtocolException;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.utils.URIBuilder;</div><div class="line"><span class="keyword">import</span> org.apache.http.entity.ContentType;</div><div class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</div><div class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</div><div class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</div><div class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanFactory;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanFactoryAware;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</div><div class="line"><span class="keyword">import</span> com.taotao.common.httpclient.HttpResult;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> ApiService</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 封装通用的请求方式</div><div class="line"> * <span class="doctag">@Date</span> 2017年2月25日 上午12:53:33</div><div class="line"> */</div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiService</span> <span class="keyword">implements</span> <span class="title">BeanFactoryAware</span> </span>&#123;</div><div class="line">    <span class="comment">// 注入httpclient对象</span></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * httpclient应该是多例的，但是在这里已经注入了，调用service时就是单例，应该修改为多例模式</div><div class="line">     */</div><div class="line">    <span class="comment">// @Autowired</span></div><div class="line">    <span class="comment">// private CloseableHttpClient httpclient;</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Fields</span> beanFactory</div><div class="line">     * bean工厂可以解决httpclient多例的问题</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> BeanFactory beanFactory;</div><div class="line">	<span class="comment">// 需要设置RequestConfig不是必须注入的。</span></div><div class="line">    <span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</div><div class="line">    <span class="keyword">private</span> RequestConfig requestConfig;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> doGet </div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 不带参数的get请求， 执行GET请求，响应200返回内容，如果响应404返回null</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月25日 上午12:54:48</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doGet</span><span class="params">(String url)</span> <span class="keyword">throws</span> ClientProtocolException, IOException </span>&#123;</div><div class="line">	<span class="comment">// 创建http GET请求</span></div><div class="line">	HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</div><div class="line">	httpGet.setConfig(requestConfig);</div><div class="line">	CloseableHttpResponse response = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// 执行请求</span></div><div class="line">	    response = getHttpClient().execute(httpGet);</div><div class="line">	    <span class="comment">// 判断返回状态是否为200</span></div><div class="line">	    <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</div><div class="line">		<span class="keyword">return</span> EntityUtils.toString(response.getEntity(), <span class="string">"UTF-8"</span>);</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</div><div class="line">		response.close();</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> doGet </div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 带参数的GET请求</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月25日 上午12:55:13</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doGet</span><span class="params">(String url, Map&lt;String, String&gt; params)</span> <span class="keyword">throws</span> ClientProtocolException, IOException, URISyntaxException </span>&#123;</div><div class="line">	<span class="comment">// 创建构建uri对象</span></div><div class="line">	URIBuilder uriBuilder = <span class="keyword">new</span> URIBuilder(url);</div><div class="line">	<span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</div><div class="line">	    uriBuilder.setParameter(entry.getKey(), entry.getValue());</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> doGet(uriBuilder.build().toString());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> doPost </div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 执行post请求 封装通用的post请求(带参和不带参)</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月25日 上午10:40:09</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> HttpResult <span class="title">doPost</span><span class="params">(String url, Map&lt;String, String&gt; params)</span> <span class="keyword">throws</span> ClientProtocolException, IOException, URISyntaxException </span>&#123;</div><div class="line">	<span class="comment">// 创建http POST请求</span></div><div class="line">	HttpPost httpPost = <span class="keyword">new</span> HttpPost(url);</div><div class="line">	httpPost.setConfig(requestConfig);</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">null</span> != params) &#123;</div><div class="line">	    <span class="comment">// 设置1个post参数</span></div><div class="line">	    List&lt;NameValuePair&gt; parameters = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;(<span class="number">0</span>);</div><div class="line">	    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</div><div class="line">		parameters.add(<span class="keyword">new</span> BasicNameValuePair(entry.getKey(), entry.getValue()));</div><div class="line">	    &#125;</div><div class="line">	    <span class="comment">// 构造一个form表单式的实体</span></div><div class="line">	    UrlEncodedFormEntity formEntity = <span class="keyword">new</span> UrlEncodedFormEntity(parameters, <span class="string">"UTF-8"</span>);</div><div class="line">	    <span class="comment">// 将请求实体设置到httpPost对象中</span></div><div class="line">	    httpPost.setEntity(formEntity);</div><div class="line">	&#125;</div><div class="line">	CloseableHttpResponse response = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// 执行请求</span></div><div class="line">	    response = getHttpClient().execute(httpPost);</div><div class="line">	    <span class="comment">// 无论什么情况都返回</span></div><div class="line">	    <span class="keyword">return</span> <span class="keyword">new</span> HttpResult(response.getStatusLine().getStatusCode(), EntityUtils.toString(response.getEntity(), <span class="string">"UTF-8"</span>));</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</div><div class="line">		response.close();</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> getHttpClient </div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 封装获取多例的httpclient，因为spring注入的时httpclient为多例，每次获取都是多例的</div><div class="line">     * <span class="doctag">@Date</span> 2017年2月25日 上午10:52:21</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> CloseableHttpClient <span class="title">getHttpClient</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.beanFactory.getBean(CloseableHttpClient.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Title</span> setBeanFactory</div><div class="line">     * <span class="doctag">@Description</span> 设置spring注入的bean为多例,spring初始化时会调用这个覆盖的方法,(设置beanFactory对象)</div><div class="line">     * <span class="doctag">@param</span> beanFactory</div><div class="line">     * <span class="doctag">@throws</span> BeansException</div><div class="line">     * <span class="doctag">@throws</span> </div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</div><div class="line">	<span class="keyword">this</span>.beanFactory = beanFactory;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> doPostJson</div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 请求类型：APPLICATION_JSON，方式：post</div><div class="line">     * <span class="doctag">@Date</span> 2017年3月1日 下午12:38:31</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> HttpResult <span class="title">doPostJson</span><span class="params">(String url, String json)</span> <span class="keyword">throws</span> ClientProtocolException, IOException, URISyntaxException </span>&#123;</div><div class="line">	<span class="comment">// 创建http POST请求</span></div><div class="line">	HttpPost httpPost = <span class="keyword">new</span> HttpPost(url);</div><div class="line">	httpPost.setConfig(requestConfig);</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">null</span> != json) &#123;</div><div class="line">	    <span class="comment">// 构造一个form表单式的实体</span></div><div class="line">	    StringEntity stringEntity = <span class="keyword">new</span> StringEntity(json, ContentType.APPLICATION_JSON);</div><div class="line">	    <span class="comment">// 将请求实体设置到httpPost对象中</span></div><div class="line">	    httpPost.setEntity(stringEntity);</div><div class="line">	&#125;</div><div class="line">	CloseableHttpResponse response = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// 执行请求</span></div><div class="line">	    response = getHttpClient().execute(httpPost);</div><div class="line">	    <span class="comment">// 无论什么情况都返回</span></div><div class="line">	    <span class="keyword">return</span> <span class="keyword">new</span> HttpResult(response.getStatusLine().getStatusCode(), EntityUtils.toString(response.getEntity(), <span class="string">"UTF-8"</span>));</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</div><div class="line">		response.close();</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上3个类应该放到common项目中，以便其他项目使用http请求。<br>总结：单例对象(ApiService)中使用多例对象(CloseableHttpClient)通用接解决方法<br>    ApiService实现BeanFactoryAware接口</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[请求跨域问题]]></title>
      <url>https://volc1605.github.io/2017/06/01/%E8%AF%B7%E6%B1%82%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h3 id="1-解决跨域问题"><a href="#1-解决跨域问题" class="headerlink" title="1 解决跨域问题"></a>1 解决跨域问题</h3><a id="more"></a>
<h4 id="1-1-问题产生原因"><a href="#1-1-问题产生原因" class="headerlink" title="1.1 问题产生原因"></a>1.1 问题产生原因</h4><p>浏览器对ajax请求的限制，不允许跨域请求资源。<br><a href="http://www.a.com" target="_blank" rel="external">http://www.a.com</a> -&gt;  <a href="http://www.b.com" target="_blank" rel="external">http://www.b.com</a>       是跨域<br><a href="http://www.a.com" target="_blank" rel="external">http://www.a.com</a> -&gt;  <a href="http://www.a.com:8080" target="_blank" rel="external">http://www.a.com:8080</a>  是跨域<br><a href="http://a.a.com" target="_blank" rel="external">http://a.a.com</a>   -&gt;<a href="http://b.a.com" target="_blank" rel="external">http://b.a.com</a>          是跨域<br><a href="http://www.a.com" target="_blank" rel="external">http://www.a.com</a> -&gt; <a href="http://www.a.com/api" target="_blank" rel="external">http://www.a.com/api</a>    不是</p>
<p>总结：<br>不同的域名或不同的端口都是跨域请求。<br><img src="https://volc1605.github.io/images/请求跨域问题/kuayu.png" alt="kuayu"></p>
<h4 id="1-2-测试"><a href="#1-2-测试" class="headerlink" title="1.2 测试"></a>1.2 测试</h4><p>json.jsp资源<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></div><div class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">%</span></span></span></div><div class="line">    /* <span class="attr">String</span> <span class="attr">callback</span> = <span class="string">request.getParameter(</span>"<span class="attr">callback</span>");</div><div class="line">    <span class="attr">if</span> (<span class="attr">null</span> != <span class="string">callback)</span> &#123;</div><div class="line">    	<span class="attr">out.print</span>(<span class="attr">callback</span> + "(&#123;\"<span class="attr">abc</span>\"<span class="attr">:123</span>&#125;)");</div><div class="line">    &#125; <span class="attr">else</span> &#123;</div><div class="line">    	<span class="attr">out.print</span>("&#123;\"<span class="attr">abc</span>\"<span class="attr">:123</span>&#125;)");</div><div class="line">    &#125; */</div><div class="line">    <span class="attr">out.print</span>("&#123;\"<span class="attr">abc</span>\"<span class="attr">:</span> \"<span class="attr">123</span>\""&#125;);</div><div class="line">	/*<span class="attr">out.print</span>("<span class="attr">fun</span>(&#123;"\"<span class="attr">abc</span>\"<span class="attr">:</span> \"<span class="attr">123</span>\""&#125;)");*/</div><div class="line">%&gt;</div></pre></td></tr></table></figure></p>
<p>test-json.htm文件，与json.jsp资源属于不同的项目中<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 访问url: http://manage.taotao.com/test-json.htm --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span></span></div><div class="line">	<span class="attr">src</span>=<span class="string">"http://manage.taotao.com/js/jquery-easyui-1.4.1/jquery.min.js"</span>&gt;<span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">	alert ($);</div><div class="line">    $ (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	    $.ajax (&#123;</div><div class="line">	        <span class="attr">type</span> : <span class="string">"GET"</span>,</div><div class="line">	        <span class="attr">url</span> : <span class="string">"http://manage.taotao.com/json.jsp"</span>,</div><div class="line">	        <span class="attr">dataType</span> : <span class="string">"json"</span>,</div><div class="line">	        <span class="attr">success</span> : <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">		        alert (data.abc);</div><div class="line">	        &#125;</div><div class="line">	    &#125;);</div><div class="line">    &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>经过测试可以得出,script标签是可以跨域请求的，而ajax不能跨域请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script type=“text/javascript” src=&quot;http://www.manage.com/js/jquery-easyui-1.4.1/jquery.min.js&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>如果换成script标签请求资源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script type=“text/javascript” src=&quot;http://manage.taotao.com/json.jsp&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>会出现以下错误，意思是js解析出错了，因为资源返回的是{“abc”:”123”}json格式的字符串数据无法解析成js<br><img src="https://volc1605.github.io/images/请求跨域问题/jiexi.png" alt="kuayu"><br>如果资源返回结果变成out.print(“fun({“\”abc\”: \”123\””})”);<br>就会出现fun is not defined错误，说明可以解析js，但是返回的这个fun函数找不到。那么就在test-json.htm中定义一个fun函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">	alert(data.abc);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再次请求弹出返回的数据。<br>以上就是jsonp的原理:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Jsonp的原理：</div><div class="line">1、	jsonp通过script标签的src可以跨域请求的特性，加载资源</div><div class="line">2、	将加载的资源（通过一个方法名将数据进行包裹）当做是js脚本解析</div><div class="line">3、	定义一个回调函数，获取传入的数据</div></pre></td></tr></table></figure></p>
<h3 id="2-使用jsonp-处理跨域请求"><a href="#2-使用jsonp-处理跨域请求" class="headerlink" title="2 使用jsonp,处理跨域请求"></a>2 使用jsonp,处理跨域请求</h3><p>请求代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$.ajax(&#123;</div><div class="line">	<span class="attr">url</span>: <span class="string">"http://manage.taotao.com/rest/api/item/cat?callback=category.getDataService"</span>,</div><div class="line">	<span class="attr">dataType</span>: <span class="string">"jsonp"</span>,</div><div class="line">	<span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">		<span class="comment">// data的值：category.getDataService(&#123;abc: 123&#125;)</span></div><div class="line">		alert(data.abc);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$.getJSONP(<span class="string">"http://manage.taotao.com/rest/api/item/cat?callback=category.getDataService"</span>, category.getDataService)</div><div class="line"><span class="keyword">var</span> category = &#123;</div><div class="line">	<span class="attr">getDataService</span> : <span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>后台接口代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"api/item/cat"</span>)</div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiItemCatController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ItemCatService itemCatService;</div><div class="line">    <span class="comment">// private static final ObjectMapper MAPPER = new ObjectMapper();</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Title</span> queryItemCat</div><div class="line">     * <span class="doctag">@Description</span> 对外提供查询类目借口数据</div><div class="line">     * <span class="doctag">@return</span> ResponseEntity&lt;ItemCatResult&gt;</div><div class="line">     * <span class="doctag">@throws</span> </div><div class="line">     * url:http://manage.taotao.com/rest/api/item/cat?callback=category.getDataService</div><div class="line">     */</div><div class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">queryItemCat</span><span class="params">(@RequestParam(<span class="string">"callback"</span>)</span> String callback) </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    ItemCatResult itemCatResult = <span class="keyword">this</span>.itemCatService.queryAllToTree();</div><div class="line">	    String json = MAPPER.writeValueAsString(itemCatResult);</div><div class="line">	    <span class="keyword">if</span> (callback.isEmpty()) &#123;</div><div class="line">		<span class="keyword">return</span> ResponseEntity.ok(json);</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">return</span> ResponseEntity.ok(callback + <span class="string">"("</span> + json + <span class="string">");"</span>); <span class="comment">// 拼接成js</span></div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">		<span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="3-统一解决jsonp请求，并处理中文乱码"><a href="#3-统一解决jsonp请求，并处理中文乱码" class="headerlink" title="3 统一解决jsonp请求，并处理中文乱码"></a>3 统一解决jsonp请求，并处理中文乱码</h3><h4 id="3-1-接口"><a href="#3-1-接口" class="headerlink" title="3.1 接口"></a>3.1 接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</div><div class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</div><div class="line"><span class="keyword">import</span> com.taotao.common.bean.ItemCatResult;</div><div class="line"><span class="keyword">import</span> com.taotao.manage.service.ItemCatService;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> ApiItemCatController</div><div class="line"> * <span class="doctag">@Description</span> </div><div class="line"> * <span class="doctag">@Author</span> youtanzhi</div><div class="line"> * <span class="doctag">@Date</span> 2017年2月14日 下午9:29:43</div><div class="line"> * url: http://manage.taotao.com/rest/api/item/cat</div><div class="line"> */</div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"api/item/cat"</span>)</div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiItemCatController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ItemCatService itemCatService;</div><div class="line">    <span class="comment">// private static final ObjectMapper MAPPER = new ObjectMapper();</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Title</span> queryItemCat</div><div class="line">     * <span class="doctag">@Description</span> 对外提供查询类目借口数据</div><div class="line">     * <span class="doctag">@return</span> ResponseEntity&lt;ItemCatResult&gt;</div><div class="line">     * <span class="doctag">@throws</span> </div><div class="line">     */</div><div class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;ItemCatResult&gt; <span class="title">queryItemCat</span><span class="params">(@RequestParam(<span class="string">"callback"</span>)</span> String callback) </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    ItemCatResult itemCatResult = <span class="keyword">this</span>.itemCatService.queryAllToTree();</div><div class="line">	    <span class="keyword">return</span> ResponseEntity.ok(itemCatResult);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-2-初始化servlet-xml文件中配置消息转化器"><a href="#3-2-初始化servlet-xml文件中配置消息转化器" class="headerlink" title="3.2 初始化servlet.xml文件中配置消息转化器"></a>3.2 初始化servlet.xml文件中配置消息转化器</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></div><div class="line">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义注解驱动 加载多个消息转化器 默认编码为ISO-8859-1(不支持中出现了乱码) --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 自定义essageConverter 为utf-8解决中文乱码问题 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">"true"</span>&gt;</span><span class="comment">&lt;!-- true代表使用自定的消息转化器 --&gt;</span></div><div class="line">			<span class="comment">&lt;!--&lt;bean class="org.springframework.http.converter.StringHttpMessageConverter"&gt; </span></div><div class="line">				&lt;constructor-arg index="0" value="UTF-8" /&gt; &lt;/bean&gt; --&gt;</div><div class="line">			<span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">				<span class="attr">class</span>=<span class="string">"com.taotao.common.spring.exetend.converter.json.CallbackMappingJackson2HttpMessageConverter"</span>&gt;</div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"callbackName"</span> <span class="attr">value</span>=<span class="string">"callback"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 结束 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 定义Controller的扫描包 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.taotao.manage.controller"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义试图解析器 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- Example: prefix="/WEB-INF/jsp/", suffix=".jsp", viewname="test" -&gt; </span></div><div class="line">		"/WEB-INF/jsp/test.jsp" --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 使用fileupload-common上传组件需要sring的支持，这里就要配置支持上传组件的视图解析器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</div><div class="line">		<span class="comment">&lt;!-- 限制文件的最大上传大小，字节单位5M --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"5242880"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="3-3-自定义消息转化器处理类"><a href="#3-3-自定义消息转化器处理类" class="headerlink" title="3.3 自定义消息转化器处理类"></a>3.3 自定义消息转化器处理类</h4><p>引用jar<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;!-- spring-web 这里用于加载消息转化器类 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;spring-web&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;!-- Apache工具组件 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;commons-io&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;javax.servlet&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;</div><div class="line">	&lt;scope&gt;provided&lt;/scope&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>处理类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</div><div class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</div><div class="line"><span class="keyword">import</span> org.springframework.http.HttpOutputMessage;</div><div class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageNotWritableException;</div><div class="line"><span class="keyword">import</span> org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</div><div class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</div><div class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonEncoding;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallbackMappingJackson2HttpMessageConverter</span> <span class="keyword">extends</span> <span class="title">MappingJackson2HttpMessageConverter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 做jsonp的支持的标识，在请求参数中加该参数</span></div><div class="line">    <span class="keyword">private</span> String callbackName;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">writeInternal</span><span class="params">(Object object, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException </span>&#123;</div><div class="line">	<span class="comment">// 从threadLocal中获取当前的Request对象</span></div><div class="line">	HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest();</div><div class="line">	String callbackParam = request.getParameter(callbackName);</div><div class="line">	<span class="keyword">if</span> (StringUtils.isEmpty(callbackParam)) &#123;</div><div class="line">	    <span class="comment">// 没有找到callback参数，直接返回json数据</span></div><div class="line">	    <span class="keyword">super</span>.writeInternal(object, outputMessage);</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">	    JsonEncoding encoding = getJsonEncoding(outputMessage.getHeaders().getContentType());</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">		String result = callbackParam + <span class="string">"("</span> + <span class="keyword">super</span>.getObjectMapper().writeValueAsString(object) + <span class="string">");"</span>;</div><div class="line">		IOUtils.write(result, outputMessage.getBody(), encoding.getJavaName());</div><div class="line">	    &#125; <span class="keyword">catch</span> (JsonProcessingException ex) &#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> HttpMessageNotWritableException(<span class="string">"Could not write JSON: "</span> + ex.getMessage(), ex);</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCallbackName</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> callbackName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCallbackName</span><span class="params">(String callbackName)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.callbackName = callbackName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[解析json字符串]]></title>
      <url>https://volc1605.github.io/2017/05/16/fastJson%E8%A7%A3%E6%9E%90json%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      <content type="html"><![CDATA[<h3 id="1-使用fastjson解析json字符串"><a href="#1-使用fastjson解析json字符串" class="headerlink" title="1 使用fastjson解析json字符串"></a>1 使用fastjson解析json字符串</h3><a id="more"></a>
<p>要解析的json串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;				--首先创建DatasResult类用于接收数据</div><div class="line">  &quot;data&quot;: [			--可以看出data这个元素属于一个集合，所以在DataResult类中创建List&lt;Data&gt;集合属性</div><div class="line">    &#123;				--List&lt;Data&gt;集合包含很多Data类型，创建Data类，Date类中有title属性和result类</div><div class="line">      &quot;title&quot;: &quot;123&quot;,</div><div class="line">      &quot;result&quot;: &#123;		--而result元素又属于一个对象，在Data类中创建DataResult类</div><div class="line">        &quot;name&quot;: &quot;volc&quot;		--DataResult类中包含name属性</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      &quot;title&quot;: &quot;123&quot;,</div><div class="line">      &quot;result&quot;: &#123;</div><div class="line">        &quot;name&quot;: &quot;volc&quot;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>1.构造实体类</p>
<p>创建DatasResult的实体类用于接受数据<br>里面包含List<data>集合属性</data></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatasResult</span> </span>&#123;</div><div class="line">	List&lt;Data&gt; data = <span class="keyword">new</span> ArrayList&lt;Data&gt;();</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> List&lt;Data&gt; <span class="title">getData</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> data;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(List&lt;Data&gt; data)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.data = data;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建Data类型，里面包含title属性和result类，在Date类型创建DataResult类，DataResult类中包含name属性<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Data</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> String title;</div><div class="line">	<span class="keyword">private</span> DataResult result;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataResult</span> </span>&#123;</div><div class="line">		<span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> name;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">			<span class="keyword">this</span>.name = name;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> DataResult <span class="title">getResult</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResult</span><span class="params">(DataResult result)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.result = result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> title;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.title = title;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"Data [title="</span> + title + <span class="string">", result="</span> + result + <span class="string">"]"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2 解析<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONToList</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		String json = <span class="string">"&#123;\"data\":[&#123;\"title\":\"123\",\"result\":&#123;\"name\":\"volc\"&#125;&#125;,&#123;\"title\":\"123\",\"result\":&#123;\"name\":\"volc\"&#125;&#125;]&#125;"</span>;</div><div class="line">		System.out.println(json);</div><div class="line">		DatasResult parseObject = JSON.parseObject(json, DatasResult.class);</div><div class="line">		System.out.println(parseObject.getData().get(<span class="number">0</span>).getResult().getName());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="2-使用jackson解析"><a href="#2-使用jackson解析" class="headerlink" title="2 使用jackson解析"></a>2 使用jackson解析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">依赖</div><div class="line">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;2.8.7&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>DataResult类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatasResult</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 定义jackson对象</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper MAPPER = <span class="keyword">new</span> ObjectMapper();</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;?&gt; data;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DatasResult</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DatasResult</span><span class="params">(List&lt;?&gt; data)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.data = data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> List&lt;?&gt; getData() &#123;</div><div class="line">	<span class="keyword">return</span> data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(List&lt;?&gt; data)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.data = data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Object是集合转化</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> jsonData json数据</div><div class="line">     * <span class="doctag">@param</span> clazz 集合中的类型</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DatasResult <span class="title">formatToList</span><span class="params">(String jsonData, Class&lt;?&gt; clazz)</span> </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    JsonNode jsonNode = MAPPER.readTree(jsonData);</div><div class="line">	    JsonNode data = jsonNode.get(<span class="string">"data"</span>);</div><div class="line">	    List&lt;?&gt; list = <span class="keyword">null</span>;</div><div class="line">	    <span class="keyword">if</span> (data.isArray() &amp;&amp; data.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">		list = MAPPER.readValue(data.traverse(), MAPPER.getTypeFactory().constructCollectionType(List.class, clazz));</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">return</span> <span class="keyword">new</span> DatasResult(list);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Data类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Data</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line">    <span class="keyword">private</span> DataResult result;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataResult</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">	    <span class="keyword">return</span> name;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">	    <span class="keyword">this</span>.name = name;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> DataResult <span class="title">getResult</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResult</span><span class="params">(DataResult result)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.result = result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> title;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.title = title;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">"Data [title="</span> + title + <span class="string">", result="</span> + result + <span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> Jackson</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 解析json字符串节点为对象</div><div class="line"> * <span class="doctag">@Date</span> 2017年6月2日 上午1:51:26</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jackson</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	String json = <span class="string">"&#123;\"data\":[&#123;\"title\":\"123\",\"result\":&#123;\"name\":\"volc\"&#125;&#125;,&#123;\"title\":\"123\",\"result\":&#123;\"name\":\"volc\"&#125;&#125;]&#125;"</span>;</div><div class="line">	DatasResult dataResult = DatasResult.formatToList(json, Data.class);</div><div class="line">	System.out.println(dataResult);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-使用jackson解析json指定节点"><a href="#3-使用jackson解析json指定节点" class="headerlink" title="3 使用jackson解析json指定节点"></a>3 使用jackson解析json指定节点</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.ArrayNode;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> Jackson</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 解析json字符串中的节点对象</div><div class="line"> * <span class="doctag">@Date</span> 2017年6月2日 上午1:51:26</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jackson2</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper MAPPER = <span class="keyword">new</span> ObjectMapper();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException, IOException </span>&#123;</div><div class="line">	String json = <span class="string">"&#123;\"data\":[&#123;\"title\":\"123\",\"result\":&#123;\"name\":\"volc\"&#125;&#125;,&#123;\"title\":\"123\",\"result\":&#123;\"name\":\"volc\"&#125;&#125;]&#125;"</span>;</div><div class="line">	<span class="comment">// 解析json生成前端所需要的json数据</span></div><div class="line">	JsonNode jsonNode = MAPPER.readTree(json);</div><div class="line">	ArrayNode arrayNode = (ArrayNode) jsonNode.get(<span class="string">"data"</span>);</div><div class="line">	<span class="comment">// 定义含有map集合的list用于组织封装想要的格式</span></div><div class="line">	List&lt;Map&lt;String, Object&gt;&gt; result = <span class="keyword">new</span> ArrayList&lt;Map&lt;String, Object&gt;&gt;();</div><div class="line">	<span class="keyword">for</span> (JsonNode data : arrayNode) &#123;</div><div class="line">	    <span class="comment">// 有顺序的hashmap</span></div><div class="line">	    Map&lt;String, Object&gt; map = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;();</div><div class="line">	    map.put(<span class="string">"result"</span>, data.get(<span class="string">"result"</span>).get(<span class="string">"name"</span>).asText()); <span class="comment">// 获取节点对象并获取值</span></div><div class="line">	    result.add(map);</div><div class="line">	&#125;</div><div class="line">	System.out.println(MAPPER.writeValueAsString(result));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-jackson解析为list"><a href="#4-jackson解析为list" class="headerlink" title="4 jackson解析为list"></a>4 jackson解析为list</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &#123;</div><div class="line">    &quot;created&quot;: 1488441787000,</div><div class="line">    &quot;updated&quot;: 1488441787000,</div><div class="line">    &quot;id&quot;: 1474391928,</div><div class="line">    &quot;title&quot;: &quot;电子书测试&quot;,</div><div class="line">    &quot;sellPoint&quot;: &quot;电子书测试&quot;,</div><div class="line">    &quot;price&quot;: 1200,</div><div class="line">    &quot;num&quot;: 1111,</div><div class="line">    &quot;barcode&quot;: &quot;&quot;,</div><div class="line">    &quot;image&quot;: &quot;http://image.taotao.com/images/2017/03/02/2017030204021882807073.jpg,http://image.taotao.com/images/2017/03/02/2017030204021910209674.jpg&quot;,</div><div class="line">    &quot;cid&quot;: 3,</div><div class="line">    &quot;status&quot;: 1</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    &quot;created&quot;: 1425821628000,</div><div class="line">    &quot;updated&quot;: 1488441643000,</div><div class="line">    &quot;id&quot;: 1474391927,</div><div class="line">    &quot;title&quot;: &quot;6小米（MI）小米米键 颜色随机 官方正品&quot;,</div><div class="line">    &quot;sellPoint&quot;: &quot;智键手机快捷键防尘塞&quot;,</div><div class="line">    &quot;price&quot;: 100,</div><div class="line">    &quot;num&quot;: 99999,</div><div class="line">    &quot;barcode&quot;: &quot;&quot;,</div><div class="line">    &quot;image&quot;: &quot;http://image.taotao.com/jd/0a182402ff97495f882f20244c71284b.jpg&quot;,</div><div class="line">    &quot;cid&quot;: 560,</div><div class="line">    &quot;status&quot;: 1</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    &quot;created&quot;: 1425821628000,</div><div class="line">    &quot;updated&quot;: 1425821628000,</div><div class="line">    &quot;id&quot;: 1473655354,</div><div class="line">    &quot;title&quot;: &quot;小米 红米Note 8G内存移动4G合约增强版 不含合约计划 白色 移动4G&quot;,</div><div class="line">    &quot;sellPoint&quot;: &quot;&quot;,</div><div class="line">    &quot;price&quot;: 1159000,</div><div class="line">    &quot;num&quot;: 99999,</div><div class="line">    &quot;barcode&quot;: null,</div><div class="line">    &quot;image&quot;: &quot;http://image.taotao.com/jd/26cc33af58e3452aa27a207db7c35a1e.jpg&quot;,</div><div class="line">    &quot;cid&quot;: 560,</div><div class="line">    &quot;status&quot;: 1</div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>bean对象Item类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</div><div class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.beans.Field;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</div><div class="line"></div><div class="line"><span class="meta">@JsonIgnoreProperties</span>(ignoreUnknown = <span class="keyword">true</span>)</div><div class="line"><span class="comment">/*</span></div><div class="line"> * 忽略为知的字段,因为以下字段是为写入到solr用的，用jackson反序列化时需要，反序列化以下字段即可，不需要加入到solr的字段我们需要忽略.</div><div class="line"> * 否则在反序列化时会报错</div><div class="line"> * com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field "created" (class cn.itcast.solrj.pojo.Item), not marked as ignorable (8 known properties: "status", "title", "price", "id", "updated", "image", "sellPoint", "cid"])</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Field</span>(<span class="string">"id"</span>)</div><div class="line">    <span class="keyword">private</span> Long id;</div><div class="line"></div><div class="line">    <span class="meta">@Field</span>(<span class="string">"title"</span>)</div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line"></div><div class="line">    <span class="meta">@Field</span>(<span class="string">"sellPoint"</span>)</div><div class="line">    <span class="keyword">private</span> String sellPoint;</div><div class="line"></div><div class="line">    <span class="meta">@Field</span>(<span class="string">"price"</span>)</div><div class="line">    <span class="keyword">private</span> Long price;</div><div class="line"></div><div class="line">    <span class="meta">@Field</span>(<span class="string">"image"</span>)</div><div class="line">    <span class="keyword">private</span> String image;</div><div class="line"></div><div class="line">    <span class="meta">@Field</span>(<span class="string">"cid"</span>)</div><div class="line">    <span class="keyword">private</span> Long cid;</div><div class="line"></div><div class="line">    <span class="meta">@Field</span>(<span class="string">"status"</span>)</div><div class="line">    <span class="keyword">private</span> Integer status;</div><div class="line"></div><div class="line">    <span class="meta">@Field</span>(<span class="string">"updated"</span>)</div><div class="line">    <span class="keyword">private</span> Long updated;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> title;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSellPoint</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> sellPoint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSellPoint</span><span class="params">(String sellPoint)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.sellPoint = sellPoint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> price;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(Long price)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.price = price;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getImage</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> image;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImage</span><span class="params">(String image)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.image = image;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getCid</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> cid;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCid</span><span class="params">(Long cid)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.cid = cid;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> status;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.status = status;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getUpdated</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> updated;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpdated</span><span class="params">(Long updated)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.updated = updated;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> String[] getImages() &#123;</div><div class="line">        <span class="keyword">return</span> StringUtils.split(<span class="keyword">this</span>.getImage(), <span class="string">','</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Item [id="</span> + id + <span class="string">", title="</span> + title + <span class="string">", sellPoint="</span> + sellPoint + <span class="string">", price="</span> + price</div><div class="line">                + <span class="string">", image="</span> + image + <span class="string">", cid="</span> + cid + <span class="string">", status="</span> + status + <span class="string">", updated="</span> + updated + <span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>解析代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">String jsonData = doGet(u);</div><div class="line">JsonNode jsonNode = MAPPER.readTree(jsonData);</div><div class="line">String rowsStr = jsonNode.get(<span class="string">"rows"</span>).toString(); <span class="comment">// rowsStr字符串就是上面要解析为List的资源</span></div><div class="line">List&lt;Item&gt; items = MAPPER.readValue(rowsStr, MAPPER.getTypeFactory().constructCollectionType(List.class, Item.class));</div></pre></td></tr></table></figure></p>
<h4 id="4-1-jackson解析字符串异常"><a href="#4-1-jackson解析字符串异常" class="headerlink" title="4.1 jackson解析字符串异常"></a>4.1 jackson解析字符串异常</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Exception in thread &quot;main&quot; com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field &quot;created&quot; (class com.biusoft.Item), not marked as ignorable (8 known properties: , &quot;status&quot;, &quot;title&quot;, &quot;price&quot;, &quot;id&quot;, &quot;updated&quot;, &quot;image&quot;, &quot;sellPoint&quot;, &quot;cid&quot;])</div></pre></td></tr></table></figure>
<p>需要在接受实体类上添加@JsonIgnoreProperties(ignoreUnknown = true)，忽略未知字段的解析。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[oracle数据库]]></title>
      <url>https://volc1605.github.io/2017/04/14/oracle%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      <content type="html"><![CDATA[<h3 id="1-oracle数据库对表设置自增ID"><a href="#1-oracle数据库对表设置自增ID" class="headerlink" title="1 oracle数据库对表设置自增ID"></a>1 oracle数据库对表设置自增ID</h3><a id="more"></a>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 创建序列</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> SYS_MAIL_PLAN_WAIT_SEQUENCE</div><div class="line">   <span class="keyword">increment</span> <span class="keyword">by</span> <span class="number">1</span>    <span class="comment">-- 每次递增1</span></div><div class="line">   <span class="keyword">start</span> <span class="keyword">with</span> <span class="number">1</span>       <span class="comment">-- 从1开始</span></div><div class="line">   <span class="keyword">nomaxvalue</span>      <span class="comment">-- 没有最大值</span></div><div class="line">   <span class="keyword">minvalue</span> <span class="number">1</span>       <span class="comment">-- 最小值=1</span></div><div class="line">   <span class="keyword">NOCYCLE</span>;      <span class="comment">-- 不循环</span></div><div class="line"><span class="comment">-- 创建触发器，每次新增SYS_MAIL_PLAN_WAIT表数据之前被执行，并将SYS_MAIL_PLAN_WAIT中PLAN_ID自增1</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">TRIGGER</span> SYS_MAIL_PLAN_WAIT_TRIGGER</div><div class="line">    <span class="keyword">BEFORE</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> SYS_MAIL_PLAN_WAIT</div><div class="line">  <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></div><div class="line">  <span class="keyword">BEGIN</span></div><div class="line">    <span class="keyword">SELECT</span> SYS_MAIL_PLAN_WAIT_SEQUENCE.nextval <span class="keyword">INTO</span> :new.PLAN_ID <span class="keyword">FROM</span> DUAL;</div><div class="line">  <span class="keyword">END</span>;</div><div class="line">  </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SYS_MAIL_PLAN_WAIT(PROS_ID) <span class="keyword">VALUES</span> (<span class="string">'1'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SYS_MAIL_PLAN_WAIT(PROS_ID) <span class="keyword">VALUES</span> (<span class="string">'3'</span>);</div></pre></td></tr></table></figure>
<h3 id="2-批量更新"><a href="#2-批量更新" class="headerlink" title="2 批量更新"></a>2 批量更新</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;update id="lockTaskPlan"&gt;</div><div class="line">	begin</div><div class="line">	&lt;foreach collection="mailPlanList" item="item" index="index" separator=";" close=""&gt;</div><div class="line">		UPDATE SYS_MAIL_PLAN_WAIT SET STATUS =</div><div class="line">		#&#123;item.status&#125;,thread_id = #&#123;item.threadId&#125; WHERE PLAN_ID = #&#123;item.planId&#125;</div><div class="line">	&lt;/foreach&gt;</div><div class="line">	;end;</div><div class="line">&lt;/update&gt;</div></pre></td></tr></table></figure>
<p>这种写法对于返回更新数量的数据库配置是不起作用的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;!--由于项目配置中启用了BATCH执行器，UPDATE和DELETE返回的行数就丢失了，把执行器改为SIMPLE即可。--&gt;</div><div class="line">&lt;!-- defaultExecutorType设置为BATCH有个缺陷就是无法获取update、delete返回的行数 --&gt;</div><div class="line">        &lt;!-- &lt;setting name=&quot;defaultExecutorType&quot; value=&quot;SIMPLE&quot; /&gt;--&gt;</div></pre></td></tr></table></figure></p>
<p>获取返回数量的批量更新如下写法<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">update</span> table_name t1 <span class="keyword">set</span> (a,b,c)=( <span class="keyword">select</span> a,b,c <span class="keyword">from</span> table_name_2 t2 <span class="keyword">where</span> t1.a=t2.a) <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> table_name_2 t2 <span class="keyword">where</span> t1.a=t2.a);</div></pre></td></tr></table></figure></p>
<h3 id="3-navicat连接本地oracle"><a href="#3-navicat连接本地oracle" class="headerlink" title="3 navicat连接本地oracle"></a>3 navicat连接本地oracle</h3><h4 id="3-1-Navicat-Premium连接本地Oracle"><a href="#3-1-Navicat-Premium连接本地Oracle" class="headerlink" title="3.1 Navicat Premium连接本地Oracle"></a>3.1 Navicat Premium连接本地Oracle</h4><p>想要使用navicat连接本地oracle数据库首先确保两点<br>1.oracle版本号11.2.0.1.0 64位,Navicat Premium也是64位，总之保证数据库客户端工具运行平台操作系统位数和oracle运行平台操作系统位数相同。<br>2.客户端instantclient_11_2和安装的oracle版本号一致，也是64位。</p>
<h4 id="3-2-下载instantclient-11-2"><a href="#3-2-下载instantclient-11-2" class="headerlink" title="3.2 下载instantclient_11_2"></a>3.2 下载instantclient_11_2</h4><p>要下载<a href="http://www.oracle.com/technetwork/topics/winx64soft-089540.html" target="_blank" rel="external">instantclient_11_2</a>，和navicat一样都是64位，找到对应的版本号，选择Basic类型下载<br>下载完成后解压到Navicat安装目录E:\Navicat Premium替换掉原来的instantclient_11_2，重启navicat</p>
<h4 id="3-3-修改文件"><a href="#3-3-修改文件" class="headerlink" title="3.3 修改文件"></a>3.3 修改文件</h4><p>E:\database\base\product\11.2.0\dbhome_1\NETWORK\ADMIN\listener.ora和<br>E:\database\base\product\11.2.0\dbhome_1\NETWORK\ADMIN\tnsnames.ora两个文件，修改之前要先备份这两个文件<br>把这两个文件中的localhost全部替换为该计算机全名。<br>重新启动OracleServiceORCL和OracleOraDb11g_home1TNSListener服务</p>
<p>配置navicat<br>E:\Navicat Premium\instantclient_11_2\oci.dll<br>E:\database\base\product\11.2.0\dbhome_1\BIN\sqlplus.exe<br><img src="http://www.volcfamily.cn/images/oracle数据库/navicat.png" alt="测试"> </p>
<h4 id="3-4-连接数据库"><a href="#3-4-连接数据库" class="headerlink" title="3.4 连接数据库"></a>3.4 连接数据库</h4><p>连接类型Basic<br>端口号1521<br>服务名ORCL(和E:\database\base\product\11.2.0\dbhome_1\NETWORK\ADMIN\tnsnames.ora文件中的SERVICE_NAME值一致，不区分大小写)<br>用户名scott<br>密码tiger</p>
<p>遇到的问题<br>ORA-28000 scott账号被锁<br>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter user scott account unlock;</div></pre></td></tr></table></figure></p>
<p>ORA-28001 用户账号过期</p>
<p>在从计算机开始选项中打开SQL Plus，使用修复账号<br>用户名：system<br>密码为安装oracle时的登录密码<br>执行以下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">alter user scott identified by tiger;</div><div class="line">alter user scott account unlock;</div></pre></td></tr></table></figure></p>
<p>重新连接问题解决</p>
<h4 id="3-5-指定数据库中的用户名过期"><a href="#3-5-指定数据库中的用户名过期" class="headerlink" title="3.5 指定数据库中的用户名过期"></a>3.5 指定数据库中的用户名过期</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">SQL&gt; connect system/123456@localcas</div><div class="line">connect 统一数据库登录名称/统一数据库登录密码@指定的数据库sid</div><div class="line">已连接。</div><div class="line">SQL&gt; alter user SCOTT account unlock;</div><div class="line">用户已更改。</div><div class="line">SQL&gt; COMMIT;</div><div class="line">提交完成。</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure>
<h3 id="4-oracle分页"><a href="#4-oracle分页" class="headerlink" title="4 oracle分页"></a>4 oracle分页</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">select</div><div class="line">	&lt;include refid="MailColumns" /&gt;</div><div class="line">	from</div><div class="line">	(</div><div class="line">	select sm.*,rownum rn from (</div><div class="line">	select</div><div class="line">	*</div><div class="line">	from sys_mail where 1 = 1</div><div class="line">	&lt;if test="userId != null and userId != ''"&gt;</div><div class="line">		and user_id = #&#123;userId&#125;</div><div class="line">	&lt;/if&gt;</div><div class="line">	&lt;if test="mailType != null and mailType != ''"&gt;</div><div class="line">		and mail_type = #&#123;mailType&#125;</div><div class="line">	&lt;/if&gt;</div><div class="line">	order by create_time desc) sm</div><div class="line">	) a where 1 =1</div><div class="line">	&lt;if test="rowStart != null and rowStart != 0"&gt;</div><div class="line">		and a.rn &amp;gt;= #&#123;rowStart&#125;</div><div class="line">	&lt;/if&gt;</div><div class="line">	&lt;if test="rowEnd != null and rowEnd != 0"&gt;</div><div class="line">		and a.rn &amp;lt; #&#123;rowEnd&#125;</div><div class="line">	&lt;/if&gt;</div></pre></td></tr></table></figure>
<h3 id="5-分组排序取各组第一个"><a href="#5-分组排序取各组第一个" class="headerlink" title="5 分组排序取各组第一个"></a>5 分组排序取各组第一个</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	T.ID</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	(</div><div class="line">		<span class="keyword">SELECT</span></div><div class="line">			am.ID,</div><div class="line">			ROW_NUMBER () <span class="keyword">OVER</span> (</div><div class="line">				<span class="keyword">PARTITION</span> <span class="keyword">BY</span> am.APPID <span class="comment">-- 分组字段</span></div><div class="line">				<span class="keyword">ORDER</span> <span class="keyword">BY</span></div><div class="line">					am.NEWTIME <span class="keyword">DESC</span> <span class="comment">-- 排序字段</span></div><div class="line">			) <span class="keyword">AS</span> code_id</div><div class="line">		<span class="keyword">FROM</span></div><div class="line">			CAS_APP_MANAGER am</div><div class="line">		<span class="keyword">WHERE</span></div><div class="line">			<span class="number">1</span> = <span class="number">1</span></div><div class="line">	) T</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	T.code_id = <span class="number">1</span></div></pre></td></tr></table></figure>
<h3 id="6-批量插入"><a href="#6-批量插入" class="headerlink" title="6 批量插入"></a>6 批量插入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_user_mail</div><div class="line">(<span class="keyword">id</span>, user_id,</div><div class="line">mail_id,recipient_org,recipient_dept,user_name,mail_status,user_account,create_time,update_time,</div><div class="line">re_status)</div><div class="line">&lt;foreach collection=<span class="string">"userMailBeanList"</span> item=<span class="string">"item"</span> separator=<span class="string">"union all"</span>&gt;</div><div class="line">	(<span class="keyword">SELECT</span></div><div class="line">	#&#123;item.id&#125;,#&#123;item.userId&#125;,#&#123;item.mailId&#125;,#&#123;item.recipientOrg&#125;,#&#123;item.recipientDept&#125;,#&#123;item.userName&#125;,#&#123;item.mailStatus&#125;,#&#123;item.email&#125;,#&#123;item.createTime&#125;,#&#123;item.updateTime&#125;,#&#123;item.reStatus&#125;</div><div class="line">	<span class="keyword">FROM</span> DUAL)</div><div class="line">&lt;/foreach&gt;</div></pre></td></tr></table></figure>
<h3 id="7-创建数据库"><a href="#7-创建数据库" class="headerlink" title="7 创建数据库"></a>7 创建数据库</h3><p>参考：<a href="http://blog.csdn.net/wshysh/article/details/7649664" target="_blank" rel="external">http://blog.csdn.net/wshysh/article/details/7649664</a></p>
<p>创建数据库过程中记住SID值，客户端连接：<br>数据库类型：Basic<br>主机名或IP地址：localhost<br>端口号:1521<br>服务名或ISD:选择SID,值为创建数据库时SID值<br>用户名：SCOTT<br>密码：TIGER</p>
<p>配置文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">jdbc.type=oracle</div><div class="line">jdbc.driver=oracle.jdbc.driver.OracleDriver</div><div class="line">jdbc.url=jdbc:oracle:thin:@localhost:1521:sid值</div><div class="line">jdbc.username=SCOTT</div><div class="line">jdbc.password=TIGER</div></pre></td></tr></table></figure></p>
<h3 id="8-修改oracle账户密码永不过期"><a href="#8-修改oracle账户密码永不过期" class="headerlink" title="8 修改oracle账户密码永不过期"></a>8 修改oracle账户密码永不过期</h3><p>========================<br>管理员账户打开cmd<br>使用system账号登录</p>
<h4 id="8-1-使用system账号登录"><a href="#8-1-使用system账号登录" class="headerlink" title="8.1 使用system账号登录"></a>8.1 使用system账号登录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">C:\Users\Administrator&gt;sqlplus</div><div class="line">SQL*Plus: Release 11.2.0.1.0 Production on 星期三 11月 15 17:22:21 2017</div><div class="line"></div><div class="line">Copyright (c) 1982, 2010, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">请输入用户名:  system</div><div class="line">输入口令:</div><div class="line"></div><div class="line">连接到:</div><div class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</div><div class="line">With the Partitioning, OLAP, Data Mining and Real Application Testing options</div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure>
<h4 id="8-2-查看账户的proifle是哪个，一般是default"><a href="#8-2-查看账户的proifle是哪个，一般是default" class="headerlink" title="8.2 查看账户的proifle是哪个，一般是default"></a>8.2 查看账户的proifle是哪个，一般是default</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT username,PROFILE FROM dba_users;</div><div class="line"></div><div class="line">USERNAME                       PROFILE</div><div class="line">------------------------------ ------------------------------</div><div class="line">DB_RCS                         DEFAULT</div><div class="line">GLJTLCX                        DEFAULT</div><div class="line">JIBJTSJ                        DEFAULT</div><div class="line">TRAFFIC                        DEFAULT</div><div class="line">SCOTT                          DEFAULT</div><div class="line">ORACLE_OCM                     DEFAULT</div><div class="line">XS$NULL                        DEFAULT</div><div class="line">MDDATA                         DEFAULT</div><div class="line">DIP                            DEFAULT</div><div class="line">APEX_PUBLIC_USER               DEFAULT</div><div class="line">SPATIAL_CSW_ADMIN_USR          DEFAULT</div><div class="line"></div><div class="line">USERNAME                       PROFILE</div><div class="line">------------------------------ ------------------------------</div><div class="line">SPATIAL_WFS_ADMIN_USR          DEFAULT</div><div class="line">DBSNMP                         MONITORING_PROFILE</div><div class="line">SYSMAN                         DEFAULT</div><div class="line">FLOWS_FILES                    DEFAULT</div><div class="line">MDSYS                          DEFAULT</div><div class="line">ORDSYS                         DEFAULT</div><div class="line">EXFSYS                         DEFAULT</div><div class="line">WMSYS                          DEFAULT</div><div class="line">APPQOSSYS                      DEFAULT</div><div class="line">APEX_030200                    DEFAULT</div><div class="line">OWBSYS_AUDIT                   DEFAULT</div><div class="line"></div><div class="line">USERNAME                       PROFILE</div><div class="line">------------------------------ ------------------------------</div><div class="line">ORDDATA                        DEFAULT</div><div class="line">CTXSYS                         DEFAULT</div><div class="line">ANONYMOUS                      DEFAULT</div><div class="line">XDB                            DEFAULT</div><div class="line">ORDPLUGINS                     DEFAULT</div><div class="line">OWBSYS                         DEFAULT</div><div class="line">SI_INFORMTN_SCHEMA             DEFAULT</div><div class="line">OLAPSYS                        DEFAULT</div><div class="line">MGMT_VIEW                      DEFAULT</div><div class="line">SYS                            DEFAULT</div><div class="line">SYSTEM                         DEFAULT</div><div class="line"></div><div class="line">USERNAME                       PROFILE</div><div class="line">------------------------------ ------------------------------</div><div class="line">OUTLN                          DEFAULT</div><div class="line"></div><div class="line">已选择34行。</div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure>
<h4 id="8-3-看账户的过期时间"><a href="#8-3-看账户的过期时间" class="headerlink" title="8.3 看账户的过期时间"></a>8.3 看账户的过期时间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT * FROM dba_profiles WHERE profile=&apos;DEFAULT&apos; AND resource_name=&apos;PASSWORD_LIFE_TIME&apos;;</div><div class="line"></div><div class="line">PROFILE                        RESOURCE_NAME                    RESOURCE</div><div class="line">------------------------------ -------------------------------- --------</div><div class="line">LIMIT</div><div class="line">----------------------------------------</div><div class="line">DEFAULT                        PASSWORD_LIFE_TIME               PASSWORD</div><div class="line">180</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure>
<h4 id="8-4-修改用户密码的过期时间"><a href="#8-4-修改用户密码的过期时间" class="headerlink" title="8.4 修改用户密码的过期时间"></a>8.4 修改用户密码的过期时间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; ALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME UNLIMITED;</div><div class="line"></div><div class="line">配置文件已更改</div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure>
<h4 id="8-5-查看修改过后的用户密码过期时间为UNLIMITED-无限制"><a href="#8-5-查看修改过后的用户密码过期时间为UNLIMITED-无限制" class="headerlink" title="8.5 查看修改过后的用户密码过期时间为UNLIMITED(无限制)"></a>8.5 查看修改过后的用户密码过期时间为UNLIMITED(无限制)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT * FROM dba_profiles WHERE profile=&apos;DEFAULT&apos; AND resource_name=&apos;PASSWORD_LIFE_TIME&apos;;</div><div class="line"></div><div class="line">PROFILE                        RESOURCE_NAME                    RESOURCE</div><div class="line">------------------------------ -------------------------------- --------</div><div class="line">LIMIT</div><div class="line">----------------------------------------</div><div class="line">DEFAULT                        PASSWORD_LIFE_TIME               PASSWORD</div><div class="line">UNLIMITED</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure>
<p>========================</p>
<h3 id="9-oracle备份数据库和还原数据库"><a href="#9-oracle备份数据库和还原数据库" class="headerlink" title="9 oracle备份数据库和还原数据库"></a>9 oracle备份数据库和还原数据库</h3><p>导出：<br>exp traffic/123456@traffic file=E:\daochu.dmp<br>导入(还原DMP备份文件)：<br>命令：imp system/system@orcl full=y BUFFER=81920 file=”C:\Users\Administrator\Desktop\shengjushuju\B_LC_JIBJTSJ201710\B_LC_JIBJTSJ201710.dmp” ignore=y<br>在执行还原之前需要创建用户和空间并分配空间和权限给这个用户。</p>
<h3 id="9-1-创建用户分配表空间"><a href="#9-1-创建用户分配表空间" class="headerlink" title="9.1 创建用户分配表空间"></a>9.1 创建用户分配表空间</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">创建用户</div><div class="line">create user DB_RCS identified by njdongba;</div><div class="line">创建自动扩充空间</div><div class="line">create tablespace DB_RCS datafile &apos;E:\database\base\product\11.2.0\db_rcs_data.dbf&apos; size 200M autoextend on next 10M maxsize unlimited EXTENT MANAGEMENT local  autoallocate segment space management auto;</div><div class="line">为用户分配表空间</div><div class="line">alter user DB_RCS default tablespace DB_RCS;</div><div class="line">为用户分配权限</div><div class="line">grant create session,create table,create view,create sequence,unlimited tablespace to DB_RCS;</div></pre></td></tr></table></figure>
<h3 id="10-oracle截取，分组再排序"><a href="#10-oracle截取，分组再排序" class="headerlink" title="10 oracle截取，分组再排序"></a>10 oracle截取，分组再排序</h3><h4 id="10-1-oracle截取，分组再排序"><a href="#10-1-oracle截取，分组再排序" class="headerlink" title="10.1 oracle截取，分组再排序"></a>10.1 oracle截取，分组再排序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div></pre></td><td class="code"><pre><div class="line">SELECT</div><div class="line">	T8.*</div><div class="line">FROM</div><div class="line">	(</div><div class="line">		SELECT</div><div class="line">			ROWNUM ID,</div><div class="line">			T7.*</div><div class="line">		FROM</div><div class="line">			(</div><div class="line">				SELECT</div><div class="line">					CASE</div><div class="line">				WHEN INSTR (T6.wholeNum, &apos;-&apos;) &gt; 0 -- INSTR(&apos;&apos;,&apos;&apos;) 判断后面的字符或字符串在前面字符串中的位置，返回int型角标+1，如 select INSTR (&apos;123-15&apos;, &apos;15&apos;) from dual; 返回值为5</div><div class="line">										</div><div class="line">					THEN</div><div class="line">					TO_NUMBER (  -- TO_NUMBER() String型字符&apos;123&apos;串转为int型123</div><div class="line">						SUBSTR ( -- SUBSTR(&apos;&apos;,1,2) 在字符串中截取角标为1-2的字符串，并返回字符串</div><div class="line">							T6.wholeNum,</div><div class="line">							0,</div><div class="line">							INSTR (T6.wholeNum, &apos;-&apos;) - 1</div><div class="line">						)</div><div class="line">					)</div><div class="line">				ELSE</div><div class="line">					TO_NUMBER (T6.wholeNum)</div><div class="line">				END || &apos;-&apos; || -- 符号 || 为字符串拼接符</div><div class="line">					ROW_NUMBER () OVER (</div><div class="line">					PARTITION BY T6.city -- 分组字段</div><div class="line">					ORDER BY</div><div class="line">						T6.TEMP_ID -- 排序字段</div><div class="line">				) CURRENTNUM, -- CURRENTNUM为别名</div><div class="line">				T6.*</div><div class="line">			FROM</div><div class="line">				(</div><div class="line">					SELECT</div><div class="line">						ROWNUM TEMP_ID,</div><div class="line">						T5.*</div><div class="line">					FROM</div><div class="line">						(</div><div class="line">							SELECT</div><div class="line">								STA1.F_WHOLE_NUM wholeNum,</div><div class="line">								STA1.F_STATIONID stationId,</div><div class="line">								STA1.F_STATIONNAME stationName,</div><div class="line">								STA1.F_DEVICEID deviceId,</div><div class="line">								STA1.F_CITY city,</div><div class="line">								STA1.F_LONGITUDE longitude,</div><div class="line">								STA1.F_LATITUDE latitude,</div><div class="line">								STA1.F_ROUTEID routeId,</div><div class="line">								STA1.F_MARK mark,</div><div class="line">								STA1.F_PROMARK proMark,</div><div class="line">								CHE.F_MARKERROR markError,</div><div class="line">								DAT.F_PARTINGERROR partingError,</div><div class="line">								DEV.F_ISOUT isOut,</div><div class="line">								STA1.F_ROADLEVEL roadLevel,</div><div class="line">								CHE.F_OPERATIONSTATUS operationStatus,</div><div class="line">								ROA.F_TEXTURE texture,</div><div class="line">								DEV.F_FACTORY factory,</div><div class="line">								DEV.F_DEVICETYPE deviceType,</div><div class="line">								DEV.F_SITE site,</div><div class="line">								DEV.F_POWERTYPE powerType,</div><div class="line">								DEV.F_TRANSFERTYPE transferType,</div><div class="line">								DEV.F_ANGLESTATUS anglestatus,</div><div class="line">								DEV.F_STABILITY stability,</div><div class="line">								DEV.F_BARTYPE barType,</div><div class="line">								DEV.F_VERTICALITY verticality,</div><div class="line">								DEV.F_CORROSION corrosion,</div><div class="line">								DEV.F_SOLARTYPE solarType,</div><div class="line">								DEV.F_FACADE facade,</div><div class="line">								DEVS.F_LANDFORM landForm,</div><div class="line">								ROA.F_MIXCONDITION mixCondition,</div><div class="line">								ROA.F_LIMIVELOCITY limiVelocity,</div><div class="line">								DEVS.F_ISSCENIC isScenic,</div><div class="line">								DEVS.F_ISMEDIUM isMedium,</div><div class="line">								DEVS.F_ISSECURITYDEVICE isSecurityDevice,</div><div class="line">								DEVS.F_ISSHARPTURN isSharpTurn,</div><div class="line">								DEVS.F_ISCROSS isCross,</div><div class="line">								DEVS.F_CROSSDISTANCE crossDistance,</div><div class="line">								DEVS.F_CROSSCONTROL crossControl,</div><div class="line">								DEVS.F_ISTOWN isTown,</div><div class="line">								ROA.F_ROADCONDITION roadCondition,</div><div class="line">								CHE.F_CHECKLANECOUNT checkLaneCount,</div><div class="line">								t3.F_ROADID &quot;roadId&quot;,</div><div class="line">								DAT.F_TIMEEND timeEnd,</div><div class="line">								DAT.F_TIMESTART timeStart,</div><div class="line">								CHE.F_WEATHER weather,</div><div class="line">								BUI.F_EXPLAIN EXPLAIN,</div><div class="line">								BUI.F_MEMO memo,</div><div class="line">								STA1.F_DEPT dept,</div><div class="line">								STA1.F_MILEAGE mileage,</div><div class="line">								ROA.F_ROADWIDTH roadWidth,</div><div class="line">								STA1.F_LEVEL &quot;level&quot;,</div><div class="line">								ROA.F_SPEED speed,</div><div class="line">								ROA.F_TRAVOLUME travolume,</div><div class="line">								DEV.F_UPRIGHT upright,</div><div class="line">								CHE.F_ISIMPORTANT isImportant,</div><div class="line">								DAT.F_DATACOLLECTIONUP dataCollectionUp,</div><div class="line">								DAT.F_DATACOLLECTIONDOWN dataCollectionDown,</div><div class="line">								DAT.F_AVGSPEEDERRORUP avgSpeedErrorUp,</div><div class="line">								DAT.F_AVGSPEEDERRORDOWN avgSpeedErrorDown,</div><div class="line">								DAT.F_CARFLOWRATEUP carFlowRateUp,</div><div class="line">								DAT.F_CARFLOWRATEDOWN carFlowRateDown,</div><div class="line">								T4.F_ZREO zeroRate,</div><div class="line">								DEV.F_ANTISEPTIC antiseptic,</div><div class="line">								BUI.F_CONSTRUCTIONNAME constructionName,</div><div class="line">								BUI.F_DONEDATE doneDate,</div><div class="line">								BUI.F_CHANGECOUNT changeCount,</div><div class="line">								BUI.F_CHANGEDEPT changeDept,</div><div class="line">								BUI.F_CHANGEDONEDATE changeDoneDate,</div><div class="line">								BUI.F_MAINTAINDEPT maintainDept,</div><div class="line">								BUI.F_MAINTAINCONTACTS maintainContacts,</div><div class="line">								BUI.F_MAINTAINMOBILE maintainMobile</div><div class="line">							FROM</div><div class="line">								JD_STATIONINFO STA1</div><div class="line">							LEFT JOIN JD_ARTIFICIAL_INFO ART ON ART.F_DEVICEID = STA1.F_DEVICEID</div><div class="line">							AND ART.F_FLOWSTART &gt;= TO_DATE (</div><div class="line">								&apos;2017-09-01 00:00:00&apos;,</div><div class="line">								&apos;yyyy-MM-dd hh24:mi:ss&apos;</div><div class="line">							)</div><div class="line">							AND ART.F_FLOWEND &lt; TO_DATE (</div><div class="line">								&apos;2017-10-01 00:00:00&apos;,</div><div class="line">								&apos;yyyy-MM-dd hh24:mi:ss&apos;</div><div class="line">							)</div><div class="line">							LEFT JOIN JD_DATA_RESULT DAT ON DAT.F_TIMESTART = ART.F_FLOWSTART</div><div class="line">							AND DAT.F_TIMEEND = ART.F_FLOWEND</div><div class="line">							AND DAT.F_DEVICEID = ART.F_DEVICEID</div><div class="line">							LEFT JOIN (</div><div class="line">								SELECT</div><div class="line">									wm_concat (F_ROADID) F_ROADID</div><div class="line">										-- wm_concat() 列转为行的方法，如表:有两列数据</div><div class="line">												-- id  name  age </div><div class="line">												-- 1   张三  23</div><div class="line">												-- 2   李四  24</div><div class="line">										-- wm_concat(name) 则返回 &apos;张三,李四&apos; 一行字符串</div><div class="line">								FROM</div><div class="line">									(</div><div class="line">										SELECT</div><div class="line">											T .F_ROADID</div><div class="line">										FROM</div><div class="line">											(</div><div class="line">												SELECT</div><div class="line">													JAS.F_ROADID,</div><div class="line">													ROW_NUMBER () OVER (</div><div class="line">														PARTITION BY JAS.F_ROADID</div><div class="line">														ORDER BY</div><div class="line">															JAS.F_ROADID DESC</div><div class="line">													) AS code_id</div><div class="line">												FROM</div><div class="line">													JD_ARTIFICIAL_SPEED JAS</div><div class="line">												WHERE</div><div class="line">													1 = 1</div><div class="line">												AND JAS.F_SPEEDDATESTART &gt;= TO_DATE (</div><div class="line">													&apos;2017-09-01 00:00:00&apos;,</div><div class="line">													&apos;yyyy-MM-dd hh24:mi:ss&apos;</div><div class="line">												)</div><div class="line">												AND JAS.F_SPEEDDATEEND &lt; TO_DATE (</div><div class="line">													&apos;2017-10-01 00:00:00&apos;,</div><div class="line">													&apos;yyyy-MM-dd hh24:mi:ss&apos;</div><div class="line">												)</div><div class="line">											) T</div><div class="line">										WHERE</div><div class="line">											T .code_id = 1</div><div class="line">									) t2</div><div class="line">							) t3 ON 1 = 1</div><div class="line">							LEFT JOIN JD_BUILD BUI ON BUI.F_DEVICEID = STA1.F_DEVICEID</div><div class="line">							LEFT JOIN JD_CHECK CHE ON CHE.F_DEVICEID = STA1.F_DEVICEID</div><div class="line">							LEFT JOIN JD_DEVICE DEV ON DEV.F_DEVICEID = STA1.F_DEVICEID</div><div class="line">							LEFT JOIN JD_DEVICE_SITE DEVS ON DEVS.F_DEVICEID = STA1.F_DEVICEID</div><div class="line">							LEFT JOIN JD_ROAD_INFO ROA ON ROA.F_DEVICEID = STA1.F_DEVICEID</div><div class="line">							LEFT JOIN (</div><div class="line">								SELECT</div><div class="line">									*</div><div class="line">								FROM</div><div class="line">									(</div><div class="line">										SELECT</div><div class="line">											JZR.F_ZREO,</div><div class="line">											JZR.F_DEVICE_ID</div><div class="line">										FROM</div><div class="line">											JD_ZERO_RATE JZR</div><div class="line">										WHERE</div><div class="line">											JZR.F_YEAR = 2017</div><div class="line">									)</div><div class="line">							) T4 ON T4.F_DEVICE_ID = ART.F_DEVICEID</div><div class="line">							WHERE</div><div class="line">								1 = 1</div><div class="line">							ORDER BY -- 多条件排序</div><div class="line">								CASE</div><div class="line">								WHEN INSTR (STA1.F_WHOLE_NUM, &apos;-&apos;) &gt; 0 THEN</div><div class="line">									TO_NUMBER (</div><div class="line">										SUBSTR (</div><div class="line">											STA1.F_WHOLE_NUM,</div><div class="line">											0,</div><div class="line">											INSTR (STA1.F_WHOLE_NUM, &apos;-&apos;) - 1</div><div class="line">										)</div><div class="line">									)</div><div class="line">								ELSE</div><div class="line">									TO_NUMBER (STA1.F_WHOLE_NUM)</div><div class="line">								END, -- 条件1 将STA1.F_WHOLE_NUM字段分割并取取出想要排序的字符，再转化成int型</div><div class="line">								CASE</div><div class="line">								WHEN INSTR (STA1.F_WHOLE_NUM, &apos;-&apos;) &gt; 0 THEN</div><div class="line">									TO_NUMBER (</div><div class="line">										SUBSTR (</div><div class="line">											STA1.F_WHOLE_NUM,</div><div class="line">											INSTR (STA1.F_WHOLE_NUM, &apos;-&apos;) + 1</div><div class="line">										)</div><div class="line">									)</div><div class="line">								ELSE</div><div class="line">									TO_NUMBER (STA1.F_WHOLE_NUM)</div><div class="line">								END -- 条件2</div><div class="line">						) T5</div><div class="line">				) T6</div><div class="line">			) T7</div><div class="line">	) T8</div><div class="line">WHERE</div><div class="line">	1 = 1</div></pre></td></tr></table></figure>
<h4 id="10-2-字符分割成多列语句"><a href="#10-2-字符分割成多列语句" class="headerlink" title="10.2 字符分割成多列语句"></a>10.2 字符分割成多列语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">with t as</div><div class="line"> (select &apos;0141150312061303,0141150312061306,0141150312061302,0141150315123001,0141150312061305,0141150314122202,0141150313101101,0141150312061311,0141150312121802,0141150312061310,0141150314122201,0141150312061312,0141150312061309,0141150313122301,0141150312061308,0141150312061307,0141150313122302,0141150316110701,0141150312061304,0141150316110702,0151145309120004,0151145311120017,0151145311120018,0151145311120019,0151145313090090,0151145309120003,0151145307070006,0151145311120016,0151145307070003,0151145311120012,0151145311120013,0151145307070005,0151145307070007,0141150316111801,0151145311120010,0151145311120050,0151145315120003,0151145309120002,0151145215120002,0151145311120015,0151145307070001,0151145307070002,0151145311120014,0141150309030036,0141150309030035,0171170315090810,0141150309030032,0141150309030037,0141150309030038,010106140807,0141150309030039,0141150310040049,0141150309030040,0141150309030041,0141150309030042,0141150312010009,0AB0004784,0141150312010012,0141150312010007,0141150310040058,0141150312010006,0141150312010011,0101130313010202,0101130313010201,0141150313012503,0141150312010010,0141150312010002,0141150312010005,0101130313010204,0141150313012501,0141150313012502,0171170315090710,0141150312010001,0171170315090711,0141150312010003,0141150309030033,0141150316101203,0141150312102908,0141150316101204,0141150311090002,0141150316101202,0141150309100051,0141150309100050,0141150309100049,0141150309100048,0140050309100047,0141150309100046,0141150311110093,0141150316101205,0141150314101403,0141150311110091,0141150309100045,0141150309100044,0141150312102902,0141150311090006,0141150312102903,0141150314101401,0141150309100043,0141150314101402,0141150611090004,0141150312102906,0141150311050187,0141150311110092,0141150311050189,0141150312102904,0141150316101207,0141150312102901,0141150312102905,0141150311090001,0141150311020051,0141150310040040,0141150316101206,0141150311050188&apos; a from dual)</div><div class="line">select substr(a,</div><div class="line">              decode(level - 1, 0, 0, instr(a, &apos;,&apos;, 1, level - 1)) + 1,</div><div class="line">              (decode(level,</div><div class="line">                      regexp_count(a, &apos;,&apos;) + 1,</div><div class="line">                      length(a) + 1,</div><div class="line">                      instr(a, &apos;,&apos;, 1, level))) -</div><div class="line">              (decode(level - 1, 0, 0, instr(a, &apos;,&apos;, 1, level - 1)) + 1)) F_DEVICEID</div><div class="line">  from t</div><div class="line">connect by level &lt;= regexp_count(a, &apos;,&apos;) + 1;</div></pre></td></tr></table></figure>
<h3 id="11-group-by-注意事项"><a href="#11-group-by-注意事项" class="headerlink" title="11 group by 注意事项"></a>11 group by 注意事项</h3><p>GROUP BY注意点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">表名 t</div><div class="line">id name age</div><div class="line">1  a     4</div><div class="line">2  b     5</div><div class="line">3  c     6</div><div class="line">like MIN, MAX or SUM).</div><div class="line">select name from t group by id; ×</div><div class="line">select name from t group by id,name; √</div><div class="line">在使用group时，select和from之间不能直接添加某个字段，需要使用函数，如：MIN, MAX, SUM。</div></pre></td></tr></table></figure>
<p>======</p>
<h3 id="12-left-join-on后面的条件与where后的条件的区别"><a href="#12-left-join-on后面的条件与where后的条件的区别" class="headerlink" title="12 left join on后面的条件与where后的条件的区别"></a>12 left join on后面的条件与where后的条件的区别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">select * from td</div><div class="line">  left join (</div><div class="line">select case_id as sup_case_id , count(*) supervise_number from </div><div class="line"> td_kcdc_case_sup_info </div><div class="line"> group by  case_id</div><div class="line">  ) sup</div><div class="line"> on  </div><div class="line">   sup.sup_case_id = td.case_id</div><div class="line"> where 1=1   /*不能去掉， 否则认为and 后的条件为 联合查询时的条件， 不能起过滤作用，由于left join因此td表中记录将全部查出来*/</div><div class="line"></div><div class="line"> and td.con = &apos;xxxx&apos;</div></pre></td></tr></table></figure>
<p>总结：</p>
<ol>
<li>对于left join，不管on后面跟什么条件，左表的数据全部查出来，因此要想过滤需把条件放到where后面。</li>
<li>对于inner join，满足on后面的条件表的数据才能查出，可以起到过滤作用。也可以把条件放到where后面。</li>
</ol>
<h3 id="13-查询某字段不等于字符串的数据的sql"><a href="#13-查询某字段不等于字符串的数据的sql" class="headerlink" title="13 查询某字段不等于字符串的数据的sql"></a>13 查询某字段不等于字符串的数据的sql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-- 判断name不等于&apos;xn&apos;的数据，会把name为null的和name不等于&apos;xn&apos;的数据查出来</div><div class="line">select * from test where instr(concat(name,&apos;xx&apos;),&apos;xn&apos;) = 0</div></pre></td></tr></table></figure>
<h3 id="14-树形结构查询"><a href="#14-树形结构查询" class="headerlink" title="14 树形结构查询"></a>14 树形结构查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">SELECT</div><div class="line">	cor. ID,cor.parent_id,cor. NAME</div><div class="line">FROM</div><div class="line">	cas_organization cor</div><div class="line">WHERE</div><div class="line">	1 = 1</div><div class="line">AND INSTR (CONCAT (cor.remarks, &apos;xx&apos;),&apos;Y&apos;) = 0 -- remarks字段不等于&apos;Y&apos;的数据</div><div class="line">AND INSTR (CONCAT (cor.del_flag, &apos;xx&apos;),&apos;1&apos;) = 0</div><div class="line">START WITH cor.parent_id = &apos;164294abc7ca649b9eb200000c9f10bf&apos; -- 这里是父id，如果是id(子id：cor.id = &apos;164294abc7ca649b9eb200000c9f10bf&apos;)则查询结果包含该数据</div><div class="line">CONNECT BY PRIOR cor. ID = cor.parent_id</div></pre></td></tr></table></figure>
<h3 id="15-powerdesigner连接数据库"><a href="#15-powerdesigner连接数据库" class="headerlink" title="15 powerdesigner连接数据库"></a>15 powerdesigner连接数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">参考：</div><div class="line">https://www.cnblogs.com/clivehua/articles/4593211.html</div></pre></td></tr></table></figure>
<h3 id="16-用户权限"><a href="#16-用户权限" class="headerlink" title="16 用户权限"></a>16 用户权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-- 为用户分配操作所有表的权限和创建运行存储过程的权限</div><div class="line">grant create any table to username;</div><div class="line">grant create any procedure to username; </div><div class="line">grant execute any procedure to username;</div></pre></td></tr></table></figure>
<h3 id="17-PowerDesigner中文注释"><a href="#17-PowerDesigner中文注释" class="headerlink" title="17 PowerDesigner中文注释"></a>17 PowerDesigner中文注释</h3><p>PowerDesigner<br>从comment替换name<br>Tools-&gt;Execute Commands-&gt;Edit/Run Script<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">Option   Explicit   </div><div class="line">ValidationMode   =   True   </div><div class="line">InteractiveMode   =   im_Batch  </div><div class="line">  </div><div class="line">Dim   mdl   &apos;   the   current   model  </div><div class="line">  </div><div class="line">&apos;   get   the   current   active   model   </div><div class="line">Set   mdl   =   ActiveModel   </div><div class="line">If   (mdl   Is   Nothing)   Then   </div><div class="line">      MsgBox   &quot;There   is   no   current   Model &quot;   </div><div class="line">ElseIf   Not   mdl.IsKindOf(PdPDM.cls_Model)   Then   </div><div class="line">      MsgBox   &quot;The   current   model   is   not   an   Physical   Data   model. &quot;   </div><div class="line">Else   </div><div class="line">      ProcessFolder   mdl   </div><div class="line">End   If  </div><div class="line">  </div><div class="line">Private   sub   ProcessFolder(folder)   </div><div class="line">On Error Resume Next  </div><div class="line">      Dim   Tab   &apos;running     table   </div><div class="line">      for   each   Tab   in   folder.tables   </div><div class="line">            if   not   tab.isShortcut   then   </div><div class="line">                  tab.name   =   tab.comment  </div><div class="line">                  Dim   col   &apos;   running   column   </div><div class="line">                  for   each   col   in   tab.columns   </div><div class="line">                  if col.comment=&quot;&quot; then  </div><div class="line">                  else  </div><div class="line">                        col.name=   col.comment   </div><div class="line">                  end if  </div><div class="line">                  next   </div><div class="line">            end   if   </div><div class="line">      next  </div><div class="line">  </div><div class="line">      Dim   view   &apos;running   view   </div><div class="line">      for   each   view   in   folder.Views   </div><div class="line">            if   not   view.isShortcut   then   </div><div class="line">                  view.name   =   view.comment   </div><div class="line">            end   if   </div><div class="line">      next  </div><div class="line">  </div><div class="line">      &apos;   go   into   the   sub-packages   </div><div class="line">      Dim   f   &apos;   running   folder   </div><div class="line">      For   Each   f   In   folder.Packages   </div><div class="line">            if   not   f.IsShortcut   then   </div><div class="line">                  ProcessFolder   f   </div><div class="line">            end   if   </div><div class="line">      Next   </div><div class="line">end   sub</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[spring整合quartz]]></title>
      <url>https://volc1605.github.io/2017/04/09/spring%E6%95%B4%E5%90%88quartz/</url>
      <content type="html"><![CDATA[<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><a id="more"></a>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><h5 id="问题1-quartz解决并发问题"><a href="#问题1-quartz解决并发问题" class="headerlink" title="问题1 quartz解决并发问题"></a>问题1 quartz解决并发问题</h5><p>要清楚一点是，synchronized同步是不能够完全处理并发问题的。<br>产生原因：触发时间间隔小于程序运行时间间隔，也就是当前任务没有结束就进行了下一轮任务。<br>这样容易导致数据混乱，是不可行的。</p>
<p>applicationContext-schedule.xml配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div class="line">	xsi:schemaLocation=&quot;</div><div class="line">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</div><div class="line">	default-lazy-init=&quot;true&quot;&gt;</div><div class="line">	&lt;!-- 线程池执行器配置，用于任务注册 --&gt;</div><div class="line">	&lt;bean id=&quot;executor&quot; class=&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&quot;&gt;</div><div class="line">		&lt;property name=&quot;corePoolSize&quot; value=&quot;1&quot; /&gt;</div><div class="line">		&lt;property name=&quot;maxPoolSize&quot; value=&quot;1&quot; /&gt;</div><div class="line">		&lt;property name=&quot;queueCapacity&quot; value=&quot;500&quot; /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line">	&lt;bean id=&quot;testJobTask&quot; class=&quot;cn.volc.task.job.TestJobTask&quot; /&gt;</div><div class="line"></div><div class="line">	&lt;!-- 定义任务bean --&gt;</div><div class="line">	&lt;bean name=&quot;myJobDetail&quot; class=&quot;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&quot;&gt;</div><div class="line">		&lt;property name=&quot;targetObject&quot; ref=&quot;testJobTask&quot; /&gt;</div><div class="line">		&lt;property name=&quot;targetMethod&quot; value=&quot;excute&quot; /&gt;</div><div class="line">		&lt;!-- false:定义这个任务不能并发执行(很关键) --&gt;</div><div class="line">		&lt;property name=&quot;concurrent&quot; value=&quot;false&quot; /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line"></div><div class="line">	&lt;!-- 定义触发器 --&gt;</div><div class="line">	&lt;bean id=&quot;cronTrigger&quot; class=&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;&gt;</div><div class="line">		&lt;property name=&quot;jobDetail&quot; ref=&quot;myJobDetail&quot; /&gt;</div><div class="line">		&lt;!-- 每半小时执行一次 (0/30000 * * * * ?)(凌晨一点)0 0 1 * * ? | 0 5 16 17 5 ? --&gt;</div><div class="line">		&lt;property name=&quot;cronExpression&quot; value=&quot;0/1 * * * * ?&quot; /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line"></div><div class="line">	&lt;!-- 定义调度器 --&gt;</div><div class="line">	&lt;bean class=&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;&gt;</div><div class="line">		&lt;property name=&quot;triggers&quot;&gt;</div><div class="line">			&lt;list&gt;</div><div class="line">				&lt;ref bean=&quot;cronTrigger&quot; /&gt;</div><div class="line">				&lt;!-- &lt;ref bean=&quot;cronTrigger2&quot; /&gt; --&gt;</div><div class="line">			&lt;/list&gt;</div><div class="line">		&lt;/property&gt;</div><div class="line">		&lt;property name=&quot;taskExecutor&quot; ref=&quot;executor&quot; /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure></p>
<p>TestJobTask任务处理类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJobTask</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">excute</span><span class="params">()</span> </span>&#123;</div><div class="line">	System.out.println(<span class="string">"Start job"</span>);</div><div class="line">	<span class="comment">// 创建线程池大小</span></div><div class="line">	ExecutorService exec = Executors.newFixedThreadPool(<span class="number">3</span>);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</div><div class="line">	    exec.execute(<span class="keyword">new</span> TestThread());</div><div class="line">	&#125;</div><div class="line">	exec.shutdown();</div><div class="line">	<span class="keyword">while</span> (!exec.isTerminated()) &#123;</div><div class="line">	&#125;</div><div class="line">	System.out.println(<span class="string">"end job"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>TestThread类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.volc.task.job;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    System.out.println(<span class="string">"执行线程"</span>);</div><div class="line">	    Thread.sleep(<span class="number">5000</span>);</div><div class="line">	    System.out.println(<span class="string">"执行完毕"</span>);</div><div class="line">	&#125; <span class="keyword">catch</span> (InterruptedException e1) &#123;</div><div class="line">	    e1.printStackTrace();</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>虽然轮询间隔为1秒，但是上一轮询主线程中的子线程(睡眠5秒)没结束，主线程不会继续往下执行，就不会进入下一轮询。处理并发问题可采用这种方案。</p>
<h5 id="问题2-多线程保证数据准确性-待优化"><a href="#问题2-多线程保证数据准确性-待优化" class="headerlink" title="问题2 多线程保证数据准确性(待优化)"></a>问题2 多线程保证数据准确性(待优化)</h5><p>问题产生原因<br>在次线程1中创建一个对象，并实例化其中的static变量值，那么次线程2也实例化了该对象并更新了其static变量值，<br>在次线程1中使用实例化的对象时数据是不准确定，导致数据产生混乱。<br>解决方案：以传递参数的方式，传递实例化的对象中的方法所需要的参数，而不是在实例化对象时赋予变量值。<br>强烈参照：<a href="http://blog.csdn.net/mark_lq/article/details/50329559" target="_blank" rel="external">多线程保证数据的隔离性</a></p>
<h3 id="1-quartz使用"><a href="#1-quartz使用" class="headerlink" title="1 quartz使用"></a>1 quartz使用</h3><p>&emsp;&emsp;<strong>Quartz</strong>是一个Java下作业控制的开源框架。Quartz用来创建或简单或复杂的调度时间表，执行Java下任意数量的作业。版本1.0发布于2002年9月13日，当前版本2.2.1发布于2013年9月24日。<br>可以通过CronTrigger定义Quartz的调度时间表（例如0 0 12 ? * WED表示“每周三上午12：00”）。此外，时间表也可以通过SimpleTrigger，由Date定义触发的开始时间、毫秒的时间间隔和重复计数（例如“在下周三12：00，然后每隔10秒、执行5次”）。可以使用Calender定义例外的日程（例如“没有周末和节假日”）。<br>作业可以是实现了Job接口任意的Java类。作业监听器（JobListener）和触发器监听器（TriggerListener）通知作业的执行（和其他事件）。作业及其触发器可以被持久化。<br>Quartz一般用于企业级应用程序，以支持工作流、系统管理（维护）活动，并在应用程序中提供实时的服务。Quartz还支持集群。<br>Quartz是Terracotta公司的开源产品。 .NET平台下的对应产品叫Quartz.NET。<br>quratz任务的注册(蓝线)和执行(红线)</p>
<p><img src="http://volcfamily.cn/images/spring整合quratz/quratz.PNG" alt="quartz"><br>quartz核心接口</p>
<blockquote>
<ul>
<li>Schecduler  核心调度器</li>
<li>Job         任务</li>
<li>JobDetail   任务描述</li>
<li>Trigger     触发器</li>
</ul>
</blockquote>
<p>Tigger</p>
<blockquote>
<ul>
<li>SimpleTrigger 简单的触发，指定时间</li>
<li>CronTrigger 表达式触发,处理复杂时间执行，类似日历</li>
</ul>
</blockquote>
<h3 id="2-简单使用demo"><a href="#2-简单使用demo" class="headerlink" title="2 简单使用demo"></a>2 简单使用demo</h3><p>定义job<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> org.slf4j.Logger;</div><div class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</div><div class="line"><span class="keyword">import</span> org.quartz.Job;</div><div class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</div><div class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * &lt;p&gt;</div><div class="line"> * This is just a simple job that says "Hello" to the world.</div><div class="line"> * &lt;/p&gt;</div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> Bill Kratzer</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger _log = LoggerFactory.getLogger(HelloJob.class);</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * &lt;p&gt;</div><div class="line">     * Empty constructor for job initilization</div><div class="line">     * &lt;/p&gt;</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Quartz requires a public empty constructor so that the</div><div class="line">     * scheduler can instantiate the class whenever it needs.</div><div class="line">     * &lt;/p&gt;</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloJob</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * &lt;p&gt;</div><div class="line">     * Called by the &lt;code&gt;&#123;<span class="doctag">@link</span> org.quartz.Scheduler&#125;&lt;/code&gt; when a</div><div class="line">     * &lt;code&gt;&#123;<span class="doctag">@link</span> org.quartz.Trigger&#125;&lt;/code&gt; fires that is associated with</div><div class="line">     * the &lt;code&gt;Job&lt;/code&gt;.</div><div class="line">     * &lt;/p&gt;</div><div class="line">     * </div><div class="line">     * <span class="doctag">@throws</span> JobExecutionException</div><div class="line">     *             if there is an exception while executing the job.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">// Say Hello to the World and display the date/time</span></div><div class="line">	_log.info(<span class="string">"Hello World! - "</span> + <span class="keyword">new</span> Date());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>简单注册和触发demo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.quartz.DateBuilder.evenMinuteDate;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.quartz.JobBuilder.newJob;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.quartz.TriggerBuilder.newTrigger;</div><div class="line"><span class="keyword">import</span> org.quartz.JobDetail;</div><div class="line"><span class="keyword">import</span> org.quartz.Scheduler;</div><div class="line"><span class="keyword">import</span> org.quartz.SchedulerFactory;</div><div class="line"><span class="keyword">import</span> org.quartz.Trigger;</div><div class="line"><span class="keyword">import</span> org.quartz.impl.StdSchedulerFactory;</div><div class="line"><span class="keyword">import</span> org.slf4j.Logger;</div><div class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * This Example will demonstrate how to start and shutdown the Quartz scheduler and how to schedule</div><div class="line"> * a job to run in Quartz.</div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> Bill Kratzer</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleExample</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	Logger log = LoggerFactory.getLogger(SimpleExample.class);</div><div class="line"></div><div class="line">	log.info(<span class="string">"------- Initializing ----------------------"</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 定义调度器</span></div><div class="line">	SchedulerFactory sf = <span class="keyword">new</span> StdSchedulerFactory();</div><div class="line">	Scheduler sched = sf.getScheduler();</div><div class="line"></div><div class="line">	log.info(<span class="string">"------- Initialization Complete -----------"</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 获取当前时间的下一分钟</span></div><div class="line">	Date runTime = evenMinuteDate(<span class="keyword">new</span> Date());</div><div class="line"></div><div class="line">	log.info(<span class="string">"------- Scheduling Job  -------------------"</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 定义job,要执行的HelloJob,组曾jobdetail</span></div><div class="line">	<span class="comment">// 在quartz中，有组的概念，组+job名称 唯一的</span></div><div class="line">	JobDetail job = newJob(HelloJob.class).withIdentity(<span class="string">"job1"</span>, <span class="string">"group1"</span>).build();</div><div class="line"></div><div class="line">	<span class="comment">// 定义触发器，在下一分钟启动</span></div><div class="line">	Trigger trigger = newTrigger().withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>).startAt(runTime).build();</div><div class="line"></div><div class="line">	<span class="comment">// 将job注册到调度器</span></div><div class="line">	sched.scheduleJob(job, trigger);</div><div class="line">	log.info(job.getKey() + <span class="string">" will run at: "</span> + runTime);</div><div class="line"></div><div class="line">	<span class="comment">// 启动调度器</span></div><div class="line">	sched.start();</div><div class="line"></div><div class="line">	log.info(<span class="string">"------- Started Scheduler -----------------"</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 等待65秒</span></div><div class="line">	log.info(<span class="string">"------- Waiting 65 seconds... -------------"</span>);</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// wait 65 seconds to show job</span></div><div class="line">	    Thread.sleep(<span class="number">65L</span> * <span class="number">1000L</span>);</div><div class="line">	    <span class="comment">// executing...</span></div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    <span class="comment">//</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 关闭调度器</span></div><div class="line">	log.info(<span class="string">"------- Shutting Down ---------------------"</span>);</div><div class="line">	sched.shutdown(<span class="keyword">true</span>);</div><div class="line">	log.info(<span class="string">"------- Shutdown Complete -----------------"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">	SimpleExample example = <span class="keyword">new</span> SimpleExample();</div><div class="line">	example.run();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>表达式注册和触发demo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.quartz.CronScheduleBuilder.cronSchedule;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.quartz.DateBuilder.evenMinuteDate;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.quartz.JobBuilder.newJob;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.quartz.TriggerBuilder.newTrigger;</div><div class="line"><span class="keyword">import</span> org.quartz.JobDetail;</div><div class="line"><span class="keyword">import</span> org.quartz.Scheduler;</div><div class="line"><span class="keyword">import</span> org.quartz.SchedulerFactory;</div><div class="line"><span class="keyword">import</span> org.quartz.Trigger;</div><div class="line"><span class="keyword">import</span> org.quartz.impl.StdSchedulerFactory;</div><div class="line"><span class="keyword">import</span> org.slf4j.Logger;</div><div class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * This Example will demonstrate how to start and shutdown the Quartz scheduler and how to schedule</div><div class="line"> * a job to run in Quartz.</div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> Bill Kratzer</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleCronExample</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	Logger log = LoggerFactory.getLogger(SimpleCronExample.class);</div><div class="line"></div><div class="line">	log.info(<span class="string">"------- Initializing ----------------------"</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 定义调度器</span></div><div class="line">	SchedulerFactory sf = <span class="keyword">new</span> StdSchedulerFactory();</div><div class="line">	Scheduler sched = sf.getScheduler();</div><div class="line"></div><div class="line">	log.info(<span class="string">"------- Initialization Complete -----------"</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 获取当前时间的下一分钟</span></div><div class="line">	Date runTime = evenMinuteDate(<span class="keyword">new</span> Date());</div><div class="line"></div><div class="line">	log.info(<span class="string">"------- Scheduling Job  -------------------"</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 定义job</span></div><div class="line">	JobDetail job = newJob(HelloJob.class).withIdentity(<span class="string">"job1"</span>, <span class="string">"group1"</span>).build();</div><div class="line"></div><div class="line">	<span class="comment">// 定义触发器，每2秒执行一次</span></div><div class="line">	Trigger trigger = newTrigger().withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>).withSchedule(cronSchedule(<span class="string">"0 0/1 * * * ?"</span>)).build();</div><div class="line"></div><div class="line">	<span class="comment">// 将job注册到调度器</span></div><div class="line">	sched.scheduleJob(job, trigger);</div><div class="line">	log.info(job.getKey() + <span class="string">" will run at: "</span> + runTime);</div><div class="line"></div><div class="line">	<span class="comment">// 启动调度器</span></div><div class="line">	sched.start();</div><div class="line"></div><div class="line">	log.info(<span class="string">"------- Started Scheduler -----------------"</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 等待1分钟</span></div><div class="line">	log.info(<span class="string">"------- Waiting 60 seconds... -------------"</span>);</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    Thread.sleep(<span class="number">60L</span> * <span class="number">1000L</span>);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    <span class="comment">//</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 关闭调度器</span></div><div class="line">	log.info(<span class="string">"------- Shutting Down ---------------------"</span>);</div><div class="line">	sched.shutdown(<span class="keyword">true</span>);</div><div class="line">	log.info(<span class="string">"------- Shutdown Complete -----------------"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">	SimpleCronExample example = <span class="keyword">new</span> SimpleCronExample();</div><div class="line">	example.run();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="3-spring整合quartz"><a href="#3-spring整合quartz" class="headerlink" title="3 spring整合quartz"></a>3 spring整合quartz</h3><h4 id="3-1-导入依赖"><a href="#3-1-导入依赖" class="headerlink" title="3.1 导入依赖"></a>3.1 导入依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;quartz&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;2.2.1&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;!-- 支持spring整合第三方框架支持包 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;4.0.6.RELEASE&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h4 id="3-2-Job类继承抽象类QuartzJobBean实现其中的executeInternal方法"><a href="#3-2-Job类继承抽象类QuartzJobBean实现其中的executeInternal方法" class="headerlink" title="3.2 Job类继承抽象类QuartzJobBean实现其中的executeInternal方法"></a>3.2 Job类继承抽象类QuartzJobBean实现其中的executeInternal方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</div><div class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;</div><div class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</div><div class="line"><span class="keyword">import</span> org.springframework.scheduling.quartz.QuartzJobBean;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJob</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</div><div class="line">	System.out.println(<span class="string">"myJob 执行了............."</span> + context.getTrigger().getKey().getName());</div><div class="line">	ApplicationContext applicationContext = (ApplicationContext) context.getJobDetail().getJobDataMap().get(<span class="string">"applicationContext"</span>); <span class="comment">// 配置中设置applicationContext</span></div><div class="line">	System.out.println(<span class="string">"获取到的Spring容器是： "</span> + applicationContext);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-3-加载scheduler配置文件-启动调度器"><a href="#3-3-加载scheduler配置文件-启动调度器" class="headerlink" title="3.3 加载scheduler配置文件(启动调度器)"></a><span id="jump">3.3 加载scheduler配置文件(启动调度器)</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:applicationContext-scheduler.xml"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="3-3-1-applicationContext-scheduler-xml配置文件"><a href="#3-3-1-applicationContext-scheduler-xml配置文件" class="headerlink" title="3.3.1 applicationContext-scheduler.xml配置文件"></a>3.3.1 applicationContext-scheduler.xml配置文件</h5><blockquote>
<ul>
<li>1.定义任务job类</li>
<li>2.定义表达式触发器</li>
<li>3.定义调度器并注册触发</li>
<li><a href="#jump">4.启动spring容器(启动调度器)</a></li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 定义任务bean --&gt;</div><div class="line">	&lt;bean name=&quot;myJobDetail&quot; class=&quot;org.springframework.scheduling.quartz.JobDetailFactoryBean&quot;&gt;</div><div class="line">		&lt;!-- 指定具体的job类 --&gt;</div><div class="line">		&lt;property name=&quot;jobClass&quot; value=&quot;cn.test.quartz.MyJob&quot; /&gt;</div><div class="line">		&lt;!-- 指定job的名称 --&gt;</div><div class="line">		&lt;property name=&quot;name&quot; value=&quot;myJob&quot; /&gt;</div><div class="line">		&lt;!-- 指定job的分组 --&gt;</div><div class="line">		&lt;property name=&quot;group&quot; value=&quot;jobs&quot; /&gt;</div><div class="line">		&lt;!-- 必须设置为true，如果为false，当没有活动的触发器与之关联时会在调度器中删除该任务 --&gt;</div><div class="line">		&lt;property name=&quot;durability&quot; value=&quot;true&quot; /&gt;</div><div class="line">		&lt;!-- 指定spring容器的key，如果不设定在job中的jobmap中是获取不到spring容器的 --&gt;</div><div class="line">		&lt;property name=&quot;applicationContextJobDataKey&quot; value=&quot;applicationContext&quot; /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line"></div><div class="line">	&lt;!-- 定义触发器 --&gt;</div><div class="line">	&lt;bean id=&quot;cronTrigger&quot; class=&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;&gt;</div><div class="line">		&lt;!-- 一个触发器只能有一个job，因为CronTriggerFactoryBean中没有setJobDetails --&gt;</div><div class="line">		&lt;property name=&quot;jobDetail&quot; ref=&quot;myJobDetail&quot; /&gt;</div><div class="line">		&lt;!-- 每一分钟执行一次 --&gt;</div><div class="line">		&lt;property name=&quot;cronExpression&quot; value=&quot;0/5 * * * * ?&quot; /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line"></div><div class="line">	&lt;!-- 定义触发器 --&gt;</div><div class="line">	&lt;!-- 演示：一个job可以有多个trigger； --&gt;</div><div class="line">	&lt;!-- &lt;bean id=&quot;cronTrigger2&quot; class=&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;&gt; &lt;property name=&quot;jobDetail&quot; ref=&quot;myJobDetail&quot; /&gt; 每一分钟执行一次 &lt;property name=&quot;cronExpression&quot; value=&quot;0 */1 </div><div class="line">		* * * ?&quot; /&gt; &lt;/bean&gt; --&gt;</div><div class="line">	&lt;!-- 定义调度器 --&gt;</div><div class="line">	&lt;bean class=&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;&gt;</div><div class="line">		&lt;property name=&quot;triggers&quot;&gt;</div><div class="line">			&lt;list&gt;</div><div class="line">				&lt;ref bean=&quot;cronTrigger&quot; /&gt;</div><div class="line">				&lt;ref bean=&quot;cronTrigger2&quot; /&gt;</div><div class="line">			&lt;/list&gt;</div><div class="line">		&lt;/property&gt;</div><div class="line">	&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h3 id="4-使用org-springframework-scheduling-concurrent-ThreadPoolTaskExecutor多线程执行任务"><a href="#4-使用org-springframework-scheduling-concurrent-ThreadPoolTaskExecutor多线程执行任务" class="headerlink" title="4 使用org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor多线程执行任务"></a>4 使用org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor多线程执行任务</h3><p>ThreadPoolTaskExecutor线程池，用来并行执行每个对应的job，提高效率，这也是上面提到不推荐使用jdk自身timer的一个很重要的原因</p>
<h4 id="4-1-job类"><a href="#4-1-job类" class="headerlink" title="4.1 job类"></a>4.1 job类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJobThread</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">()</span> </span>&#123;</div><div class="line">	ThreadPoolTaskExecutor jobPropertyConfigurer = (ThreadPoolTaskExecutor) ContextUtil.getBean(<span class="string">"executor"</span>);</div><div class="line">	jobPropertyConfigurer.execute(<span class="keyword">new</span> TestThread()); <span class="comment">// 单个线程加入到线程池中执行，可加入多个线程到线程池</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="4-2-需要执行的线程类"><a href="#4-2-需要执行的线程类" class="headerlink" title="4.2 需要执行的线程类"></a>4.2 需要执行的线程类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> TestThread</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 需要执行的线程类</div><div class="line"> * <span class="doctag">@Date</span> 2017年4月10日 上午12:55:36</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">	System.out.println(<span class="string">"执行了线程"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="4-3-启动调度器"><a href="#4-3-启动调度器" class="headerlink" title="4.3 启动调度器"></a>4.3 启动调度器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</div><div class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</div><div class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> ContextUtil</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> 获取ApplicationContext对象工具类，用于方取出注入的bean</div><div class="line"> * <span class="doctag">@Date</span> 2017年4月10日 上午12:08:58</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextUtil</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext context;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title">getContext</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String beanName)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> context.getBean(beanName);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</div><div class="line">	context = applicationContext;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 启动调度器</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="keyword">new</span> String[] &#123; <span class="string">"applicationContext-schedulerThread.xml"</span> &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="4-4-scheduler配置文件applicationContext-schedulerThread-xml"><a href="#4-4-scheduler配置文件applicationContext-schedulerThread-xml" class="headerlink" title="4.4 scheduler配置文件applicationContext-schedulerThread.xml"></a>4.4 scheduler配置文件applicationContext-schedulerThread.xml</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line">&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:context="http://www.springframework.org/schema/context" xmlns:p="http://www.springframework.org/schema/p" xmlns:aop="http://www.springframework.org/schema/aop"</div><div class="line">	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</div><div class="line">	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	&lt;!-- 线程执行器配置，用于任务注册 --&gt;</div><div class="line">	&lt;bean id="executor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor"&gt;</div><div class="line">		&lt;property name="corePoolSize" value="10" /&gt;</div><div class="line">		&lt;property name="maxPoolSize" value="100" /&gt;</div><div class="line">		&lt;property name="queueCapacity" value="500" /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line"></div><div class="line">	&lt;bean id="testJobTask" class="cn.test.quartz.MyJobThread" /&gt;</div><div class="line"></div><div class="line">	&lt;!-- 定义任务bean --&gt;</div><div class="line">	&lt;bean name="myJobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"&gt;</div><div class="line">		&lt;property name="targetObject" ref="testJobTask" /&gt;</div><div class="line">		&lt;property name="targetMethod" value="service" /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line"></div><div class="line">	&lt;!-- 定义触发器 --&gt;</div><div class="line">	&lt;bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean"&gt;</div><div class="line">		&lt;property name="jobDetail" ref="myJobDetail" /&gt;</div><div class="line">		&lt;!-- 每一分钟执行一次 --&gt;</div><div class="line">		&lt;property name="cronExpression" value="0/5 * * * * ?" /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line"></div><div class="line">	&lt;!-- 定义触发器 --&gt;</div><div class="line">	&lt;!-- 演示：一个job可以有多个trigger； --&gt;</div><div class="line">	&lt;!-- &lt;bean id="cronTrigger2" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean"&gt; &lt;property name="jobDetail" ref="myJobDetail" /&gt; 每一分钟执行一次 &lt;property name="cronExpression" value="0 */1 </div><div class="line">		* * * ?" /&gt; &lt;/bean&gt; --&gt;</div><div class="line">	&lt;!-- 定义调度器 --&gt;</div><div class="line">	&lt;bean class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt;</div><div class="line">		&lt;property name="triggers"&gt;</div><div class="line">			&lt;list&gt;</div><div class="line">				&lt;ref bean="cronTrigger" /&gt;</div><div class="line">				&lt;!-- &lt;ref bean="cronTrigger2" /&gt; --&gt;</div><div class="line">			&lt;/list&gt;</div><div class="line">		&lt;/property&gt;</div><div class="line">		&lt;!-- ThreadPoolTaskExecutor，线程池，用来并行执行每个对应的job，提高效率，这也是上面提到不推荐使用jdk自身timer的一个很重要的原因 --&gt;</div><div class="line">		&lt;property name="taskExecutor" ref="executor" /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">执行了线程</div><div class="line">2017-04-10 00:58:30,016 [org.springframework.scheduling.quartz.SchedulerFactoryBean#0_QuartzSchedulerThread] [org.quartz.core.QuartzSchedulerThread]-[DEBUG] batch acquisition of 1 triggers</div><div class="line">2017-04-10 00:58:35,004 [executor-4] [org.quartz.core.JobRunShell]-[DEBUG] Calling execute on job DEFAULT.myJobDetail</div><div class="line">2017-04-10 00:58:35,004 [org.springframework.scheduling.quartz.SchedulerFactoryBean#0_QuartzSchedulerThread] [org.quartz.core.QuartzSchedulerThread]-[DEBUG] batch acquisition of 1 triggers</div><div class="line">2017-04-10 00:58:35,004 [executor-4] [org.springframework.beans.factory.support.DefaultListableBeanFactory]-[DEBUG] Returning cached instance of singleton bean &apos;executor&apos;</div><div class="line">执行了线程</div><div class="line">2017-04-10 00:58:40,011 [executor-5] [org.quartz.core.JobRunShell]-[DEBUG] Calling execute on job DEFAULT.myJobDetail</div><div class="line">2017-04-10 00:58:40,011 [executor-5] [org.springframework.beans.factory.support.DefaultListableBeanFactory]-[DEBUG] Returning cached instance of singleton bean &apos;executor&apos;</div><div class="line">执行了线程</div><div class="line">2017-04-10 00:58:40,012 [org.springframework.scheduling.quartz.SchedulerFactoryBean#0_QuartzSchedulerThread] [org.quartz.core.QuartzSchedulerThread]-[DEBUG] batch acquisition of 1 triggers</div><div class="line">2017-04-10 00:58:45,001 [executor-7] [org.quartz.core.JobRunShell]-[DEBUG] Calling execute on job DEFAULT.myJobDetail</div><div class="line">2017-04-10 00:58:45,001 [org.springframework.scheduling.quartz.SchedulerFactoryBean#0_QuartzSchedulerThread] [org.quartz.core.QuartzSchedulerThread]-[DEBUG] batch acquisition of 1 triggers</div><div class="line">2017-04-10 00:58:45,001 [executor-7] [org.springframework.beans.factory.support.DefaultListableBeanFactory]-[DEBUG] Returning cached instance of singleton bean &apos;executor&apos;</div><div class="line">执行了线程</div></pre></td></tr></table></figure>
<hr>
<h3 id="5-quratz-cron表达式"><a href="#5-quratz-cron表达式" class="headerlink" title="5 quratz cron表达式"></a>5 quratz cron表达式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">1.	CronTrigger</div><div class="line">CronTriggers往往比SimpleTrigger更有用，如果您需要基于日历的概念，而非SimpleTrigger完全指定的时间间隔，复发的发射工作的时间表。</div><div class="line">CronTrigger，你可以指定触发的时间表如“每星期五中午”，或“每个工作日9:30时”，甚至“每5分钟一班9:00和10:00逢星期一上午，星期三星期五“。</div><div class="line">即便如此，SimpleTrigger一样，CronTrigger拥有的startTime指定的时间表时生效，指定的时间表时，应停止（可选）结束时间。</div><div class="line">2.	Cron Expressions</div><div class="line">cron的表达式被用来配置CronTrigger实例。 cron的表达式是字符串，实际上是由七子表达式，描述个别细节的时间表。这些子表达式是分开的空白，代表：</div><div class="line">1.	1.        Seconds</div><div class="line">2.	2.        Minutes</div><div class="line">3.	3.        Hours</div><div class="line">4.	4.        Day-of-Month</div><div class="line">5.	5.        Month</div><div class="line">6.	6.        Day-of-Week</div><div class="line">7.	7.        Year (可选字段)</div><div class="line">例  &quot;0 0 12 ? * WED&quot; 在每星期三下午12:00 执行,</div><div class="line">个别子表达式可以包含范围, 例如，在前面的例子里(&quot;WED&quot;)可以替换成 &quot;MON-FRI&quot;, &quot;MON, WED, FRI&quot;甚至&quot;MON-WED,SAT&quot;.</div><div class="line">“*” 代表整个时间段.</div><div class="line">每一个字段都有一套可以指定有效值，如</div><div class="line">Seconds (秒)         ：可以用数字0－59 表示，</div><div class="line">Minutes(分)          ：可以用数字0－59 表示，</div><div class="line">Hours(时)             ：可以用数字0-23表示,</div><div class="line">Day-of-Month(天) ：可以用数字1-31 中的任一一个值，但要注意一些特别的月份</div><div class="line">Month(月)            ：可以用0-11 或用字符串  “JAN, FEB, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV and DEC” 表示</div><div class="line">Day-of-Week(每周)：可以用数字1-7表示（1 ＝ 星期日）或用字符口串“SUN, MON, TUE, WED, THU, FRI and SAT”表示</div><div class="line">“/”：为特别单位，表示为“每”如“0/15”表示每隔15分钟执行一次,“0”表示为从“0”分开始, “3/20”表示表示每隔20分钟执行一次，“3”表示从第3分钟开始执行</div><div class="line">“?”：表示每月的某一天，或第周的某一天</div><div class="line">“L”：用于每月，或每周，表示为每月的最后一天，或每个月的最后星期几如“6L”表示“每月的最后一个星期五”</div><div class="line">“W”：表示为最近工作日，如“15W”放在每月（day-of-month）字段上表示为“到本月15日最近的工作日”</div><div class="line">““#”：是用来指定“的”每月第n个工作日,例 在每周（day-of-week）这个字段中内容为&quot;6#3&quot; or &quot;FRI#3&quot; 则表示“每月第三个星期五”</div><div class="line"> </div><div class="line">1）Cron表达式的格式：秒 分 时 日 月 周 年(可选)。</div><div class="line">               字段名                 允许的值                        允许的特殊字符  </div><div class="line">               秒                         0-59                               , - * /  </div><div class="line">               分                         0-59                               , - * /  </div><div class="line">               小时                     0-23                               , - * /  </div><div class="line">               日                         1-31                               , - * ? / L W C  </div><div class="line">               月                         1-12 or JAN-DEC         , - * /  </div><div class="line">               周几                     1-7 or SUN-SAT           , - * ? / L C #  </div><div class="line">               年 (可选字段)     empty, 1970-2099      , - * /</div><div class="line"> </div><div class="line">               “?”字符：表示不确定的值</div><div class="line">               “,”字符：指定数个值</div><div class="line">               “-”字符：指定一个值的范围</div><div class="line">               “/”字符：指定一个值的增加幅度。n/m表示从n开始，每次增加m</div><div class="line">               “L”字符：用在日表示一个月中的最后一天，用在周表示该月最后一个星期X</div><div class="line">               “W”字符：指定离给定日期最近的工作日(周一到周五)</div><div class="line">               “#”字符：表示该月第几个周X。6#3表示该月第3个周五</div><div class="line"> </div><div class="line"> </div><div class="line">         2）Cron表达式范例：</div><div class="line">                 每隔5秒执行一次：*/5 * * * * ?</div><div class="line">                 每隔1分钟执行一次：0 */1 * * * ?</div><div class="line">                 每天23点执行一次：0 0 23 * * ?</div><div class="line">                 每天凌晨1点执行一次：0 0 1 * * ?</div><div class="line">                 每月1号凌晨1点执行一次：0 0 1 1 * ?</div><div class="line">                 每月最后一天23点执行一次：0 0 23 L * ?</div><div class="line">                 每周星期天凌晨1点实行一次：0 0 1 ? * L</div><div class="line">                 在26分、29分、33分执行一次：0 26,29,33 * * * ?</div><div class="line">                 每天的0点、13点、18点、21点都执行一次：0 0 0,13,18,21 * * ?</div></pre></td></tr></table></figure>
<p>生成cron表达式工具:<br><a href="http://pan.baidu.com/s/1pKZKQWb" target="_blank" rel="external">CronExpBuilder-1.0(触发器表达式生成器).jar</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[收发邮件]]></title>
      <url>https://volc1605.github.io/2017/04/08/%E6%94%B6%E5%8F%91%E9%82%AE%E4%BB%B6/</url>
      <content type="html"><![CDATA[<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><a id="more"></a>
<h4 id="设置邮件标记"><a href="#设置邮件标记" class="headerlink" title="设置邮件标记"></a>设置邮件标记</h4><p>这个标记跟随email，用于区分是否为系统发送邮件，进行同步各用户邮件服务的邮件<br>有两种方式：<br>1.邮件对象设置内容ID(不推荐，容易丢失数据)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msg.setContentID();</div></pre></td></tr></table></figure></p>
<p>2.邮件对象设置handler(推荐)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msg.setHeader(&quot;key&quot;,&quot;value&quot;);</div></pre></td></tr></table></figure>
<p>3.IMAP解析<br>使用IMAP进行解析就可以获取该邮件的标识，来进行判断是否为外部系统发送的邮件，再同步该邮件到本地<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">msg.getContentID();</div><div class="line">String[] header = msg.getHeader(&quot;key&quot;);</div><div class="line">for (String s : header) &#123;</div><div class="line">	System.out.println(&quot;设定唯一标记&quot; + s);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="1-javamail收发邮件"><a href="#1-javamail收发邮件" class="headerlink" title="1 javamail收发邮件"></a>1 javamail收发邮件</h3><p>操作邮件收发需要服务开启POP3/SMTP服务。<br>引入javamailjar包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!-- https://mvnrepository.com/artifact/javax.mail/mail --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;javax.mail&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;mail&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;1.4&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>验证邮件账号<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.mail.Authenticator;</div><div class="line"><span class="keyword">import</span> javax.mail.PasswordAuthentication;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> Administrator</div><div class="line"> *         发送邮件验证发送人账号</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailAutherticator</span> <span class="keyword">extends</span> <span class="title">Authenticator</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String m_username = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> String m_userpass = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</div><div class="line">        m_username = username;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserpass</span><span class="params">(String userpass)</span> </span>&#123;</div><div class="line">        m_userpass = userpass;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmailAutherticator</span><span class="params">(String username, String userpass)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        setUsername(username);</div><div class="line">        setUserpass(userpass);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> PasswordAuthentication <span class="title">getPasswordAuthentication</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PasswordAuthentication(m_username, m_userpass);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>发邮件<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"><span class="keyword">import</span> javax.activation.DataHandler;</div><div class="line"><span class="keyword">import</span> javax.activation.FileDataSource;</div><div class="line"><span class="keyword">import</span> javax.mail.Authenticator;</div><div class="line"><span class="keyword">import</span> javax.mail.Multipart;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.InternetAddress;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeBodyPart;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeMultipart;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeUtility;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 利用java.mail的邮件发送程序</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendMail</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        String title = <span class="string">"公司信息"</span>; <span class="comment">// 发送邮件主题</span></div><div class="line">        <span class="comment">// String from = ""; // 发送人邮箱账号</span></div><div class="line">        String from = <span class="string">""</span>;</div><div class="line">        String sendTo[] = &#123;<span class="string">""</span>, <span class="string">""</span>&#125;; <span class="comment">// 收件人邮箱账号</span></div><div class="line"></div><div class="line">        <span class="comment">// 邮件的文本内容，可以包含html标记则显示为html页面</span></div><div class="line">        <span class="comment">// String content = "内容含有html变迁支持mail test!!!!!!&lt;br&gt;&lt;a href=#&gt;aaa&lt;/a&gt;";</span></div><div class="line">        String content = <span class="string">"gongsixinxi&lt;a href=\"#\"&gt;111&lt;/a&gt;"</span>;</div><div class="line">        <span class="comment">// 上传多个附件及修改附件名称</span></div><div class="line">        String fileNames[] = &#123;<span class="string">"F:\\javamail\\mailtmp\\attachment\\test\\test.txt,test.txt"</span>,</div><div class="line">                <span class="string">"F:\\javamail\\mailtmp\\attachment\\test.txt,哈哈.txt"</span>&#125;;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// MailSender mailsender = new MailSender(); // 封装为邮件对象存储本次邮件信息</span></div><div class="line">            sendmail(title, from, sendTo, content, fileNames, <span class="string">"text/html;charset=gb2312"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">            ex.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"static-access"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendmail</span><span class="params">(String subject, String from, String[] to, String text, String[] filenames,</span></span></div><div class="line">                                String mimeType) <span class="keyword">throws</span> Exception &#123;</div><div class="line">        <span class="comment">// ResourceBundle mailProps = ResourceBundle.getBundle("mail");</span></div><div class="line">        <span class="comment">// 可以从配置文件读取相应的参数</span></div><div class="line">        Properties props = <span class="keyword">new</span> Properties();</div><div class="line"></div><div class="line">        String smtp = <span class="string">"smtp.qq.com"</span>; <span class="comment">// 使用smtp协议传输，对应发送端的邮件服务器</span></div><div class="line">        String servername = <span class="string">""</span>; <span class="comment">// 发件人账号</span></div><div class="line">        String serverpaswd = <span class="string">""</span>; <span class="comment">// 发件人邮箱密码</span></div><div class="line"></div><div class="line">        javax.mail.Session mailSession; <span class="comment">// 邮件会话对象</span></div><div class="line">        javax.mail.internet.MimeMessage mimeMsg; <span class="comment">// MIME邮件对象</span></div><div class="line"></div><div class="line">        props = System.getProperties(); <span class="comment">// 获得系统属性对象</span></div><div class="line">        props.put(<span class="string">"mail.smtp.host"</span>, smtp); <span class="comment">// 设置SMTP主机</span></div><div class="line">        props.put(<span class="string">"mail.smtp.auth"</span>, <span class="string">"true"</span>); <span class="comment">// 设置为默认验证用户名和密码</span></div><div class="line"></div><div class="line">        <span class="comment">// 统一使用ssl协议端口, qq邮箱服务需要ssl协议认证，否侧返回530错误</span></div><div class="line">        <span class="keyword">final</span> String smtpPort = <span class="string">"465"</span>;</div><div class="line">        props.setProperty(<span class="string">"mail.smtp.port"</span>, smtpPort);</div><div class="line">        props.setProperty(<span class="string">"mail.smtp.socketFactory.class"</span>, <span class="string">"javax.net.ssl.SSLSocketFactory"</span>);</div><div class="line">        props.setProperty(<span class="string">"mail.smtp.socketFactory.fallback"</span>, <span class="string">"false"</span>);</div><div class="line">        props.setProperty(<span class="string">"mail.smtp.socketFactory.port"</span>, smtpPort);</div><div class="line"></div><div class="line">        <span class="comment">// 到服务器验证发送的用户名和密码是否正确</span></div><div class="line">        EmailAutherticator myEmailAuther = <span class="keyword">new</span> EmailAutherticator(servername, serverpaswd);</div><div class="line">        <span class="comment">// 设置邮件会话</span></div><div class="line">        mailSession = javax.mail.Session.getInstance(props, (Authenticator) myEmailAuther);</div><div class="line"></div><div class="line">        <span class="comment">// 设置debug打印信息</span></div><div class="line">        mailSession.setDebug(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 设置传输协议</span></div><div class="line">        javax.mail.Transport transport = mailSession.getTransport(<span class="string">"smtp"</span>);</div><div class="line">        <span class="comment">// 设置from、to等信息</span></div><div class="line">        mimeMsg = <span class="keyword">new</span> javax.mail.internet.MimeMessage(mailSession);</div><div class="line">        <span class="keyword">if</span> (!from.isEmpty()) &#123;</div><div class="line"></div><div class="line">            InternetAddress sentFrom = <span class="keyword">new</span> InternetAddress(from);</div><div class="line">            mimeMsg.setFrom(sentFrom); <span class="comment">// 设置发送人地址</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        InternetAddress[] sendTo = <span class="keyword">new</span> InternetAddress[to.length];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; to.length; i++) &#123;</div><div class="line">            System.out.println(<span class="string">"发送到:"</span> + to[i]);</div><div class="line">            sendTo[i] = <span class="keyword">new</span> InternetAddress(to[i]);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mimeMsg.setRecipients(javax.mail.internet.MimeMessage.RecipientType.TO, sendTo);</div><div class="line">        mimeMsg.setSubject(subject, <span class="string">"gb2312"</span>);</div><div class="line"></div><div class="line">        MimeBodyPart messageBodyPart1 = <span class="keyword">new</span> MimeBodyPart();</div><div class="line">        <span class="comment">// messageBodyPart.setText(UnicodeToChinese(text));</span></div><div class="line">        messageBodyPart1.setContent(text, mimeType);</div><div class="line"></div><div class="line">        Multipart multipart = <span class="keyword">new</span> MimeMultipart();<span class="comment">// 附件传输格式</span></div><div class="line">        multipart.addBodyPart(messageBodyPart1);</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; filenames.length; i++) &#123;</div><div class="line">            MimeBodyPart messageBodyPart2 = <span class="keyword">new</span> MimeBodyPart();</div><div class="line">            <span class="comment">// 选择出每一个附件名</span></div><div class="line">            String filename = filenames[i].split(<span class="string">","</span>)[<span class="number">0</span>];</div><div class="line">            System.out.println(<span class="string">"附件名："</span> + filename);</div><div class="line">            String displayname = filenames[i].split(<span class="string">","</span>)[<span class="number">1</span>];</div><div class="line">            <span class="comment">// 得到数据源</span></div><div class="line">            FileDataSource fds = <span class="keyword">new</span> FileDataSource(filename);</div><div class="line">            <span class="comment">// 得到附件本身并至入BodyPart</span></div><div class="line">            messageBodyPart2.setDataHandler(<span class="keyword">new</span> DataHandler(fds));</div><div class="line">            <span class="comment">// 得到文件名同样至入BodyPart</span></div><div class="line">            <span class="comment">// messageBodyPart2.setFileName(displayname);</span></div><div class="line">            <span class="comment">// messageBodyPart2.setFileName(fds.getName());</span></div><div class="line">            messageBodyPart2.setFileName(MimeUtility.encodeText(displayname));</div><div class="line">            multipart.addBodyPart(messageBodyPart2);</div><div class="line">        &#125;</div><div class="line">        mimeMsg.setContent(multipart);</div><div class="line">        <span class="comment">// 设置信件头的发送日期</span></div><div class="line">        mimeMsg.setSentDate(<span class="keyword">new</span> Date());</div><div class="line">        mimeMsg.saveChanges();</div><div class="line">        <span class="comment">// 发送邮件</span></div><div class="line">        transport.send(mimeMsg);</div><div class="line">        System.out.println(<span class="string">" 邮件发送成功.. "</span>);</div><div class="line">        transport.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用pop3解析邮件<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</div><div class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"><span class="keyword">import</span> javax.mail.Address;</div><div class="line"><span class="keyword">import</span> javax.mail.BodyPart;</div><div class="line"><span class="keyword">import</span> javax.mail.FetchProfile;</div><div class="line"><span class="keyword">import</span> javax.mail.Flags;</div><div class="line"><span class="keyword">import</span> javax.mail.Folder;</div><div class="line"><span class="keyword">import</span> javax.mail.Message;</div><div class="line"><span class="keyword">import</span> javax.mail.MessagingException;</div><div class="line"><span class="keyword">import</span> javax.mail.Multipart;</div><div class="line"><span class="keyword">import</span> javax.mail.Part;</div><div class="line"><span class="keyword">import</span> javax.mail.Session;</div><div class="line"><span class="keyword">import</span> javax.mail.Store;</div><div class="line"><span class="keyword">import</span> javax.mail.URLName;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.InternetAddress;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeMultipart;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeUtility;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 使用POP3协议接收邮件</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">POP3ReceiveMail</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        receive();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 接收邮件</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">// 准备连接服务器的会话信息</span></div><div class="line">        <span class="keyword">final</span> String SSL_FACTORY = <span class="string">"javax.net.ssl.SSLSocketFactory"</span>;</div><div class="line">        Properties props = <span class="keyword">new</span> Properties();</div><div class="line">        props.setProperty(<span class="string">"mail.pop3.host"</span>, <span class="string">"smtp.163.com"</span>);</div><div class="line">        props.setProperty(<span class="string">"mail.pop3.socketFactory.class"</span>, SSL_FACTORY);</div><div class="line">        props.setProperty(<span class="string">"mail.pop3.socketFactory.fallback"</span>, <span class="string">"false"</span>);</div><div class="line">        props.setProperty(<span class="string">"mail.pop3.port"</span>, <span class="string">"995"</span>);</div><div class="line">        props.setProperty(<span class="string">"mail.pop3.socketFactory.port"</span>, <span class="string">"995"</span>);</div><div class="line">        props.setProperty(<span class="string">"mail.pop3.auth"</span>, <span class="string">"true"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 建立会话</span></div><div class="line">        Session session = Session.getDefaultInstance(props, <span class="keyword">null</span>);</div><div class="line">        <span class="comment">// 设置连接邮件仓库的环境</span></div><div class="line">        URLName url = <span class="keyword">new</span> URLName(<span class="string">"pop3"</span>, <span class="string">"pop.163.com"</span>, <span class="number">995</span>, <span class="keyword">null</span>, <span class="string">""</span>, <span class="string">""</span>); <span class="comment">// 后两个参数发送账号和密码</span></div><div class="line">        Store store = <span class="keyword">null</span>;</div><div class="line">        Folder folder = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        <span class="comment">// 得到邮件仓库并连接</span></div><div class="line">        store = session.getStore(url);</div><div class="line">        store.connect();</div><div class="line"></div><div class="line">        <span class="comment">// 得到收件箱并抓取邮件</span></div><div class="line">        folder = store.getFolder(<span class="string">"INBOX"</span>);</div><div class="line">        <span class="comment">/*</span></div><div class="line">         * Folder.READ_ONLY：只读权限 Folder.READ_WRITE：可读可写（可以修改邮件的状态）</div><div class="line">		 */</div><div class="line">        folder.open(Folder.READ_ONLY);</div><div class="line"></div><div class="line">        FetchProfile profile = <span class="keyword">new</span> FetchProfile();</div><div class="line">        profile.add(FetchProfile.Item.ENVELOPE);</div><div class="line">        <span class="comment">// 获取收件箱邮件</span></div><div class="line">        Message[] messages = folder.getMessages();</div><div class="line">        folder.fetch(messages, profile);</div><div class="line">        <span class="comment">// 由于POP3协议无法获知邮件的状态,所以getUnreadMessageCount得到的是收件箱的邮件总数</span></div><div class="line">        System.out.println(<span class="string">"未读邮件数: "</span> + folder.getUnreadMessageCount());</div><div class="line"></div><div class="line">        <span class="comment">// 由于POP3协议无法获知邮件的状态,所以下面得到的结果始终都是为0</span></div><div class="line">        System.out.println(<span class="string">"删除邮件数: "</span> + folder.getDeletedMessageCount());</div><div class="line">        System.out.println(<span class="string">"新邮件: "</span> + folder.getNewMessageCount());</div><div class="line"></div><div class="line">        <span class="comment">// 获得收件箱中的邮件总数</span></div><div class="line">        System.out.println(<span class="string">"邮件总数: "</span> + folder.getMessageCount());</div><div class="line"></div><div class="line">        <span class="comment">// 解析获取到的邮件f</span></div><div class="line">        parseMessage(messages);</div><div class="line"></div><div class="line">        <span class="comment">// 释放资源</span></div><div class="line">        folder.close(<span class="keyword">true</span>);</div><div class="line">        store.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 解析邮件</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> messages 要解析的邮件列表</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseMessage</span><span class="params">(Message... messages)</span> <span class="keyword">throws</span> MessagingException, IOException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (messages == <span class="keyword">null</span> || messages.length &lt; <span class="number">1</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MessagingException(<span class="string">"未找到要解析的邮件!"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 解析所有邮件</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, count = messages.length; i &lt; count; i++) &#123;</div><div class="line">            MimeMessage msg = (MimeMessage) messages[i];</div><div class="line">            System.out.println(<span class="string">"------------------解析第"</span> + msg.getMessageNumber() + <span class="string">"封邮件-------------------- "</span>);</div><div class="line">            System.out.println(<span class="string">"主题: "</span> + getSubject(msg));</div><div class="line">            System.out.println(<span class="string">"发件人: "</span> + getFrom(msg));</div><div class="line">            System.out.println(<span class="string">"收件人："</span> + getReceiveAddress(msg, <span class="keyword">null</span>));</div><div class="line">            System.out.println(<span class="string">"发送时间："</span> + getSentDate(msg, <span class="keyword">null</span>));</div><div class="line">            System.out.println(<span class="string">"是否已读："</span> + isSeen(msg));</div><div class="line">            System.out.println(<span class="string">"邮件优先级："</span> + getPriority(msg));</div><div class="line">            System.out.println(<span class="string">"是否需要回执："</span> + isReplySign(msg));</div><div class="line">            System.out.println(<span class="string">"邮件大小："</span> + msg.getSize() * <span class="number">1024</span> + <span class="string">"kb"</span>);</div><div class="line">            <span class="keyword">boolean</span> isContainerAttachment = isContainAttachment(msg);</div><div class="line">            System.out.println(<span class="string">"是否包含附件："</span> + isContainerAttachment);</div><div class="line">            <span class="keyword">if</span> (isContainerAttachment) &#123;</div><div class="line">                saveAttachment(msg, <span class="string">"F:\\javamail\\mailtmp\\"</span> + msg.getSubject() + <span class="string">"_"</span>); <span class="comment">// 保存附件</span></div><div class="line">            &#125;</div><div class="line">            StringBuffer content = <span class="keyword">new</span> StringBuffer(<span class="number">30</span>);</div><div class="line">            getMailTextContent(msg, content);</div><div class="line">            System.out.println(<span class="string">"邮件正文："</span> + (content.length() &gt; <span class="number">100</span> ? content.substring(<span class="number">0</span>, <span class="number">100</span>) + <span class="string">"..."</span> : content));</div><div class="line">            System.out.println(<span class="string">"------------------第"</span> + msg.getMessageNumber() + <span class="string">"封邮件解析结束-------------------- "</span>);</div><div class="line">            System.out.println();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件主题</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> msg 邮件内容</div><div class="line">     * <span class="doctag">@return</span> 解码后的邮件主题</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSubject</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> UnsupportedEncodingException, MessagingException </span>&#123;</div><div class="line">        <span class="keyword">return</span> MimeUtility.decodeText(msg.getSubject());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件发件人</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> msg 邮件内容</div><div class="line">     * <span class="doctag">@return</span> 姓名 &lt;Email地址&gt;</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     * <span class="doctag">@throws</span> UnsupportedEncodingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFrom</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> MessagingException, UnsupportedEncodingException </span>&#123;</div><div class="line">        String from = <span class="string">""</span>;</div><div class="line">        Address[] froms = msg.getFrom();</div><div class="line">        <span class="keyword">if</span> (froms.length &lt; <span class="number">1</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MessagingException(<span class="string">"没有发件人!"</span>);</div><div class="line"></div><div class="line">        InternetAddress address = (InternetAddress) froms[<span class="number">0</span>];</div><div class="line">        String person = address.getPersonal();</div><div class="line">        <span class="keyword">if</span> (person != <span class="keyword">null</span>) &#123;</div><div class="line">            person = MimeUtility.decodeText(person) + <span class="string">" "</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            person = <span class="string">""</span>;</div><div class="line">        &#125;</div><div class="line">        from = person + <span class="string">"&lt;"</span> + address.getAddress() + <span class="string">"&gt;"</span>;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> from;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 根据收件人类型，获取邮件收件人、抄送和密送地址。如果收件人类型为空，则获得所有的收件人</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Message.RecipientType.TO 收件人</div><div class="line">     * &lt;/p&gt;</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Message.RecipientType.CC 抄送</div><div class="line">     * &lt;/p&gt;</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Message.RecipientType.BCC 密送</div><div class="line">     * &lt;/p&gt;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> msg  邮件内容</div><div class="line">     * <span class="doctag">@param</span> type 收件人类型</div><div class="line">     * <span class="doctag">@return</span> 收件人1 &lt;邮件地址1&gt;, 收件人2 &lt;邮件地址2&gt;, ...</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getReceiveAddress</span><span class="params">(MimeMessage msg, Message.RecipientType type)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">        StringBuffer receiveAddress = <span class="keyword">new</span> StringBuffer();</div><div class="line">        Address[] addresss = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (type == <span class="keyword">null</span>) &#123;</div><div class="line">            addresss = msg.getAllRecipients();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            addresss = msg.getRecipients(type);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (addresss == <span class="keyword">null</span> || addresss.length &lt; <span class="number">1</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MessagingException(<span class="string">"没有收件人!"</span>);</div><div class="line">        <span class="keyword">for</span> (Address address : addresss) &#123;</div><div class="line">            InternetAddress internetAddress = (InternetAddress) address;</div><div class="line">            receiveAddress.append(internetAddress.toUnicodeString()).append(<span class="string">","</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        receiveAddress.deleteCharAt(receiveAddress.length() - <span class="number">1</span>); <span class="comment">// 删除最后一个逗号</span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> receiveAddress.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件发送时间</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> msg 邮件内容</div><div class="line">     * <span class="doctag">@return</span> yyyy年mm月dd日 星期X HH:mm</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSentDate</span><span class="params">(MimeMessage msg, String pattern)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">        Date receivedDate = msg.getSentDate();</div><div class="line">        <span class="keyword">if</span> (receivedDate == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (pattern == <span class="keyword">null</span> || <span class="string">""</span>.equals(pattern))</div><div class="line">            pattern = <span class="string">"yyyy年MM月dd日 E HH:mm "</span>;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(pattern).format(receivedDate);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断邮件中是否包含附件</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> msg 邮件内容</div><div class="line">     * <span class="doctag">@return</span> 邮件中存在附件返回true，不存在返回false</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isContainAttachment</span><span class="params">(Part part)</span> <span class="keyword">throws</span> MessagingException, IOException </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">if</span> (part.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">            MimeMultipart multipart = (MimeMultipart) part.getContent();</div><div class="line">            <span class="keyword">int</span> partCount = multipart.getCount();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; partCount; i++) &#123;</div><div class="line">                BodyPart bodyPart = multipart.getBodyPart(i);</div><div class="line">                String disp = bodyPart.getDisposition();</div><div class="line">                <span class="keyword">if</span> (disp != <span class="keyword">null</span> &amp;&amp; (disp.equalsIgnoreCase(Part.ATTACHMENT) || disp.equalsIgnoreCase(Part.INLINE))) &#123;</div><div class="line">                    flag = <span class="keyword">true</span>;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bodyPart.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">                    flag = isContainAttachment(bodyPart);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    String contentType = bodyPart.getContentType();</div><div class="line">                    <span class="keyword">if</span> (contentType.indexOf(<span class="string">"application"</span>) != -<span class="number">1</span>) &#123;</div><div class="line">                        flag = <span class="keyword">true</span>;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (contentType.indexOf(<span class="string">"name"</span>) != -<span class="number">1</span>) &#123;</div><div class="line">                        flag = <span class="keyword">true</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (flag)</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.isMimeType(<span class="string">"message/rfc822"</span>)) &#123;</div><div class="line">            flag = isContainAttachment((Part) part.getContent());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> flag;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断邮件是否已读</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> msg 邮件内容</div><div class="line">     * <span class="doctag">@return</span> 如果邮件已读返回true, 否则返回false</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSeen</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">        <span class="keyword">return</span> msg.getFlags().contains(Flags.Flag.SEEN);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断邮件是否需要阅读回执</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> msg 邮件内容</div><div class="line">     * <span class="doctag">@return</span> 需要回执返回true, 否则返回false</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isReplySign</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> replySign = <span class="keyword">false</span>;</div><div class="line">        String[] headers = msg.getHeader(<span class="string">"Disposition-Notification-To"</span>);</div><div class="line">        <span class="keyword">if</span> (headers != <span class="keyword">null</span>)</div><div class="line">            replySign = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">return</span> replySign;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件的优先级</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> msg 邮件内容</div><div class="line">     * <span class="doctag">@return</span> 1(High):紧急 3:普通(Normal) 5:低(Low)</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPriority</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">        String priority = <span class="string">"普通"</span>;</div><div class="line">        String[] headers = msg.getHeader(<span class="string">"X-Priority"</span>);</div><div class="line">        <span class="keyword">if</span> (headers != <span class="keyword">null</span>) &#123;</div><div class="line">            String headerPriority = headers[<span class="number">0</span>];</div><div class="line">            <span class="keyword">if</span> (headerPriority.indexOf(<span class="string">"1"</span>) != -<span class="number">1</span> || headerPriority.indexOf(<span class="string">"High"</span>) != -<span class="number">1</span>)</div><div class="line">                priority = <span class="string">"紧急"</span>;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (headerPriority.indexOf(<span class="string">"5"</span>) != -<span class="number">1</span> || headerPriority.indexOf(<span class="string">"Low"</span>) != -<span class="number">1</span>)</div><div class="line">                priority = <span class="string">"低"</span>;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                priority = <span class="string">"普通"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> priority;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件文本内容</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> part    邮件体</div><div class="line">     * <span class="doctag">@param</span> content 存储邮件文本内容的字符串</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getMailTextContent</span><span class="params">(Part part, StringBuffer content)</span> <span class="keyword">throws</span> MessagingException, IOException </span>&#123;</div><div class="line">        <span class="comment">// 如果是文本类型的附件，通过getContent方法可以取到文本内容，但这不是我们需要的结果，所以在这里要做判断</span></div><div class="line">        <span class="keyword">boolean</span> isContainTextAttach = part.getContentType().indexOf(<span class="string">"name"</span>) &gt; <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (part.isMimeType(<span class="string">"text/*"</span>) &amp;&amp; !isContainTextAttach) &#123;</div><div class="line">            content.append(part.getContent().toString());</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.isMimeType(<span class="string">"message/rfc822"</span>)) &#123;</div><div class="line">            getMailTextContent((Part) part.getContent(), content);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">            Multipart multipart = (Multipart) part.getContent();</div><div class="line">            <span class="keyword">int</span> partCount = multipart.getCount();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; partCount; i++) &#123;</div><div class="line">                BodyPart bodyPart = multipart.getBodyPart(i);</div><div class="line">                getMailTextContent(bodyPart, content);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 保存附件</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> part    邮件中多个组合体中的其中一个组合体</div><div class="line">     * <span class="doctag">@param</span> destDir 附件保存目录</div><div class="line">     * <span class="doctag">@throws</span> UnsupportedEncodingException</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     * <span class="doctag">@throws</span> FileNotFoundException</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveAttachment</span><span class="params">(Part part, String destDir)</span></span></div><div class="line">            <span class="keyword">throws</span> UnsupportedEncodingException, MessagingException, FileNotFoundException, IOException &#123;</div><div class="line">        <span class="keyword">if</span> (part.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">            Multipart multipart = (Multipart) part.getContent(); <span class="comment">// 复杂体邮件</span></div><div class="line">            <span class="comment">// 复杂体邮件包含多个邮件体</span></div><div class="line">            <span class="keyword">int</span> partCount = multipart.getCount();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; partCount; i++) &#123;</div><div class="line">                <span class="comment">// 获得复杂体邮件中其中一个邮件体</span></div><div class="line">                BodyPart bodyPart = multipart.getBodyPart(i);</div><div class="line">                <span class="comment">// 某一个邮件体也有可能是由多个邮件体组成的复杂体</span></div><div class="line">                String disp = bodyPart.getDisposition();</div><div class="line">                <span class="keyword">if</span> (disp != <span class="keyword">null</span> &amp;&amp; (disp.equalsIgnoreCase(Part.ATTACHMENT) || disp.equalsIgnoreCase(Part.INLINE))) &#123;</div><div class="line">                    InputStream is = bodyPart.getInputStream();</div><div class="line">                    saveFile(is, destDir, decodeText(bodyPart.getFileName()));</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bodyPart.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">                    saveAttachment(bodyPart, destDir);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    String contentType = bodyPart.getContentType();</div><div class="line">                    <span class="keyword">if</span> (contentType.indexOf(<span class="string">"name"</span>) != -<span class="number">1</span> || contentType.indexOf(<span class="string">"application"</span>) != -<span class="number">1</span>) &#123;</div><div class="line">                        saveFile(bodyPart.getInputStream(), destDir, decodeText(bodyPart.getFileName()));</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.isMimeType(<span class="string">"message/rfc822"</span>)) &#123;</div><div class="line">            saveAttachment((Part) part.getContent(), destDir);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 读取输入流中的数据保存至指定目录</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> is       输入流</div><div class="line">     * <span class="doctag">@param</span> fileName 文件名</div><div class="line">     * <span class="doctag">@param</span> destDir  文件存储目录</div><div class="line">     * <span class="doctag">@throws</span> FileNotFoundException</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveFile</span><span class="params">(InputStream is, String destDir, String fileName)</span></span></div><div class="line">            <span class="keyword">throws</span> FileNotFoundException, IOException &#123;</div><div class="line">        BufferedInputStream bis = <span class="keyword">new</span> BufferedInputStream(is);</div><div class="line">        BufferedOutputStream bos = <span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(destDir + fileName)));</div><div class="line">        <span class="keyword">int</span> len = -<span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> ((len = bis.read()) != -<span class="number">1</span>) &#123;</div><div class="line">            bos.write(len);</div><div class="line">            bos.flush();</div><div class="line">        &#125;</div><div class="line">        bos.close();</div><div class="line">        bis.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 文本解码</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> encodeText 解码MimeUtility.encodeText(String text)方法编码后的文本</div><div class="line">     * <span class="doctag">@return</span> 解码后的文本</div><div class="line">     * <span class="doctag">@throws</span> UnsupportedEncodingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decodeText</span><span class="params">(String encodeText)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (encodeText == <span class="keyword">null</span> || <span class="string">""</span>.equals(encodeText)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> MimeUtility.decodeText(encodeText);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>IMAP协议读取收件箱邮件解析邮件，和POP3的区别是，IMAP解析邮件时就会标记为已读邮件，收件箱中的未读邮件的状态自动更新为已读，<br>而POP3只是单向输出邮件信息，并不向邮件服务器返回状态。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</div><div class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"><span class="keyword">import</span> javax.mail.Address;</div><div class="line"><span class="keyword">import</span> javax.mail.BodyPart;</div><div class="line"><span class="keyword">import</span> javax.mail.Flags;</div><div class="line"><span class="keyword">import</span> javax.mail.Folder;</div><div class="line"><span class="keyword">import</span> javax.mail.Message;</div><div class="line"><span class="keyword">import</span> javax.mail.MessagingException;</div><div class="line"><span class="keyword">import</span> javax.mail.Multipart;</div><div class="line"><span class="keyword">import</span> javax.mail.Part;</div><div class="line"><span class="keyword">import</span> javax.mail.Session;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.InternetAddress;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeMultipart;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeUtility;</div><div class="line"><span class="keyword">import</span> com.sun.mail.imap.IMAPFolder;</div><div class="line"><span class="keyword">import</span> com.sun.mail.imap.IMAPStore;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> IMAPReceiveMail</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> IMAP协议读取解析邮件</div><div class="line"> * <span class="doctag">@Date</span> 2017年4月10日 下午4:54:27</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IMAPReceiveMail</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String host;</div><div class="line">    <span class="keyword">private</span> String port;</div><div class="line">    <span class="keyword">private</span> String username;</div><div class="line">    <span class="keyword">private</span> String password;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IMAPReceiveMail</span><span class="params">(String host, String port, String username, String password)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.host = host;</div><div class="line">	<span class="keyword">this</span>.port = port;</div><div class="line">	<span class="keyword">this</span>.username = username;</div><div class="line">	<span class="keyword">this</span>.password = password;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	<span class="comment">// IMAPReceiveMail imapReceiveMail = new</span></div><div class="line">	<span class="comment">// IMAPReceiveMail("imap.sina.com", "143", "",</span></div><div class="line">	<span class="comment">// ""); // 账号和密码</span></div><div class="line">	IMAPReceiveMail imapReceiveMail = <span class="keyword">new</span> IMAPReceiveMail(<span class="string">"imap.163.com"</span>, <span class="string">"995"</span>, <span class="string">"userAccount"</span>, <span class="string">"passWord"</span>);</div><div class="line">	<span class="comment">// IMAPReceiveMail imapReceiveMail = new IMAPReceiveMail("imap.qq.com",</span></div><div class="line">	<span class="comment">// "995", "", "");</span></div><div class="line"></div><div class="line">	imapReceiveMail.receive();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 读取邮件</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	Properties prop = System.getProperties();</div><div class="line">	prop.put(<span class="string">"mail.store.protocol"</span>, <span class="string">"imap"</span>);</div><div class="line">	prop.put(<span class="string">"mail.imap.host"</span>, host);</div><div class="line"></div><div class="line">	prop.put(<span class="string">"mail.smtp.port"</span>, port);</div><div class="line">	prop.put(<span class="string">"mail.smtp.auth"</span>, <span class="string">"true"</span>);</div><div class="line"></div><div class="line">	Session session = Session.getInstance(prop);</div><div class="line"></div><div class="line">	<span class="keyword">int</span> total = <span class="number">0</span>;</div><div class="line">	IMAPStore store = (IMAPStore) session.getStore(<span class="string">"imap"</span>); <span class="comment">// 使用imap会话机制，连接服务器</span></div><div class="line">	store.connect(username, password);</div><div class="line">	<span class="comment">// 获取收件箱邮件</span></div><div class="line">	IMAPFolder folder = (IMAPFolder) store.getFolder(<span class="string">"INBOX"</span>);</div><div class="line">	folder.open(Folder.READ_WRITE);</div><div class="line">	<span class="comment">// 获取总邮件数</span></div><div class="line">	total = folder.getMessageCount();</div><div class="line">	System.out.println(<span class="string">"-----------------共有邮件："</span> + total + <span class="string">" 封--------------"</span>);</div><div class="line">	<span class="comment">// 获取收件箱邮件</span></div><div class="line">	Message[] messages = folder.getMessages();</div><div class="line">	<span class="comment">// 解析获取到的邮件</span></div><div class="line">	<span class="keyword">int</span> unReadCount = getUnReadCount(messages);</div><div class="line">	System.out.println(unReadCount);</div><div class="line">	<span class="comment">// parseMessage(messages);</span></div><div class="line">	<span class="comment">// 释放资源</span></div><div class="line">	folder.close(<span class="keyword">true</span>);</div><div class="line">	store.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 解析邮件</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> messages</div><div class="line">     *            要解析的邮件列表</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseMessage</span><span class="params">(Message... messages)</span> <span class="keyword">throws</span> MessagingException, IOException </span>&#123;</div><div class="line">	<span class="keyword">if</span> (messages == <span class="keyword">null</span> || messages.length &lt; <span class="number">1</span>)</div><div class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> MessagingException(<span class="string">"未找到要解析的邮件!"</span>);</div><div class="line">	<span class="comment">// 解析所有邮件</span></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, count = messages.length; i &lt; count; i++) &#123;</div><div class="line">	    MimeMessage msg = (MimeMessage) messages[i];</div><div class="line">	    System.out.println(<span class="string">"------------------解析第"</span> + msg.getMessageNumber() + <span class="string">"封邮件-------------------- "</span>);</div><div class="line">	    System.out.println(<span class="string">"主题: "</span> + getSubject(msg));</div><div class="line">	    System.out.println(<span class="string">"发件人: "</span> + getFrom(msg));</div><div class="line">	    System.out.println(<span class="string">"收件人："</span> + getReceiveAddress(msg, <span class="keyword">null</span>));</div><div class="line">	    System.out.println(<span class="string">"发送时间："</span> + getSentDate(msg, <span class="keyword">null</span>));</div><div class="line">	    System.out.println(<span class="string">"是否已读："</span> + isSeen(msg));</div><div class="line">	    System.out.println(<span class="string">"邮件优先级："</span> + getPriority(msg));</div><div class="line">	    System.out.println(<span class="string">"是否需要回执："</span> + isReplySign(msg));</div><div class="line">	    System.out.println(<span class="string">"邮件大小："</span> + msg.getSize() * <span class="number">1024</span> + <span class="string">"kb"</span>);</div><div class="line">	    <span class="keyword">boolean</span> isContainerAttachment = isContainAttachment(msg);</div><div class="line">	    System.out.println(<span class="string">"是否包含附件："</span> + isContainerAttachment);</div><div class="line">	    <span class="keyword">if</span> (isContainerAttachment) &#123;</div><div class="line">		saveAttachment(msg, <span class="string">"F:\\javamail\\mailtmp\\"</span> + msg.getSubject() + <span class="string">"_"</span>); <span class="comment">// 保存附件</span></div><div class="line">	    &#125;</div><div class="line">	    StringBuffer content = <span class="keyword">new</span> StringBuffer(<span class="number">30</span>);</div><div class="line">	    getMailTextContent(msg, content);</div><div class="line">	    System.out.println(<span class="string">"邮件正文："</span> + (content.length() &gt; <span class="number">100</span> ? content.substring(<span class="number">0</span>, <span class="number">100</span>) + <span class="string">"..."</span> : content));</div><div class="line">	    System.out.println(<span class="string">"------------------第"</span> + msg.getMessageNumber() + <span class="string">"封邮件解析结束-------------------- "</span>);</div><div class="line">	    System.out.println();</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件主题</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> msg</div><div class="line">     *            邮件内容</div><div class="line">     * <span class="doctag">@return</span> 解码后的邮件主题</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSubject</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> UnsupportedEncodingException, MessagingException </span>&#123;</div><div class="line">	<span class="keyword">return</span> MimeUtility.decodeText(msg.getSubject());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件发件人</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> msg</div><div class="line">     *            邮件内容</div><div class="line">     * <span class="doctag">@return</span> 姓名 &lt;Email地址&gt;</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     * <span class="doctag">@throws</span> UnsupportedEncodingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFrom</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> MessagingException, UnsupportedEncodingException </span>&#123;</div><div class="line">	String from = <span class="string">""</span>;</div><div class="line">	Address[] froms = msg.getFrom();</div><div class="line">	<span class="keyword">if</span> (froms.length &lt; <span class="number">1</span>)</div><div class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> MessagingException(<span class="string">"没有发件人!"</span>);</div><div class="line"></div><div class="line">	InternetAddress address = (InternetAddress) froms[<span class="number">0</span>];</div><div class="line">	String person = address.getPersonal();</div><div class="line">	<span class="keyword">if</span> (person != <span class="keyword">null</span>) &#123;</div><div class="line">	    person = MimeUtility.decodeText(person) + <span class="string">" "</span>;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">	    person = <span class="string">""</span>;</div><div class="line">	&#125;</div><div class="line">	from = person + <span class="string">"&lt;"</span> + address.getAddress() + <span class="string">"&gt;"</span>;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> from;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 根据收件人类型，获取邮件收件人、抄送和密送地址。如果收件人类型为空，则获得所有的收件人</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Message.RecipientType.TO 收件人</div><div class="line">     * &lt;/p&gt;</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Message.RecipientType.CC 抄送</div><div class="line">     * &lt;/p&gt;</div><div class="line">     * &lt;p&gt;</div><div class="line">     * Message.RecipientType.BCC 密送</div><div class="line">     * &lt;/p&gt;</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> msg</div><div class="line">     *            邮件内容</div><div class="line">     * <span class="doctag">@param</span> type</div><div class="line">     *            收件人类型</div><div class="line">     * <span class="doctag">@return</span> 收件人1 &lt;邮件地址1&gt;, 收件人2 &lt;邮件地址2&gt;, ...</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getReceiveAddress</span><span class="params">(MimeMessage msg, Message.RecipientType type)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">	StringBuffer receiveAddress = <span class="keyword">new</span> StringBuffer();</div><div class="line">	Address[] addresss = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">if</span> (type == <span class="keyword">null</span>) &#123;</div><div class="line">	    addresss = msg.getAllRecipients();</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">	    addresss = msg.getRecipients(type);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (addresss == <span class="keyword">null</span> || addresss.length &lt; <span class="number">1</span>)</div><div class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> MessagingException(<span class="string">"没有收件人!"</span>);</div><div class="line">	<span class="keyword">for</span> (Address address : addresss) &#123;</div><div class="line">	    InternetAddress internetAddress = (InternetAddress) address;</div><div class="line">	    receiveAddress.append(internetAddress.toUnicodeString()).append(<span class="string">","</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	receiveAddress.deleteCharAt(receiveAddress.length() - <span class="number">1</span>); <span class="comment">// 删除最后一个逗号</span></div><div class="line"></div><div class="line">	<span class="keyword">return</span> receiveAddress.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件发送时间</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> msg</div><div class="line">     *            邮件内容</div><div class="line">     * <span class="doctag">@return</span> yyyy年mm月dd日 星期X HH:mm</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSentDate</span><span class="params">(MimeMessage msg, String pattern)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">	Date receivedDate = msg.getSentDate();</div><div class="line">	<span class="keyword">if</span> (receivedDate == <span class="keyword">null</span>)</div><div class="line">	    <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (pattern == <span class="keyword">null</span> || <span class="string">""</span>.equals(pattern))</div><div class="line">	    pattern = <span class="string">"yyyy年MM月dd日 E HH:mm "</span>;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(pattern).format(receivedDate);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断邮件中是否包含附件</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> msg</div><div class="line">     *            邮件内容</div><div class="line">     * <span class="doctag">@return</span> 邮件中存在附件返回true，不存在返回false</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isContainAttachment</span><span class="params">(Part part)</span> <span class="keyword">throws</span> MessagingException, IOException </span>&#123;</div><div class="line">	<span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</div><div class="line">	<span class="keyword">if</span> (part.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">	    MimeMultipart multipart = (MimeMultipart) part.getContent();</div><div class="line">	    <span class="keyword">int</span> partCount = multipart.getCount();</div><div class="line">	    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; partCount; i++) &#123;</div><div class="line">		BodyPart bodyPart = multipart.getBodyPart(i);</div><div class="line">		String disp = bodyPart.getDisposition();</div><div class="line">		<span class="keyword">if</span> (disp != <span class="keyword">null</span> &amp;&amp; (disp.equalsIgnoreCase(Part.ATTACHMENT) || disp.equalsIgnoreCase(Part.INLINE))) &#123;</div><div class="line">		    flag = <span class="keyword">true</span>;</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (bodyPart.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">		    flag = isContainAttachment(bodyPart);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">		    String contentType = bodyPart.getContentType();</div><div class="line">		    <span class="keyword">if</span> (contentType.indexOf(<span class="string">"application"</span>) != -<span class="number">1</span>) &#123;</div><div class="line">			flag = <span class="keyword">true</span>;</div><div class="line">		    &#125;</div><div class="line"></div><div class="line">		    <span class="keyword">if</span> (contentType.indexOf(<span class="string">"name"</span>) != -<span class="number">1</span>) &#123;</div><div class="line">			flag = <span class="keyword">true</span>;</div><div class="line">		    &#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (flag)</div><div class="line">		    <span class="keyword">break</span>;</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.isMimeType(<span class="string">"message/rfc822"</span>)) &#123;</div><div class="line">	    flag = isContainAttachment((Part) part.getContent());</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> flag;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断邮件是否已读</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> msg</div><div class="line">     *            邮件内容</div><div class="line">     * <span class="doctag">@return</span> 如果邮件已读返回true,否则返回false</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSeen</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">	<span class="keyword">return</span> msg.getFlags().contains(Flags.Flag.SEEN);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断邮件是否需要阅读回执</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> msg</div><div class="line">     *            邮件内容</div><div class="line">     * <span class="doctag">@return</span> 需要回执返回true,否则返回false</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isReplySign</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">	<span class="keyword">boolean</span> replySign = <span class="keyword">false</span>;</div><div class="line">	String[] headers = msg.getHeader(<span class="string">"Disposition-Notification-To"</span>);</div><div class="line">	<span class="keyword">if</span> (headers != <span class="keyword">null</span>)</div><div class="line">	    replySign = <span class="keyword">true</span>;</div><div class="line">	<span class="keyword">return</span> replySign;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件的优先级</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> msg</div><div class="line">     *            邮件内容</div><div class="line">     * <span class="doctag">@return</span> 1(High):紧急 3:普通(Normal) 5:低(Low)</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPriority</span><span class="params">(MimeMessage msg)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</div><div class="line">	String priority = <span class="string">"普通"</span>;</div><div class="line">	String[] headers = msg.getHeader(<span class="string">"X-Priority"</span>);</div><div class="line">	<span class="keyword">if</span> (headers != <span class="keyword">null</span>) &#123;</div><div class="line">	    String headerPriority = headers[<span class="number">0</span>];</div><div class="line">	    <span class="keyword">if</span> (headerPriority.indexOf(<span class="string">"1"</span>) != -<span class="number">1</span> || headerPriority.indexOf(<span class="string">"High"</span>) != -<span class="number">1</span>)</div><div class="line">		priority = <span class="string">"紧急"</span>;</div><div class="line">	    <span class="keyword">else</span> <span class="keyword">if</span> (headerPriority.indexOf(<span class="string">"5"</span>) != -<span class="number">1</span> || headerPriority.indexOf(<span class="string">"Low"</span>) != -<span class="number">1</span>)</div><div class="line">		priority = <span class="string">"低"</span>;</div><div class="line">	    <span class="keyword">else</span></div><div class="line">		priority = <span class="string">"普通"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> priority;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获得邮件文本内容</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> part</div><div class="line">     *            邮件体</div><div class="line">     * <span class="doctag">@param</span> content</div><div class="line">     *            存储邮件文本内容的字符串</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getMailTextContent</span><span class="params">(Part part, StringBuffer content)</span> <span class="keyword">throws</span> MessagingException, IOException </span>&#123;</div><div class="line">	<span class="comment">// 如果是文本类型的附件，通过getContent方法可以取到文本内容，但这不是我们需要的结果，所以在这里要做判断</span></div><div class="line">	<span class="keyword">boolean</span> isContainTextAttach = part.getContentType().indexOf(<span class="string">"name"</span>) &gt; <span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span> (part.isMimeType(<span class="string">"text/*"</span>) &amp;&amp; !isContainTextAttach) &#123;</div><div class="line">	    content.append(part.getContent().toString());</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.isMimeType(<span class="string">"message/rfc822"</span>)) &#123;</div><div class="line">	    getMailTextContent((Part) part.getContent(), content);</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">	    Multipart multipart = (Multipart) part.getContent();</div><div class="line">	    <span class="keyword">int</span> partCount = multipart.getCount();</div><div class="line">	    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; partCount; i++) &#123;</div><div class="line">		BodyPart bodyPart = multipart.getBodyPart(i);</div><div class="line">		getMailTextContent(bodyPart, content);</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 保存附件</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> part</div><div class="line">     *            邮件中多个组合体中的其中一个组合体</div><div class="line">     * <span class="doctag">@param</span> destDir</div><div class="line">     *            附件保存目录</div><div class="line">     * <span class="doctag">@throws</span> UnsupportedEncodingException</div><div class="line">     * <span class="doctag">@throws</span> MessagingException</div><div class="line">     * <span class="doctag">@throws</span> FileNotFoundException</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveAttachment</span><span class="params">(Part part, String destDir)</span> <span class="keyword">throws</span> UnsupportedEncodingException, MessagingException, FileNotFoundException, IOException </span>&#123;</div><div class="line">	<span class="keyword">if</span> (part.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">	    Multipart multipart = (Multipart) part.getContent(); <span class="comment">// 复杂体邮件</span></div><div class="line">	    <span class="comment">// 复杂体邮件包含多个邮件体</span></div><div class="line">	    <span class="keyword">int</span> partCount = multipart.getCount();</div><div class="line">	    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; partCount; i++) &#123;</div><div class="line">		<span class="comment">// 获得复杂体邮件中其中一个邮件体</span></div><div class="line">		BodyPart bodyPart = multipart.getBodyPart(i);</div><div class="line">		<span class="comment">// 某一个邮件体也有可能是由多个邮件体组成的复杂体</span></div><div class="line">		String disp = bodyPart.getDisposition();</div><div class="line">		<span class="keyword">if</span> (disp != <span class="keyword">null</span> &amp;&amp; (disp.equalsIgnoreCase(Part.ATTACHMENT) || disp.equalsIgnoreCase(Part.INLINE))) &#123;</div><div class="line">		    InputStream is = bodyPart.getInputStream();</div><div class="line">		    saveFile(is, destDir, decodeText(bodyPart.getFileName()));</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (bodyPart.isMimeType(<span class="string">"multipart/*"</span>)) &#123;</div><div class="line">		    saveAttachment(bodyPart, destDir);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">		    String contentType = bodyPart.getContentType();</div><div class="line">		    <span class="keyword">if</span> (contentType.indexOf(<span class="string">"name"</span>) != -<span class="number">1</span> || contentType.indexOf(<span class="string">"application"</span>) != -<span class="number">1</span>) &#123;</div><div class="line">			saveFile(bodyPart.getInputStream(), destDir, decodeText(bodyPart.getFileName()));</div><div class="line">		    &#125;</div><div class="line">		&#125;</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.isMimeType(<span class="string">"message/rfc822"</span>)) &#123;</div><div class="line">	    saveAttachment((Part) part.getContent(), destDir);</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 读取输入流中的数据保存至指定目录</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> is</div><div class="line">     *            输入流</div><div class="line">     * <span class="doctag">@param</span> fileName</div><div class="line">     *            文件名</div><div class="line">     * <span class="doctag">@param</span> destDir</div><div class="line">     *            文件存储目录</div><div class="line">     * <span class="doctag">@throws</span> FileNotFoundException</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveFile</span><span class="params">(InputStream is, String destDir, String fileName)</span> <span class="keyword">throws</span> FileNotFoundException, IOException </span>&#123;</div><div class="line">	BufferedInputStream bis = <span class="keyword">new</span> BufferedInputStream(is);</div><div class="line">	BufferedOutputStream bos = <span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(destDir + fileName)));</div><div class="line">	<span class="keyword">int</span> len = -<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> ((len = bis.read()) != -<span class="number">1</span>) &#123;</div><div class="line">	    bos.write(len);</div><div class="line">	    bos.flush();</div><div class="line">	&#125;</div><div class="line">	bos.close();</div><div class="line">	bis.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 文本解码</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> encodeText</div><div class="line">     *            解码MimeUtility.encodeText(String text)方法编码后的文本</div><div class="line">     * <span class="doctag">@return</span> 解码后的文本</div><div class="line">     * <span class="doctag">@throws</span> UnsupportedEncodingException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decodeText</span><span class="params">(String encodeText)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</div><div class="line">	<span class="keyword">if</span> (encodeText == <span class="keyword">null</span> || <span class="string">""</span>.equals(encodeText)) &#123;</div><div class="line">	    <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">	    <span class="keyword">return</span> MimeUtility.decodeText(encodeText);</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@throws</span> MessagingException </div><div class="line">     * <span class="doctag">@MethodName</span> getUnreadCount </div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 获取未读邮件</div><div class="line">     * <span class="doctag">@Date</span> 2017年4月11日 下午2:20:53</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUnReadCount</span><span class="params">(Message... messages)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (Message messge : messages) &#123;</div><div class="line">	    MimeMessage mineMessage = (MimeMessage) messge;</div><div class="line">	    <span class="keyword">if</span> (!(isSeen(mineMessage))) &#123;</div><div class="line">		count++;</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> count;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>操作收发邮件返回码提示参考：<br><a href="https://my.oschina.net/darkspell/blog/12511" target="_blank" rel="external">https://my.oschina.net/darkspell/blog/12511</a><br>具体返回码信息需要查看各邮件服务器返回码提示。</p>
<h3 id="2-遇到的错误"><a href="#2-遇到的错误" class="headerlink" title="2 遇到的错误"></a>2 遇到的错误</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">535 Error: ÇëÊ¹ÓÃÊÚÈ¨ÂëµÇÂ¼¡£ÏêÇéÇë¿´: http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256</div></pre></td></tr></table></figure>
<p>qq邮箱服务未开启smtp/pop,获取授权码错误</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[js中逻辑或用法]]></title>
      <url>https://volc1605.github.io/2017/03/29/js%E4%B8%AD%E9%80%BB%E8%BE%91%E6%88%96%E7%94%A8%E6%B3%95/</url>
      <content type="html"><![CDATA[<h3 id="1-js中-的用法"><a href="#1-js中-的用法" class="headerlink" title="1 js中||的用法"></a>1 js中||的用法</h3><a id="more"></a>
<p>js中||运算符的含义：<br>例如a || b<br>系统先判断A表达式的布尔值，是真是假。如果为真，直接返回a对象。如果为假，直接返回b对象(并不只是b的值，还有类型)。<br>所以，var a = a || {}这行代码中如果a为false则直接返回null对象{}赋值给a。<br>这样写，虽然看着比较复杂点，但是效率高，特别是判断一些变量，属性或者是传参是否存在，如果存在就直接用，不存在，就赋予一个空变量。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        test(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a</span>) </span>&#123; <span class="comment">// 如果a为1，a的类型b值为number，如果a为0，a的类型b值为object</span></div><div class="line">        a = a || &#123;&#125;; <span class="comment">// 如果a为</span></div><div class="line">        <span class="keyword">var</span> b = <span class="keyword">typeof</span> a;</div><div class="line">        alert(b);</div><div class="line">        <span class="keyword">if</span> (a === <span class="string">'1'</span>) &#123;</div><div class="line">            alert(a);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&lt;<span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure></p>
<p>作者：李文龙<br>链接：<a href="https://www.zhihu.com/question/22914542/answer/23070403" target="_blank" rel="external">https://www.zhihu.com/question/22914542/answer/23070403</a><br>来源：知乎<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用idea开发工具同步本地代码到github远程仓库]]></title>
      <url>https://volc1605.github.io/2017/03/28/%E5%90%8C%E6%AD%A5github/</url>
      <content type="html"><![CDATA[<p><img src="http://p1.pstatp.com/large/19420003a59e4ef41c50" alt="taiji"><br><a id="more"></a></p>
<h3 id="1-使用idea开发工具同步本地代码到github远程仓库"><a href="#1-使用idea开发工具同步本地代码到github远程仓库" class="headerlink" title="1 使用idea开发工具同步本地代码到github远程仓库"></a>1 使用idea开发工具同步本地代码到github远程仓库</h3><p>git clone<br>git fetch # 抓取远程仓库中更新的数据<br>git merge # 合并将本地更改与其他的更改。通常，合并远程更新的数据和本地修改的数据<br>git pull</p>
<h4 id="1-1-本地配置远程提交仓库"><a href="#1-1-本地配置远程提交仓库" class="headerlink" title="1.1 本地配置远程提交仓库"></a>1.1 本地配置远程提交仓库</h4><h5 id="1）idea关联-初始化-本地仓库"><a href="#1）idea关联-初始化-本地仓库" class="headerlink" title="1）idea关联(初始化)本地仓库"></a>1）idea关联(初始化)本地仓库</h5><p>本地git仓库地址E:\projectidea\springwind(也就是idea中项目所在地址)。</p>
<h5 id="2）本地提交"><a href="#2）本地提交" class="headerlink" title="2）本地提交"></a>2）本地提交</h5><p>选择项目中的src和pom右击git，先add提交的内容，再点击commit directories，最后只选择commit提交。</p>
<h5 id="3）关联远程仓库"><a href="#3）关联远程仓库" class="headerlink" title="3）关联远程仓库"></a>3）关联远程仓库</h5><p>在远程创建没有README.md的仓库，如果创建含有文件的远程仓库，在本地关联时会遇到问题，下面介绍了解决的方法。<br>这里为了方便在远程创建了空的仓库，github上的项目仓库url: <a href="https://github.com/volc1605/springwindide.git" target="_blank" rel="external">https://github.com/volc1605/springwindide.git</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"># 进入本地项目目录，在第1步idea已经关联了这个目录</div><div class="line">PS E:\&gt; cd .\projectidea</div><div class="line">PS E:\projectidea&gt; cd .\springwind</div><div class="line"># 关联远程仓库地址</div><div class="line">PS E:\projectidea\springwind&gt; git remote add origin https://github.com/volc1605/springwindide.git</div><div class="line"># 下面一行命令意思是本地的master分支推送到origin主机，同时指定origin为默认主机，后面就可以不加任何参数使用git push了</div><div class="line">PS E:\projectidea\springwind&gt; git push -u origin master</div><div class="line">To https://github.com/volc1605/springwindide.git</div><div class="line"> ! [rejected]        master -&gt; master (fetch first)</div><div class="line">error: failed to push some refs to &apos;https://github.com/volc1605/springwindide.git&apos;</div><div class="line">hint: Updates were rejected because the remote contains work that you do</div><div class="line">hint: not have locally. This is usually caused by another repository pushing</div><div class="line">hint: to the same ref. You may want to first integrate the remote changes</div><div class="line">hint: (e.g., &apos;git pull ...&apos;) before pushing again.</div><div class="line">hint: See the &apos;Note about fast-forwards&apos; in &apos;git push --help&apos; for details.</div><div class="line">PS E:\projectidea\springwind&gt; git pull --rebase origin master</div><div class="line">remote: Counting objects: 5, done.</div><div class="line">remote: Compressing objects: 100% (3/3), done.</div><div class="line">remote: Total 5 (delta 0), reused 3 (delta 0), pack-reused 0</div><div class="line">warning: no common commits</div><div class="line">Unpacking objects: 100% (5/5), done.</div><div class="line">From https://github.com/volc1605/springwindide</div><div class="line"> * branch            master     -&gt; FETCH_HEAD</div><div class="line"> * [new branch]      master     -&gt; origin/master</div><div class="line">First, rewinding head to replay your work on top of it...</div><div class="line">Applying: giiigiigi  # 第2步本地提交的注释信息</div><div class="line">PS E:\projectidea\springwind&gt;</div></pre></td></tr></table></figure>
<p>这时恭喜你！本地项目已和github远程同步成功。</p>
<h4 id="1-2-遇到的问题"><a href="#1-2-遇到的问题" class="headerlink" title="1.2 遇到的问题"></a>1.2 遇到的问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">********************远程仓库无文件时***************</div><div class="line">PS E:\test&gt; git remote add origin https://github.com/volc1605/test.git</div><div class="line">PS E:\test&gt; git push -u origin master</div><div class="line">error: src refspec master does not match any.</div><div class="line">error: failed to push some refs to &apos;https://github.com/volc1605/test.git&apos;</div><div class="line"># 产生的原因是本地没有文件提交</div><div class="line"># 解决方法：</div><div class="line"># 在本地仓库随意新建一个文件，linux下执行**touch README**命令即可</div><div class="line">PS E:\test&gt; git add --all</div><div class="line">PS E:\test&gt; git commit -m &apos;first commit&apos;</div><div class="line">[master (root-commit) 4fae4c6] first commit</div><div class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 &quot;\346\226\260\345\273\272\346\226\207\346\234\254\346\226\207\346\241\243.txt&quot;</div><div class="line">PS E:\test&gt; git push origin master</div><div class="line">Counting objects: 3, done.</div><div class="line">Delta compression using up to 4 threads.</div><div class="line">Compressing objects: 100% (2/2), done.</div><div class="line">Writing objects: 100% (3/3), 218 bytes | 0 bytes/s, done.</div><div class="line">Total 3 (delta 0), reused 0 (delta 0)</div><div class="line">To https://github.com/volc1605/test.git</div><div class="line"> * [new branch]      master -&gt; master</div><div class="line">PS E:\test&gt;</div><div class="line"></div><div class="line">********************远程仓库有文件时***************</div><div class="line">PS E:\test&gt; cd ../test1</div><div class="line">PS E:\test1&gt; git remote add origin https://github.com/volc1605/test.git</div><div class="line">PS E:\test1&gt; git push origin master</div><div class="line">error: src refspec master does not match any.</div><div class="line">error: failed to push some refs to &apos;https://github.com/volc1605/test.git&apos;</div><div class="line">PS E:\test1&gt; git push origin master</div><div class="line">error: src refspec master does not match any.</div><div class="line">error: failed to push some refs to &apos;https://github.com/volc1605/test.git&apos;</div><div class="line">PS E:\test1&gt; git add --all</div><div class="line">PS E:\test1&gt; git commit -m &apos;test&apos;</div><div class="line">[master (root-commit) a52ce82] test</div><div class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 ee.txt</div><div class="line">PS E:\test1&gt; git push origin master</div><div class="line">To https://github.com/volc1605/test.git</div><div class="line"> ! [rejected]        master -&gt; master (fetch first)</div><div class="line">error: failed to push some refs to &apos;https://github.com/volc1605/test.git&apos;</div><div class="line">hint: Updates were rejected because the remote contains work that you do</div><div class="line">hint: not have locally. This is usually caused by another repository pushing</div><div class="line">hint: to the same ref. You may want to first integrate the remote changes</div><div class="line">hint: (e.g., &apos;git pull ...&apos;) before pushing again.</div><div class="line">hint: See the &apos;Note about fast-forwards&apos; in &apos;git push --help&apos; for details.</div><div class="line"># 产生的原因是本地和远程不同步，无法建立连接，提交拒绝</div><div class="line"># 解决方法是先同步远程代码，再提交</div><div class="line">PS E:\test1&gt; git pull --rebase origin master</div><div class="line">remote: Counting objects: 5, done.</div><div class="line">remote: Compressing objects: 100% (4/4), done.</div><div class="line">remote: Total 5 (delta 0), reused 5 (delta 0), pack-reused 0</div><div class="line">warning: no common commits</div><div class="line">Unpacking objects: 100% (5/5), done.</div><div class="line">From https://github.com/volc1605/test</div><div class="line"> * branch            master     -&gt; FETCH_HEAD</div><div class="line"> * [new branch]      master     -&gt; origin/master</div><div class="line">First, rewinding head to replay your work on top of it...</div><div class="line">Applying: test</div><div class="line"># 这时远程的代码已经同步到本地了，刚才本地修改的代码已经commit，这时再push到远程就没有问题了。</div><div class="line">PS E:\test1&gt; git push origin master</div><div class="line">Counting objects: 2, done.</div><div class="line">Delta compression using up to 4 threads.</div><div class="line">Compressing objects: 100% (2/2), done.</div><div class="line">Writing objects: 100% (2/2), 215 bytes | 0 bytes/s, done.</div><div class="line">Total 2 (delta 1), reused 0 (delta 0)</div><div class="line">remote: Resolving deltas: 100% (1/1), completed with 1 local objects.</div><div class="line">To https://github.com/volc1605/test.git</div><div class="line">   534a267..f6fed00  master -&gt; master</div><div class="line">PS E:\test1&gt;</div></pre></td></tr></table></figure>
<h3 id="2-简单方法同步"><a href="#2-简单方法同步" class="headerlink" title="2 简单方法同步"></a>2 简单方法同步</h3><p>intelij中 VCS-&gt;Checkout from Version Contrl—&gt;Git中粘贴远程仓库url地址<br>本地修改代码后提交到远程仓库会提示输入github的账号密码。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[盐值加密]]></title>
      <url>https://volc1605.github.io/2017/03/26/%E7%9B%90%E5%80%BC%E5%8A%A0%E5%AF%86/</url>
      <content type="html"><![CDATA[<h3 id="1-盐值加密"><a href="#1-盐值加密" class="headerlink" title="1 盐值加密"></a>1 盐值加密</h3><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!-- https://mvnrepository.com/artifact/com.baomidou/kisso --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;kisso&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;3.6.11&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/* </span></div><div class="line"> * 注册</div><div class="line"> * 演示不验证表单，用户名作为密码盐值 </div><div class="line"> * md5SaltEncode用账号和密码生成salt值，再使用salt值和密码作为加密字符串进行散列得到hash值</div><div class="line"> */</div><div class="line">user.setPassword(SaltEncoder.md5SaltEncode(user.getLoginName(), user.getPassword())); <span class="comment">// 生成固定的密文密码</span></div><div class="line"><span class="comment">/* </span></div><div class="line"> * 登录</div><div class="line"> * 生成的hash值和数据库中的用户密码(hash)值进行比较</div><div class="line"> * 校验用户名登录密码是否正确。登录名 提交的密码 数据库中的密码</div><div class="line"> * 返回true或false</div><div class="line"> */</div><div class="line">SaltEncoder.md5SaltValid(loginName, user.getPassword(), password);</div></pre></td></tr></table></figure>
<p>以上是使用SaltEncoder类自动生成salt值加密(SaltEncoder中的加密策略)。当然也可以使用固定的salt值，自定义加密策略。</p>
<h3 id="2-盐值加密2"><a href="#2-盐值加密2" class="headerlink" title="2 盐值加密2"></a>2 盐值加密2</h3><blockquote>
<p>hex也称为base16，意思是使用16个可见字符来表示一个二进制数组，编码后数据大小将翻倍,因为1个字符需要用2个可见字符来表示。<br>base32，意思是使用32个可见字符来表示一个二进制数组，编码后数据大小变成原来的8/5,也即5个字符用8个可见字符表示，但是最后如果不足8个字符，将用=来补充。<br>base64，意思是使用64个可见字符来表示一个二进制数组，编码后数据大小变成原来的4/3,也即3个字符用4个可见字符来表示。</p>
</blockquote>
<p>摘要算法（哈希）</p>
<p>摘要的目的是为了校验信息的完整性，保证信息在传输过程中不被篡改。例如你在网络上需要下载一个非官方论坛软件，但又担心软件被第三方篡改，可以将该软件的md5值和官方下载的md5值进行对比，如果一致，则可放心使用。摘要算法有如下几个特点</p>
<p>输入相同时，输出一致<br>输入不同时，输出不同<br>通过输出，不能计算出输入<br>对输入的任何细微修改，都会导致完全不同的输出<br>由于以上特性，摘要也常被用来给密码加密，不过由于计算机运算能力的提升以及越来越丰富的破解手段，已不建议使用摘要算法来给密码加密。</p>
<p>通过解码可以还原原始信息<br>例子：ASCII, Unicode, URL Encoding, Base64等<br>通过解码不可以还原原始信息<br>例子：md5, sha系列</p>
<p>上面的盐值加密只能生成固定的加密字符串，接下来介绍生成动态的加密字符串。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line">import org.apache.commons.codec.DecoderException;</div><div class="line">import org.apache.commons.codec.binary.Hex;</div><div class="line">import org.apache.commons.lang3.Validate;</div><div class="line">import java.security.GeneralSecurityException;</div><div class="line">import java.security.MessageDigest;</div><div class="line">import java.security.SecureRandom;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 数字: 代表第几部分</div><div class="line"> * 加密后的字符串(存于数据库中)：4:十六进制编码(1:随机生成大小为8的byte数组作为盐值) + 5:十六进制编码(3:HAS1散列(1:随机生成大小为8的byte数组作为盐值 + 2:明文密码))</div><div class="line"> * 解密：取出密文密码的前16位进行十六进制解码(也就是加密中的第一部分)</div><div class="line"> * 使用用户提交的密码进行加密后的字符串：4:十六进制编码(1:从数据库中取出第4部分进行十六进制解码作为盐值) + 5:十六进制编码(3:HAS1散列(1:从数据库中取出第4部分进行十六进制解码作为盐值 + 2:明文密码(用户提交的密码)))</div><div class="line"> * 判断用户密码是否正确：</div><div class="line"> *  使用用户提交的密码进行加密后的字符串和数据库中的加密后的正确的字符串进行对比。</div><div class="line"> * </div><div class="line"> * </div><div class="line"> */</div><div class="line">public class Pas &#123;</div><div class="line">    private static SecureRandom random = new SecureRandom();</div><div class="line">    private static String SHA1 = &quot;SHA-1&quot;;</div><div class="line">    private static int SIZE = 8;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        // 随机生成指定大小的byte数组作为盐值</div><div class="line">        byte[] salt = generateSalt(SIZE);</div><div class="line">        // 进行has1散列</div><div class="line">        byte[] hashPassword = digest(&quot;admin&quot;.getBytes(), SHA1, salt, 1024);</div><div class="line"></div><div class="line">        System.out.println(&quot;slat:&quot; + new String(Hex.encodeHex(salt))); // 每次都不一样，所以密码加密后的字符串每次都不一样</div><div class="line">        System.out.println(&quot;hashPassword:&quot; + new String(Hex.encodeHex(hashPassword)));</div><div class="line">        // 进行十六进制编码</div><div class="line">        String s1 = new String(Hex.encodeHex(salt)) + new String(Hex.encodeHex(hashPassword));</div><div class="line">        System.out.println(&quot;密文密码:&quot; + s1);</div><div class="line"></div><div class="line">        // 解密 s1为密文密码 mPass为使用用户传进来的参数生成的的密文密码</div><div class="line"></div><div class="line">        byte[] salt2 = new byte[0];</div><div class="line">        try &#123;</div><div class="line">            // 取出密文密码的前16位(也就是对随机生成size为8的byte数组进行十六进制编码后的字符串),进行十六解码</div><div class="line">            salt2 = Hex.decodeHex(s1.substring(0, SIZE * 2).toCharArray());</div><div class="line"></div><div class="line">            // 进行has1散列</div><div class="line">            byte[] hashPassword2 = digest(&quot;admin&quot;.getBytes(), SHA1, salt2, 1024);</div><div class="line">            System.out.println(&quot;slat2:&quot; + new String(Hex.encodeHex(salt)));</div><div class="line"></div><div class="line">            System.out.println(&quot;hashPassword2:&quot; + new String(Hex.encodeHex(hashPassword)));</div><div class="line">            String mPass = new String(Hex.encodeHex(salt2)) + new String(Hex.encodeHex(hashPassword2));</div><div class="line">            System.out.println(&quot;密文密码:&quot; + mPass);</div><div class="line">        &#125; catch (DecoderException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 对字符串进行散列, 支持md5与sha1算法.</div><div class="line">     */</div><div class="line">    private static byte[] digest(byte[] input, String algorithm, byte[] salt, int iterations) &#123;</div><div class="line">        try &#123;</div><div class="line">            MessageDigest digest = MessageDigest.getInstance(algorithm);</div><div class="line"></div><div class="line">            if (salt != null) &#123;</div><div class="line">                digest.update(salt);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            byte[] result = digest.digest(input);</div><div class="line"></div><div class="line">            for (int i = 1; i &lt; iterations; i++) &#123;</div><div class="line">                digest.reset();</div><div class="line">                result = digest.digest(result);</div><div class="line">            &#125;</div><div class="line">            return result;</div><div class="line">        &#125; catch (GeneralSecurityException e) &#123;</div><div class="line">        &#125;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 生成随机的Byte[]作为salt.</div><div class="line">     *</div><div class="line">     * @param numBytes byte数组的大小</div><div class="line">     */</div><div class="line">    public static byte[] generateSalt(int numBytes) &#123;</div><div class="line">        Validate.isTrue(numBytes &gt; 0, &quot;numBytes argument must be a positive integer (1 or larger)&quot;, numBytes);</div><div class="line">        byte[] bytes = new byte[numBytes];</div><div class="line">        random.nextBytes(bytes);</div><div class="line">        return bytes;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>因为加密和解密使用的是两个不同的密钥(4:十六进制编码(1:随机生成大小为8的byte数组作为盐值))，所以这种算法叫作非对称加密算法</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[项目架构]]></title>
      <url>https://volc1605.github.io/2017/03/05/%E9%A1%B9%E7%9B%AE%E6%9E%84%E6%9E%B6/</url>
      <content type="html"><![CDATA[<h3 id="1-项目架构"><a href="#1-项目架构" class="headerlink" title="1 项目架构"></a>1 项目架构</h3><a id="more"></a>
<h4 id="1、项目架构示意图"><a href="#1、项目架构示意图" class="headerlink" title="1、项目架构示意图"></a>1、项目架构示意图</h4><!-- ![jiagou](https://volc1605.github.io/images/项目架构/架构.png) -->
<!-- ![jiagou](http://127.0.0.1:4000/images/项目架构/jiagou.png) -->
<p><img src="https://volc1605.github.io/images/项目架构/jiagou.png" alt="jiagou"><br>所有的入口经过nginx，项目性能取决于nginx,存在性能安全隐患。<br>解决方案<br>方案一：<br>keepalived+nginx实现双机主备<br><img src="https://volc1605.github.io/images/项目架构/jiagou2.png" alt="jiagou"><br>方案二：<br>keepalived+nginx实现双主热备<br><img src="https://volc1605.github.io/images/项目架构/jiagou3.png" alt="jiagou"><br>方案三：<br>lvs+nginx实现负载均衡，直接代替nginx的负载均衡，解决足够大的并发问题<br><img src="https://volc1605.github.io/images/项目架构/jiagou4.png" alt="jiagou"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[图片无法显示的问题]]></title>
      <url>https://volc1605.github.io/2017/03/05/%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h3 id="1-图片无法显示的问题"><a href="#1-图片无法显示的问题" class="headerlink" title="1 图片无法显示的问题"></a>1 图片无法显示的问题</h3><a id="more"></a>
<p>问题产生原因：</p>
<p>后台系统taotao-manage上传的图片是在192.168.0.44的/ucenter/web/taotao-upload<br>前台系统taotao-web访问图片，现在的nginx的配置是：将image.taotao.com指向到本地(192.168.0.50)的/ucneter/web/taotao-upload<br>导致新上传的图片将无法显示。<br>如何解决方式：<br>方式一：部署一台单独的图片服务器，上传和访问都是同一台服务器<br>方式二：使用FTP频繁手动上传到192.168.0.44的/ucenter/web/taotao-upload<br>方式三(推荐使用)：NFS – 网络文件系统(类似windows系统中，多台电脑访问共享文件夹)<br>临时解决方案：在192.168.0.50上直接上传taotao-upload.tar.gz解压</p>
<hr>
<p>下面介绍具体使用NFS<br>在CentOS下搭建NFS服务器总结：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line">环境介绍：</div><div class="line">1. 服务器： 192.168.0.100</div><div class="line">2. 客户机： 192.168.0.101</div><div class="line">安装软件包：</div><div class="line">服务器和客户机都要安装nfs 和 rpcbind 软件包：</div><div class="line">yum -y install nfs-utils  rpcbind</div><div class="line">服务器端配置：</div><div class="line">1. 在服务器上创建NFS共享目录：mkdir /usr/local/test</div><div class="line">2. 设置共享目录的读写权限: chmod 666 /usr/local/test</div><div class="line">3. 编辑export文件：  vi /etc/exports </div><div class="line">/usr/local/test/ 192.168.0.101(rw,no_root_squash,no_all_squash,sync)</div><div class="line">注意地址和参数表之间没有空格。如果下面设置的mountd端口大于1024，需要在参数表里加入参数：insecure</div><div class="line">4. 配置生效：</div><div class="line">exportfs  -r</div><div class="line">注：配置文件说明：</div><div class="line">/usr/local/test/ 为共享的目录，使用绝对路径。</div><div class="line">192.168.0.101(rw,no_root_squash,no_all_squash,sync) 为客户端的地址及权限，地址可以是一个网段（如：192.168.0.0/24），一个IP地址或者是一个域名，域名支持通配符，如：*.hpce.cn，地址与权限中间没有空格。</div><div class="line">权限说明：</div><div class="line">rw：read-write，可读写；</div><div class="line">ro：read-only，只读；</div><div class="line">sync：文件同时写入硬盘和内存；</div><div class="line">async：文件暂存于内存，而不是直接写入内存；</div><div class="line">no_root_squash：NFS客户端连接服务端时如果使用的是root的话，那么对服务端分享的目录来说，也拥有root权限。显然开启这项是不安全的。</div><div class="line">root_squash：NFS客户端连接服务端时如果使用的是root的话，那么对服务端分享的目录来说，拥有匿名用户权限，通常他将使用nobody或nfsnobody身份；</div><div class="line">all_squash：不论NFS客户端连接服务端时使用什么用户，对服务端分享的目录来说都是拥有匿名用户权限；</div><div class="line">anonuid：匿名用户的UID值，通常是nobody或nfsnobody，可以在此处自行设定；</div><div class="line">anongid：匿名用户的GID值。</div><div class="line"></div><div class="line">5. 启动服务rpcbind、nfs服务:</div><div class="line">service rpcbind  start</div><div class="line">service nfs  start</div><div class="line">服务器端防火墙设置（NFS 开启防墙配置）：</div><div class="line">修改/etc/services文件：</div><div class="line">配置rpc，nfsd，rquotad，mountd使用的端口。配置之前先检查一下是否已经配置过了，已经配过的就不用配置了。没有配置的，要分配一个在此文件中未被使用的端口号。我的机器默认配置了：rpc、nfsd、rquotad</div><div class="line">mountd: 没有配置。手工加上：</div><div class="line">mountd          48620/tcp               #rpc.mountd </div><div class="line">mountd          48620/udp               #rpc.mountd </div><div class="line">如果mountd占用端口大于 1024，在文件 /etc/exports里需要加入参数insecure。如：192.168.0.100(insecure,rw,async,root_squash,no_all_squash)</div><div class="line">重启NFS服务：</div><div class="line">service nfs restart </div><div class="line">在防火墙配置文件里开放上面配置的端口：</div><div class="line">打开文件：vim /etc/sysconfig/iptables</div><div class="line">加入红色部分的内容： </div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT</div><div class="line">#rpc</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 121 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m udp -p udp --dport 121 -j ACCEPT</div><div class="line">#nfsd</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 2049 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m udp -p udp --dport 2049 -j ACCEPT</div><div class="line">#rquotad</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 875 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m udp -p udp --dport 875 -j ACCEPT</div><div class="line">#mountd</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 48620 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m udp -p udp --dport 48620 -j ACCEPT</div><div class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</div><div class="line"></div><div class="line"></div><div class="line">或者：</div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 121 -j ACCEPT </div><div class="line"></div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 2049 -j ACCEPT </div><div class="line"></div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 875 -j ACCEPT </div><div class="line"></div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 48620 -j ACCEPT </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">客户端挂载：</div><div class="line">创建挂载目录： mkdir /usr/local/test</div><div class="line">查看服务器抛出的共享目录信息：</div><div class="line">showmount -e 192.168.0.100</div><div class="line">Export list for 192.168.0.100:</div><div class="line">/usr/local/test 192.168.0.101</div><div class="line">如果显示：rpc mount export: RPC: Unable to receive; errno = No route to host，则需要在服务端关闭防火墙。</div><div class="line">为了提高NFS的稳定性，使用TCP协议挂载，NFS默认用UDP协议：</div><div class="line">mount -t nfs 192.168.0.100:/usr/local/test  /usr/local/test  -o proto=tcp -o nolock</div><div class="line">挂载成功后即可访问共享的NFS文件系统了。</div><div class="line">卸载已挂在的NFS</div><div class="line">umount /usr/local/test</div><div class="line">查看挂载目录的信息：</div><div class="line">fuser -m -v /usr/local/test</div><div class="line"></div><div class="line">来源： &lt;http://blog.chinaunix.net/uid-23500957-id-4217525.html&gt;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[tomcat集群]]></title>
      <url>https://volc1605.github.io/2017/03/05/tomcat%E9%9B%86%E7%BE%A4/</url>
      <content type="html"><![CDATA[<h3 id="1-tomcat集群"><a href="#1-tomcat集群" class="headerlink" title="1 tomcat集群"></a>1 tomcat集群</h3><a id="more"></a>
<h4 id="1、安装多个tomcat，每个tomcat部署同一个项目"><a href="#1、安装多个tomcat，每个tomcat部署同一个项目" class="headerlink" title="1、安装多个tomcat，每个tomcat部署同一个项目"></a>1、安装多个tomcat，每个tomcat部署同一个项目</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"># 这里的taotao-web-tomcat-01已经安装成功，并部署了项目，只要复制taotao-web-tomcat-01即可，不需要再次部署项目</div><div class="line"># 复制递归tomcat[taotao-web-tomcat-01]</div><div class="line">cd /ucenter/taotao-web</div><div class="line">cp taotao-web-tomcat-01 taotao-web-tomcat-02 -R</div><div class="line"># 做tomcat集群需要修改三个地方的配置文件</div><div class="line">cd taotao-web-tomcat-02/conf</div><div class="line">vim server.xml</div><div class="line">&lt;!-- 第一个tomcatport=&quot;8005&quot;,这里修改成8105--&gt;</div><div class="line">&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</div><div class="line">  &lt;Listener className=&quot;org.apache.catalina.startup.VersionLoggerListener&quot; /&gt;</div><div class="line">  </div><div class="line">&lt;!-- 请求端口，第一个tomcatport=&quot;8080&quot;，修改为8081 --&gt;</div><div class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;</div><div class="line">   connectionTimeout=&quot;20000&quot;</div><div class="line"> </div><div class="line">&lt;!-- 修改AJP服务端口，第一个tomcat为8009，这里修改为8109 --&gt;</div><div class="line">&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt;</div><div class="line"># 保存退出</div></pre></td></tr></table></figure>
<h4 id="2、使用nginx做负载均衡"><a href="#2、使用nginx做负载均衡" class="headerlink" title="2、使用nginx做负载均衡"></a>2、使用nginx做负载均衡</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"># 进入安装nginx服务器，修改配置文件</div><div class="line">cd /ucenter/soft/nginx/conf</div><div class="line">vim nginx.xml</div><div class="line"># 第一个tomcat配置</div><div class="line">server &#123;</div><div class="line">	listen       80;</div><div class="line">	server_name  www.taotao.com taotao.com;</div><div class="line"></div><div class="line">	#charset koi8-r;</div><div class="line"></div><div class="line">	#access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">	proxy_set_header X-Forwarded-Host $host;</div><div class="line">	proxy_set_header X-Forwarded-Server $host;</div><div class="line">	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">	proxy_set_header Host $host;</div><div class="line">	location / &#123;</div><div class="line">		proxy_pass http://安装第一个tomcat[taotao-web-tomcat-01]所在服务器的ip:8080;</div><div class="line">		proxy_connect_timeout 600;</div><div class="line">		proxy_read_timeout 600;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"># 需要在http节点添加以下配置</div><div class="line">upstream taotao-web &#123;</div><div class="line">	# 这里taotao-web-tomcat-01和taotao-web-tomcat-02两个tomcat都安装在了同一个服务器上</div><div class="line">	# 8080和8081分别是两个tomcat访问的端口号</div><div class="line">	server 安装第一个tomcat[taotao-web-tomcat-01]所在服务器的ip:8080;</div><div class="line">	server 安装第二个tomcat[taotao-web-tomcat-02]所在服务器的ip:8081;</div><div class="line">&#125;</div><div class="line"># 最后修改nginx.conf配置文件为</div><div class="line">upstream taotao-web &#123;</div><div class="line">	server 安装第一个tomcat[taotao-web-tomcat-01]所在服务器的ip:8080;</div><div class="line">	server 安装第二个tomcat[taotao-web-tomcat-02]所在服务器的ip:8081;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">	listen       80;</div><div class="line">	server_name  www.taotao.com taotao.com;</div><div class="line"></div><div class="line">	#charset koi8-r;</div><div class="line"></div><div class="line">	#access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">	proxy_set_header X-Forwarded-Host $host;</div><div class="line">	proxy_set_header X-Forwarded-Server $host;</div><div class="line">	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">	proxy_set_header Host $host;</div><div class="line">	location / &#123;</div><div class="line">		# taotao-web就是上面upstream后面的名称，相当于一个变量</div><div class="line">		proxy_pass http://taotao-web;</div><div class="line">		proxy_connect_timeout 600;</div><div class="line">		proxy_read_timeout 600;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"># 保存退出nginx.conf配置文件,重启nginx</div><div class="line">:wq</div><div class="line">cd /ucenter/soft/nginx/conf/sbin</div><div class="line">./ngin -s reload</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 需要明白一点的是nginx配合tomcat作集群，proxy_pass http://taotao-web;是采用轮询方式来代理不同的tomcat的。</div><div class="line"># 第一次访问</div><div class="line"># 	server 安装第一个tomcat[taotao-web-tomcat-01]所在服务器的ip:8080;</div><div class="line"># 第二次就会访问</div><div class="line"># 	server 安装第二个tomcat[taotao-web-tomcat-02]所在服务器的ip:8081;</div><div class="line"># 第三次再次访问</div><div class="line"># 	server 安装第一个tomcat[taotao-web-tomcat-01]所在服务器的ip:8080;</div><div class="line"># 类似MySQL的主从配置后轮询读取主库和从库数据</div><div class="line"># 如果其中一个tomcat挂掉，nginx会自动检测并从轮询列表中移除该轮询对象。</div><div class="line"># 如果这个tomcat又正常启动了，nginx会自动检测添加该对象到轮询列表中，进行下一轮询。</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[linux下部署项目]]></title>
      <url>https://volc1605.github.io/2017/03/05/linux%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/</url>
      <content type="html"><![CDATA[<h3 id="1-部署项目"><a href="#1-部署项目" class="headerlink" title="1 部署项目"></a>1 部署项目</h3><a id="more"></a>
<p>注意：先安装JDK,然后再部署项目</p>
<h4 id="1、创建普通用户"><a href="#1、创建普通用户" class="headerlink" title="1、创建普通用户"></a>1、创建普通用户</h4><p>一般生产环境是不会使用root用户来发布tomcat等应用的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"># 创建linux服务器的普通用户，用户名为ucenter，默认权限目录为home下的ucenter目录</div><div class="line">useradd ucenter</div><div class="line"># 进入根目录的home目录中</div><div class="line">cd home</div><div class="line"># 查看当前用户所处的目录</div><div class="line">pwd</div><div class="line"># ll会列出该文件下的所有文件信息，包括隐藏的文件，而ls -l只列出显式文件</div><div class="line">ll</div><div class="line"># 切换用户到ucenter</div><div class="line">su - ucenter</div><div class="line"># 查看当前用户所处的目录</div><div class="line">pwd</div><div class="line">/home/ucenter</div><div class="line"># 创建用户，用户名为ucenter访问权限为根目录下ucenter目录</div><div class="line">useradd ucenter -d /ucenter</div><div class="line"># 设置ucenter用户的密码为:ucenter</div><div class="line">passwd ucenter</div><div class="line"># 为ucenter用户创建ucenter目录</div><div class="line">mkdir /ucenter</div><div class="line"># 把ucenter目录及其下所有的目录的授权给ucenter用户和其所在的组</div><div class="line">chown ucenter:ucenter /ucenter/ -R</div></pre></td></tr></table></figure></p>
<h4 id="2、安装tomcat"><a href="#2、安装tomcat" class="headerlink" title="2、安装tomcat"></a>2、安装tomcat</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">cd /ucenter/</div><div class="line">mkdir web</div><div class="line">cd web/</div><div class="line">mkdir taotao-manage</div><div class="line">cd taotao-manage/</div><div class="line"># 上传tomcat</div><div class="line">rz</div><div class="line"># 解压到当前目录</div><div class="line">tar -xvf apache-tomcat-7.0.57.tar.gz</div><div class="line"># 重命名</div><div class="line">mv apache-tomcat-7.0.57 taotao-manage-tomcat</div><div class="line">cd taotao-manage-tomcat</div><div class="line">cd webapps/</div><div class="line"># 删除当前目录下所有的文件和文件夹</div><div class="line">rm -rf *</div><div class="line"># 创建ROOT目录</div><div class="line">mkdir ROOT</div><div class="line"># 上传打好的war包，taotao-manage.war</div><div class="line">rz</div><div class="line"># 使用jdk提供的jar命令，解压war包</div><div class="line">jar -xvf taotao-manage.war</div><div class="line"># 解压成功删除taotao-manage.war</div><div class="line">rm  -rf taotao-manage.war</div></pre></td></tr></table></figure>
<h4 id="3、修改项目配置文件"><a href="#3、修改项目配置文件" class="headerlink" title="3、修改项目配置文件"></a>3、修改项目配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"># 修改配置文件</div><div class="line">cd /ucenter/web/taotao-manage/taotao-manage-tomcat/WEB-INF/classes</div><div class="line">vim env.properties</div><div class="line"># 修改为</div><div class="line">REPOSITORY_PATH=/ucenter/web/taotao-upload</div><div class="line">IMAGE_BASE_URL=http://image.taotao.com</div><div class="line">TAOTAO_WEB_UTL=http://www.taotao.com</div><div class="line"># 保存退出</div><div class="line">:wq</div><div class="line"># 创建taotao-upload目录</div><div class="line">mkdir /ucenter/web/taotao-upload</div><div class="line"># 修改jdbc.properties</div><div class="line"># 修改rabbitmq.properties</div><div class="line">rabbitmq.host=服务器ip地址</div><div class="line">rabbitmq.port=5672</div><div class="line">rabbitmq.username=taotao</div><div class="line">rabbitmq.password=taotao</div><div class="line">rabbitmq.vhost=/taotao</div><div class="line"># 修改redis.properties</div><div class="line">redis.maxTotal=100</div><div class="line">redis.node1.host=服务器ip地址</div><div class="line">redis.node1.port=6379</div><div class="line"># 保存退出</div></pre></td></tr></table></figure>
<h4 id="4、启动tomcat"><a href="#4、启动tomcat" class="headerlink" title="4、启动tomcat"></a>4、启动tomcat</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cd /ucenter/web/taotao-manage/taotao-manage-tomcat/bin</div><div class="line"># 查看8080端口是否开放</div><div class="line">/etc/init.d/iptables status</div><div class="line"># dtp后面为开放的端口号，没有8080端口号，需要添加8080端口</div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 8080 -j ACCEPT</div><div class="line">/etc/rc.d/init.d/iptables save</div><div class="line"># 启动tomcat</div><div class="line">./startup.sh</div><div class="line"># 浏览器访问地址：[服务器ip:8080/rest/page/index]成功访问</div></pre></td></tr></table></figure>
<h4 id="5、解决浏览器无法访问线上项目问题"><a href="#5、解决浏览器无法访问线上项目问题" class="headerlink" title="5、解决浏览器无法访问线上项目问题"></a>5、解决浏览器无法访问线上项目问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 查看所有的tomcat进程</div><div class="line">ps -ef | grep tomcat</div><div class="line"># 结束多个进程</div><div class="line">kill -9 18007 23419</div><div class="line"># 提示不允许的操作，说明没有权限，需要用root用户进行kill</div><div class="line"># 结束全部tomcat进程后，重新启动tomcat</div><div class="line">cd /ucenter/web/taotao-manage/taotao-manage-tomcat/bin</div><div class="line"># 启动taotao-manage-tomcat并查看tomcat日志，&amp;&amp; 代表逻辑执行，如果前面的命令执行成功就执行后面的命令</div><div class="line">./statup.sh &amp;&amp; tail -f ../logs/catalina.out</div><div class="line"># 浏览器访问地址：[服务器ip:8080/rest/page/index]成功访问</div></pre></td></tr></table></figure>
<h4 id="6、本地通过域名访问线上项目"><a href="#6、本地通过域名访问线上项目" class="headerlink" title="6、本地通过域名访问线上项目"></a>6、本地通过域名访问线上项目</h4><h5 id="6-1修改本地SwitchHosts映射"><a href="#6-1修改本地SwitchHosts映射" class="headerlink" title="6.1修改本地SwitchHosts映射"></a>6.1修改本地SwitchHosts映射</h5><p>本地使用SwitchHosts映射，nginx反向代理，访问本地项目，要想访问线上的项目，需要修改SwitchHosts映射和nginx反向代理配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># SwitchHosts映射修改为</div><div class="line"># 淘淘生产环境</div><div class="line">安装nginx服务器的ip地址 manage.taotao.com</div></pre></td></tr></table></figure></p>
<h5 id="6-2修改线上nginx代理配置"><a href="#6-2修改线上nginx代理配置" class="headerlink" title="6.2修改线上nginx代理配置"></a>6.2修改线上nginx代理配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"># 进入安装ngin的服务器，切换到普通用户</div><div class="line">su ucenter</div><div class="line">cd soft/nginx/conf</div><div class="line">vim nginx.conf</div><div class="line"># 先做bak</div><div class="line">mv nginx.conf nginx.conf.bak</div><div class="line"># 上传本地的nginx.conf配置文件</div><div class="line">rz</div><div class="line"># 打开nignx.conf(这个文件应该是uft-8进行编码的，否则上传到服务器会出现中文乱码)</div><div class="line">vim nginx.conf</div><div class="line"># 修改manage.taotao.com的代理如下</div><div class="line">server &#123;</div><div class="line">	listen       80;</div><div class="line">	server_name  manage.taotao.com;</div><div class="line">	#charset koi8-r;</div><div class="line">	#access_log  logs/host.access.log  main;</div><div class="line">	proxy_set_header X-Forwarded-Host $host;</div><div class="line">	proxy_set_header X-Forwarded-Server $host;</div><div class="line">	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">	location / &#123;</div><div class="line">		proxy_pass http://部署taotao-manage项目的tomcat所在的服务器的ip地址:8080;</div><div class="line">		proxy_connect_timeout 600;</div><div class="line">		proxy_read_timeout 600;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"># 保存退出:wq</div><div class="line">cd sbin/</div><div class="line"># 重启nginx</div><div class="line">./nginx -s reload</div><div class="line"># 浏览器访问地址：[manage.taotao.com/rest/page/index]成功访问</div></pre></td></tr></table></figure>
<h3 id="2-其他项目部署问题"><a href="#2-其他项目部署问题" class="headerlink" title="2 其他项目部署问题"></a>2 其他项目部署问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># taotao-web项目，evn.properties</div><div class="line">TAOTAO_MANAGE_URL=http://manage.taotao.com</div><div class="line">TAOTAO_ORDER_URL=http://order.taotao.com</div><div class="line">TAOTAO_SSO_URL=http://sso.taotao.com</div><div class="line">TAOTAO_CART_URL=http://cart.taotao.com</div><div class="line">TAOTAO_ORDER_URL=http://order.taotao.com</div><div class="line">TAOTAO_CART_UTL=http://cart.taotao.com</div><div class="line">SSO_TAOTAO_URL=http://sso.taotao.com</div><div class="line">INDEX_AD1_URL=/rest/content?categoryId=16&amp;page=1&amp;rows=6</div><div class="line">INDEX_AD2_URL=/rest/content?categoryId=18&amp;page=1&amp;rows=1</div><div class="line"># 修改rabbitmq.properties</div><div class="line">rabbitmq.host=安装rabbitmq服务器IP</div><div class="line">rabbitmq.port=5672</div><div class="line">rabbitmq.username=taotao</div><div class="line">rabbitmq.password=taotao</div><div class="line">rabbitmq.vhost=/taotao</div><div class="line"># 修改redis.properties</div><div class="line">redis.maxTotal=100</div><div class="line">redis.node1.host=安装redis服务器的IP</div><div class="line">redis.node1.port=6379</div></pre></td></tr></table></figure>
<p>taotao-web前台项目需要访问后台taotao-manage项目<br>进入部署taotao-web项目的tomcat所在的服务器，进行ping<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ping taotao.manage.com</div><div class="line"># ping不通，无法访问后台项目，这里就需要参考evn.properties配置文件修改hosts文件</div><div class="line">vim /etc/hosts</div><div class="line">安装nginx服务器的ip地址 manage.taotao.com</div><div class="line">安装nginx服务器的ip地址 order.taotao.com</div><div class="line">安装nginx服务器的ip地址 sso.taotao.com</div><div class="line">安装nginx服务器的ip地址 cart.taotao.com</div><div class="line"># 保存退出</div></pre></td></tr></table></figure></p>
<h3 id="3-配置访问静态资源"><a href="#3-配置访问静态资源" class="headerlink" title="3 配置访问静态资源"></a>3 配置访问静态资源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">cd cd soft/nginx/conf</div><div class="line">vim nginx.conf</div><div class="line"># 查找image字符串</div><div class="line">/image</div><div class="line"># 修改nginx代理访问静态资源</div><div class="line"># 首先创建静态资源访问目录</div><div class="line">cd /ucenter</div><div class="line"># 上传静态资源,taotao-upload.tar.gz</div><div class="line">rz</div><div class="line"># 解压tar包</div><div class="line">tar -xvf taotao-upload</div><div class="line">rm -rf taotao-upload.tar.gz</div><div class="line"># 查看静态资源</div><div class="line">cd taotao-upload</div><div class="line">cd cd soft/nginx/conf</div><div class="line">vim nginx.conf</div><div class="line"># 修改访问静态资源路径</div><div class="line">server &#123;</div><div class="line">	listen       80;</div><div class="line">	server_name  image.taotao.com;</div><div class="line">	#charset koi8-r;</div><div class="line">	#access_log  logs/host.access.log  main;</div><div class="line">	proxy_set_header X-Forwarded-Host $host;</div><div class="line">	proxy_set_header X-Forwarded-Server $host;</div><div class="line">	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">	location / &#123;</div><div class="line">		root  /ucenter/taotao-upload;</div><div class="line">	&#125; </div><div class="line">&#125;</div><div class="line"># 保存退出</div><div class="line">cd ../sbin/</div><div class="line"># 重启nginx</div><div class="line">./nginx -s reload</div></pre></td></tr></table></figure>
<h3 id="4-solr相关配置"><a href="#4-solr相关配置" class="headerlink" title="4 solr相关配置"></a>4 solr相关配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># taotao-search-tomcat中项目配置文件evn.properties</div><div class="line">TAOTAO_MANAGE_URL=http://manage.taotao.com</div><div class="line"># 也要在安装tomcat[taotao-search-tomcat]所在的服务其中配置hosts</div><div class="line">vim /etc/hosts</div><div class="line">安装nginx服务器的ip地址 manage.taotao.com</div><div class="line"># taotao-search-tomcat中项目配置文件solr.properties</div><div class="line">solr.url=http://solr.taotao.com/taotao</div><div class="line">solr.maxRetries=1</div><div class="line">solr.connectionTimeout=500</div><div class="line"># 需要配置hosts，这里仍然指向nginx所在的服务器</div><div class="line">安装nginx服务器的ip地址 solr.taotao.com</div><div class="line"># 需要注意的是域名全部要指向ngin所在的服务器</div><div class="line"># 最后的tomcat[taotao-search-tomcat]所在的服务其中配置hosts配置为</div><div class="line">安装nginx服务器的ip地址 manage.taotao.com</div><div class="line">安装nginx服务器的ip地址 solr.taotao.com</div></pre></td></tr></table></figure>
<h3 id="5-遇到的问题"><a href="#5-遇到的问题" class="headerlink" title="5 遇到的问题"></a>5 遇到的问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;Server port=&quot;29051&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</div><div class="line"></div><div class="line">&lt;Connector port=&quot;19051&quot; protocol=&quot;HTTP/1.1&quot; maxThreads=&quot;150&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; URIEncoding=&quot;UTF-8&quot;/&gt;</div><div class="line">URIEncoding=&quot;UTF-8&quot;可解决get请求中文乱码</div><div class="line">			   </div><div class="line">&lt;Connector port=&quot;39051&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[RabbitMQ]]></title>
      <url>https://volc1605.github.io/2017/03/05/linux%E4%B8%8B%E5%AE%89%E8%A3%85RabbitMQ/</url>
      <content type="html"><![CDATA[<h3 id="1-windows下安装RabbitMQ"><a href="#1-windows下安装RabbitMQ" class="headerlink" title="1 windows下安装RabbitMQ"></a>1 windows下安装RabbitMQ</h3><a id="more"></a>
<h4 id="1-1-注意事项"><a href="#1-1-注意事项" class="headerlink" title="1.1 注意事项"></a>1.1 注意事项</h4><p>1.推荐使用3.4.1版本。<br>2.推荐使用默认的安装路径(c盘)<br>3.系统用户名必须是英文<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\Users\Administrator&gt;</div></pre></td></tr></table></figure></p>
<p>4.计算机名必须是英文<br>5.系统的用户必须是管理员<br>6.<br>安装失败的同学应该如何解决：<br>    1、    重装系统  –  不推荐<br>    2、    将RabbitMQ安装到linux虚拟机中<br>        a)    推荐<br>    3、    使用别人安装好的RabbitMQ服务<br>        a)    只要给你开通一个账户即可。<br>        b)    使用公用的RabbitMQ服务。<br>        c)    推荐</p>
<h4 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a>1.2 安装</h4><p>下载地址：<a href="http://www.rabbitmq.com/download.html" target="_blank" rel="external">http://www.rabbitmq.com/download.html</a></p>
<h5 id="1-2-1-安装Erlang"><a href="#1-2-1-安装Erlang" class="headerlink" title="1.2.1 安装Erlang"></a>1.2.1 安装Erlang</h5><p>下载地址：<a href="http://www.erlang.org/download/otp_win64_17.3.exe" target="_blank" rel="external">http://www.erlang.org/download/otp_win64_17.3.exe</a><br>以管理员身份运行安装，安装默认路径，安装过程中可能出现以下提示<br><img src="https://volc1605.github.io/images/rabbitmq/e.png" alt="e"><br>直接忽略即可。</p>
<h5 id="1-2-2-安装rabbitmq"><a href="#1-2-2-安装rabbitmq" class="headerlink" title="1.2.2 安装rabbitmq"></a>1.2.2 安装rabbitmq</h5><p>以管理员身份安装，安装成功后，系统服务中有RabbitMQ服务，尝试停止、启动、重启确认安装成功。</p>
<h5 id="1-2-3-连接rabbitmq服务"><a href="#1-2-3-连接rabbitmq服务" class="headerlink" title="1.2.3 连接rabbitmq服务"></a>1.2.3 连接rabbitmq服务</h5><p>以管理员身份进入安装目录(C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.4.1\sbin)目录下<br>执行以下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rabbitmq-plugins enable rabbitmq_management</div></pre></td></tr></table></figure></p>
<h5 id="1-2-4-登录"><a href="#1-2-4-登录" class="headerlink" title="1.2.4 登录"></a>1.2.4 登录</h5><p>浏览器访问:127.0.0.1:15672<br>默认账号：guest 密码：guest<br><a href="#jump">需要创建普通用户</a></p>
<h3 id="2-spring整合rabbitmq"><a href="#2-spring整合rabbitmq" class="headerlink" title="2 spring整合rabbitmq"></a>2 spring整合rabbitmq</h3><h4 id="2-1-后台系统"><a href="#2-1-后台系统" class="headerlink" title="2.1 后台系统"></a>2.1 后台系统</h4><h5 id="2-1-1-引入依赖"><a href="#2-1-1-引入依赖" class="headerlink" title="2.1.1 引入依赖"></a>2.1.1 引入依赖</h5><p>service项目中引入依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 在使用的最底层倒入依赖 spring封装好对rabbitmq消息队列的操作 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.springframework.amqp&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;spring-rabbit&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;1.4.0.RELEASE&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<h5 id="2-1-2-rabbitmq-properties属性文件"><a href="#2-1-2-rabbitmq-properties属性文件" class="headerlink" title="2.1.2 rabbitmq.properties属性文件"></a>2.1.2 rabbitmq.properties属性文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">rabbitmq.host=127.0.0.1</div><div class="line">rabbitmq.port=5672</div><div class="line">rabbitmq.username=taotao</div><div class="line">rabbitmq.password=taotao</div><div class="line">rabbitmq.vhost=/taotao</div></pre></td></tr></table></figure>
<h5 id="2-1-3-spring初始化配置文件applicationContext-xml加载rabbitmq-properties属性文件"><a href="#2-1-3-spring初始化配置文件applicationContext-xml加载rabbitmq-properties属性文件" class="headerlink" title="2.1.3 spring初始化配置文件applicationContext.xml加载rabbitmq.properties属性文件"></a>2.1.3 spring初始化配置文件applicationContext.xml加载rabbitmq.properties属性文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></div><div class="line">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 使用spring自带的占位符替换功能 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 允许JVM参数覆盖 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"systemPropertiesModeName"</span> <span class="attr">value</span>=<span class="string">"SYSTEM_PROPERTIES_MODE_OVERRIDE"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 忽略没有找到的资源文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ignoreResourceNotFound"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置资源文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:jdbc.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:evn.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:redis.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:httpclient.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:rabbitmq.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 扫描包 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.taotao"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 未实现读写分离时配置定义数据源 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- &lt;bean id="dataSource" class="com.jolbox.bonecp.BoneCPDataSource" destroy-method="close"&gt; 数据库驱动 &lt;property name="driverClass" value="$&#123;jdbc.driverClassName&#125;" /&gt; 相应驱动的jdbcUrl &lt;property name="jdbcUrl" </span></div><div class="line">		value="$&#123;jdbc.url&#125;" /&gt; 数据库的用户名 &lt;property name="username" value="$&#123;jdbc.username&#125;" /&gt; 数据库的密码 &lt;property name="password" value="$&#123;jdbc.password&#125;" /&gt; 检查数据库连接池中空闲连接的间隔时间，单位是分，默认值：240，如果要取消则设置为0 &lt;property name="idleConnectionTestPeriod" </div><div class="line">		value="60" /&gt; 连接池中未使用的链接最大存活时间，单位是分，默认值：60，如果要永远存活设置为0 &lt;property name="idleMaxAge" value="30" /&gt; 每个分区最大的连接数 判断依据：请求并发数 &lt;property name="maxConnectionsPerPartition" value="100" /&gt; 每个分区最小的连接数 &lt;property name="minConnectionsPerPartition" </div><div class="line">		value="5" /&gt; &lt;/bean&gt; --&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 配置连接池 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"masterDataSource"</span> <span class="attr">class</span>=<span class="string">"com.jolbox.bonecp.BoneCPDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据库驱动 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.master.driver&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 相应驱动的jdbcUrl --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.master.url&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据库的用户名 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.master.username&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据库的密码 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.master.password&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 检查数据库连接池中空闲连接的间隔时间，单位是分，默认值：240，如果要取消则设置为0 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"idleConnectionTestPeriod"</span> <span class="attr">value</span>=<span class="string">"60"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 连接池中未使用的链接最大存活时间，单位是分，默认值：60，如果要永远存活设置为0 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"idleMaxAge"</span> <span class="attr">value</span>=<span class="string">"30"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 每个分区最大的连接数 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxConnectionsPerPartition"</span> <span class="attr">value</span>=<span class="string">"150"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 每个分区最小的连接数 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minConnectionsPerPartition"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 配置连接池 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"slave01DataSource"</span> <span class="attr">class</span>=<span class="string">"com.jolbox.bonecp.BoneCPDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据库驱动 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.slave01.driver&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 相应驱动的jdbcUrl --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.slave01.url&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据库的用户名 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.slave01.username&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据库的密码 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.slave01.password&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 检查数据库连接池中空闲连接的间隔时间，单位是分，默认值：240，如果要取消则设置为0 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"idleConnectionTestPeriod"</span> <span class="attr">value</span>=<span class="string">"60"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 连接池中未使用的链接最大存活时间，单位是分，默认值：60，如果要永远存活设置为0 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"idleMaxAge"</span> <span class="attr">value</span>=<span class="string">"30"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 每个分区最大的连接数 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxConnectionsPerPartition"</span> <span class="attr">value</span>=<span class="string">"150"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 每个分区最小的连接数 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minConnectionsPerPartition"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义数据源，使用自己实现的数据源 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.taotao.manage.datasource.DynamicDataSource"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 设置多个数据源 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetDataSources"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">map</span> <span class="attr">key-type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">				<span class="comment">&lt;!-- 这个key需要和程序中的key一致 --&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"master"</span> <span class="attr">value-ref</span>=<span class="string">"masterDataSource"</span> /&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"slave"</span> <span class="attr">value-ref</span>=<span class="string">"slave01DataSource"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 设置默认的数据源，这里默认走写库 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultTargetDataSource"</span> <span class="attr">ref</span>=<span class="string">"masterDataSource"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="2-1-4-spring整合rabbitmq文件applicationContext-rabbitmq-xml"><a href="#2-1-4-spring整合rabbitmq文件applicationContext-rabbitmq-xml" class="headerlink" title="2.1.4 spring整合rabbitmq文件applicationContext-rabbitmq.xml"></a>2.1.4 spring整合rabbitmq文件applicationContext-rabbitmq.xml</h5><h6 id="2-1-4-1-加入spring-rabbit-1-4-xsd引用"><a href="#2-1-4-1-加入spring-rabbit-1-4-xsd引用" class="headerlink" title="2.1.4.1 加入spring-rabbit-1.4.xsd引用"></a>2.1.4.1 加入spring-rabbit-1.4.xsd引用</h6><p>为xml文件添加引用头文件<br>找到Add XML Catalog Element：<br>user specified entries 点击添加<br>Location:spring-rabbit-1.4.xsd文件路径<br>Key Type:Schema location<br>Key:<a href="http://www.springframework.org/schema/rabbit/spring-rabbit-1.4.xsd" target="_blank" rel="external">http://www.springframework.org/schema/rabbit/spring-rabbit-1.4.xsd</a><br>导入xsd文件后，有关rabbitmq的配置就会有提示。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:rabbit</span>=<span class="string">"http://www.springframework.org/schema/rabbit"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/rabbit</span></div><div class="line">	http://www.springframework.org/schema/rabbit/spring-rabbit-1.4.xsd</div><div class="line">	http://www.springframework.org/schema/beans</div><div class="line">	http://www.springframework.org/schema/beans/spring-beans-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义RabbitMQ的连接工厂 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span></span></div><div class="line">		<span class="attr">host</span>=<span class="string">"$&#123;rabbitmq.host&#125;"</span> <span class="attr">port</span>=<span class="string">"$&#123;rabbitmq.port&#125;"</span> <span class="attr">username</span>=<span class="string">"$&#123;rabbitmq.username&#125;"</span></div><div class="line">		<span class="attr">password</span>=<span class="string">"$&#123;rabbitmq.password&#125;"</span> <span class="attr">virtual-host</span>=<span class="string">"$&#123;rabbitmq.vhost&#125;"</span> /&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义管理 用于声明交换机 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">rabbit:admin</span> <span class="attr">connection-factory</span>=<span class="string">"connectionFactory"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义交换机持久化并自动声明的交换机,自动声明并不是在tomcat启动时声明，而是在使用中没有交换机时才声明，这时登录rabbitmq就会看到taotao-item_exchange交换机已创建 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">"taotao-item_exchange"</span></span></div><div class="line">		<span class="attr">durable</span>=<span class="string">"true"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span> /&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义模板 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">rabbit:template</span> <span class="attr">id</span>=<span class="string">"template"</span> <span class="attr">connection-factory</span>=<span class="string">"connectionFactory"</span></span></div><div class="line">		<span class="attr">exchange</span>=<span class="string">"taotao-item_exchange"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h6 id="2-1-4-2-注入RabbitTemplate"><a href="#2-1-4-2-注入RabbitTemplate" class="headerlink" title="2.1.4.2 注入RabbitTemplate"></a>2.1.4.2 注入RabbitTemplate</h6><p>spring整合rabbitmq文件配置成功后，在业务实现类里可直接注入RabbitTemplate。<br>通过交换机给其他系统发送消息，通配符模式示意图：<br><img src="https://volc1605.github.io/images/rabbitmq/t.png" alt="t"></p>
<p>业务处理类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"><span class="keyword">import</span> com.github.abel533.entity.Example;</div><div class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</div><div class="line"><span class="keyword">import</span> com.github.pagehelper.PageInfo;</div><div class="line"><span class="keyword">import</span> com.taotao.common.service.ApiService;</div><div class="line"><span class="keyword">import</span> com.taotao.manage.mapper.ItemMapper;</div><div class="line"><span class="keyword">import</span> com.taotao.manage.pojo.Item;</div><div class="line"><span class="keyword">import</span> com.taotao.manage.pojo.ItemDesc;</div><div class="line"><span class="keyword">import</span> com.taotao.manage.pojo.ItemParamItem;</div><div class="line"></div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemService</span> <span class="keyword">extends</span> <span class="title">BaseService</span>&lt;<span class="title">Item</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 在service中springmvc自动开启事物管理</span></div><div class="line">    <span class="comment">// 事物具有传播性，itemMDescService存在于ItemService中，所以说他们执行的方法在同一个事物中</span></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ItemDescService iteMDescService;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ItemParamItemService itemParamItemService;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ItemMapper itemMapper;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> ApiService apiService;</div><div class="line"></div><div class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;TAOTAO_WEB_UTL&#125;"</span>)</div><div class="line">    <span class="keyword">private</span> String TAOTAO_WEB_UTL;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper MAPPER = <span class="keyword">new</span> ObjectMapper();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveItem</span><span class="params">(Item item, String desc, String itemParams)</span> </span>&#123;</div><div class="line">	<span class="comment">// 设置初始值</span></div><div class="line">	item.setStatus(<span class="number">1</span>);</div><div class="line">	item.setId(<span class="keyword">null</span>); <span class="comment">// 安全考虑，强制设置id为null</span></div><div class="line">	<span class="keyword">super</span>.save(item);</div><div class="line">	ItemDesc ite = <span class="keyword">new</span> ItemDesc();</div><div class="line">	ite.setItemId(item.getId());</div><div class="line">	ite.setItemDesc(desc);</div><div class="line">	iteMDescService.save(ite);</div><div class="line">	<span class="comment">// 保存规格参数数据</span></div><div class="line">	ItemParamItem itemParamItem = <span class="keyword">new</span> ItemParamItem();</div><div class="line">	itemParamItem.setItemId(item.getId());</div><div class="line">	itemParamItem.setParamData(itemParams);</div><div class="line">	<span class="keyword">this</span>.itemParamItemService.save(itemParamItem);</div><div class="line"></div><div class="line">	<span class="comment">// 发送消息</span></div><div class="line">	sendMsg(item.getId(), <span class="string">"insert"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Title</span> queryPageList</div><div class="line">     * <span class="doctag">@Description</span> TODO</div><div class="line">     * <span class="doctag">@param</span> page</div><div class="line">     * <span class="doctag">@param</span> rows void</div><div class="line">     * <span class="doctag">@throws</span> </div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> PageInfo&lt;Item&gt; <span class="title">queryPageList</span><span class="params">(Integer page, Integer rows)</span> </span>&#123;</div><div class="line">	Example example = <span class="keyword">new</span> Example(Item.class);</div><div class="line">	example.setOrderByClause(<span class="string">"updated DESC"</span>);</div><div class="line">	<span class="comment">// 设置分页参数 一定要放在查询前面</span></div><div class="line">	PageHelper.startPage(page, rows);</div><div class="line">	List&lt;Item&gt; list = itemMapper.selectByExample(example);</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> PageInfo&lt;Item&gt;(list);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Title</span> updateItem</div><div class="line">     * <span class="doctag">@Description</span> 修改商品</div><div class="line">     * <span class="doctag">@param</span> item</div><div class="line">     * <span class="doctag">@param</span> desc void</div><div class="line">     * <span class="doctag">@throws</span> </div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateItem</span><span class="params">(Item item, String desc, String itemParams)</span> </span>&#123;</div><div class="line">	<span class="comment">// 强制设置不能修改的字段为null</span></div><div class="line">	item.setStatus(<span class="keyword">null</span>);</div><div class="line">	item.setCreated(<span class="keyword">null</span>);</div><div class="line">	<span class="keyword">super</span>.updateSelective(item); <span class="comment">// 选择不为null的字段作为修改</span></div><div class="line">	<span class="comment">// 修改商品描述数据</span></div><div class="line">	ItemDesc itemDesc = <span class="keyword">new</span> ItemDesc();</div><div class="line">	itemDesc.setItemId(item.getId());</div><div class="line">	itemDesc.setItemDesc(desc);</div><div class="line">	<span class="keyword">this</span>.iteMDescService.updateSelective(itemDesc);</div><div class="line">	<span class="comment">// 修改商品对应的规格参数</span></div><div class="line">	<span class="keyword">this</span>.itemParamItemService.udpateItemParamItem(item.getId(), itemParams);</div><div class="line"></div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 通知前台系统其他系统商品已经更新了(调用前台对缓存的处理接口，这里前台是直接删除缓存的)</div><div class="line">	 * 在service中不能trycatch，如果捕获异常了，就会影响事物的回滚</div><div class="line">	 * 但是这里的逻辑是不属于正常逻辑的一部分(不需要事物回滚)，这里可以trycatch</div><div class="line">	 */</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * try &#123; String url = TAOTAO_WEB_UTL + "/item/cache/" + item.getId() +</div><div class="line">	 * ".html"; this.apiService.doPost(url, null); &#125; catch (Exception e) &#123;</div><div class="line">	 * e.printStackTrace(); &#125;</div><div class="line">	 */</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 使用rabbitmq消息队列通知前台，代替上面的功能</div><div class="line">	 */</div><div class="line">	sendMsg(item.getId(), <span class="string">"update"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(Long itemId, String type)</span> </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    Map&lt;String, Object&gt; msg = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">	    msg.put(<span class="string">"itemId"</span>, itemId);</div><div class="line">	    msg.put(<span class="string">"type"</span>, type);</div><div class="line">	    msg.put(<span class="string">"date"</span>, System.currentTimeMillis()); <span class="comment">// 当前时间戳</span></div><div class="line">	    <span class="comment">// 参数：1.使用通配符方式通知 2.数据以jso格式传输</span></div><div class="line">	    <span class="keyword">this</span>.rabbitTemplate.convertAndSend(<span class="string">"item."</span> + type, MAPPER.writeValueAsString(msg));</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="2-2-前台系统"><a href="#2-2-前台系统" class="headerlink" title="2.2 前台系统"></a>2.2 前台系统</h4><p>1.引入jar包<br>2.rabbitmq.properties属性文件<br>3.初始化rabbitmq.properties属性文件applicationContext-rabbitmq.xml<br>4.spring整合rabbitmq文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:rabbit</span>=<span class="string">"http://www.springframework.org/schema/rabbit"</span></span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/rabbit</span></div><div class="line">	http://www.springframework.org/schema/rabbit/spring-rabbit-1.4.xsd</div><div class="line">	http://www.springframework.org/schema/beans</div><div class="line">	http://www.springframework.org/schema/beans/spring-beans-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义RabbitMQ的连接工厂 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span> <span class="attr">host</span>=<span class="string">"$&#123;rabbitmq.host&#125;"</span> <span class="attr">port</span>=<span class="string">"$&#123;rabbitmq.port&#125;"</span> <span class="attr">username</span>=<span class="string">"$&#123;rabbitmq.username&#125;"</span> <span class="attr">password</span>=<span class="string">"$&#123;rabbitmq.password&#125;"</span></span></div><div class="line">		<span class="attr">virtual-host</span>=<span class="string">"$&#123;rabbitmq.vhost&#125;"</span> /&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义管理 用于声明交换机 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">rabbit:admin</span> <span class="attr">connection-factory</span>=<span class="string">"connectionFactory"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义队列 ,一个持久化自动声明的队列 ，需要绑定后台系统(taotao-manage-web)创建的交换机，这种绑定要人工维护实现(设置权限更灵活) --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">name</span>=<span class="string">"taotao-web-item-queue"</span> <span class="attr">durable</span>=<span class="string">"true"</span> <span class="attr">auto-declare</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 定义消费者 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"itemMQHandler"</span> <span class="attr">class</span>=<span class="string">"com.taotao.web.mq.handler.ItemMQHandler"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 创建监听 ,消费者监听队列 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">rabbit:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">"connectionFactory"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">"itemMQHandler"</span> <span class="attr">method</span>=<span class="string">"excute"</span> <span class="attr">queue-names</span>=<span class="string">"taotao-web-item-queue"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">rabbit:listener-container</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>5.消费者监听队列处理类<br>ItemMQHandler<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"><span class="keyword">import</span> com.taotao.common.service.RedisService;</div><div class="line"><span class="keyword">import</span> com.taotao.web.service.ItemService;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> ItemMQHandler</div><div class="line"> * <span class="doctag">@Author</span> volc</div><div class="line"> * <span class="doctag">@Description</span> rabbitmq监听， 用于处理监听到的消息</div><div class="line"> * <span class="doctag">@Date</span> 2017年3月2日 下午2:34:37</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemMQHandler</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper MAPPER = <span class="keyword">new</span> ObjectMapper();</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> RedisService redisService;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@MethodName</span> excute</div><div class="line">     * <span class="doctag">@Author</span> volc</div><div class="line">     * <span class="doctag">@Description</span> 处理后台发送的消息，这里捕获到rabbitmq进行处理</div><div class="line">     * <span class="doctag">@Date</span> 2017年3月2日 下午2:50:31</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">excute</span><span class="params">(String message)</span> </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    JsonNode jsonNode = MAPPER.readTree(message);</div><div class="line">	    Long itemId = jsonNode.get(<span class="string">"itemId"</span>).asLong();</div><div class="line">	    String key = ItemService.REDIS_KEY + itemId;</div><div class="line">	    <span class="keyword">this</span>.redisService.del(key);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>6.<a href="#jump">队列和交换机绑定</a></p>
<h3 id="2-Linux下安装RabbitMQ"><a href="#2-Linux下安装RabbitMQ" class="headerlink" title="2 Linux下安装RabbitMQ"></a>2 Linux下安装RabbitMQ</h3><h4 id="1、安装Erlang"><a href="#1、安装Erlang" class="headerlink" title="1、安装Erlang"></a>1、安装Erlang</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># 方式一</div><div class="line">cd /usr/local/src/</div><div class="line">mkdir rabbitmq</div><div class="line">cd rabbitmq</div><div class="line"></div><div class="line">wget http://packages.erlang-solutions.com/erlang-solutions-1.0-1.noarch.rpm</div><div class="line">rpm -Uvh erlang-solutions-1.0-1.noarch.rpm</div><div class="line"></div><div class="line">rpm --import http://packages.erlang-solutions.com/rpm/erlang_solutions.asc</div><div class="line"></div><div class="line">sudo yum install erlang</div><div class="line"># 方式二(推荐使用)</div><div class="line">上传：esl-erlang_17.3-1~centos~6_amd64.rpm</div><div class="line">执行 yum install esl-erlang_17.3-1~centos~6_amd64.rpm</div><div class="line">上传：esl-erlang-compat-R14B-1.el6.noarch.rpm</div><div class="line">yum install esl-erlang-compat-R14B-1.el6.noarch.rpm</div></pre></td></tr></table></figure>
<h4 id="2、安装RabbitMQ"><a href="#2、安装RabbitMQ" class="headerlink" title="2、安装RabbitMQ"></a>2、安装RabbitMQ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mkdir /user/local/src/rabbitmq/</div><div class="line">cd /user/local/src/rabbitmq/</div><div class="line"># 上传rabbitmq-server-3.4.1-1.noarch.rpm安装文件</div><div class="line">rz</div><div class="line"># 安装命令</div><div class="line">rpm -ivh rabbitmq-server-3.4.1-1.noarch.rpm</div><div class="line"># rabbitmq服务命令</div><div class="line">cd /user/local/src/rabbitmq/</div><div class="line">service rabbitmq-server start</div><div class="line">service rabbitmq-server stop</div><div class="line">service rabbitmq-server restart</div><div class="line"># 发现启动很慢，原因是rabbitmq启动时需要获取到主机名称，命令行前面的含义[root@主机名称 rebbitmq]</div><div class="line"># rabbitmq，会执行ping 主机名称 结果ping不到，linux需要配置类似window中的host文件</div><div class="line">vim /etc/hosts</div><div class="line"># 添加一条信息，主机名称为命令行前面[root@主机名称 rebbitmq]中的主机名称</div><div class="line">127.0.0.1 主机名称</div><div class="line"># 保存退出</div><div class="line"># 重新启动rabbitmq服务</div><div class="line">service rabbitmq-server start</div><div class="line"># 启动成功</div></pre></td></tr></table></figure>
<h4 id="3、配置"><a href="#3、配置" class="headerlink" title="3、配置"></a>3、配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">cd /etc/rabbitmq</div><div class="line"># 复制配置文件</div><div class="line">cp /usr/share/doc/rabbitmq-server-3.4.1/rabbitmq.config.example /etc/rabbitmq/</div><div class="line"># mv重命名</div><div class="line">mv rabbitmq.config.example rabbitmq.config</div><div class="line"># 开启普通用户远程访问</div><div class="line">vi /etc/rabbitmq/rabbitmq.config</div><div class="line"># 搜索&#123;loopback_users, []&#125;，去掉前面的%%和后面的, 保存退出</div><div class="line"># 重启rabbitmq服务</div><div class="line">service rabbitmq-server restart</div><div class="line"># 设置开机启动</div><div class="line">chkconfig rabbitmq-server on</div></pre></td></tr></table></figure>
<h4 id="4、开启web界面管理工具"><a href="#4、开启web界面管理工具" class="headerlink" title="4、开启web界面管理工具"></a>4、开启web界面管理工具</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cd /etc/rabbitmq</div><div class="line">rabbitmq-plugins enable rabbitmq_management</div><div class="line">#开放5672和15672两个端口</div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 15672 -j ACCEPT</div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 5672 -j ACCEPT</div><div class="line">/etc/rc.d/init.d/iptables save</div></pre></td></tr></table></figure>
<h4 id="5、创建用户"><a href="#5、创建用户" class="headerlink" title="5、创建用户"></a>5、创建用户</h4><p>浏览器访问，服务器ip+rabbitmq访问端口<br>192.168.10.25:15672<br>默认账号：guest 密码：guest<br>创建用户</p>
<h3 id="3-创建用户绑定交换机"><a href="#3-创建用户绑定交换机" class="headerlink" title="3 创建用户绑定交换机"></a>3 <span id="jump">创建用户绑定交换机</span></h3><p>本地登录地址：<a href="http://127.0.0.1:15672" target="_blank" rel="external">http://127.0.0.1:15672</a><br><!-- ![rabbitmq](https://volc1605.github.io/images/rabbitmq/login.PNG) --><br><img src="https://volc1605.github.io/images/rabbitmq/login.PNG" alt="rabbitmq"><br>1、创建普通用户<br>rabbitmq默认账户为：guest 密码：guest，拥有最高权限，这里需要创建普通权限的用户<br><img src="https://volc1605.github.io/images/rabbitmq/create.gif" alt="rabbitmq"><br>2、为用户添加Virtual Hosts访问权限<br><img src="https://volc1605.github.io/images/rabbitmq/createv.gif" alt="rabbitmq"><br>3、监听队列绑定交换机，实现数据同步。<br>1) 后台系统声明交换机(定义交换机持久化并自动声明的交换机,自动声明并不是在tomcat启动时声明，而是在使用中没有交换机时才声明)。<br>2) 其他系统定义队列(一个持久化自动声明的队列 ，需要绑定后台系统(taotao-manage-web)创建的交换机，这种绑定要人工维护实现(设置权限更灵活))。<br>3) 当后台数据改变时，会发送一个消息给队列，其他系统监听队列是否有消息存在，如果有消息在本系统进行处理。</p>
<p>使用projectname账户登录rabbitmq后台，进行绑定：<br>1.选择后台创的交换机taotao-item_exchange<br>2.在Bindings添加前台创建的队列taotao-web-item-queue<br>3.指定通配符，监听处理选择<br>    搜索系统需要获取数据的更新，删除和添加消息<br>    taotao-web前台系统需要获取数据的更新和删除消息<br>整体流程：<br>    当后台(生产者)发送消息给交换机(该交换机是后台创建)，该交换机通配符将消息传递给绑定该交换机的指定的队列(该队列是前台系统创建)，前台的监听会捕获自己队列中的消息交给com.taotao.web.mq.handler.ItemMQHandler进行处理(消费者)。<br><img src="https://volc1605.github.io/images/rabbitmq/binding.gif" alt="rabbitmq"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[linux下安装Redis]]></title>
      <url>https://volc1605.github.io/2017/03/05/linux%E4%B8%8B%E5%AE%89%E8%A3%85Redis/</url>
      <content type="html"><![CDATA[<h3 id="1-linux下安装Redis"><a href="#1-linux下安装Redis" class="headerlink" title="1 linux下安装Redis"></a>1 linux下安装Redis</h3><a id="more"></a>
<h4 id="1、安装依赖"><a href="#1、安装依赖" class="headerlink" title="1、安装依赖"></a>1、安装依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install cpp binutils glibc glibc-kernheaders glibc-common glibc-devel gcc make gcc-c++ libstdc++-devel tcl</div></pre></td></tr></table></figure>
<h4 id="2、安装"><a href="#2、安装" class="headerlink" title="2、安装"></a>2、安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">mkdir -p /usr/local/src/redis</div><div class="line">cd /usr/local/src/redis</div><div class="line">wget http://download.redis.io/releases/redis-2.8.17.tar.gz</div><div class="line"># 或者 rz 回车，从本地上传</div><div class="line">tar -xvf redis-2.8.17.tar.gz</div><div class="line">cd redis-2.8.17</div><div class="line">make</div><div class="line">make test #这个就不要执行了，需要很长时间</div><div class="line">make install</div><div class="line"># 安装成功</div><div class="line">cd /ucenter/soft</div><div class="line">mkdir redis</div><div class="line">cd redis/</div><div class="line"># 复制/user/local/src/redis/redis-3.0.0/redis.conf到当前目录，. 代表当前目录</div><div class="line">cp /user/local/src/redis/redis-3.0.0/redis.conf .</div><div class="line"># 使用redis.conf配置文件启动redis服务</div><div class="line">redis-server redis.conf</div><div class="line"># ctrl + c redis停止，并不是后台启动的，这里要修改redis.conf文件</div><div class="line">vim redis.conf</div><div class="line"># 修改daemonize yes，意思是作为后台启动</div><div class="line"># 启动redis查看进程</div><div class="line">redis-server redis.conf</div><div class="line">ps -ef | grep redis</div><div class="line"># 显示结果为，含有前面的进程号和后面的redis服务使用的端口号6379，启动成功</div><div class="line"># 开放端口号</div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 6379 -j ACCEPT</div><div class="line">/etc/rc.d/init.d/iptables save</div><div class="line">/etc/init.d/iptables status</div></pre></td></tr></table></figure>
<h4 id="3、测试"><a href="#3、测试" class="headerlink" title="3、测试"></a>3、测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /ucenter/soft/redis</div><div class="line"># 使用redis客户端</div><div class="line">redis-cli</div><div class="line">ping</div><div class="line"># 结果为PANG,连接成功</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[solr搜索服务器]]></title>
      <url>https://volc1605.github.io/2017/03/03/solr%E6%90%9C%E7%B4%A2%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      <content type="html"><![CDATA[<h3 id="1-windows下使用solr"><a href="#1-windows下使用solr" class="headerlink" title="1 windows下使用solr"></a>1 windows下使用solr</h3><a id="more"></a>
<h4 id="1-1-解压solr-4-10-2-zip文件"><a href="#1-1-解压solr-4-10-2-zip文件" class="headerlink" title="1.1 解压solr-4.10.2.zip文件"></a>1.1 解压solr-4.10.2.zip文件</h4><p>cmd进入D:\solr-4.10.2\example目录<br>执行启动命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">D:\solr-4.10.2\example&gt;java -jar start.jar</div></pre></td></tr></table></figure></p>
<p>启动成功，浏览器访问<br>访问url: <a href="http://127.0.0.1:8983" target="_blank" rel="external">http://127.0.0.1:8983</a><br>修改D:\solr-4.10.2\example\contexts\solr-jetty-context.xml文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Set name=&quot;contextPath&quot;&gt;&lt;SystemProperty name=&quot;hostContext&quot; default=&quot;/&quot;/&gt;&lt;/Set&gt;</div></pre></td></tr></table></figure></p>
<p>通过nginx代理通过域名客直接访问。</p>
<h4 id="1-2-创建指定的项目solr-core"><a href="#1-2-创建指定的项目solr-core" class="headerlink" title="1.2 创建指定的项目solr core"></a>1.2 创建指定的项目solr core</h4><p>1、    在example目录下创建taotao-solr文件夹；<br>2、    将./solr下的solr.xml拷贝到taotao-solr目录下；<br>3、    在taotao-solr下创建taotao目录，并且在taotao目录下创建conf和data目录；<br>4、    将example\solr\collection1\core.properties文件拷贝到example\taotao-solr\taotao下，并且修改name=taotao；<br>5、    将example\solr\collection1\conf下的schema.xml、solrconfig.xml拷贝到example\taotao-solr\taotao\conf下；<br>6、    修改schema.xml文件，使其配置最小化：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> <span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"example"</span> <span class="attr">version</span>=<span class="string">"1.5"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_version_"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_root_"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">	<span class="comment">&lt;!--</span></div><div class="line">		配置tb_item表中的字段是否加入到solr中</div><div class="line">		字段名称(小驼峰) 类型 是否加索引 是否存储(查询的时候需要这个字段就要存储) 是否必须 是否有多个值</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">required</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"sellPoint"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"image"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"cid"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span>	</div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"status"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"updated"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">uniqueKey</span>&gt;</span>id<span class="tag">&lt;/<span class="name">uniqueKey</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"string"</span> <span class="attr">class</span>=<span class="string">"solr.StrField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"int"</span> <span class="attr">class</span>=<span class="string">"solr.TrieIntField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"long"</span> <span class="attr">class</span>=<span class="string">"solr.TrieLongField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 中文分词器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ik"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span>   </div><div class="line">		<span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span>   </div><div class="line">	<span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">solrQueryParser</span> <span class="attr">defaultOperator</span>=<span class="string">"AND"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>7、修改solrconfig.xml文件，修改一些配置，大部分配置先保持默认：<br>a)    将所有的<lib>标签注释掉；<br>b)    搜索<str name="df">text</str>替换成<str name="df">title</str><br>c)    将<searchcomponent name="elevator" class="solr.QueryElevationComponent"></searchcomponent>这部分注释掉（这个的功能类似百度的竞价排名）<br>8、启动solr：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -Dsolr.solr.home=taotao-solr -jar start.jar</div></pre></td></tr></table></figure></lib></p>
<h4 id="1-3-添加IK中文分词器的支持"><a href="#1-3-添加IK中文分词器的支持" class="headerlink" title="1.3 添加IK中文分词器的支持"></a>1.3 添加IK中文分词器的支持</h4><p>1、    将IKAnalyzer-2012-4x.jar拷贝到example\solr-webapp\webapp\WEB-INF\lib下；<br>2、    在schema.xml文件中添加fieldType：</p>
<fieldtype name="text_ik" class="solr.TextField"><br>     <analyzer class="org.wltea.analyzer.lucene.IKAnalyzer"><br></analyzer></fieldtype>

<h3 id="2-导入项目中需要加入到solr的数据"><a href="#2-导入项目中需要加入到solr的数据" class="headerlink" title="2 导入项目中需要加入到solr的数据"></a>2 导入项目中需要加入到solr的数据</h3><p>需要使用solr搜索服务的数据应先存放到solr中。<br>解析数据参考：<a href="http://volcfamily.cn/2017/05/16/fastJson%E8%A7%A3%E6%9E%90json%E5%AD%97%E7%AC%A6%E4%B8%B2/" target="_blank" rel="external">jackson解析字符串</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</div><div class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</div><div class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</div><div class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</div><div class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</div><div class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.HttpSolrServer;</div><div class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.XMLResponseParser;</div><div class="line"><span class="keyword">import</span> org.junit.Before;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</div><div class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class="line"><span class="keyword">import</span> cn.itcast.solrj.pojo.Item;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemDataImportTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> HttpSolrServer httpSolrServer;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper MAPPER = <span class="keyword">new</span> ObjectMapper();</div><div class="line"></div><div class="line">    <span class="meta">@Before</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	<span class="comment">// 在url中指定core名称：taotao</span></div><div class="line">	<span class="comment">// http://solr.taotao.com/#/taotao -- 界面操作</span></div><div class="line">	String url = <span class="string">"http://solr.taotao.com/taotao"</span>; <span class="comment">// 服务地址</span></div><div class="line">	HttpSolrServer httpSolrServer = <span class="keyword">new</span> HttpSolrServer(url); <span class="comment">// 定义solr的server</span></div><div class="line">	httpSolrServer.setParser(<span class="keyword">new</span> XMLResponseParser()); <span class="comment">// 设置响应解析器</span></div><div class="line">	httpSolrServer.setMaxRetries(<span class="number">1</span>); <span class="comment">// 设置重试次数，推荐设置为1</span></div><div class="line">	httpSolrServer.setConnectionTimeout(<span class="number">500</span>); <span class="comment">// 建立连接的最长时间</span></div><div class="line"></div><div class="line">	<span class="keyword">this</span>.httpSolrServer = httpSolrServer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testData</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	<span class="comment">// 通过后台系统的接口查询商品数据</span></div><div class="line">	String url = <span class="string">"http://manage.taotao.com/rest/item?page=&#123;page&#125;&amp;rows=100"</span>;</div><div class="line">	<span class="keyword">int</span> page = <span class="number">1</span>;</div><div class="line">	<span class="keyword">int</span> pageSzie = <span class="number">0</span>;</div><div class="line">	do &#123;</div><div class="line">	    String u = StringUtils.replace(url, <span class="string">"&#123;page&#125;"</span>, <span class="string">""</span> + page);</div><div class="line">	    System.out.println(u);</div><div class="line">	    String jsonData = doGet(u);</div><div class="line">	    JsonNode jsonNode = MAPPER.readTree(jsonData);</div><div class="line">	    String rowsStr = jsonNode.get(<span class="string">"rows"</span>).toString();</div><div class="line">	    List&lt;Item&gt; items = MAPPER.readValue(rowsStr, MAPPER.getTypeFactory().constructCollectionType(List.class, Item.class));</div><div class="line">	    pageSzie = items.size();</div><div class="line">	    <span class="keyword">this</span>.httpSolrServer.addBeans(items);</div><div class="line">	    <span class="keyword">this</span>.httpSolrServer.commit();</div><div class="line">	    page++;</div><div class="line">	&#125; <span class="keyword">while</span> (pageSzie == <span class="number">100</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">doGet</span><span class="params">(String url)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	<span class="comment">// 创建Httpclient对象</span></div><div class="line">	CloseableHttpClient httpclient = HttpClients.createDefault();</div><div class="line"></div><div class="line">	<span class="comment">// 创建http GET请求</span></div><div class="line">	HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</div><div class="line"></div><div class="line">	CloseableHttpResponse response = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// 执行请求</span></div><div class="line">	    response = httpclient.execute(httpGet);</div><div class="line">	    <span class="comment">// 判断返回状态是否为200</span></div><div class="line">	    <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</div><div class="line">		<span class="keyword">return</span> EntityUtils.toString(response.getEntity(), <span class="string">"UTF-8"</span>);</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</div><div class="line">		response.close();</div><div class="line">	    &#125;</div><div class="line">	    httpclient.close();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testData2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//</span></div><div class="line">	Item item = <span class="keyword">new</span> Item();</div><div class="line">	item.setCid(<span class="number">1L</span>);</div><div class="line">	item.setId(<span class="number">111L</span>);</div><div class="line">	item.setImage(<span class="string">"http://image.taotao.com/jd/4ef8861cf6854de9889f3db9b24dc371.jpg"</span>);</div><div class="line">	item.setPrice(<span class="number">299000L</span>);</div><div class="line">	item.setSellPoint(<span class="string">"清仓！仅北京，武汉仓有货！"</span>);</div><div class="line">	item.setStatus(<span class="number">1</span>);</div><div class="line">	item.setTitle(<span class="string">"阿尔卡特 (OT-927) 炭黑 联通3G手机 双卡双待"</span>);</div><div class="line">	item.setUpdated(System.currentTimeMillis());</div><div class="line"></div><div class="line">	<span class="keyword">this</span>.httpSolrServer.addBean(item);</div><div class="line">	<span class="keyword">this</span>.httpSolrServer.commit();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-spring整合solr搜索"><a href="#3-spring整合solr搜索" class="headerlink" title="3 spring整合solr搜索"></a>3 spring整合solr搜索</h3><h4 id="3-1-引入solr客户端jar包solrj"><a href="#3-1-引入solr客户端jar包solrj" class="headerlink" title="3.1 引入solr客户端jar包solrj"></a>3.1 引入solr客户端jar包solrj</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!-- solr客户端 --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.apache.solr&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;solr-solrj&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;4.10.2&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h4 id="3-2-solr-properties属性配置文件"><a href="#3-2-solr-properties属性配置文件" class="headerlink" title="3.2 solr.properties属性配置文件"></a>3.2 solr.properties属性配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">solr.url=http://solr.taotao.com/taotao</div><div class="line">solr.maxRetries=1</div><div class="line">solr.connectionTimeout=500</div></pre></td></tr></table></figure>
<h4 id="3-3-taotao-search-servlet-xml文件中初始化solr-properties文件"><a href="#3-3-taotao-search-servlet-xml文件中初始化solr-properties文件" class="headerlink" title="3.3 taotao-search-servlet.xml文件中初始化solr.properties文件"></a>3.3 taotao-search-servlet.xml文件中初始化solr.properties文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 使用spring自带的占位符替换功能 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</div><div class="line">		<span class="comment">&lt;!-- 允许JVM参数覆盖 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"systemPropertiesModeName"</span> <span class="attr">value</span>=<span class="string">"SYSTEM_PROPERTIES_MODE_OVERRIDE"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 忽略没有找到的资源文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ignoreResourceNotFound"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置资源文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:env.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:httpclient.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:solr.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:rabbitmq.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 扫描包 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.taotao"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="3-4-applicationContext-solr-xml文件spring整合solr文件"><a href="#3-4-applicationContext-solr-xml文件spring整合solr文件" class="headerlink" title="3.4 applicationContext-solr.xml文件spring整合solr文件"></a>3.4 applicationContext-solr.xml文件spring整合solr文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 创建solr对象 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.apache.solr.client.solrj.impl.HttpSolrServer"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"$&#123;solr.url&#125;"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 设置响应解析器 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"parser"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.apache.solr.client.solrj.impl.XMLResponseParser"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 设置重试次数 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxRetries"</span> <span class="attr">value</span>=<span class="string">"$&#123;solr.maxRetries&#125;"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 连接的超时时间 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionTimeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;solr.connectionTimeout&#125;"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="3-5-配置nginx代理"><a href="#3-5-配置nginx代理" class="headerlink" title="3.5 配置nginx代理"></a>3.5 配置nginx代理</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  search.volc.cn;</div><div class="line"></div><div class="line">        #charset koi8-r;</div><div class="line"></div><div class="line">        #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">		proxy_set_header X-Forwarded-Host $host;</div><div class="line">        proxy_set_header X-Forwarded-Server $host;</div><div class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">		proxy_set_header Host $host;</div><div class="line">        location / &#123;</div><div class="line">			proxy_pass http://127.0.0.1:8085;</div><div class="line">			proxy_connect_timeout 600;</div><div class="line">			proxy_read_timeout 600;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="3-6-项目中搜索商品数据的接口-含分页"><a href="#3-6-项目中搜索商品数据的接口-含分页" class="headerlink" title="3.6 项目中搜索商品数据的接口(含分页)"></a>3.6 项目中搜索商品数据的接口(含分页)</h4><p><a href="https://github.com/volc1605/taotao/blob/master/src/taotao-search/trunck/src/main/java/com/taotao/search/controller/SearchController.java" target="_blank" rel="external"><br>    接口访问solr服务接口示例<br></a></p>
<h4 id="3-7-解决乱码问题"><a href="#3-7-解决乱码问题" class="headerlink" title="3.7 解决乱码问题"></a>3.7 解决乱码问题</h4><p>get请求使用spring配置过滤是解决不了的。<br>接口中对数据重新编码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 解决GET前段传入参数的编码格式为utf-8</span></div><div class="line">keyWords = <span class="keyword">new</span> String(keyWords.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</div></pre></td></tr></table></figure></p>
<h3 id="4-Linux下部署搜索项目"><a href="#4-Linux下部署搜索项目" class="headerlink" title="4 Linux下部署搜索项目"></a>4 Linux下部署搜索项目</h3><!-- more -->
<p>修改<br>nginx solr.taotao.com<br>启动solr<br>java -jar start.jar<br>浏览器访问<br>solr.taotao.com/solr</p>
<p>修改D:\solr-4.10.2\example\contexts\solr-jetty-context.xml文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Set name=&quot;contextPath&quot;&gt;&lt;SystemProperty name=&quot;hostContext&quot; default=&quot;/&quot;/&gt;&lt;/Set&gt;</div></pre></td></tr></table></figure></p>
<p>目的是可以solr.taotao.com这样访问</p>
<p>放置独立的搜索项目<br>启动方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd D:\solr-4.10.2\example</div><div class="line">java -Dsolr.solr.home=taotao-solr -s jar start.jar</div></pre></td></tr></table></figure></p>
<p>因为linux系统中有java运行环境，只需要复制本地solr中的D:\solr-4.10.2\example文件夹下的文件和文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">切换到ucenter用户；</div><div class="line">mkdir /ucenter/web/</div><div class="line"># 上传taotao-solr-4.10.1.tar.gz</div><div class="line">rz</div><div class="line"></div><div class="line">tar –xvf taotao-solr-4.10.1.tar.gz</div><div class="line"># 修改/ucenter/web/example目录为/ucenter/web/taotao-solr</div><div class="line">mv example taotao-solr</div><div class="line"></div><div class="line">cd taotao-solr/</div><div class="line"># 启动solr,在linux系统中使用&amp;符号，代表服务在后台运行，ctrl + c后查看进程，solr仍然是启动状态</div><div class="line"># 类似redis中redis.conf里的daemonize yes，意思是作为后台启动配置</div><div class="line">java -Dsolr.solr.home=taotao-solr -jar start.jar &amp;</div><div class="line"># 输出结果有8861，这个就是启动solr的进程号</div><div class="line"># 开放8983solr默认端口号，这里和本地一样是通过nginx代理访问的</div><div class="line"># nginx.conf配置solr访问端口</div><div class="line">server &#123;</div><div class="line">	listen       80;</div><div class="line">	server_name  solr.taotao.com;</div><div class="line"></div><div class="line">	#charset koi8-r;</div><div class="line"></div><div class="line">	#access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">	proxy_set_header X-Forwarded-Host $host;</div><div class="line">	proxy_set_header X-Forwarded-Server $host;</div><div class="line">	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">	proxy_set_header Host $host;</div><div class="line">	location / &#123;</div><div class="line">		proxy_pass http://安装solr所在的服务器ip:8983;</div><div class="line">		proxy_connect_timeout 600;</div><div class="line">		proxy_read_timeout 600;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 8983 -j ACCEPT</div><div class="line">/etc/rc.d/init.d/iptables save</div><div class="line"># 查看solr进程</div><div class="line">ps -ef | grep java</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[无法写入cookie问题]]></title>
      <url>https://volc1605.github.io/2017/03/02/%E6%97%A0%E6%B3%95%E5%86%99%E5%85%A5cookie%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h3 id="1-无法写入cookie原因"><a href="#1-无法写入cookie原因" class="headerlink" title="1 无法写入cookie原因"></a>1 无法写入cookie原因</h3><a id="more"></a>
<p>从request中获取域名为127.0.0.1，这样违反了浏览的安全的原则。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cookie.setDomain(getDomainName(request));</div></pre></td></tr></table></figure></p>
<p>解决方法：<br>nginx配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">   listen       80;</div><div class="line">   server_name  cart.taotao.com;</div><div class="line"></div><div class="line">   #charset koi8-r;</div><div class="line"></div><div class="line">   #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">proxy_set_header X-Forwarded-Host $host;</div><div class="line">   proxy_set_header X-Forwarded-Server $host;</div><div class="line">   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line"># 配置代理头信息,名称为Host 值为$host变量(内置对象)，nginx传给tomcat真正的域名，</div><div class="line"># 而不是http://127.0.0.1:8083。处理设置cookie时域名不符导致存不到cookie的问题</div><div class="line">proxy_set_header Host $host;</div><div class="line">   location / &#123;</div><div class="line">proxy_pass http://127.0.0.1:8086; # tomcat访问地址</div><div class="line">proxy_connect_timeout 600;</div><div class="line">proxy_read_timeout 600;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>总结：<br>二级域名可以将cookie写入到主域名下，a.taotao.com -&gt; taotao.com<br>二级域名之间不能互相写入，a.taotao.com 不能写入到 b.taotao.com</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[电视剧]]></title>
      <url>https://volc1605.github.io/2017/02/21/%E7%94%B5%E8%A7%86%E5%89%A7/</url>
      <content type="html"><![CDATA[<h3 id="2-the-walking-dead"><a href="#2-the-walking-dead" class="headerlink" title="2 the walking dead"></a>2 the walking dead</h3><p>S07<br>链接:<a href="http://pan.baidu.com/s/1jIlxPOy" target="_blank" rel="external">http://pan.baidu.com/s/1jIlxPOy</a> 密码:53nr</p>
<h3 id="1-this-is-us"><a href="#1-this-is-us" class="headerlink" title="1 this is us"></a>1 this is us</h3><p>S01<br>链接: <a href="http://pan.baidu.com/s/1nvfmydb" target="_blank" rel="external">http://pan.baidu.com/s/1nvfmydb</a> 密码: 53d9<br><img src="https://volc1605.github.io/images/电影/jitang.gif" alt="鸡汤"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[电影]]></title>
      <url>https://volc1605.github.io/2017/02/21/%E7%94%B5%E5%BD%B1/</url>
      <content type="html"></content>
    </entry>
    
    <entry>
      <title><![CDATA[音乐]]></title>
      <url>https://volc1605.github.io/2017/02/21/%E9%9F%B3%E4%B9%90/</url>
      <content type="html"></content>
    </entry>
    
    <entry>
      <title><![CDATA[按月份水平分表思路]]></title>
      <url>https://volc1605.github.io/2017/02/21/%E6%8C%89%E6%9C%88%E4%BB%BD%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A1%A8%E6%80%9D%E8%B7%AF/</url>
      <content type="html"><![CDATA[<h3 id="1-初始化判断当月表是否存在，不存在侧获取上一个月的表的自增主键ID，创建当月表，自增ID为获取到的ID-1"><a href="#1-初始化判断当月表是否存在，不存在侧获取上一个月的表的自增主键ID，创建当月表，自增ID为获取到的ID-1" class="headerlink" title="1 初始化判断当月表是否存在，不存在侧获取上一个月的表的自增主键ID，创建当月表，自增ID为获取到的ID+1"></a>1 初始化判断当月表是否存在，不存在侧获取上一个月的表的自增主键ID，创建当月表，自增ID为获取到的ID+1</h3><a id="more"></a>
<h4 id="1-1-查询上个月的表的自增ID-并创建当月表"><a href="#1-1-查询上个月的表的自增ID-并创建当月表" class="headerlink" title="1.1 查询上个月的表的自增ID,并创建当月表"></a>1.1 查询上个月的表的自增ID,并创建当月表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select max(id) from table_name</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">private function AutoCreate_Table( $Auto_increment )</div><div class="line">    &#123;</div><div class="line">        $CreateSQL = "</div><div class="line">            CREATE TABLE `&#123;$this -&gt;Month_TableName_Now&#125;` (</div><div class="line">              `f_parcel_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '包裹ID',</div><div class="line">              `f_exp_id` int(11) DEFAULT '0' COMMENT '快递员ID',</div><div class="line">              PRIMARY KEY (`f_parcel_id`),</div><div class="line">              KEY `f_parcel_status` (`f_parcel_status`)</div><div class="line">            ) ENGINE=InnoDB AUTO_INCREMENT=&#123;$Auto_increment&#125; DEFAULT CHARSET=utf8 COMMENT='包裹数据分表';</div><div class="line">        ";</div><div class="line">        //创建表</div><div class="line">        return ( new \Think\Model() ) -&gt;execute( $CreateSQL );</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="1-2-判断上一个月的表是否存在，如果不存在把主表作为第二张要关联的表，如果存在就把上个月的表作为第二关联的表-默认关联两个月数据"><a href="#1-2-判断上一个月的表是否存在，如果不存在把主表作为第二张要关联的表，如果存在就把上个月的表作为第二关联的表-默认关联两个月数据" class="headerlink" title="1.2 判断上一个月的表是否存在，如果不存在把主表作为第二张要关联的表，如果存在就把上个月的表作为第二关联的表(默认关联两个月数据)"></a>1.2 判断上一个月的表是否存在，如果不存在把主表作为第二张要关联的表，如果存在就把上个月的表作为第二关联的表(默认关联两个月数据)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-- 查询xm170204数据库中的表名含有当月时间的表全名</div><div class="line">select table_name from information_schema.tables where table_schema=&apos;xm170204&apos; and table_name like &apos;%1701%&apos;;</div></pre></td></tr></table></figure>
<h3 id="2-按使用场景构造所需sql，用于操作数据"><a href="#2-按使用场景构造所需sql，用于操作数据" class="headerlink" title="2 按使用场景构造所需sql，用于操作数据"></a>2 按使用场景构造所需sql，用于操作数据</h3><h3 id="3-封装通用的方法用于操作分表数据"><a href="#3-封装通用的方法用于操作分表数据" class="headerlink" title="3 封装通用的方法用于操作分表数据"></a>3 封装通用的方法用于操作分表数据</h3>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[MyBatis批量]]></title>
      <url>https://volc1605.github.io/2017/02/21/MyBatis%E6%89%B9%E9%87%8F/</url>
      <content type="html"><![CDATA[<h3 id="1-Mybatis批量更新出现的问题"><a href="#1-Mybatis批量更新出现的问题" class="headerlink" title="1.Mybatis批量更新出现的问题"></a>1.Mybatis批量更新出现的问题</h3><a id="more"></a>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"importStationDataFromExcel"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">open</span>=<span class="string">""</span></span></div><div class="line">			<span class="attr">close</span>=<span class="string">""</span> <span class="attr">separator</span>=<span class="string">";"</span>&gt;</div><div class="line">			update tp_user u set u.f_station_name = #&#123;item.fStationName&#125; where u.f_user_id = #&#123;item.fUserId&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></div></pre></td></tr></table></figure>
<p>组织sql语句，在赋值时报错，sql语句错误<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">### SQL: update tp_user     SET f_station_name = ?      WHERE f_user_id = ?     ;     update tp_user     SET f_station_name = ?      WHERE f_user_id = ?     ;     update tp_user     SET f_station_name = ?      WHERE f_user_id = ?</div><div class="line">### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Erreur de syntaxe près de 'update tp_user</div><div class="line">			 SET f_station_name = 'nanjing' </div><div class="line">			 WHERE f_use' à la ligne 5</div></pre></td></tr></table></figure></p>
<p>原因：<br>配置的 MySQL jdbc 链接字符串 默认不支持一次性执行多个sql 语句，<br>我们可以在配置文件中链接数据库的url添加一个参数allowMultiQueries=true，代表支持执行多个条sql，问题解决。<br>jdbc.url=jdbc:mysql://192.168.1.2:3/test4?characterEncoding=utf-8&amp;allowMultiQueries=true</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[事件调用存储过程]]></title>
      <url>https://volc1605.github.io/2017/02/17/%E8%A7%A6%E5%8F%91%E5%99%A8%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<h3 id="1-存储过程"><a href="#1-存储过程" class="headerlink" title="1.存储过程"></a>1.存储过程</h3><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"># 删除存在的存储过程</div><div class="line">DROP PROCEDURE IF EXISTS updateParcelStatu_1;</div><div class="line"># 创建存储过程</div><div class="line">CREATE PROCEDURE updateParcelStatu_1() </div><div class="line">BEGIN </div><div class="line">DECLARE sql_1 VARCHAR(1000);</div><div class="line">DECLARE d char(6);</div><div class="line">-- 构建表名 获取前两个月日期 格式201701</div><div class="line">select DATE_FORMAT(DATE_SUB(CURDATE(),INTERVAL 2 MONTH),&apos;%Y%m&apos;) into d;</div><div class="line">-- 两个月以前包裹状态为已到站更新为已提货</div><div class="line">SET sql_1:=CONCAT(&quot;update tp_parcel_info_&quot;,d,&quot; pi SET pi.f_parcel_status = &apos;1&apos; where pi.f_parcel_status = &apos;0&apos; and pi.f_arrive_time &lt; DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 2 MONTH),&apos;%Y%m%d%H%i%s&apos;);&quot;); </div><div class="line"># 执行sql_1SQL语句;</div><div class="line">SET @sqlStr:=sql_1;</div><div class="line">PREPARE stmt FROM @sqlStr;</div><div class="line">EXECUTE stmt;</div><div class="line">END</div><div class="line"></div><div class="line"># 调用存储过程</div><div class="line">call updateParcelStatu_1();</div><div class="line"></div><div class="line"># 获取执行后的sqlStr值</div><div class="line">SELECT @sqlStr;</div></pre></td></tr></table></figure>
<h3 id="2-创建事件"><a href="#2-创建事件" class="headerlink" title="2.创建事件"></a>2.创建事件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">begin</div><div class="line">	call updateParcelStatu_1();</div><div class="line">end</div></pre></td></tr></table></figure>
<p><img src="https://volc1605.github.io/images/触发器调用存储过程/trigger.png" alt="trigger"><br><img src="https://volc1605.github.io/images/触发器调用存储过程/set.png" alt="set"> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 每天凌晨执行</div><div class="line">CREATE EVENT updateInfoStatus </div><div class="line">ON SCHEDULE EVERY 1 DAY STARTS &apos;2017-02-20 01:00:00&apos;</div><div class="line">DO</div><div class="line">call updateParcelStatu_1();</div></pre></td></tr></table></figure>
<h3 id="3-查看事件是否启动"><a href="#3-查看事件是否启动" class="headerlink" title="3.查看事件是否启动"></a>3.查看事件是否启动</h3><p>SHOW VARIABLES LIKE ‘event_scheduler’;<br>启动事件开始执行<br>SET GLOBAL event_scheduler = 1;</p>
<h3 id="4-查看事件信息"><a href="#4-查看事件信息" class="headerlink" title="4.查看事件信息"></a>4.查看事件信息</h3><p>SHOW EVENTS</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[mysql分组按条件获取数据]]></title>
      <url>https://volc1605.github.io/2017/02/16/mysql%E5%88%86%E7%BB%84%E6%8C%89%E6%9D%A1%E4%BB%B6%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE/</url>
      <content type="html"><![CDATA[<p>1.查询含有两个及以上的圆通包裹的所有站点信息，并获取最近的两个包裹运单号运单的站点信息<br>参考：<a href="http://www.cnblogs.com/joeblackzqq/p/4334132.html" target="_blank" rel="external">http://www.cnblogs.com/joeblackzqq/p/4334132.html</a></p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">SELECT ttt.f_station_id,</div><div class="line">       ttt.f_station_name,</div><div class="line">       group_concat(ttt.f_mail_no) 运单</div><div class="line">FROM</div><div class="line">  (SELECT tt.f_station_id,</div><div class="line">          tt.f_mail_no,</div><div class="line">          u.f_station_name</div><div class="line">   FROM</div><div class="line">     (SELECT a.f_station_id,</div><div class="line">             a.f_mail_no,</div><div class="line">             a.f_arrive_time</div><div class="line">      FROM</div><div class="line">        (SELECT i2.f_parcel_id,</div><div class="line">                i2.f_station_id,</div><div class="line">                i2.f_arrive_time,</div><div class="line">                i2.f_mail_no</div><div class="line">         FROM tp_parcel_info_201608 i2</div><div class="line">         WHERE i2.f_company_id = &apos;108&apos; ) a</div><div class="line">      WHERE 2 &gt;=</div><div class="line">          (SELECT count(1)</div><div class="line">           FROM</div><div class="line">             (SELECT i2.f_parcel_id,</div><div class="line">                     i2.f_station_id,</div><div class="line">                     i2.f_arrive_time,</div><div class="line">                     i2.f_mail_no</div><div class="line">              FROM tp_parcel_info_201608 i2</div><div class="line">              WHERE i2.f_company_id = &apos;108&apos; ) b</div><div class="line">           WHERE a.f_station_id = b.f_station_id</div><div class="line">             AND a.f_arrive_time &lt;= b.f_arrive_time )</div><div class="line">      ORDER BY a.f_station_id,</div><div class="line">               a.f_arrive_time DESC) tt</div><div class="line">   LEFT JOIN tp_user u ON u.f_user_id = tt.f_station_id</div><div class="line">   WHERE tt.f_station_id IN</div><div class="line">   -- 含有两个及以上的圆通包裹数据的所有站点ID,用于排除不满足条件的站点ID</div><div class="line">       (SELECT t.f_station_id</div><div class="line">        FROM</div><div class="line">          (SELECT count(1) c,</div><div class="line">                  pi.f_station_id</div><div class="line">           FROM tp_parcel_info_201608 pi</div><div class="line">           WHERE pi.f_company_id = &apos;108&apos;</div><div class="line">           GROUP BY pi.f_station_id) t</div><div class="line">        WHERE t.c &gt; 2 ) ) ttt</div><div class="line">GROUP BY ttt.f_station_id</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[视图]]></title>
      <url>https://volc1605.github.io/2017/02/06/%E8%A7%86%E5%9B%BE/</url>
      <content type="html"><![CDATA[<h3 id="1-MySQL视图"><a href="#1-MySQL视图" class="headerlink" title="1.MySQL视图"></a>1.MySQL视图</h3><a id="more"></a>
<h4 id="1-1-视图的使用条件"><a href="#1-1-视图的使用条件" class="headerlink" title="1.1 视图的使用条件"></a>1.1 视图的使用条件</h4><p>如果某个查询结果出现的非常频繁，就是要经常拿这个查询结果来做子查询，使用视图会更加方便。</p>
<h3 id="2-使用视图的好处"><a href="#2-使用视图的好处" class="headerlink" title="2.使用视图的好处"></a>2.使用视图的好处</h3><p>a、简化查询语句<br>b、可以进行权限控制<br>把表的权限封闭，但是开放相应的视图权限，视图里只开放部分数据列。<br>c、大数据表分表的时候，比如某张表的数据有100万条，那么可以将这张表分成四个视图。<br>按照对id取余计算。</p>
<h3 id="3-存储过程创建视图"><a href="#3-存储过程创建视图" class="headerlink" title="3.存储过程创建视图"></a>3.存储过程创建视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">create PROCEDURE useView()</div><div class="line">BEGIN</div><div class="line">create or replace view tUser2 as select * from t_user;</div><div class="line">select * from tUser2;</div><div class="line">END</div><div class="line">-- 调用</div><div class="line">call useView();</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[触发器]]></title>
      <url>https://volc1605.github.io/2017/02/06/%E8%A7%A6%E5%8F%91%E5%99%A8/</url>
      <content type="html"><![CDATA[<h3 id="1-MySQL触发器"><a href="#1-MySQL触发器" class="headerlink" title="1.MySQL触发器"></a>1.MySQL触发器</h3><p>触发器是一种特殊的存储过程，它在插入，删除或者修改特定表中的数据时触发执行，它比数据库本身标准的功能有更精细和更复杂的数据控制能力。<br>它具有这样的特征：<br>监视地点：一般就是表名<br>监视事件：update/delete/insert<br>触发时间：after/before<br>触发事件：update/delete/insert</p>
<p>他不能直接被调用，是由数据库主动执行。<br><a id="more"></a></p>
<p>建表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">DROP TABLE IF EXISTS tab1;  </div><div class="line">CREATE TABLE tab1(  </div><div class="line">    tab1_id varchar(11)  </div><div class="line">);</div><div class="line">DROP TABLE IF EXISTS tab2;  </div><div class="line">CREATE TABLE tab2(  </div><div class="line">    tab2_id varchar(11)  </div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>创建触发器:t_afterinsert_on_tab1</p>
<p>作用：增加tab1表记录后自动将记录增加到tab2表中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">DROP TRIGGER IF EXISTS t_afterinsert_on_tab1;  </div><div class="line">CREATE TRIGGER t_afterinsert_on_tab1   </div><div class="line">AFTER INSERT ON tab1  </div><div class="line">FOR EACH ROW  </div><div class="line">BEGIN  </div><div class="line">     insert into tab2(tab2_id) values(new.tab1_id);  </div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">INSERT INTO tab1(tab1_id) values(&apos;0001&apos;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM tab1;  </div><div class="line">SELECT * FROM tab2;</div></pre></td></tr></table></figure>
<p>example2:</p>
<p>创建触发器:t_afterdelete_on_tab1</p>
<p>作用：删除tab1表记录后自动将tab2表中对应的记录删去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">DROP TRIGGER IF EXISTS t_afterdelete_on_tab1;  </div><div class="line">CREATE TRIGGER t_afterdelete_on_tab1  </div><div class="line">AFTER DELETE ON tab1  </div><div class="line">FOR EACH ROW  </div><div class="line">BEGIN  </div><div class="line">      delete from tab2 where tab2_id=old.tab1_id;  </div><div class="line">END;</div></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DELETE FROM tab1 WHERE tab1_id=&apos;0001&apos;;</div></pre></td></tr></table></figure></p>
<p>查看结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM tab1;  </div><div class="line">SELECT * FROM tab2;</div></pre></td></tr></table></figure></p>
<p>实例一<br>1.创建存储过程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">DROP PROCEDURE IF EXISTS updateParcelStatu;</div><div class="line">CREATE PROCEDURE updateParcelStatu(IN tableName VARCHAR(30),OUT parcelIdStr VARCHAR(1000)) </div><div class="line">BEGIN </div><div class="line">DECLARE sql_1 VARCHAR(1000);</div><div class="line"># 查询需要修改的包裹状态的包裹ID</div><div class="line">SELECT GROUP_CONCAT(t.f_parcel_id) FROM ( SELECT nr.f_parcel_id FROM tp_parcel_notice_result nr WHERE nr.f_sms_notice = &apos;0&apos; AND nr.f_weixin_notice = &apos;0&apos; AND (now() - nr.f_create_time) &gt; 60000 ) t ORDER BY t.f_parcel_id INTO parcelIdStr;</div><div class="line"># 根据包裹ID更新包裹状态为通知失败</div><div class="line">SET sql_1 = CONCAT(&quot;UPDATE tp_parcel_info_&quot;, tableName, &quot; pi SET pi.f_parcel_status=&apos;5&apos; WHERE pi.f_parcel_id in (&quot;,parcelIdStr,&quot;);&quot;); </div><div class="line">#执行sql_1SQL语句;</div><div class="line">SET @sql_1=sql_1;</div><div class="line">PREPARE stmt FROM @sql_1;</div><div class="line">EXECUTE stmt;</div><div class="line">END</div><div class="line"></div><div class="line">call updateParcelStatu(&apos;201608&apos;,@parcelIdStr);</div><div class="line">SELECT @parcelIdStr;</div><div class="line">SELECT @sql_1;</div></pre></td></tr></table></figure></p>
<p>2.创建事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">begin</div><div class="line">	call updateParcelStatu();</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>3.设置事件为开启状态，执行sql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SET GLOBAL event_scheduler = 1;</div></pre></td></tr></table></figure></p>
<p>4.重启mysql服务</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[JDBC]]></title>
      <url>https://volc1605.github.io/2017/02/06/Jdbc%E5%A4%8D%E4%B9%A0/</url>
      <content type="html"><![CDATA[<h3 id="1-链接数据库工具类"><a href="#1-链接数据库工具类" class="headerlink" title="1.链接数据库工具类"></a>1.链接数据库工具类</h3><a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.bmx.omp.business.util;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.DriverManager;</div><div class="line"><span class="keyword">import</span> java.sql.ResultSet;</div><div class="line"><span class="keyword">import</span> java.sql.SQLException;</div><div class="line"><span class="keyword">import</span> java.sql.Statement;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">JdbcUtils</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String user;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Connection&gt; tl = <span class="keyword">new</span> ThreadLocal&lt;Connection&gt;();</div><div class="line">    <span class="comment">// 将四要素抽取至配置文件</span></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// 读取配置文件 获得四要素</span></div><div class="line">	    String driverClass = <span class="string">"com.mysql.jdbc.Driver"</span>;</div><div class="line">	    url = <span class="string">"jdbc:mysql://999.999.1.1:3306/test?characterEncoding=utf-8"</span>;</div><div class="line">	    user = <span class="string">"root"</span>;</div><div class="line">	    password = <span class="string">"123456"</span>;</div><div class="line">	    <span class="comment">// 注册驱动</span></div><div class="line">	    Class.forName(driverClass);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> ExceptionInInitializerError(e);</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 获得数据库连接</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">	ThreadLocal&lt;Connection&gt; tl = <span class="keyword">new</span> ThreadLocal&lt;Connection&gt;();</div><div class="line">	<span class="comment">// 返回当前线程绑定的连接 原因是该连接上有事务</span></div><div class="line">	Connection conn = tl.get();</div><div class="line">	<span class="comment">// 如果conn 为 null 说明线程上未绑定连接</span></div><div class="line">	<span class="keyword">if</span> (conn == <span class="keyword">null</span>) &#123;</div><div class="line">	    <span class="comment">// 获得与数据库的连接</span></div><div class="line">	    conn = DriverManager.getConnection(url, user, password);</div><div class="line">	    <span class="comment">// 绑定到当前线程</span></div><div class="line">	    tl.set(conn);</div><div class="line">	&#125;</div><div class="line">	Map&lt;String, Object&gt; m = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">	m.put(<span class="string">"thread"</span>, tl);</div><div class="line">	m.put(<span class="string">"conn"</span>, conn);</div><div class="line">	System.out.println(<span class="string">"创建线程"</span> + tl);</div><div class="line">	System.out.println(<span class="string">"线程绑定的链接"</span> + conn);</div><div class="line">	<span class="keyword">return</span> m;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 开启事务</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startTransaction</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="comment">// 获得当前线程上绑定的连接</span></div><div class="line">	    Map&lt;String, Object&gt; m = getConnection();</div><div class="line">	    Connection conn = (Connection) m.get(<span class="string">"conn"</span>);</div><div class="line">	    <span class="comment">// 开启事务</span></div><div class="line">	    conn.setAutoCommit(<span class="keyword">false</span>);</div><div class="line">	&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 提交事务</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="comment">// 获得当前线程上绑定的连接</span></div><div class="line">	Connection conn = tl.get();</div><div class="line">	<span class="comment">// 判断</span></div><div class="line">	<span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">		<span class="comment">// 如果线程上有连接 提交该连接事务</span></div><div class="line">		conn.commit();</div><div class="line">	    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 回滚事务</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="comment">// 获得当前线程上绑定的连接</span></div><div class="line">	Connection conn = tl.get();</div><div class="line">	<span class="comment">// 判断</span></div><div class="line">	<span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">		<span class="comment">// 如果线程上有连接 回滚事务</span></div><div class="line">		conn.rollback();</div><div class="line">	    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 关闭连接 关闭当前线程上绑定的连接</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="comment">// 获得当前线程上绑定的连接</span></div><div class="line">	Connection conn = tl.get();</div><div class="line">	<span class="comment">// 判断</span></div><div class="line">	<span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">		<span class="comment">// 如果线程上有连接 关闭连接</span></div><div class="line">		conn.close();</div><div class="line">	    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">	    &#125;</div><div class="line">	    <span class="comment">// 移除当前线程绑定的 connnection 对象</span></div><div class="line">	    tl.remove();</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(Connection conn, Statement stmt, ResultSet rs)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">		rs.close();</div><div class="line">	    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">		e.printStackTrace();</div><div class="line">	    &#125;</div><div class="line">	    rs = <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (stmt != <span class="keyword">null</span>) &#123;</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">		stmt.close();</div><div class="line">	    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">		e.printStackTrace();</div><div class="line">	    &#125;</div><div class="line">	    stmt = <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">		conn.close();</div><div class="line">	    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">		e.printStackTrace();</div><div class="line">	    &#125;</div><div class="line">	    conn = <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.使用多线程绑定链接<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">queryParcelThread</span><span class="params">(ParcelBean mi)</span> </span>&#123;</div><div class="line">Map&lt;String, Object&gt; retMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    Map&lt;String, Object&gt; m1 = JdbcUtils.getConnection();</div><div class="line">    Connection connection1 = (Connection) m1.get(<span class="string">"conn"</span>);</div><div class="line">    Map&lt;String, Object&gt; m2 = JdbcUtils.getConnection();</div><div class="line">    Connection connection2 = (Connection) m2.get(<span class="string">"conn"</span>);</div><div class="line">    Map&lt;String, Object&gt; m3 = JdbcUtils.getConnection();</div><div class="line">    Connection connection3 = (Connection) m3.get(<span class="string">"conn"</span>);</div><div class="line">    Statement sta1 = connection1.createStatement();</div><div class="line">    Statement sta2 = connection2.createStatement();</div><div class="line">    Statement sta3 = connection3.createStatement();</div><div class="line">    <span class="comment">// 查询语句</span></div><div class="line">    String sql1 = <span class="string">"select "</span> + <span class="string">"f_parcel_id,f_recipient_name "</span> + <span class="string">"from "</span> + <span class="string">"tp_parcel_info "</span></div><div class="line">	    + <span class="string">"where f_station_id = 293"</span>;</div><div class="line">    String sql2 = <span class="string">"select "</span> + <span class="string">"f_parcel_id,f_recipient_name "</span> + <span class="string">"from "</span> + <span class="string">"tp_parcel_info "</span></div><div class="line">	    + <span class="string">"where f_station_id = 366"</span>;</div><div class="line">    String sql3 = <span class="string">"select "</span> + <span class="string">"f_parcel_id,f_recipient_name "</span> + <span class="string">"from "</span> + <span class="string">"tp_parcel_info "</span></div><div class="line">	    + <span class="string">"where f_station_id = 1002"</span>;</div><div class="line">    Date dt = <span class="keyword">new</span> Date();</div><div class="line">    Long time = dt.getTime();</div><div class="line">    ResultSet rs1 = sta1.executeQuery(sql1);</div><div class="line">    ResultSet rs2 = sta2.executeQuery(sql2);</div><div class="line">    ResultSet rs3 = sta3.executeQuery(sql3);</div><div class="line">    Date dt2 = <span class="keyword">new</span> Date();</div><div class="line">    Long time2 = dt2.getTime();</div><div class="line">    System.out.println(<span class="string">"毫秒数 ："</span> + (time2 - time));</div><div class="line">    System.out.println(sql3);</div><div class="line">    <span class="comment">// while (rs.next()) &#123;</span></div><div class="line">    <span class="comment">// String f_parcel_id = rs.getString(1);</span></div><div class="line">    <span class="comment">// String f_recipient_name = rs.getString(2);</span></div><div class="line">    <span class="comment">// System.out.println(f_parcel_id);</span></div><div class="line">    <span class="comment">// System.out.println(f_recipient_name);</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> retMap;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[MySQL存储过程]]></title>
      <url>https://volc1605.github.io/2017/01/20/MySQL%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<h3 id="1-java调用存储过程"><a href="#1-java调用存储过程" class="headerlink" title="1 java调用存储过程"></a>1 java调用存储过程</h3><a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//	String url = "jdbc:mysql://192.168.1.1:3306/xmbg?characterEncoding=utf-8";</span></div><div class="line"><span class="comment">//	String user = "root";</span></div><div class="line"><span class="comment">//	String password = "yangqiang88";</span></div><div class="line"><span class="comment">//	Connection conn = DriverManager.getConnection(url, user, password);</span></div><div class="line">	Connection conn = dataSource.getConnection();</div><div class="line">	conn.setAutoCommit(<span class="keyword">false</span>);</div><div class="line">	CallableStatement cstmt = conn.prepareCall(<span class="string">"&#123; call test2(?) &#125;"</span>);</div><div class="line">	cstmt.registerOutParameter(<span class="number">1</span>, Types.VARCHAR);</div><div class="line">	cstmt.execute();</div><div class="line">	conn.commit();</div><div class="line">	String testPrint = cstmt.getString(<span class="number">1</span>);</div><div class="line">	System.out.println(<span class="string">"返回值：：：：：： "</span> + testPrint);</div></pre></td></tr></table></figure>
<p>参考：<br><a href="http://blog.csdn.net/evankaka/article/details/47276339" target="_blank" rel="external">http://blog.csdn.net/evankaka/article/details/47276339</a></p>
<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><h4 id="创建表："><a href="#创建表：" class="headerlink" title="创建表："></a>创建表：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">DROP TABLE IF EXISTS `t_user`;</div><div class="line">CREATE TABLE `t_user` (</div><div class="line">  `USER_ID` int(11) NOT NULL AUTO_INCREMENT,</div><div class="line">  `USER_NAME` char(30) NOT NULL,</div><div class="line">  `USER_PASSWORD` char(10) NOT NULL,</div><div class="line">  `USER_EMAIL` char(30) NOT NULL,</div><div class="line">  PRIMARY KEY (`USER_ID`),</div><div class="line">  KEY `IDX_NAME` (`USER_NAME`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">-- ----------------------------</div><div class="line">-- Records of t_user</div><div class="line">-- ----------------------------</div><div class="line">INSERT INTO `t_user` VALUES (&apos;1&apos;, &apos;王小二&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;2&apos;, &apos;葫芦娃&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;3&apos;, &apos;红孩儿&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;4&apos;, &apos;哪儿托&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;5&apos;, &apos;丹童&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;6&apos;, &apos;清风&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;7&apos;, &apos;明月&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;8&apos;, &apos;药童&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;9&apos;, &apos;郓哥&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div><div class="line">INSERT INTO `t_user` VALUES (&apos;10&apos;, &apos;高峰&apos;, &apos;123&apos;, &apos;123@qq.com&apos;);</div></pre></td></tr></table></figure>
<h4 id="带IN的存储过程"><a href="#带IN的存储过程" class="headerlink" title="带IN的存储过程"></a>带IN的存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CREATE  PROCEDURE  SP_SEARCH(IN p_name CHAR(20))  </div><div class="line">BEGIN  </div><div class="line">IF p_name is null or p_name=&apos;&apos; THEN  </div><div class="line">SELECT * FROM t_user;  </div><div class="line">ELSE  </div><div class="line">SELECT * FROM t_user WHERE USER_NAME LIKE p_name;  </div><div class="line">END IF;  </div><div class="line">END</div></pre></td></tr></table></figure>
<p>调用存储过程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CALL SP_SEARCH(&apos;王小二&apos;);</div></pre></td></tr></table></figure></p>
<h3 id="带OUT的存储过程"><a href="#带OUT的存储过程" class="headerlink" title="带OUT的存储过程"></a>带OUT的存储过程</h3><p>根据传入用户名称进行查询，统计次数返回给p_int变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">CREATE  PROCEDURE  SP_SEARCH2(IN p_name CHAR(20),OUT p_int INT)  </div><div class="line">BEGIN  </div><div class="line">IF p_name is null or p_name=&apos;&apos; THEN  </div><div class="line">SELECT * FROM t_user;  </div><div class="line">ELSE  </div><div class="line">SELECT * FROM t_user WHERE USER_NAME LIKE p_name;  </div><div class="line">END IF;  </div><div class="line">SELECT FOUND_ROWS() INTO p_int;  </div><div class="line">END</div></pre></td></tr></table></figure></p>
<p>分别执行调用：<br>查询高字开头的用户信息，定义参数@p_num，用于接收返回值，然后显示返回值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CALL SP_SEARCH2(&apos;高%&apos;,@p_num);</div><div class="line">SELECT @p_num;</div></pre></td></tr></table></figure></p>
<h4 id="带INOUT的存储过程"><a href="#带INOUT的存储过程" class="headerlink" title="带INOUT的存储过程"></a>带INOUT的存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">CREATE PROCEDURE sp_inout(INOUT p_num INT)  </div><div class="line">BEGIN  </div><div class="line">SET p_num=p_num*10;  </div><div class="line">END</div><div class="line"></div><div class="line">-- 调用</div><div class="line">SET @p_num=2;  </div><div class="line">call sp_inout(@p_num);  </div><div class="line">SELECT @p_num;</div></pre></td></tr></table></figure>
<h3 id="存储过程体"><a href="#存储过程体" class="headerlink" title="存储过程体"></a>存储过程体</h3><p>1.局部变量<br>DECLARE var_name,…,… type [DEFAULT value]<br>Var_name:指定局部变量的名称<br>    Declare var1, var2, var3 INT;<br>    Declare cid int(10) [DEFAULT 0];<br>Type:用于声明局部变量的数据类型<br>default子句:用于为局部变量指定一个默认值。若没有指定，默认为null.</p>
<p>使用说明：<br>局部变量只能在存储过程体的begin…end语句块中声明。<br>局部变量必须在存储过程体的开头处声明。<br>局部变量的作用范围仅限于声明它的begin..end语句块，其他语句块中的语句不可以使用它。<br>局部变量不同于用户变量，两者区别：局部变量声明时，在其前面没有使用@符号，并且它只能在begin..end语句块中使用；而用户变量在声明时，会在其名称前面使用@符号，同时已声明的用户变量存在于整个会话之中。</p>
<p>2.set语句<br>使用set语句为局部变量赋值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Set var_name=expr  </div><div class="line">Set cid=910;</div></pre></td></tr></table></figure></p>
<p>3.select … into 语句<br>Select col_name[,…] into var_name[,…] table_expr<br>Col_name:用于指定列名<br>Var_name:用于指定要赋值的变量名<br>Table_expr:表示select语句中的from字句及后面的语法部分<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT sum(f_sms_count) into today_count from tp_user_send_msg_log s where s.f_user_id = uid</div></pre></td></tr></table></figure></p>
<p>说明:存储过程体中的select…into语句返回的结果集只能有一行数据。</p>
<p>4.定义处理程序<br>是事先定义程序执行过程中可能遇到的问题。并且可以在处理程序中定义解决这些问题的办法。这种方式可以提前预测可能出现的问题，并提出解决方法。<br>DECLARE handler_type HANDLER FOR condition_value[,…] sp_statement<br>handler_type:CONTINUE | EXIT | UNDO<br>Condition_value:Sqlwarning | not found | sqlexception </p>
<p>5.流程控制语句</p>
<h4 id="条件判断语句"><a href="#条件判断语句" class="headerlink" title="条件判断语句"></a>条件判断语句</h4><pre><code>If语句:
If search_condition then statement_list  
[elseif search_condition then statement_list]…  
[else statement_list]  
End if 
</code></pre><p>Search_condition参数:条件判断语句<br>Statement_list参数:不同条件的执行语句<br>多重IF的存储过程实例<br>数据准备<br>学生表：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">DROP TABLE IF EXISTS `t_student`;</div><div class="line">CREATE TABLE `t_student` (</div><div class="line">  `STU_ID` int(11) NOT NULL AUTO_INCREMENT,</div><div class="line">  `STU_NAME` char(10) NOT NULL,</div><div class="line">  `STU_CLASS` int(11) NOT NULL,</div><div class="line">  `STU_SEX` char(2) NOT NULL,</div><div class="line">  `STU_AGE` int(11) NOT NULL,</div><div class="line">  PRIMARY KEY (`STU_ID`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">-- ----------------------------</div><div class="line">-- Records of t_student</div><div class="line">-- ----------------------------</div><div class="line">INSERT INTO `t_student` VALUES (&apos;1&apos;, &apos;name1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;2&apos;, &apos;name2&apos;, &apos;2&apos;, &apos;2&apos;, &apos;2&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;3&apos;, &apos;name3&apos;, &apos;3&apos;, &apos;3&apos;, &apos;3&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;4&apos;, &apos;name4&apos;, &apos;4&apos;, &apos;4&apos;, &apos;4&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;5&apos;, &apos;name5&apos;, &apos;5&apos;, &apos;5&apos;, &apos;5&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;6&apos;, &apos;name6&apos;, &apos;6&apos;, &apos;6&apos;, &apos;6&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;7&apos;, &apos;name7&apos;, &apos;7&apos;, &apos;7&apos;, &apos;7&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;8&apos;, &apos;name8&apos;, &apos;8&apos;, &apos;8&apos;, &apos;8&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;9&apos;, &apos;name9&apos;, &apos;9&apos;, &apos;9&apos;, &apos;9&apos;);</div><div class="line">INSERT INTO `t_student` VALUES (&apos;10&apos;, &apos;name10&apos;, &apos;10&apos;, &apos;10&apos;, &apos;10&apos;);</div></pre></td></tr></table></figure></p>
<p>成绩表（STU_ID是学生表是外键关系）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">DROP TABLE IF EXISTS `t_grade`;</div><div class="line">CREATE TABLE `t_grade` (</div><div class="line">  `STU_ID` int(11) NOT NULL,</div><div class="line">  `STU_SCORE` int(11) NOT NULL,</div><div class="line">  KEY `STU_ID` (`STU_ID`),</div><div class="line">  CONSTRAINT `t_grade_ibfk_1` FOREIGN KEY (`STU_ID`) REFERENCES `t_student` (`STU_ID`)</div><div class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">-- ----------------------------</div><div class="line">-- Records of t_grade</div><div class="line">-- ----------------------------</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;1&apos;, &apos;70&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;2&apos;, &apos;80&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;3&apos;, &apos;70&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;4&apos;, &apos;80&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;5&apos;, &apos;70&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;6&apos;, &apos;78&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;7&apos;, &apos;98&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;8&apos;, &apos;78&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;9&apos;, &apos;67&apos;);</div><div class="line">INSERT INTO `t_grade` VALUES (&apos;10&apos;, &apos;75&apos;);</div></pre></td></tr></table></figure></p>
<p>然后写一个存储过程：返回各个分数等级的人<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">CREATE  PROCEDURE SP_SCHOLARSHIP_LEVEL(IN p_level char(1))  </div><div class="line">BEGIN  </div><div class="line">IF p_level =&apos;A&apos;  THEN  </div><div class="line">SELECT * FROM t_grade WHERE STU_SCORE &gt;=90;  </div><div class="line">ELSEIF  p_level =&apos;B&apos;  THEN  </div><div class="line">SELECT * FROM t_grade WHERE STU_SCORE &lt;90 AND  STU_SCORE&gt;=80;  </div><div class="line">ELSEIF  p_level =&apos;C&apos;  THEN  </div><div class="line">SELECT * FROM t_grade WHERE STU_SCORE &lt;80 AND  STU_SCORE&gt;=70;  </div><div class="line">ELSEIF  p_level =&apos;D&apos;  THEN  </div><div class="line">SELECT * FROM t_grade WHERE STU_SCORE &lt;60;  </div><div class="line">ELSE  </div><div class="line">SELECT * FROM t_grade;  </div><div class="line">END IF;  </div><div class="line">END</div></pre></td></tr></table></figure></p>
<p>调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CALL SP_SCHOLARSHIP_LEVEL(&apos;A&apos;);</div></pre></td></tr></table></figure></p>
<p>Case 语句<br>表达形式1<br>Case case_value<br>When when_value then statement_list<br>[When when_value then statement_list]…<br>[else statement_list]<br>End case<br>表达形式2<br>Case<br>When search_condition then statement_list<br>End case </p>
<p>使用范例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">CREATE  PROCEDURE SP_SCHOLARSHIP_LEVEL3(IN p_level char(1))  </div><div class="line">BEGIN  </div><div class="line">DECLARE p_num int DEFAULT  0;  </div><div class="line">CASE p_level  </div><div class="line">WHEN &apos;A&apos;  THEN  </div><div class="line">SET p_num=90;  </div><div class="line">WHEN &apos;B&apos;  THEN  </div><div class="line">SET p_num=80;  </div><div class="line">WHEN &apos;C&apos;  THEN  </div><div class="line">SET p_num=70;  </div><div class="line">WHEN &apos;D&apos;  THEN  </div><div class="line">SET p_num=60;  </div><div class="line">ELSE  </div><div class="line">SET p_num=0;  </div><div class="line">END CASE;  </div><div class="line">SELECT * FROM t_grade g, t_student s WHERE g.STU_ID=s.STU_ID AND g.STU_SCORE &gt;= p_num ;  </div><div class="line">END</div></pre></td></tr></table></figure></p>
<p>调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CALL SP_SCHOLARSHIP_LEVEL3(&apos;d&apos;);</div></pre></td></tr></table></figure></p>
<h4 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h4><h5 id="While语句、repeat语句和loop语句。"><a href="#While语句、repeat语句和loop语句。" class="headerlink" title="While语句、repeat语句和loop语句。"></a>While语句、repeat语句和loop语句。</h5><p>While语句：<br>[begin_label:]<br>while search_condition do<br>Statement_list<br>End while<br>[end_label]</p>
<p>判断条件search_condition是否为真,若为真,则执行statement_list中的语句，然后再进行判断，如若仍然为真则继续循环，直至条件判断不为真时循环结束。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">CREATE PROCEDURE sp_cal(IN p_num INT,OUT p_result INT)  </div><div class="line">BEGIN  </div><div class="line"> SET p_result=1;  </div><div class="line"> WHILE p_num &gt; 1 DO  </div><div class="line">  SET p_result = p_num * p_result;  </div><div class="line">  SET p_num = p_num-1;  </div><div class="line"> END WHILE;  </div><div class="line">END  </div><div class="line">//调用并输出结果  </div><div class="line">CALL sp_cal(5,@result);  </div><div class="line">SELECT @result;</div></pre></td></tr></table></figure>
<h5 id="Repeat语句语法格式"><a href="#Repeat语句语法格式" class="headerlink" title="Repeat语句语法格式"></a>Repeat语句语法格式</h5><p>[begin_label:]<br>repeat<br>Statement_list<br>Until search_condition<br>End repeat<br>[end_label]</p>
<p>Repeat语句首先执行statement_list中的语句，然后判断条件search_condition是否为真，倘若为真，则结束循环，若不为真，继续循环。<br>Repeat先执行后判断，while先判断后执行。<br>使用范例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">CREATE PROCEDURE sp_cal2(IN p_num INT,OUT p_result INT)  </div><div class="line">BEGIN  </div><div class="line">  SET p_result=1;  </div><div class="line">  REPEAT  </div><div class="line">    SET p_result = p_num * p_result;  </div><div class="line">    SET p_num = p_num-1;  </div><div class="line">    UNTIL p_num&lt;=1  </div><div class="line">  END REPEAT;  </div><div class="line">END  </div><div class="line">//调用并输出结果  </div><div class="line">CALL sp_cal2(5,@result);  </div><div class="line">SELECT @result;</div></pre></td></tr></table></figure></p>
<h4 id="调用存储过程"><a href="#调用存储过程" class="headerlink" title="调用存储过程"></a>调用存储过程</h4><p>Call sp_name([parameter[,…]]);<br>Sp_name被调用存储过程的名称<br>Parameter:指定调用存储过程所要使用的参数。</p>
<h4 id="修改存储过程"><a href="#修改存储过程" class="headerlink" title="修改存储过程"></a>修改存储过程</h4><p>Alter procedure proc_name[characteristic…]<br>只能修改存储过程的特征，如果要修改存储过程的内容，可以先删除该存储过程，然后再重新创建</p>
<h3 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h3><p>Drop procedure if exists sp_name; </p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>MySQL中，创建存储函数的基本形式如下：</p>
<p>CREATE FUNCTION sp_name([func_parameter[,…]])<br>RETURNS type<br>[characteristic …] routine_body<br>Return  </p>
<p>子句用于声明存储函数返回值的数据类型。存储过程是用户定义的一系列sql语句的集合，涉及特定表或其它对象的任务，用户可以调用存储过程，而函数通常是数据库已定义的方法，它接收参数并返回某种类型的值并且不涉及特定用户表。<br>调用存储函数<br>Select sp_name([func_parameter…])<br>Select fn_search(2);<br>删除存储函数drop<br>修改存储函数alter 修改存储函数的某些相关特征。</p>
<h4 id="函数使用例子"><a href="#函数使用例子" class="headerlink" title="函数使用例子"></a>函数使用例子</h4><p>比较大小 ，返回大的数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">CREATE FUNCTION sp_cal_max(p_num1 INT,p_num2 INT)  </div><div class="line">RETURNS INT  </div><div class="line">BEGIN  </div><div class="line">IF p_num1 &gt;= p_num2 THEN  </div><div class="line">RETURN p_num1;  </div><div class="line">ELSE  </div><div class="line">RETURN p_num2;  </div><div class="line">END IF;  </div><div class="line">END</div></pre></td></tr></table></figure></p>
<p>报错：you <em>might</em> want to use the less safe log_bin_trust_function_creators variable<br>执行：SET GLOBAL log_bin_trust_function_creators = 1;解决问题</p>
<p>调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SET @p_num1=2;  </div><div class="line">SET @p_num2=34;  </div><div class="line">SELECT sp_cal_max(@p_num1,@p_num2);</div></pre></td></tr></table></figure></p>
<h4 id="存储过程和函数区别"><a href="#存储过程和函数区别" class="headerlink" title="存储过程和函数区别"></a>存储过程和函数区别</h4><p style="fond:red"><br>1）一般来说，存储过程实现的功能要复杂一点，而函数的实现的功能针对性比较强。存储过程，功能强大，可以执行包括修改表等一系列数据库操作；用户定义函数不能用于执行一组修改全局数据库状态的操作。<br>2）对于存储过程来说可以返回参数，如记录集，而函数只能返回值或者表对象。函数只能返回一个变量；而存储过程可以返回多个。存储过程的参数可以有IN,OUT,INOUT三种类型，而函数只能有IN类~~存储过程声明时不需要返回类型，而函数声明时必须描述返回类型，且函数体中必须包含一个有效的RETURN语句。<br>3）存储过程，可以使用非确定函数，不允许在用户定义函数主体中内置非确定函数。<br>4）存储过程一般是作为一个独立的部分来执行（ EXECUTE 语句执行），而函数可以作为查询语句的一个部分来调用（SELECT调用），由于函数可以返回一个表对象，因此它可以在查询语句中位于FROM关键字的后面。 SQL语句中不可用存储过程，而可以使用函数。<br>5）存储过程查寻结果和返回值作用域在一个会话中,建立新的会话不能使用另一个会话中存储过程中的数据。<br></p>

<h3 id="光标（游标）"><a href="#光标（游标）" class="headerlink" title="光标（游标）"></a>光标（游标）</h3><p>查询语句可能查询出多条记录，在存储过程和函数中使用光标标来逐条读取查询结果集中的记录。光标的使用包括声明光标、打开光标、使用光标和关闭光标。光标必须声明光标、打开光标、使用光标和关闭光标。光标必须声明在处理程序之前，并且声明在变量和条件之后。</p>
<h4 id="声明光标"><a href="#声明光标" class="headerlink" title="声明光标"></a>声明光标</h4><p>Declare cursor_name cursor forselect_statement;<br>Cursor_name:光标名称<br>Select_statement:select语句的内容<br>Declare cur_employee cursor forselect name,age from employee; </p>
<h4 id="打开光标"><a href="#打开光标" class="headerlink" title="打开光标"></a>打开光标</h4><p>Open cursor_name<br>Open cur_employee; </p>
<h4 id="使用光标"><a href="#使用光标" class="headerlink" title="使用光标"></a>使用光标</h4><p>Mysql中使用fetch关键字来使用光标，语法形式<br>Fetch cur_name intovar_name[,var_name…];<br>Cur_name表示光标的名称<br>Var_name表示将光标中的select语句查询出来的信息存入该参数。Var_name必须在声明光标前就定义好。<br>Fetch cur_employee intoemp_name,emp_age; </p>
<h4 id="关闭光标"><a href="#关闭光标" class="headerlink" title="关闭光标"></a>关闭光标</h4><p>[sql] view plain copy<br>Close cursor_name;<br>Close cur_employee;<br>每个光标不再需要时都应该被关闭，使用close语句将会释放光标所使用的全部资源。在一个光标被关闭后，如果没有重新被打开，则不能被使用。对于声明过的光标，则不需要再次声明，可直接使用open语句打开。</p>
<h4 id="使用范例"><a href="#使用范例" class="headerlink" title="使用范例"></a>使用范例</h4><p>（将表test_cur1数据复制到test_cur2）<br>创建表：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `test_cur1` (    </div><div class="line">  `id` int(11) NOT NULL auto_increment,    </div><div class="line">  `type` char(11) default NULL,    </div><div class="line">  `order1` char(11) default NULL,    </div><div class="line">  PRIMARY KEY  (`id`)    </div><div class="line">)   </div><div class="line">INSERT INTO `test_cur1` VALUES (1, &apos;145&apos;, &apos;d1&apos;);    </div><div class="line">INSERT INTO `test_cur1` VALUES (2, &apos;134&apos;, &apos;1d&apos;);    </div><div class="line">INSERT INTO `test_cur1` VALUES (3, &apos;123&apos;, &apos;1ad&apos;);    </div><div class="line">INSERT  INTO `test_cur1` VALUES (4, &apos;121&apos;, &apos;1as&apos;);  </div><div class="line">   </div><div class="line">CREATE TABLE `test_cur2` (    </div><div class="line">  `id` int(11) NOT NULL auto_increment,    </div><div class="line">  `type` char(11) default NULL,    </div><div class="line">  `order1` char(11) default NULL,    </div><div class="line">  PRIMARY KEY  (`id`)    </div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>然后写光标了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">create procedure get_cur ()  </div><div class="line">BEGIN  </div><div class="line">  DECLARE done INT DEFAULT 0;  </div><div class="line">  DECLARE ID int(11);  </div><div class="line">  DECLARE type char(11);  </div><div class="line">  DECLARE order1 char(11);  </div><div class="line">  DECLARE mycur CURSOR FOR SELECT * FROM test_cur1; -- 定义光标 </div><div class="line">  DECLARE CONTINUE HANDLER FOR SQLSTATE &apos;02000&apos; SET done = 1;  -- 当游标取到最后一个数据的下一个不存在的数据时，done会被值为1，那么就要在repeat中进行done的判断，当done不为1的时候，才执行循环</div><div class="line">  OPEN mycur; -- 打开光标</div><div class="line">  REPEAT  -- 开始循环</div><div class="line">    FETCH mycur INTO ID,type,order1; -- 去除光标内容到临时变量</div><div class="line">    IF NOT done THEN  -- 当done不为0时为false not false为true进行循环</div><div class="line">      INSERT INTO test_cur2 VALUES (ID,type,order1);</div><div class="line">    END IF;    </div><div class="line">  UNTIL done END REPEAT; -- until为false时继续进行下一循环，如果true时进行下一循环后结束</div><div class="line">  CLOSE mycur;  </div><div class="line">END</div></pre></td></tr></table></figure>
<p>调用存储过程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">call get_cur();</div></pre></td></tr></table></figure></p>
<h3 id="实用的存储过程"><a href="#实用的存储过程" class="headerlink" title="实用的存储过程"></a>实用的存储过程</h3><h3 id="分割字符串"><a href="#分割字符串" class="headerlink" title="分割字符串"></a>分割字符串</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">drop PROCEDURE if exists procedure_split;</div><div class="line">CREATE PROCEDURE `procedure_split`(</div><div class="line">    inputstring varchar(1000),</div><div class="line">    delim char(1)</div><div class="line">)</div><div class="line">begin</div><div class="line">    declare strlen int DEFAULT length(inputstring);</div><div class="line">    declare last_index int DEFAULT 0;</div><div class="line">    declare cur_index int DEFAULT 1;</div><div class="line">    declare cur_char VARCHAR(200);</div><div class="line">    declare len int;</div><div class="line">    drop temporary table if exists splittable;</div><div class="line">    create TEMPORARY table splittable(</div><div class="line">        value VARCHAR(20)</div><div class="line">    ) ;</div><div class="line">    WHILE(cur_index&lt;=strlen) DO    </div><div class="line">    begin</div><div class="line">        if substring(inputstring from cur_index for 1)=delim or cur_index=strlen then</div><div class="line">            set len=cur_index-last_index-1;</div><div class="line">            if cur_index=strlen then</div><div class="line">               set len=len+1;</div><div class="line">            end if;</div><div class="line">            insert into splittable(`value`)values(substring(inputstring from (last_index+1) for len));</div><div class="line">            set last_index=cur_index;</div><div class="line">        end if;</div><div class="line">        set cur_index=cur_index+1;</div><div class="line">    END;</div><div class="line">    end while;</div><div class="line">end ;</div><div class="line">-- 调用：</div><div class="line">call PROCEDURE_split(&apos;中国,开源,社区&apos;,&apos;,&apos;);</div><div class="line">select * from splittable;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">drop PROCEDURE if exists result_mail_no;</div><div class="line">CREATE PROCEDURE result_mail_no(IN mailno varchar(1000),IN fStationId CHAR(10))  </div><div class="line">BEGIN</div><div class="line">call PROCEDURE_split(mailno,&apos;,&apos;);</div><div class="line">select pi.f_mail_no from tp_parcel_info pi where pi.f_parcel_status not in (&apos;0&apos;, &apos;4&apos;) AND pi.f_station_id = fStationId AND </div><div class="line">EXISTS (select 1 from splittable s WHERE s.value = pi.f_mail_no);</div><div class="line">END;</div><div class="line">-- 调用：</div><div class="line">call result_mail_no(&apos;883960354731823677,3453&apos;,&apos;1618&apos;);</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[MySQL分表]]></title>
      <url>https://volc1605.github.io/2017/01/18/MySQL%E5%88%86%E8%A1%A8/</url>
      <content type="html"><![CDATA[<h3 id="MySQL分表"><a href="#MySQL分表" class="headerlink" title="MySQL分表"></a>MySQL分表</h3><a id="more"></a>
<p>分表参考：<br><a href="http://www.cnblogs.com/qqloving/p/3414999.html" target="_blank" rel="external">http://www.cnblogs.com/qqloving/p/3414999.html</a><br><a href="http://www.cnblogs.com/miketwais/articles/mysql_partition.html" target="_blank" rel="external">http://www.cnblogs.com/miketwais/articles/mysql_partition.html</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[MySQL优化]]></title>
      <url>https://volc1605.github.io/2017/01/18/MySQL%E4%BC%98%E5%8C%96/</url>
      <content type="html"><![CDATA[<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><a id="more"></a>
<p>EXISTS 和 IN<br><a href="https://volc1605.github.io/2016/11/19/MySQL/">用法</a></p>
<p>参考：<a href="http://www.voidcn.com/blog/u010331428/article/p-3922833.html" target="_blank" rel="external">http://www.voidcn.com/blog/u010331428/article/p-3922833.html</a><br>MySQL实现join的原理，原来MySQL内部采用了一种叫做 nested loop join的算法。Nested Loop Join 实际上就是通过驱动表的结果集作为循环基础数据，然后一条一条的通过该结果集中的数据作为过滤条件到下一个表中查询数据，然后合并结果。如果还有第三个参与 Join，则再通过前两个表的 Join 结果集作为循环基础数据，再一次通过循环查询条件到第三个表中查询数据，如此往复，基本上MySQL采用的是最容易理解的算法来实现join。所以驱动表的选择非常重要，驱动表的数据小可以显著降低扫描的行数。<br>一般情况下参与联合查询的两张表都会一大一小，如果是join，在没有其他过滤条件的情况下MySQL会选择小表作为驱动表，但是left join一般用作大表去join小表，而left join本身的特性决定了MySQL会用大表去做驱动表，这样下来效率就差了不少。</p>
<p>1.如果where条件中含有右表的非空条件（除开右表使用is null判断），则left join语句等同于join语句，可直接改写成join语句。<br>SELECT<em> FROM A pi LEFT JOIN B si ON si.f_station_id = pi.f_station_id; – 以左表为驱动表<br>SELECT</em> FROM A pi LEFT JOIN B si ON si.f_station_id = pi.f_station_id WHERE pi.f_station_id &gt;= ‘7231’ – 以小表为驱动表等同于join</p>
<p>那么如何优化left join：<br>1、条件中尽量能够过滤一些行将驱动表变得小一点，用小数据表去驱动大数据表<br>2、右表的条件列一定要加上索引（主键、唯一索引、前缀索引等），最好能够使type达到range及以上（ref,eq_ref,const,system）<br>3、无视以上两点，一般不要用left join</p>
<p>例如：<br>为防止查询优化器犯傻，则可以根据你SQL特点和字段名何曾看(A与B，A与C是1对1的关系，或者B,C表中可能不存在，不能是1-N的关系)，先对A表进行那个过滤和分页，再进行LEFT JOIN操作，则可以大致些成：<br>SELECT *<br>FROM (SELECT A.columnname.. FROM A WHERE A…=..ORDER BY A.ap_like LIMIT 12) AS A<br>LEFT JOIN B …..<br>LEFT JOIN C……;</p>
<p>写成以小表驱动大表，这是描述的嵌套循环算法</p>
<p>=========================================</p>
<p>sql优化<br>1.<br>使用inner join 等值匹配连接查询<br>查询站点ID&gt;=7231的所有包裹信息和站点信息<br>效率低：<br>– 查询B表f_station_id大于7231的数据再根据条件匹配A表数据，匹配成功返回A表数据<br>SELECT <em> FROM A pi WHERE EXISTS ( SELECT </em> FROM B si WHERE si.f_station_id &gt;= ‘7231’ AND pi.f_station_id = si.f_station_id );<br>效率高：<br>SELECT* FROM A pi INNER JOIN B si USING(f_station_id) WHERE si.f_station_id &gt;= ‘7231’;</p>
<p>2.<br>使用JOIN时候，应该用小的结果驱动打的结果（left join 左边表结果尽量小，如果有条件应该放到左边先处理，right join同理反向）<br>Select * from A left join B ona.id=B.ref_id where B.ref_id&gt;10;</p>
<p>可以优化为：<br>select <em> from (select </em> from A wehre id &gt;10) T1 left join B onT1.id=B.ref_id;</p>
<p>3.<br>使用between and<br>效率低:<br>Select <em> from A order by id limit 10000000,10;<br>效率高：<br>Select </em> from A where id between 10000000and 10000010;</p>
<p>4.<br>尽量用union all 代替union<br>A.union和union all的差异主要是前者需要将两个（或者多个）结果集合并后再进行唯一性过滤操作，这就会涉及到排序，增加大量的cpu运算，加大资源消耗及延迟。所以当我们可以确认不可能出现重复结果集或者不在乎重复结果集的时候，尽量使用union all而不是union.</p>
<p>5.<br>不要在列上进行运算<br>select <em> fromusers where YEAR(adddate)&lt;2007;<br>这些导致索引失效进行全表扫描，因此我们可以改成：<br>Select </em> from users where adddate&lt;’2007-01-01’;</p>
<p>6.<br>尽量不要使用NOT IN和&lt;&gt;操作</p>
<p>=========================================</p>
<p>1、应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则将引擎放弃使用索引而进行全表扫描。</p>
<p>2、对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p>
<p>3、应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：<br>select id from t where num is null<br>可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：<br>select id from t where num=0</p>
<p>4、尽量避免在 where 子句中使用 or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：<br>select id from t where num=10 or num=20<br>可以这样查询：<br>select id from t where num=10<br>union all<br>select id from t where num=20</p>
<p>5、下面的查询也将导致全表扫描：(不能前置百分号)<br>select id from t where name like ‘%%’<br>若要提高效率，可以考虑全文检索。</p>
<p>6、in 和 not in也要慎用,否则会导致全表扫描，如：<br>select id from t where num in(1,2,3)<br>对于连续的数值，能用 between 就不要用 in 了：<br>select id from t where num between 1 and 3</p>
<p>7、应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：<br>select id from t where num/2=100<br>应改为:<br>select id from t where num=100*2</p>
<p>8、应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：<br>select id from t where substring(name,1,3)=’abc’–name以abc开头的id<br>select id from t where datediff(day,createdate,’2005-11-30’)=0–’2005-11-30’生成的id<br>应改为:<br>select id from t where name like ‘abc%’<br>select id from t where createdate&gt;=’2005-11-30’ and createdate&lt;’2005-12-1’</p>
<p>9、不要在 where 子句中的”=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</p>
<p>10、在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使 用，并且应尽可能的让字段顺序与索引顺序相一致。</p>
<p>11、并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段 sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。</p>
<p>12、索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有 必要。</p>
<p>13、尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会 逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。</p>
<p>14、尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。<br>    char 和 varchar</p>
<pre><code>CHAR(M)定义的列的长度为固定的
VARCHAR(M)定义的列的长度为可变长字符串
超限自动截取
效率来说基本是char&gt;varchar&gt;text，但是如果使用的是Innodb引擎的话，推荐使用varchar代替char


使用：
1.根据字符的长度来判断，是考虑其长度的是否相近来确定选择char还是varchar，如何字段的长度基本都是一样或者其长度总是近似的可以选用char
2.是从碎片角度进行考虑 用可变长度的字符型数据时，数据库管理员要时不时的对碎片进行整理。如执行数据库导出导入作业，来消除碎片。
3.即使使用Varchar数据类型，也不能够太过于慷慨！ 比如你只使用到90个字符，VARCHAR(100)与VARCHAR(200)真的相同吗?结果是否定的。虽然他们用来存储90个字符的数据，其存储空间相同。但是对于内存的消耗是不同的。
</code></pre><p>15、任何地方都不要使用 select <em> from t ，用具体的字段列表代替”</em>“，不要返回用不到的任何字段。</p>
<p>16、尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。</p>
<p>17、避免频繁创建和删除临时表，以减少系统表资源的消耗。</p>
<p>18、临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使 用导出表。</p>
<p>19、在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。</p>
<p>20、如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。</p>
<p>21、尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。</p>
<p>22、使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。</p>
<p>23、与临时表一样，游标并不是不可使用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括”合计”的例程通常要比使用游标执行的速度快。如果开发时 间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。</p>
<p>24、在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送 DONE_IN_PROC 消息。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[PHP外部请求]]></title>
      <url>https://volc1605.github.io/2017/01/13/PHP%E8%AF%B7%E6%B1%82/</url>
      <content type="html"><![CDATA[<h3 id="1-php请求"><a href="#1-php请求" class="headerlink" title="1.php请求"></a>1.php请求</h3><a id="more"></a>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">UOPStorage</span><span class="params">($dataList)</span> </span>&#123;</div><div class="line">       <span class="comment">// 构造参数</span></div><div class="line">       $param = <span class="keyword">Array</span>();</div><div class="line">       <span class="comment">// receivePush</span></div><div class="line">       $receivePush = <span class="keyword">Array</span>();</div><div class="line">       $trace = <span class="keyword">Array</span>();</div><div class="line">       $parcelDat = <span class="keyword">Array</span>();</div><div class="line">       <span class="keyword">foreach</span> ($dataList <span class="keyword">as</span> $data) &#123;</div><div class="line">           $parcelId = $data[<span class="string">'f_parcel_id'</span>];</div><div class="line">           $where = <span class="keyword">array</span>(<span class="string">'f_parcel_id'</span> =&gt; $parcelId);</div><div class="line">           $parcelInfo = <span class="keyword">new</span> \Home\Model\ParcelInfoModel();</div><div class="line">           $lastTime = $parcelInfo-&gt;getParcelArriveTime($where);</div><div class="line">           $lastTime = $lastTime[<span class="string">'f_last_time'</span>];</div><div class="line">           $time = date(<span class="string">"Y年n月j日 ag:i:s"</span>, strtotime($lastTime));</div><div class="line">           $time = str_replace(<span class="string">'am'</span>, <span class="string">"上午"</span>, $time);</div><div class="line">           $time = str_replace(<span class="string">'pm'</span>, <span class="string">"下午"</span>, $time);</div><div class="line">           $parcelDat[<span class="string">'scanTime'</span>] = date(<span class="string">"Y-m-d H:i:s"</span>, time());</div><div class="line">           $parcelDat[<span class="string">'context'</span>] = <span class="string">"联系方式："</span> . $data[<span class="string">'f_tel'</span>];</div><div class="line">           <span class="keyword">if</span> ($data[<span class="string">'f_type'</span>] == <span class="number">1</span>) &#123;</div><div class="line">               $reqType = <span class="keyword">array</span>(<span class="string">'f_storage_status'</span> =&gt; <span class="string">'0'</span>);</div><div class="line">               $parcelDat[<span class="string">'scanType'</span>] = <span class="string">"0"</span>;<span class="comment">// 请求类型 在途</span></div><div class="line">           &#125; <span class="keyword">elseif</span> ($data[<span class="string">'f_type'</span>] == <span class="number">2</span>) &#123;</div><div class="line">               $reqType = <span class="keyword">array</span>(<span class="string">'f_arrive_status'</span> =&gt; <span class="string">'0'</span>);</div><div class="line">               $parcelDat[<span class="string">'scanType'</span>] = <span class="string">"15"</span>;<span class="comment">// 请求类型 签收</span></div><div class="line">               $parcelDat[<span class="string">'context'</span>] = <span class="string">"context"</span>;</div><div class="line">           &#125; <span class="keyword">else</span> &#123;</div><div class="line">               $reqType = <span class="keyword">array</span>(<span class="string">'f_rejection_status'</span> =&gt; <span class="string">'0'</span>);</div><div class="line">               $parcelDat[<span class="string">'scanType'</span>] = <span class="string">"0"</span>;<span class="comment">// 请求类型 在途</span></div><div class="line">           &#125;</div><div class="line">           $parcelDat[<span class="string">'siteName'</span>] = $data[<span class="string">'f_station_name'</span>];</div><div class="line">           $parcelDat[<span class="string">'mobile'</span>] = $data[<span class="string">'f_tel'</span>];</div><div class="line">           $trace[<span class="string">'trace'</span>] = $parcelDat;</div><div class="line">           $receivePush[<span class="string">'billCode'</span>] = $data[<span class="string">'f_mail_no'</span>];</div><div class="line">           $receivePush[<span class="string">'traces'</span>] = $trace;</div><div class="line">           $param[<span class="string">'receivePush'</span>] = $receivePush;</div><div class="line">           <span class="keyword">$this</span>-&gt;doPostUOP($data[<span class="string">'f_parcel_id'</span>], json_encode($param), $reqType);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doPostUOP</span><span class="params">($parcelId, $param, $reqType)</span> </span>&#123;</div><div class="line">       <span class="comment">// 测试</span></div><div class="line">       <span class="comment">// $UOPeceiveUrl = "http://123.123.123.123/com.uc5.main/a/a.action";</span></div><div class="line">       $secretKey = <span class="string">"ab0d3b38bb2"</span>;</div><div class="line">       <span class="comment">//$secretKey = "6a8b866e7eb4ad";</span></div><div class="line">       $partner = <span class="string">"041"</span>;</div><div class="line">       $serviceName = <span class="string">"receive_track"</span>;</div><div class="line">       $dataType = <span class="string">"json"</span>;</div><div class="line">       <span class="comment">// 拼接加密字符串</span></div><div class="line">       $data = <span class="keyword">Array</span>();</div><div class="line">       $data[<span class="number">0</span>] = <span class="string">"dataType"</span> . <span class="string">"="</span> . $dataType;</div><div class="line">       $data[<span class="number">1</span>] = <span class="string">"param"</span> . <span class="string">"="</span> . $param;</div><div class="line">       $data[<span class="number">2</span>] = <span class="string">"partner"</span> . <span class="string">"="</span> . $partner;</div><div class="line">       $data[<span class="number">3</span>] = <span class="string">"serviceName"</span> . <span class="string">"="</span> . $serviceName;</div><div class="line">       $comma_separated = implode(<span class="string">"&amp;"</span>, $data);</div><div class="line">       <span class="comment">// 加密最后结果</span></div><div class="line">       $dataSign = md5($comma_separated . $secretKey);</div><div class="line">       $Request_Data[<span class="string">'dataSign'</span>] = $dataSign;</div><div class="line">       $Request_Data[<span class="string">'partner'</span>] = $partner;</div><div class="line">       $Request_Data[<span class="string">'serviceName'</span>] = $serviceName;</div><div class="line">       $Request_Data[<span class="string">'dataType'</span>] = $dataType;</div><div class="line">       $Request_Data[<span class="string">'param'</span>] = $param;</div><div class="line">       <span class="comment">// 请求UOP平台</span></div><div class="line">       $postdata = http_build_query($Request_Data);</div><div class="line">       $options = <span class="keyword">array</span>(</div><div class="line">           <span class="string">'http'</span> =&gt; <span class="keyword">array</span>(</div><div class="line">               <span class="string">'method'</span> =&gt; <span class="string">'POST'</span>,</div><div class="line">               <span class="string">'header'</span> =&gt; <span class="string">'Content-type:application/x-www-form-urlencoded'</span>,</div><div class="line">               <span class="string">'content'</span> =&gt; $postdata,</div><div class="line">               <span class="string">'timeout'</span> =&gt; <span class="number">5</span> * <span class="number">60</span> <span class="comment">// 超时时间（单位:s）</span></div><div class="line">           )</div><div class="line">       );</div><div class="line">       $context = stream_context_create($options);</div><div class="line">       $result = file_get_contents($UOPeceiveUrl, <span class="keyword">true</span>, $context);</div><div class="line">       $xml = simplexml_load_string(<span class="string">'&lt;?xml version="1.0" encoding="gbk"?&gt;'</span> . $result);</div><div class="line">       $re = (string)$xml-&gt;returnCode;</div><div class="line">       <span class="comment">// 请求成功更新包裹状态</span></div><div class="line">       <span class="keyword">if</span> ($re == <span class="string">"SUCCESSFUL"</span>) &#123;</div><div class="line">           <span class="comment">// 更新包裹状态</span></div><div class="line">           print_r($re);</div><div class="line">           <span class="keyword">foreach</span>($reqType <span class="keyword">as</span> $key=&gt;$val)&#123;</div><div class="line">               $reqType[$key] = <span class="number">1</span>;</div><div class="line">           &#125;</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           <span class="keyword">foreach</span>($reqType <span class="keyword">as</span> $key=&gt;$val)&#123;</div><div class="line">               $reqType[$key] = <span class="number">2</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       $parcelInfo = <span class="keyword">new</span> \Home\Model\StationAbutmentLogModel();</div><div class="line">       $parcelInfo-&gt;updateExpressData($parcelId, $reqType);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[MySQL主从读写分离]]></title>
      <url>https://volc1605.github.io/2017/01/05/MySQL%E4%B8%BB%E4%BB%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/</url>
      <content type="html"><![CDATA[<h3 id="1-mysql简单配置主从参考方式"><a href="#1-mysql简单配置主从参考方式" class="headerlink" title="1 mysql简单配置主从参考方式"></a>1 mysql简单配置主从参考方式</h3><a id="more"></a>
<p>注意：<br>1、    主DB server和从DB server数据库的版本一致。<br>2、    主DB server和从DB server数据库数据一致[ 这里就会可以把主的备份在从上还原，也可以直接将主的数据目录拷贝到从的相应数据目录]。<br>3、    主DB server开启二进制日志,主DB server和从DB server的server_id都必须唯一。<br>4、 mysql主从有延迟，是由于原理所致，需要根据业务场景分析是否实现主从，以免造成不可逆的代价。<br>5、 读写分离解决读数据库的压力，并不能很好的解决写数据库。<br>步骤：<br>为主从mysql添加服务<br>进入D:\mysql\3381\bin目录下执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.\mysqld.exe install MySQL-3380 --defaults-file=&quot;D:\mysql\3380\data\my.ini&quot;</div></pre></td></tr></table></figure></p>
<p>1.主库配置，开启二进制日志，用于从库调用进行同步<br>2.主库为从库授权(创建复制帐号)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># &apos;定义从库用户名称&apos;@&apos;从库IP&apos; by &apos;该用户访问主库密码&apos;</div><div class="line">grant replication slave on *.* to &apos;slave01&apos;@&apos;127.0.0.1&apos; identified by &apos;123456&apos;;</div><div class="line">flush privileges;</div></pre></td></tr></table></figure>
<p>3.从库配置<br>主库执行获取二进制日志文件名称<br>使用navicat连接主库执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SHOW MASTER STATUS;</div><div class="line"># 结果：</div><div class="line">mysql-bin.000002   420	taotao</div></pre></td></tr></table></figure>
<p>file mysql-bin.000002<br>position 420<br>这两个参数用于配置从库</p>
<p>根据刚刚执行的命令(grant replication slave on <em>.</em> to ‘slave01’@’127.0.0.1’ identified by ‘123456’;)，配置从库<br>master_host 定义从库用户名称<br>master_user 从库IP<br>master_password 该用户访问主库密码<br>master_port 主库端口(3380)<br>master_log_file 需要复制的主库中二进制文件名称<br>master_log_pos 文件位置</p>
<p>从库执行以下命令配置从库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CHANGE MASTER TO</div><div class="line"> master_host=&apos;127.0.0.1&apos;,</div><div class="line"> master_user=&apos;slave01&apos;,</div><div class="line"> master_password=&apos;123456&apos;,</div><div class="line"> master_port=3380,</div><div class="line"> master_log_file=&apos;mysql-bin.000002&apos;,</div><div class="line"> master_log_pos=420;</div></pre></td></tr></table></figure></p>
<p>4.启动从库同步，查看从库状态<br>进入从库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">START SLAVE;</div></pre></td></tr></table></figure>
<p>如果启动出错需要删除掉主库从库的日志文件，和配置文件，再次启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SHOW SLAVE STATUS;</div><div class="line"># 结果：</div><div class="line">	127.0.0.1	slave01	3380	60	mysql-bin.000002	420	PC-201701242302-relay-bin.000001	4	mysql-bin.000002	No	Yes							0		0	420	120	None		0	No							No	1593	Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work.	0			80		D:\mysql\3381\data\data\master.info	0		Slave has read all relay log; waiting for the slave I/O thread to update it	86400		170304 12:18:46						0</div></pre></td></tr></table></figure>
<p>查看结果<br>Slave_IO_Running:No<br>Slave_SQL_Running:Yes<br>两个都为Yes说明主从配置成功，需要查看从库日志排除配置失败的原因<br>D:\mysql\3381\logs\mysql.err.log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2017-03-04 12:18:46 7764 [ERROR] Slave I/O: Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work. Error_code: 1593</div></pre></td></tr></table></figure>
<p>说明主从数据库uuid相同了，需要从新设置从mysql的uuid<br>找到从数据库中D:\mysql\3381\data\data\auto.cnf配置文件，内容如下，修改一个值即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[auto]</div><div class="line">server-uuid=d71ec2ee-65ba-11e5-a4e3-000c29deb96f</div></pre></td></tr></table></figure>
<p>重启从数据库服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SHOW SLAVE STATUS;</div><div class="line"># 结果</div><div class="line">Waiting for master to send event	127.0.0.1	slave01	3380	60	mysql-bin.000002	420	PC-201701242302-relay-bin.000003	283	mysql-bin.000002	Yes	Yes							0		0	420	466	None		0	No						0	No	0		0			80	d71ec2ee-65ba-11e5-a4e3-000c29deb96e	D:\mysql\3381\data\data\master.info	0		Slave has read all relay log; waiting for the slave I/O thread to update it	86400								0</div></pre></td></tr></table></figure>
<p>Slave_IO_Running:Yes<br>Slave_SQL_Running:Yes<br>要重新启动从库同步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">START SLAVE;</div></pre></td></tr></table></figure>
<p>不同需要步时执行以下sql停止同步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">START SLAVE;</div></pre></td></tr></table></figure>
<p>5.测试主从<br>修改主数据数据，从数据库跟着该表，MySql主从同步成功。<br>以下是详细配置文件<br>主my.ini：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">no-beep</div><div class="line"></div><div class="line"># pipe</div><div class="line">socket=0.0</div><div class="line">port=3380</div><div class="line"></div><div class="line">[mysql]</div><div class="line"></div><div class="line">default-character-set=utf8</div><div class="line"></div><div class="line"># SERVER SECTION</div><div class="line"># ----------------------------------------------------------------------</div><div class="line">#</div><div class="line"># The following options will be read by the MySQL Server. Make sure that</div><div class="line"># you have installed the server correctly (see above) so it reads this </div><div class="line"># file.</div><div class="line">#</div><div class="line"># server_type=3</div><div class="line">[mysqld]</div><div class="line"></div><div class="line">enable-named-pipe</div><div class="line"></div><div class="line">shared-memory</div><div class="line"></div><div class="line">shared-memory-base-name=MYSQL-3380</div><div class="line"></div><div class="line"># The Pipe the MySQL Server will use</div><div class="line">socket=MYSQL-3380</div><div class="line"></div><div class="line"># The TCP/IP Port the MySQL Server will listen on</div><div class="line">port=3380</div><div class="line"></div><div class="line"># Path to installation directory. All paths are usually resolved relative to this.</div><div class="line"># basedir=&quot;D:/mysql/3380/&quot;</div><div class="line"></div><div class="line"># Path to the database root</div><div class="line">datadir=D:/mysql/3380/data/Data</div><div class="line"></div><div class="line">character-set-server=utf8</div><div class="line"></div><div class="line">default-storage-engine=INNODB</div><div class="line"></div><div class="line">sql-mode=&quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</div><div class="line"></div><div class="line">log-output=FILE</div><div class="line">general-log=0</div><div class="line">general_log_file=&quot;WIN-A1JA6NUDTV4.log&quot;</div><div class="line">slow-query-log=1</div><div class="line">slow_query_log_file=&quot;D:/mysql/3380/logs/mysql-slow.log&quot;</div><div class="line">long_query_time=10</div><div class="line"></div><div class="line"># Binary Logging. 主数据库要开启二进制日志</div><div class="line">log-bin=&quot;D:/mysql/3380/logs/mysql-bin&quot;</div><div class="line"></div><div class="line"># Error Logging.</div><div class="line">log-error=&quot;D:/mysql/3380/logs/mysql.err.log&quot;</div><div class="line"></div><div class="line"># Server Id.</div><div class="line">server-id=80</div><div class="line"></div><div class="line"># 主数据库中配置需要同步的数据库为taotao</div><div class="line">binlog-do-db=taotao</div><div class="line"></div><div class="line">max_connections=151</div><div class="line"></div><div class="line">query_cache_size=0</div><div class="line"></div><div class="line">table_open_cache=2000</div><div class="line"></div><div class="line">tmp_table_size=14M</div><div class="line"></div><div class="line">thread_cache_size=10</div><div class="line"></div><div class="line">myisam_max_sort_file_size=100G</div><div class="line"></div><div class="line">myisam_sort_buffer_size=18M</div><div class="line"></div><div class="line">key_buffer_size=8M</div><div class="line"></div><div class="line">read_buffer_size=37K</div><div class="line">read_rnd_buffer_size=256K</div><div class="line"></div><div class="line">sort_buffer_size=256K</div><div class="line"></div><div class="line">innodb_additional_mem_pool_size=2M</div><div class="line"></div><div class="line">innodb_flush_log_at_trx_commit=1</div><div class="line"></div><div class="line">innodb_log_buffer_size=1M</div><div class="line"></div><div class="line">innodb_buffer_pool_size=43M</div><div class="line"></div><div class="line">innodb_log_file_size=48M</div><div class="line"></div><div class="line">innodb_thread_concurrency=8</div><div class="line"></div><div class="line">innodb_autoextend_increment=64</div><div class="line"></div><div class="line">innodb_buffer_pool_instances=8</div><div class="line"></div><div class="line">innodb_concurrency_tickets=5000</div><div class="line"></div><div class="line">innodb_old_blocks_time=1000</div><div class="line"></div><div class="line">innodb_open_files=300</div><div class="line"></div><div class="line">innodb_stats_on_metadata=0</div><div class="line"></div><div class="line">innodb_file_per_table=1</div><div class="line"></div><div class="line">innodb_checksum_algorithm=0</div><div class="line"></div><div class="line">back_log=80</div><div class="line"></div><div class="line">flush_time=0</div><div class="line"></div><div class="line">join_buffer_size=256K</div><div class="line"></div><div class="line">max_allowed_packet=4M</div><div class="line"></div><div class="line">max_connect_errors=100</div><div class="line"></div><div class="line">open_files_limit=4161</div><div class="line"></div><div class="line">query_cache_type=0</div><div class="line"></div><div class="line">sort_buffer_size=256K</div><div class="line"></div><div class="line">table_definition_cache=1400</div><div class="line"></div><div class="line">binlog_row_event_max_size=8K</div><div class="line"></div><div class="line">sync_master_info=10000</div><div class="line"></div><div class="line">sync_relay_log=10000</div><div class="line"></div><div class="line">sync_relay_log_info=10000</div></pre></td></tr></table></figure>
<p>从my.ini<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">no-beep</div><div class="line"></div><div class="line"># pipe</div><div class="line">socket=0.0</div><div class="line">port=3381</div><div class="line"></div><div class="line">[mysql]</div><div class="line"></div><div class="line">default-character-set=utf8</div><div class="line"></div><div class="line"># SERVER SECTION</div><div class="line"># ----------------------------------------------------------------------</div><div class="line">#</div><div class="line"># The following options will be read by the MySQL Server. Make sure that</div><div class="line"># you have installed the server correctly (see above) so it reads this </div><div class="line"># file.</div><div class="line">#</div><div class="line"># server_type=3</div><div class="line">[mysqld]</div><div class="line"></div><div class="line"># The next three options are mutually exclusive to SERVER_PORT below.</div><div class="line"># skip-networking</div><div class="line"></div><div class="line">enable-named-pipe</div><div class="line"></div><div class="line">shared-memory</div><div class="line"></div><div class="line">shared-memory-base-name=MYSQL-3381</div><div class="line"></div><div class="line"># The Pipe the MySQL Server will use</div><div class="line">socket=MYSQL-3381</div><div class="line"></div><div class="line"># The TCP/IP Port the MySQL Server will listen on</div><div class="line">port=3381</div><div class="line"></div><div class="line"># Path to installation directory. All paths are usually resolved relative to this.</div><div class="line"># basedir=&quot;D:/mysql/3381/&quot;</div><div class="line"></div><div class="line"># Path to the database root</div><div class="line">datadir=D:/mysql/3381/data/data</div><div class="line"></div><div class="line"># The default character set that will be used when a new schema or table is</div><div class="line"># created and no character set is defined</div><div class="line">character-set-server=utf8</div><div class="line"></div><div class="line"># The default storage engine that will be used when create new tables when</div><div class="line">default-storage-engine=INNODB</div><div class="line"></div><div class="line"># Set the SQL mode to strict</div><div class="line">sql-mode=&quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</div><div class="line"></div><div class="line"># Enable Windows Authentication</div><div class="line"># plugin-load=authentication_windows.dll</div><div class="line"></div><div class="line"># General and Slow logging.</div><div class="line">log-output=FILE</div><div class="line">general-log=0</div><div class="line">general_log_file=&quot;WIN-A1JA6NUDTV4.log&quot;</div><div class="line">slow-query-log=1</div><div class="line">slow_query_log_file=&quot;D:/mysql/3381/logs/mysql-slow.log&quot;</div><div class="line">long_query_time=10</div><div class="line"></div><div class="line"># Binary Logging.</div><div class="line">log-bin=&quot;D:/mysql/3381/logs/mysql-bin&quot;</div><div class="line"></div><div class="line"># Error Logging.</div><div class="line">log-error=&quot;D:/mysql/3381/logs/mysql.err.log&quot;</div><div class="line"></div><div class="line"># Server Id.</div><div class="line">server-id=81</div><div class="line"></div><div class="line">max_connections=151</div><div class="line"></div><div class="line">query_cache_size=0</div><div class="line"></div><div class="line">table_open_cache=2000</div><div class="line"></div><div class="line">tmp_table_size=14M</div><div class="line"></div><div class="line">thread_cache_size=10</div><div class="line"></div><div class="line">myisam_max_sort_file_size=100G</div><div class="line"></div><div class="line">myisam_sort_buffer_size=18M</div><div class="line"></div><div class="line">key_buffer_size=8M</div><div class="line"></div><div class="line">read_buffer_size=37K</div><div class="line">read_rnd_buffer_size=256K</div><div class="line"></div><div class="line">sort_buffer_size=256K</div><div class="line"></div><div class="line">innodb_additional_mem_pool_size=2M</div><div class="line"></div><div class="line">innodb_flush_log_at_trx_commit=1</div><div class="line"></div><div class="line">innodb_log_buffer_size=1M</div><div class="line"></div><div class="line">innodb_buffer_pool_size=43M</div><div class="line"></div><div class="line">innodb_log_file_size=48M</div><div class="line"></div><div class="line">innodb_thread_concurrency=8</div><div class="line"></div><div class="line">innodb_autoextend_increment=64</div><div class="line"></div><div class="line">innodb_buffer_pool_instances=8</div><div class="line"></div><div class="line">innodb_concurrency_tickets=5000</div><div class="line"></div><div class="line">innodb_old_blocks_time=1000</div><div class="line"></div><div class="line">innodb_open_files=300</div><div class="line"></div><div class="line">innodb_stats_on_metadata=0</div><div class="line"></div><div class="line">innodb_file_per_table=1</div><div class="line"></div><div class="line">innodb_checksum_algorithm=0</div><div class="line"></div><div class="line">back_log=80</div><div class="line"></div><div class="line">flush_time=0</div><div class="line"></div><div class="line">join_buffer_size=256K</div><div class="line"></div><div class="line">max_allowed_packet=4M</div><div class="line"></div><div class="line">max_connect_errors=100</div><div class="line"></div><div class="line">open_files_limit=4161</div><div class="line"></div><div class="line">query_cache_type=0</div><div class="line"></div><div class="line">sort_buffer_size=256K</div><div class="line"></div><div class="line">table_definition_cache=1400</div><div class="line"></div><div class="line">binlog_row_event_max_size=8K</div><div class="line"></div><div class="line">sync_master_info=10000</div><div class="line"></div><div class="line">sync_relay_log=10000</div><div class="line"></div><div class="line">sync_relay_log_info=10000</div></pre></td></tr></table></figure></p>
<hr>
<p>之前的主从配置和使用第三方开源框架实现读写分离</p>
<p>详细实现主从如下</p>
<h3 id="2-MySQL主从"><a href="#2-MySQL主从" class="headerlink" title="2 MySQL主从"></a>2 MySQL主从</h3><p>这里介绍win环境下MySQL的主从和读写分离，同样Linux操作系统下也是这个原理  </p>
<p>master(IP:192.168.1.15)主服务器mysql<br>slave(IP:192.168.1.200)从服务器mysql<br>需要注意的地方<br>1.数据库主从和读写分离不同服务器上mysql版本尽量保持一致，以免造成不必要的麻烦。<br>2.不同服务器都要含有需要同步的指定数据库。<br>3.数据库中已存在的表在同步成功后从数据库中也不会同步，只能同步成功配置同步以后创建的表。</p>
<h4 id="开启log-bin"><a href="#开启log-bin" class="headerlink" title="开启log_bin"></a>开启log_bin</h4><p>安装服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\mysql\mysql-5.5.47-win32\bin&gt;mysql -install</div></pre></td></tr></table></figure></p>
<p>参考：<a href="https://volc1605.github.io/2017/01/05/win%E9%85%8D%E7%BD%AEMySQL/">win配置mysql</a><br><!-- more --><br>查看log_bin是否开启<br><img src="https://volc1605.github.io/images/MySQL主从配置和读写分离/1.png" alt="查看log_bin是否开启"><br>如果log_bin的值OFF需要在配置文件中开启<br>找到mysql安装目录下的配置文件my.ini，在[mysqld]追加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line"># 开启log_bin</div><div class="line">log_bin</div></pre></td></tr></table></figure></p>
<h4 id="配置master-主数据库-my-ini"><a href="#配置master-主数据库-my-ini" class="headerlink" title="配置master(主数据库)my.ini"></a>配置master(主数据库)my.ini</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">追加[mysqld]配置</div><div class="line"># =============读写===========</div><div class="line"></div><div class="line">log-bin = mysql-bin</div><div class="line"></div><div class="line">log-bin-index = mysql-bin.index</div><div class="line"></div><div class="line"># 服务Id，和slave 的server-id不一样，一般取ip最后一节</div><div class="line">server-id = 15</div><div class="line"></div><div class="line">sync_binlog = 1</div><div class="line"></div><div class="line">binlog_format = mixed</div><div class="line"></div><div class="line"># 做主从同步的数据库名</div><div class="line">binlog-do-db = test</div><div class="line"></div><div class="line">binlog-ignore-db = mysql</div><div class="line"></div><div class="line">binlog-ignore-db = performance_schema</div><div class="line"></div><div class="line">binlog-ignore-db = information_schema</div><div class="line"># =============结束===========</div></pre></td></tr></table></figure>
<h4 id="关联从数据库，并给予全部权限"><a href="#关联从数据库，并给予全部权限" class="headerlink" title="关联从数据库，并给予全部权限"></a>关联从数据库，并给予全部权限</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; grant all privileges on *.* to &apos;root&apos;@&apos;192.168.1.200&apos; identified by &apos;root&apos; with grant option;</div></pre></td></tr></table></figure>
<p><img src="https://volc1605.github.io/images/MySQL主从配置和读写分离/2.png" alt="关联从数据库并给予权限"></p>
<p>‘root’                     slave从数据库账户<br>‘192.168.1.200’            slaveIP<br>‘root’                    slave登录密码</p>
<p>刷新权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; flush privileges;</div></pre></td></tr></table></figure></p>
<p>在从服务器上链接主服务器mysql<br><img src="https://volc1605.github.io/images/MySQL主从配置和读写分离/3.png" alt="链接master数据库"></p>
<h4 id="获取master状态信息"><a href="#获取master状态信息" class="headerlink" title="获取master状态信息"></a>获取master状态信息</h4><p><img src="https://volc1605.github.io/images/MySQL主从配置和读写分离/4.png" alt="获取master状态信息"></p>
<p>记录以下两个字段值，从服务器上mysql配置需要用到<br>File: mysql-bin.000015<br>Position: 107</p>
<h4 id="配置slave数据库"><a href="#配置slave数据库" class="headerlink" title="配置slave数据库"></a>配置slave数据库</h4><p>配置my.ini<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">#=========新增=====</div><div class="line"># 服务Id，和master 的server-id不一样</div><div class="line">server-id = 200</div><div class="line">log-bin = mysql-bin</div><div class="line">relay-log-index = slave-relay-bin.index</div><div class="line">relay-log = slave-relay-bin</div><div class="line">sync_master_info = 1</div><div class="line">sync_relay_log = 1</div><div class="line">sync_relay_log_info = 1</div><div class="line">#=========结束======</div></pre></td></tr></table></figure></p>
<p>重新启动从服务器上的mysql服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; net stop mysql</div><div class="line">mysql&gt; net start mysql</div></pre></td></tr></table></figure></p>
<p>确认在从服务器上可以链接本地的mysql后进行以下操作<br>关闭slave数据库同步，关联master数据库信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line">mysql&gt; stop slave;</div><div class="line">mysql&gt; change master to master_host=&apos;192.168.1.15&apos;,master_user=&apos;root&apos;,master_port=3306,master_password=&apos;root&apos;,master_log_file=&apos;mysql-bin.000015&apos;,master_log_pos=107;</div><div class="line">Query OK, 0 rows affected (0.21 sec)</div><div class="line"></div><div class="line">mysql&gt; show slave status\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">               Slave_IO_State:</div><div class="line">                  Master_Host: 192.168.1.15</div><div class="line">                  Master_User: root</div><div class="line">                  Master_Port: 3306</div><div class="line">                Connect_Retry: 60</div><div class="line">              Master_Log_File: mysql-bin.000015</div><div class="line">          Read_Master_Log_Pos: 107</div><div class="line">               Relay_Log_File: slave-relay-bin.000001</div><div class="line">                Relay_Log_Pos: 4</div><div class="line">        Relay_Master_Log_File: mysql-bin.000015</div><div class="line">             Slave_IO_Running: No</div><div class="line">            Slave_SQL_Running: No</div><div class="line">              Replicate_Do_DB:</div><div class="line">          Replicate_Ignore_DB:</div><div class="line">           Replicate_Do_Table:</div><div class="line">       Replicate_Ignore_Table:</div><div class="line">      Replicate_Wild_Do_Table:</div><div class="line">  Replicate_Wild_Ignore_Table:</div><div class="line">                   Last_Errno: 0</div><div class="line">                   Last_Error:</div><div class="line">                 Skip_Counter: 0</div><div class="line">          Exec_Master_Log_Pos: 107</div><div class="line">              Relay_Log_Space: 107</div><div class="line">              Until_Condition: None</div><div class="line">               Until_Log_File:</div><div class="line">                Until_Log_Pos: 0</div><div class="line">           Master_SSL_Allowed: No</div><div class="line">           Master_SSL_CA_File:</div><div class="line">           Master_SSL_CA_Path:</div><div class="line">              Master_SSL_Cert:</div><div class="line">            Master_SSL_Cipher:</div><div class="line">               Master_SSL_Key:</div><div class="line">        Seconds_Behind_Master: NULL</div><div class="line">Master_SSL_Verify_Server_Cert: No</div><div class="line">                Last_IO_Errno: 0</div><div class="line">                Last_IO_Error:</div><div class="line">               Last_SQL_Errno: 0</div><div class="line">               Last_SQL_Error:</div><div class="line">  Replicate_Ignore_Server_Ids:</div><div class="line">             Master_Server_Id: 15</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; start slave;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; show slave status\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">               Slave_IO_State: Waiting for master to send event</div><div class="line">                  Master_Host: 192.168.1.15</div><div class="line">                  Master_User: root</div><div class="line">                  Master_Port: 3306</div><div class="line">                Connect_Retry: 60</div><div class="line">              Master_Log_File: mysql-bin.000015</div><div class="line">          Read_Master_Log_Pos: 107</div><div class="line">               Relay_Log_File: slave-relay-bin.000002</div><div class="line">                Relay_Log_Pos: 253</div><div class="line">        Relay_Master_Log_File: mysql-bin.000015</div><div class="line">             Slave_IO_Running: Yes</div><div class="line">            Slave_SQL_Running: Yes</div><div class="line">              Replicate_Do_DB:</div><div class="line">          Replicate_Ignore_DB:</div><div class="line">           Replicate_Do_Table:</div><div class="line">       Replicate_Ignore_Table:</div><div class="line">      Replicate_Wild_Do_Table:</div><div class="line">  Replicate_Wild_Ignore_Table:</div><div class="line">                   Last_Errno: 0</div><div class="line">                   Last_Error:</div><div class="line">                 Skip_Counter: 0</div><div class="line">          Exec_Master_Log_Pos: 107</div><div class="line">              Relay_Log_Space: 409</div><div class="line">              Until_Condition: None</div><div class="line">               Until_Log_File:</div><div class="line">                Until_Log_Pos: 0</div><div class="line">           Master_SSL_Allowed: No</div><div class="line">           Master_SSL_CA_File:</div><div class="line">           Master_SSL_CA_Path:</div><div class="line">              Master_SSL_Cert:</div><div class="line">            Master_SSL_Cipher:</div><div class="line">               Master_SSL_Key:</div><div class="line">        Seconds_Behind_Master: 0</div><div class="line">Master_SSL_Verify_Server_Cert: No</div><div class="line">                Last_IO_Errno: 0</div><div class="line">                Last_IO_Error:</div><div class="line">               Last_SQL_Errno: 0</div><div class="line">               Last_SQL_Error:</div><div class="line">  Replicate_Ignore_Server_Ids:</div><div class="line">             Master_Server_Id: 15</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<p>注意<br>Slave_IO_Running: Yes<br>Slave_SQL_Running: Yes<br>说明主从配置成功</p>
<h4 id="测试主从"><a href="#测试主从" class="headerlink" title="测试主从"></a>测试主从</h4><p>master中test数据库和slave中test数据库进行同步测试。<br>在master中test数据库新建test表，刷新slave中test数据库会发现同步成功。<br>而master不会同步slave中创建的表，想让master同步slave中创建的表可参考以下方案。</p>
<h4 id="master与slave数据恢复"><a href="#master与slave数据恢复" class="headerlink" title="master与slave数据恢复"></a>master与slave数据恢复</h4><h4 id="应用切换到slave"><a href="#应用切换到slave" class="headerlink" title="应用切换到slave"></a>应用切换到slave</h4><p>如果master mysql坏掉了，需要将应用转移到slave段。首先在slave端执行：show master status;<br>把输出保存下来，然后再把应用切换过去。保存输出的File和Position值将可以用于以后从slave恢复master。<br> 具体从slave恢复master的办法：<br> 在master端执行：<br>CHANGE MASTER to MASTER_HOST=’192.168.0.203’, MASTER_PORT=3306, MASTER_USER=’repl’, MASTER_PASSWORD=’repl’,<br>MASTER_LOG_FILE=’mysql-bin.000006’, MASTER_LOG_POS=98 ;<br>其中 MASTER_HOST 为slave的ip, MASTER_LOG_FILE, MASTER_LOG_POS为切换到slave时记录下的File和Position值。<br>在master执行：start slave;<br>待master内容基本恢复以后（在master执行：show slave status \G; Slave_IO_State显示为Waiting for master to send event）<br>将应用切换回master。<br>待系统稳定后master执行：stop slave停止slave。如果要避免master重启以后自动开启slave，可以将master<br>mysql的data文件夹的master.info文件删掉。<br>参考：<a href="http://blog.sina.com.cn/s/blog_620adf7f0100kj5e.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_620adf7f0100kj5e.html</a>  </p>
<h3 id="使用Amoeba-阿米巴-开源框架实现mysql读写分离-负载均衡"><a href="#使用Amoeba-阿米巴-开源框架实现mysql读写分离-负载均衡" class="headerlink" title="使用Amoeba(阿米巴)开源框架实现mysql读写分离(负载均衡)"></a>使用Amoeba(阿米巴)开源框架实现mysql读写分离(负载均衡)</h3><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>环境:<br>    windows 64<br>    amoeba-for-mysql-2.2.0.zip<br>    java version “1.8.0_31”<br>    mysql-5.5.47-win32<br>win需要安装jdk运行环境支持amoeba的运行<br>mastermysqlIP:192.168.1.15<br>slavemysqlIP:192.168.1.200<br>amoeba-for-mysql-2安装在IP:192.168.1.15<br>master和slave已实现了主从，配置主从可参考上面<br>下面介绍一下amoeba的使用</p>
<h3 id="配置amoeba"><a href="#配置amoeba" class="headerlink" title="配置amoeba"></a>配置amoeba</h3><p>将下载好的amoeba-for-mysql-2.2.0.zip文件解压到C:\mysql\amoeba-for-mysql-2.2.0<br><img src="https://volc1605.github.io/images/MySQL主从配置和读写分离/9.png" alt="目录结构"></p>
<p>conf目录下有dbServers.xml和amoeba.xml两个文件需要修改<br>dbServers.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;gbk&quot;?&gt;</div><div class="line"></div><div class="line">&lt;!DOCTYPE amoeba:dbServers SYSTEM &quot;dbserver.dtd&quot;&gt;</div><div class="line">&lt;amoeba:dbServers xmlns:amoeba=&quot;http://amoeba.meidusa.com/&quot;&gt;</div><div class="line"></div><div class="line">		&lt;!-- </div><div class="line">			Each dbServer needs to be configured into a Pool,</div><div class="line">			If you need to configure multiple dbServer with load balancing that can be simplified by the following configuration:</div><div class="line">			 add attribute with name virtual = &quot;true&quot; in dbServer, but the configuration does not allow the element with name factoryConfig</div><div class="line">			 such as &apos;multiPool&apos; dbServer   </div><div class="line">		--&gt;</div><div class="line">		</div><div class="line">	&lt;dbServer name=&quot;abstractServer&quot; abstractive=&quot;true&quot;&gt;</div><div class="line">		&lt;factoryConfig class=&quot;com.meidusa.amoeba.mysql.net.MysqlServerConnectionFactory&quot;&gt;</div><div class="line">			&lt;property name=&quot;manager&quot;&gt;$&#123;defaultManager&#125;&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;sendBufferSize&quot;&gt;64&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;receiveBufferSize&quot;&gt;128&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- amoeba账户信息，主从服务器上的mysql需要为amoeba账号授权 --&gt;</div><div class="line">			&lt;!-- mysql port master数据库端口号--&gt;</div><div class="line">			&lt;property name=&quot;port&quot;&gt;3306&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- mysql schema master读写分离的数据库名称--&gt;</div><div class="line">			&lt;property name=&quot;schema&quot;&gt;newchange&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- mysql user amoeba账号名称--&gt;</div><div class="line">			&lt;property name=&quot;user&quot;&gt;amoeba&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- amoeba账号密码 --&gt;</div><div class="line">			&lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;</div><div class="line">			</div><div class="line">		&lt;/factoryConfig&gt;</div><div class="line"></div><div class="line">		&lt;poolConfig class=&quot;com.meidusa.amoeba.net.poolable.PoolableObjectPool&quot;&gt;</div><div class="line">			&lt;property name=&quot;maxActive&quot;&gt;500&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;maxIdle&quot;&gt;500&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;minIdle&quot;&gt;10&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;minEvictableIdleTimeMillis&quot;&gt;600000&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;timeBetweenEvictionRunsMillis&quot;&gt;600000&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;testOnBorrow&quot;&gt;true&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;testOnReturn&quot;&gt;true&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;testWhileIdle&quot;&gt;true&lt;/property&gt;</div><div class="line">		&lt;/poolConfig&gt;</div><div class="line">	&lt;/dbServer&gt;</div><div class="line">	&lt;!-- mastermysql --&gt;</div><div class="line">	&lt;dbServer name=&quot;master&quot;  parent=&quot;abstractServer&quot;&gt;</div><div class="line">		&lt;factoryConfig&gt;</div><div class="line">			&lt;!-- mysql ip --&gt;</div><div class="line">			&lt;property name=&quot;ipAddress&quot;&gt;192.168.1.15&lt;/property&gt;</div><div class="line">		&lt;/factoryConfig&gt;</div><div class="line">	&lt;/dbServer&gt;</div><div class="line">	&lt;!-- slavemysql --&gt;</div><div class="line">	&lt;dbServer name=&quot;slave&quot;  parent=&quot;abstractServer&quot;&gt;</div><div class="line">		&lt;factoryConfig&gt;</div><div class="line">			&lt;!-- mysql ip --&gt;</div><div class="line">			&lt;property name=&quot;ipAddress&quot;&gt;192.168.1.200&lt;/property&gt;</div><div class="line">		&lt;/factoryConfig&gt;</div><div class="line">	&lt;/dbServer&gt;</div><div class="line">	</div><div class="line">	&lt;dbServer name=&quot;multiPool&quot; virtual=&quot;true&quot;&gt;</div><div class="line">		&lt;poolConfig class=&quot;com.meidusa.amoeba.server.MultipleServerPool&quot;&gt;</div><div class="line">			&lt;!-- Load balancing strategy: 1=ROUNDROBIN , 2=WEIGHTBASED , 3=HA--&gt;</div><div class="line">			&lt;!-- 1为轮询，2为并 --&gt;</div><div class="line">			&lt;property name=&quot;loadbalance&quot;&gt;1&lt;/property&gt;</div><div class="line">			&lt;!-- Separated by commas,such as: server1,server2,server1 --&gt;</div><div class="line">			&lt;property name=&quot;poolNames&quot;&gt;master,slave&lt;/property&gt;</div><div class="line">		&lt;/poolConfig&gt;</div><div class="line">	&lt;/dbServer&gt;</div><div class="line">		</div><div class="line">&lt;/amoeba:dbServers&gt;</div></pre></td></tr></table></figure></p>
<p>amoeba.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;gbk&quot;?&gt;</div><div class="line"></div><div class="line">&lt;!DOCTYPE amoeba:configuration SYSTEM &quot;amoeba.dtd&quot;&gt;</div><div class="line">&lt;amoeba:configuration xmlns:amoeba=&quot;http://amoeba.meidusa.com/&quot;&gt;</div><div class="line"></div><div class="line">	&lt;proxy&gt;</div><div class="line">	</div><div class="line">		&lt;!-- service class must implements com.meidusa.amoeba.service.Service --&gt;</div><div class="line">		&lt;service name=&quot;Amoeba for Mysql&quot; class=&quot;com.meidusa.amoeba.net.ServerableConnectionManager&quot;&gt;</div><div class="line">			&lt;!-- port amoeba账号访问端口 --&gt;</div><div class="line">			&lt;property name=&quot;port&quot;&gt;8066&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- bind ipAddress --&gt;</div><div class="line">			</div><div class="line">			&lt;property name=&quot;ipAddress&quot;&gt;127.0.0.1&lt;/property&gt;</div><div class="line">			</div><div class="line">			</div><div class="line">			&lt;property name=&quot;manager&quot;&gt;$&#123;clientConnectioneManager&#125;&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;property name=&quot;connectionFactory&quot;&gt;</div><div class="line">				&lt;bean class=&quot;com.meidusa.amoeba.mysql.net.MysqlClientConnectionFactory&quot;&gt;</div><div class="line">					&lt;property name=&quot;sendBufferSize&quot;&gt;128&lt;/property&gt;</div><div class="line">					&lt;property name=&quot;receiveBufferSize&quot;&gt;64&lt;/property&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">			&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;property name=&quot;authenticator&quot;&gt;</div><div class="line">				&lt;bean class=&quot;com.meidusa.amoeba.mysql.server.MysqlClientAuthenticator&quot;&gt;</div><div class="line">					</div><div class="line">					&lt;!-- mysql客户端访问amoeba账号配置 --&gt;</div><div class="line">					&lt;property name=&quot;user&quot;&gt;amoebaroot&lt;/property&gt;</div><div class="line">					&lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;</div><div class="line">					&lt;property name=&quot;filter&quot;&gt;</div><div class="line">						&lt;bean class=&quot;com.meidusa.amoeba.server.IPAccessController&quot;&gt;</div><div class="line">							&lt;property name=&quot;ipFile&quot;&gt;$&#123;amoeba.home&#125;/conf/access_list.conf&lt;/property&gt;</div><div class="line">						&lt;/bean&gt;</div><div class="line">					&lt;/property&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">			&lt;/property&gt;</div><div class="line">			</div><div class="line">		&lt;/service&gt;</div><div class="line">		</div><div class="line">		&lt;!-- server class must implements com.meidusa.amoeba.service.Service --&gt;</div><div class="line">		&lt;service name=&quot;Amoeba Monitor Server&quot; class=&quot;com.meidusa.amoeba.monitor.MonitorServer&quot;&gt;</div><div class="line">			&lt;!-- port --&gt;</div><div class="line">			&lt;!--  default value: random number</div><div class="line">			&lt;property name=&quot;port&quot;&gt;9066&lt;/property&gt;</div><div class="line">			--&gt;</div><div class="line">			&lt;!-- bind ipAddress --&gt;</div><div class="line">			&lt;property name=&quot;ipAddress&quot;&gt;127.0.0.1&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;daemon&quot;&gt;true&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;manager&quot;&gt;$&#123;clientConnectioneManager&#125;&lt;/property&gt;</div><div class="line">			&lt;property name=&quot;connectionFactory&quot;&gt;</div><div class="line">				&lt;bean class=&quot;com.meidusa.amoeba.monitor.net.MonitorClientConnectionFactory&quot;&gt;&lt;/bean&gt;</div><div class="line">			&lt;/property&gt;</div><div class="line">			</div><div class="line">		&lt;/service&gt;</div><div class="line">		</div><div class="line">		&lt;runtime class=&quot;com.meidusa.amoeba.mysql.context.MysqlRuntimeContext&quot;&gt;</div><div class="line">			&lt;!-- proxy server net IO Read thread size --&gt;</div><div class="line">			&lt;property name=&quot;readThreadPoolSize&quot;&gt;20&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- proxy server client process thread size --&gt;</div><div class="line">			&lt;property name=&quot;clientSideThreadPoolSize&quot;&gt;30&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- mysql server data packet process thread size --&gt;</div><div class="line">			&lt;property name=&quot;serverSideThreadPoolSize&quot;&gt;30&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- per connection cache prepared statement size  --&gt;</div><div class="line">			&lt;property name=&quot;statementCacheSize&quot;&gt;500&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- query timeout( default: 60 second , TimeUnit:second) --&gt;</div><div class="line">			&lt;property name=&quot;queryTimeout&quot;&gt;60&lt;/property&gt;</div><div class="line">		&lt;/runtime&gt;</div><div class="line">		</div><div class="line">	&lt;/proxy&gt;</div><div class="line">	</div><div class="line">	&lt;!-- </div><div class="line">		Each ConnectionManager will start as thread</div><div class="line">		manager responsible for the Connection IO read , Death Detection</div><div class="line">	--&gt;</div><div class="line">	&lt;connectionManagerList&gt;</div><div class="line">		&lt;connectionManager name=&quot;clientConnectioneManager&quot; class=&quot;com.meidusa.amoeba.net.MultiConnectionManagerWrapper&quot;&gt;</div><div class="line">			&lt;property name=&quot;subManagerClassName&quot;&gt;com.meidusa.amoeba.net.ConnectionManager&lt;/property&gt;</div><div class="line">			&lt;!-- </div><div class="line">			  default value is avaliable Processors </div><div class="line">			&lt;property name=&quot;processors&quot;&gt;5&lt;/property&gt;</div><div class="line">			 --&gt;</div><div class="line">		&lt;/connectionManager&gt;</div><div class="line">		&lt;connectionManager name=&quot;defaultManager&quot; class=&quot;com.meidusa.amoeba.net.MultiConnectionManagerWrapper&quot;&gt;</div><div class="line">			&lt;property name=&quot;subManagerClassName&quot;&gt;com.meidusa.amoeba.net.AuthingableConnectionManager&lt;/property&gt;</div><div class="line">			</div><div class="line">			&lt;!-- </div><div class="line">			  default value is avaliable Processors </div><div class="line">			&lt;property name=&quot;processors&quot;&gt;5&lt;/property&gt;</div><div class="line">			 --&gt;</div><div class="line">		&lt;/connectionManager&gt;</div><div class="line">	&lt;/connectionManagerList&gt;</div><div class="line">	</div><div class="line">		&lt;!-- default using file loader --&gt;</div><div class="line">	&lt;dbServerLoader class=&quot;com.meidusa.amoeba.context.DBServerConfigFileLoader&quot;&gt;</div><div class="line">		&lt;property name=&quot;configFile&quot;&gt;$&#123;amoeba.home&#125;/conf/dbServers.xml&lt;/property&gt;</div><div class="line">	&lt;/dbServerLoader&gt;</div><div class="line">	</div><div class="line">	&lt;queryRouter class=&quot;com.meidusa.amoeba.mysql.parser.MysqlQueryRouter&quot;&gt;</div><div class="line">		&lt;property name=&quot;ruleLoader&quot;&gt;</div><div class="line">			&lt;bean class=&quot;com.meidusa.amoeba.route.TableRuleFileLoader&quot;&gt;</div><div class="line">				&lt;property name=&quot;ruleFile&quot;&gt;$&#123;amoeba.home&#125;/conf/rule.xml&lt;/property&gt;</div><div class="line">				&lt;property name=&quot;functionFile&quot;&gt;$&#123;amoeba.home&#125;/conf/ruleFunctionMap.xml&lt;/property&gt;</div><div class="line">			&lt;/bean&gt;</div><div class="line">		&lt;/property&gt;</div><div class="line">		&lt;property name=&quot;sqlFunctionFile&quot;&gt;$&#123;amoeba.home&#125;/conf/functionMap.xml&lt;/property&gt;</div><div class="line">		&lt;property name=&quot;LRUMapSize&quot;&gt;1500&lt;/property&gt;</div><div class="line">		&lt;property name=&quot;defaultPool&quot;&gt;master&lt;/property&gt;</div><div class="line">		&lt;!-- 可写数据库 --&gt;</div><div class="line">		&lt;property name=&quot;writePool&quot;&gt;master&lt;/property&gt;</div><div class="line">		&lt;!-- 可读的数据库 --&gt;</div><div class="line">		&lt;property name=&quot;readPool&quot;&gt;multiPool&lt;/property&gt;	</div><div class="line">		&lt;property name=&quot;needParse&quot;&gt;true&lt;/property&gt;</div><div class="line">	&lt;/queryRouter&gt;</div><div class="line">&lt;/amoeba:configuration&gt;</div></pre></td></tr></table></figure></p>
<p>配置文件配置完成，主从mysql为amoeba授权</p>
<p>分别登录主从mysql执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; grant all on newchange.* to amoeba@&apos;192.168.1.%&apos; identified by &apos;123456&apos;;</div><div class="line">flush privileges;</div></pre></td></tr></table></figure></p>
<p>启动amoeba<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">C:\mysql\amoeba-for-mysql-2.2.0\bin&gt;amoeba</div><div class="line">amoeba start|stop</div><div class="line">请按任意键继续. . .</div><div class="line"></div><div class="line">C:\mysql\amoeba-for-mysql-2.2.0\bin&gt;amoeba start</div><div class="line">log4j:WARN log4j config load completed from file:C:\mysql\amoeba-for-mysql-2.2.0</div><div class="line">\bin\..\conf\log4j.xml</div><div class="line">2017-01-06 14:46:42,470 INFO  context.MysqlRuntimeContext - Amoeba for Mysql cur</div><div class="line">rent versoin=5.1.45-mysql-amoeba-proxy-2.2.0</div><div class="line">log4j:WARN ip access config load completed from file:C:\mysql\amoeba-for-mysql-2</div><div class="line">.2.0\bin\../conf/access_list.conf</div><div class="line">2017-01-06 14:46:42,645 INFO  net.ServerableConnectionManager - Amoeba for Mysql</div><div class="line"> listening on /127.0.0.1:8066.</div><div class="line">2017-01-06 14:46:42,648 INFO  net.ServerableConnectionManager - Amoeba Monitor S</div><div class="line">erver listening on /127.0.0.1:49986.</div></pre></td></tr></table></figure></p>
<h4 id="测试读写分离及负载均衡"><a href="#测试读写分离及负载均衡" class="headerlink" title="测试读写分离及负载均衡"></a>测试读写分离及负载均衡</h4><p>在登录master主库上newchange数据库中创建liu表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create table liu (id int(10), text varchar(20));</div><div class="line">mysql&gt; insert into liu values(&apos;1&apos;, &apos;this_is_master&apos;);</div></pre></td></tr></table></figure></p>
<p>登录slave从库停掉从库复制进程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; stop slave;</div><div class="line">mysql&gt; insert into liu values(&apos;2&apos;,,&apos;this_is_slave&apos;);</div></pre></td></tr></table></figure></p>
<p>192.168.1.15(master服务器)连接amoeba客户端<br><img src="https://volc1605.github.io/images/MySQL主从配置和读写分离/10.png" alt="链接amoeba"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">C:\mysql\mysql-5.5.47-win32\bin&gt;mysql -u amoebaroot -p -h 127.0.0.1 -P 8066</div><div class="line">Enter password: ******</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 1164729376</div><div class="line">Server version: 5.1.45-mysql-amoeba-proxy-2.2.0 MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; use newchange;</div><div class="line">Database changed</div></pre></td></tr></table></figure>
<p>因为默认连的数据库是主库，第一次查询查的是主库的数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from liu;</div><div class="line">+------+----------------+</div><div class="line">| id   | text           |</div><div class="line">+------+----------------+</div><div class="line">|  1   | this_is_master |</div><div class="line">+------+----------------+</div><div class="line">1 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>因为开启了负载均衡并采用轮询模式该查询查的是从库的数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from liu;</div><div class="line">+------+---------------+</div><div class="line">| id   | text          |</div><div class="line">+------+---------------+</div><div class="line">|  1   | this_is_master|</div><div class="line">|  2   | this_is_slave |</div><div class="line">+------+---------------+</div><div class="line">2 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>插入两条数据，观察数据插入到哪个库中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql&gt; insert into liu values(&apos;3&apos;,&apos;this_is_master&apos;);</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; insert into liu values(&apos;3&apos;,&apos;this_is_master&apos;);</div><div class="line">Query OK, 1 row affected (0.01 sec)</div></pre></td></tr></table></figure>
<p>在主库查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from liu;</div><div class="line">+------+----------------+</div><div class="line">| id   | text           |</div><div class="line">+------+----------------+</div><div class="line">|  1   | this_is_master |</div><div class="line">|  3   | this_is_master |</div><div class="line">|  4   | this_is_master |</div><div class="line">+------+----------------+</div><div class="line">3 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>在从库查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from liu;</div><div class="line">+------+---------------+</div><div class="line">| id   |   text        |</div><div class="line">+------+---------------+</div><div class="line">|  2   | this_is_slave |</div><div class="line">+------+---------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>可见数据插入到了主库上，因为配置了主库可读写、从库为只读，且主从同步中从库的同步进程已被停用。</p>
<p>配置参考：<a href="http://docs.hexnova.com/amoeba/single-dbserver.html#example.dbServer.abstractServer.port" target="_blank" rel="external">http://docs.hexnova.com/amoeba/single-dbserver.html#example.dbServer.abstractServer.port</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[win配置MySQL]]></title>
      <url>https://volc1605.github.io/2017/01/05/win%E9%85%8D%E7%BD%AEMySQL/</url>
      <content type="html"><![CDATA[<h3 id="1-遇到的错误"><a href="#1-遇到的错误" class="headerlink" title="1 遇到的错误"></a>1 遇到的错误</h3><a id="more"></a>
<h4 id="1-1-mysql服务启动不了"><a href="#1-1-mysql服务启动不了" class="headerlink" title="1.1 mysql服务启动不了"></a>1.1 mysql服务启动不了</h4><p>查看D:\mysql\3381\logs\mysql.err.log错误日志文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2016-02-03 10:19:54 6448 [ERROR] InnoDB: Attempted to open a previously opened tablespace. Previous tablespace mysql/innodb_table_stats uses space ID: 1 at filepath: .\mysql\innodb_table_stats.ibd. Cannot open tablespace scrapers/openpasts_records which uses space ID: 1 at filepath: .\scrapers\openpasts_records.ibd</div></pre></td></tr></table></figure>
<p>问题出现原因是，由于移动其他盘的空间扩充到系统盘，系统盘扩充不会受到影响，而其他盘的文件索引改变了导致问题出现。</p>
<p>解决方法：<br>1 停止mysql服务<br>2 备份数据库，删掉出问题的数据库<br>3 删掉D:\mysql\3381\data\data文件夹下ibdata1及log文件,删掉D:\mysql\3381\logs中的日志文件<br>4 重启mysqls服务，导入新库</p>
<p>测试主从。<br>主从参考：<a href="http://volcfamily.cn/2017/01/05/MySQL%E4%B8%BB%E4%BB%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/" target="_blank" rel="external">点一下</a></p>
<h4 id="1-2-执行更新语句报错"><a href="#1-2-执行更新语句报错" class="headerlink" title="1.2 执行更新语句报错"></a>1.2 执行更新语句报错</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[Err] 1055 - Expression #1 of ORDER BY clause is not in GROUP BY clause and contains nonaggregated column &apos;information_schema.PROFILING.SEQ&apos; which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</div></pre></td></tr></table></figure>
<p>原因：<br>查询SQL_MODE信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select @@global.sql_mode;</div><div class="line">ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</div></pre></td></tr></table></figure></p>
<p>对于GROUP by聚合操作，如果在select中的列没有在GROUP BY中出现，那么sql语句是不合法的，因为a列不在group by从句中。<br>select id,sum(date) from tt group by date; // 不合法的sql语句<br>解决方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SET GLOBAL sql_mode=(SELECT REPLACE(@@sql_mode,&apos;ONLY_FULL_GROUP_BY&apos;,&apos;&apos;));</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="类型长度"><a href="#类型长度" class="headerlink" title="类型长度"></a>类型长度</h3><p>下载：<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="external">https://dev.mysql.com/downloads/mysql/</a></p>
<p>int和bigint超限会改变值<br>char和varchar超限会截取值<br><!-- more --></p>
<h3 id="win配置mysql"><a href="#win配置mysql" class="headerlink" title="win配置mysql"></a>win配置mysql</h3><h4 id="解压mysql-5-7-17-winx64-zip配置环境变量"><a href="#解压mysql-5-7-17-winx64-zip配置环境变量" class="headerlink" title="解压mysql-5.7.17-winx64.zip配置环境变量"></a>解压mysql-5.7.17-winx64.zip配置环境变量</h4><p>新增编辑用户变量：<br>    MYSQL_HOME<br>    C:\mysql\mysql-5.7.17-winx64<br>在编辑系统变量中path变量新增%MYSQL_HOME%\bin;</p>
<h4 id="初始化和配置"><a href="#初始化和配置" class="headerlink" title="初始化和配置"></a>初始化和配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\mysql\mysql-5.7.17-winx64\bin&gt;mysqld  --initialize</div></pre></td></tr></table></figure>
<p>增加服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\mysql\mysql-5.7.17-winx64\bin&gt;mysqld -install</div></pre></td></tr></table></figure></p>
<p>启动停止服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">C:\Users\Administrator&gt;net stop mysql</div><div class="line">MySQL 服务正在停止.</div><div class="line">MySQL 服务已成功停止。</div><div class="line"></div><div class="line">C:\Users\Administrator&gt;net start mysql</div><div class="line">MySQL 服务正在启动 .</div><div class="line">MySQL 服务已经启动成功。</div></pre></td></tr></table></figure></p>
<h4 id="查看版本号"><a href="#查看版本号" class="headerlink" title="查看版本号"></a>查看版本号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">C:\Users\Administrator&gt;mysql -V</div><div class="line">mysql  Ver 14.14 Distrib 5.7.17, for Win64 (x86)</div></pre></td></tr></table></figure>
<p>配置my.ini文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"># For advice on how to change settings please see</div><div class="line"># http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html</div><div class="line"># *** DO NOT EDIT THIS FILE. It&apos;s a template which will be copied to the</div><div class="line"># *** default location during install, and will be replaced if you</div><div class="line"># *** upgrade to a newer version of MySQL.</div><div class="line"></div><div class="line">[mysqld]</div><div class="line">#绑定IPv4和3306端口</div><div class="line">bind-address = 127.0.0.1</div><div class="line">port = 3306</div><div class="line">log_bin</div><div class="line"># 允许最大连接数</div><div class="line">max_connections = 200</div><div class="line">basedir = C:\mysql\mysql-5.7.17-winx64</div><div class="line">datadir = C:\mysql\mysql-5.7.17-winx64\data</div><div class="line">port = 3306</div><div class="line">server_id = 15</div><div class="line">#设置字符集为utf8  </div><div class="line">loose-default-character-set = utf8</div><div class="line"># join_buffer_size = 128M</div><div class="line"># sort_buffer_size = 2M</div><div class="line"># read_rnd_buffer_size = 2M </div><div class="line">[client]  </div><div class="line">#设置客户端字符集  </div><div class="line">loose-default-character-set = utf8</div><div class="line"></div><div class="line"># 不区分表的大小写</div><div class="line">lower_case_table_names = 1</div><div class="line">  </div><div class="line">[WinMySQLadmin]</div><div class="line">Server = C:\mysql\mysql-5.7.17-winx64\bin\mysqld.exe</div></pre></td></tr></table></figure></p>
<h4 id="net-start-mysql报错"><a href="#net-start-mysql报错" class="headerlink" title="net start mysql报错"></a>net start mysql报错</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">C:\Users\Administrator&gt;net start mysql</div><div class="line">MySQL 服务正在启动 .</div><div class="line">MySQL 服务无法启动。</div><div class="line"></div><div class="line">服务没有报告任何错误。</div><div class="line"></div><div class="line">请键入 NET HELPMSG 3534 以获得更多的帮助。</div></pre></td></tr></table></figure>
<p>或者遇到1067进程意外终止错误</p>
<p>解决方法：<br>1、打开任务管理器终止mysqld进程；<br>2、# 设置默认引擎(可分表)<br>    default-storage-engine=MRG_MyISAM8<br>3、打开mysql安装目录的data文件夹，删除以下2个文件：<br>ib_logfile0和ib_logfile1<br>4、找到在配置MySQL服务器时指定的InfoDB目录删除掉ibdata1<br>    根据my.ini文件中：</p>
<pre><code>#*** INNODB Specific options ***
innodb_data_home_dir=&quot;D:/&quot;。
</code></pre><p>5、重新启动MySQL的Service  </p>
<h4 id="win下忘记mysql登录密码"><a href="#win下忘记mysql登录密码" class="headerlink" title="win下忘记mysql登录密码"></a>win下忘记mysql登录密码</h4><h5 id="1-停止服务再执行跳过权限登录命令"><a href="#1-停止服务再执行跳过权限登录命令" class="headerlink" title="1.停止服务再执行跳过权限登录命令"></a>1.停止服务再执行跳过权限登录命令</h5><p>跳过权限命令<br>mysqld –defaults-file=”C:\mysql\mysql-5.7.17-winx64\my.ini” –console –skip-grant-tables<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">C:\mysql\mysql-5.7.17-winx64\bin&gt;net stop mysql</div><div class="line">mysql 服务正在停止.</div><div class="line">mysql 服务已成功停止。</div><div class="line"></div><div class="line">C:\mysql\mysql-5.7.17-winx64\bin&gt;mysqld --defaults-file=&quot;C:\mysql\mysql-5.7.17-winx64\my.ini&quot; --console --skip-grant-tables</div><div class="line"></div><div class="line">2017-01-04T08:01:40.506477Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is</div><div class="line"> deprecated. Please use --explicit_defaults_for_timestamp server option (see doc</div><div class="line">umentation for more details).</div><div class="line">2017-01-04T08:01:40.506477Z 0 [Note] --secure-file-priv is set to NULL. Operatio</div><div class="line">ns related to importing and exporting data are disabled</div><div class="line">2017-01-04T08:01:40.507477Z 0 [Note] mysqld (mysqld 5.7.17-log) starting as proc</div><div class="line">ess 9168 ...</div><div class="line">2017-01-04T08:01:40.513478Z 0 [Warning] No argument was provided to --log-bin, a</div><div class="line">nd --log-bin-index was not used; so replication may break when this MySQL server</div><div class="line"> acts as a master and has his hostname changed!! Please use &apos;--log-bin=PC-201606</div><div class="line">29TTDK-bin&apos; to avoid this problem.</div><div class="line">2017-01-04T08:01:40.527478Z 0 [Note] InnoDB: Mutexes and rw_locks use Windows in</div><div class="line">terlocked functions</div><div class="line">2017-01-04T08:01:40.528479Z 0 [Note] InnoDB: Uses event mutexes</div><div class="line">2017-01-04T08:01:40.529479Z 0 [Note] InnoDB: _mm_lfence() and _mm_sfence() are u</div><div class="line">sed for memory barrier</div><div class="line">2017-01-04T08:01:40.530479Z 0 [Note] InnoDB: Compressed tables use zlib 1.2.3</div><div class="line">2017-01-04T08:01:40.531479Z 0 [Note] InnoDB: Number of pools: 1</div><div class="line">2017-01-04T08:01:40.531479Z 0 [Note] InnoDB: Not using CPU crc32 instructions</div><div class="line">2017-01-04T08:01:40.534479Z 0 [Note] InnoDB: Initializing buffer pool, total siz</div><div class="line">e = 128M, instances = 1, chunk size = 128M</div><div class="line">2017-01-04T08:01:40.542479Z 0 [Note] InnoDB: Completed initialization of buffer</div><div class="line">pool</div><div class="line">2017-01-04T08:01:40.609483Z 0 [Note] InnoDB: Highest supported file format is Ba</div><div class="line">rracuda.</div><div class="line">2017-01-04T08:01:40.708489Z 0 [Note] InnoDB: Creating shared tablespace for temp</div><div class="line">orary tables</div><div class="line">2017-01-04T08:01:40.710489Z 0 [Note] InnoDB: Setting file &apos;.\ibtmp1&apos; size to 12</div><div class="line">MB. Physically writing the file full; Please wait ...</div><div class="line">2017-01-04T08:01:40.893499Z 0 [Note] InnoDB: File &apos;.\ibtmp1&apos; size is now 12 MB.</div><div class="line">2017-01-04T08:01:40.897500Z 0 [Note] InnoDB: 96 redo rollback segment(s) found.</div><div class="line">96 redo rollback segment(s) are active.</div><div class="line">2017-01-04T08:01:40.899500Z 0 [Note] InnoDB: 32 non-redo rollback segment(s) are</div><div class="line"> active.</div><div class="line">2017-01-04T08:01:40.905500Z 0 [Note] InnoDB: 5.7.17 started; log sequence number</div><div class="line"> 2535781</div><div class="line">2017-01-04T08:01:40.908500Z 0 [Note] InnoDB: Loading buffer pool(s) from C:\mysq</div><div class="line">l\mysql-5.7.17-winx64\data\ib_buffer_pool</div><div class="line">2017-01-04T08:01:40.908500Z 0 [Note] Plugin &apos;FEDERATED&apos; is disabled.</div><div class="line">2017-01-04T08:01:40.912500Z 0 [Warning] unknown variable &apos;loose-default-characte</div><div class="line">r-set=utf8&apos;</div><div class="line">2017-01-04T08:01:41.122513Z 0 [Warning] Failed to set up SSL because of the foll</div><div class="line">owing SSL library error: SSL context is not usable without certificate and priva</div><div class="line">te key</div><div class="line">2017-01-04T08:01:41.126513Z 0 [Note] Server hostname (bind-address): &apos;127.0.0.1&apos;</div><div class="line">; port: 3306</div><div class="line">2017-01-04T08:01:41.129513Z 0 [Note]   - &apos;127.0.0.1&apos; resolves to &apos;127.0.0.1&apos;;</div><div class="line">2017-01-04T08:01:41.131513Z 0 [Note] Server socket created on IP: &apos;127.0.0.1&apos;.</div><div class="line">2017-01-04T08:01:41.169515Z 0 [Note] InnoDB: Buffer pool(s) load completed at 17</div><div class="line">0104 16:01:41</div><div class="line">2017-01-04T08:01:41.209517Z 0 [Note] Executing &apos;SELECT * FROM INFORMATION_SCHEMA</div><div class="line">.TABLES;&apos; to get a list of tables using the deprecated partition engine. You may</div><div class="line"> use the startup option &apos;--disable-partition-engine-check&apos; to skip this check.</div><div class="line">2017-01-04T08:01:41.211518Z 0 [Note] Beginning of list of non-natively partition</div><div class="line">ed tables</div><div class="line">2017-01-04T08:01:41.242519Z 0 [Note] End of list of non-natively partitioned tab</div><div class="line">les</div><div class="line">2017-01-04T08:01:41.243519Z 0 [Note] mysqld: ready for connections.</div><div class="line">Version: &apos;5.7.17-log&apos;  socket: &apos;&apos;  port: 3306  MySQL Community Server (GPL)</div></pre></td></tr></table></figure></p>
<p>出现以上效果说明已经跳过了权限，如果遇到10065错误，就先停止mysqld.exe进程</p>
<h5 id="2-在新的CMD中执行命令"><a href="#2-在新的CMD中执行命令" class="headerlink" title="2.在新的CMD中执行命令"></a>2.在新的CMD中执行命令</h5><p>提示输入密码，直接按回车就好了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">C:\mysql\mysql-5.7.17-winx64\bin&gt;mysql -u root -p</div><div class="line">Enter password:</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 3</div><div class="line">Server version: 5.7.17-log MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; use mysql;</div><div class="line">Database changed</div><div class="line">mysql&gt; select count(1) from user where user = &apos;root&apos;;</div><div class="line">+----------+</div><div class="line">| count(1) |</div><div class="line">+----------+</div><div class="line">|        1 |</div><div class="line">+----------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; UPDATE user SET password = PASSWORD(&apos;root&apos;) WHERE user = &apos;root&apos;;</div><div class="line">ERROR 1054 (42S22): Unknown column &apos;password&apos; in &apos;field list&apos;</div><div class="line">mysql&gt; update user u set u.authentication_string = PASSWORD(&apos;root&apos;) WHERE u.user</div><div class="line"> = &apos;root&apos;;</div><div class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line">Rows matched: 1  Changed: 0  Warnings: 1</div><div class="line"></div><div class="line">mysql&gt; quit;</div><div class="line">Bye</div><div class="line"></div><div class="line">C:\mysql\mysql-5.7.17-winx64\bin&gt;net start mysql</div><div class="line">mysql 服务正在启动 .</div><div class="line">mysql 服务已经启动成功。</div><div class="line"></div><div class="line">C:\mysql\mysql-5.7.17-winx64\bin&gt;mysql -u root -p</div><div class="line">Enter password: ****</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 3</div><div class="line">Server version: 5.7.17-log</div><div class="line"></div><div class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<p>sql：update user u set u.authentication_string = PASSWORD(‘root’) WHERE u.user = ‘root’;<br>不同版本的mysql密码字段不一样，越过权限需要查看user表中字段信息</p>
<h3 id="分表"><a href="#分表" class="headerlink" title="分表"></a>分表</h3><p>参考地址：<br><a href="http://www.cnblogs.com/miketwais/articles/mysql_partition.html" target="_blank" rel="external">http://www.cnblogs.com/miketwais/articles/mysql_partition.html</a><br><a href="http://blog.csdn.net/shandalue/article/details/52035040" target="_blank" rel="external">http://blog.csdn.net/shandalue/article/details/52035040</a></p>
<p>哪些引擎可以分表？</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[java操作Excel]]></title>
      <url>https://volc1605.github.io/2016/12/24/java%E8%A7%A3%E6%9E%90Excel%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      <content type="html"><![CDATA[<h3 id="java解析-xlsx或者xls格式数据"><a href="#java解析-xlsx或者xls格式数据" class="headerlink" title="java解析.xlsx或者xls格式数据"></a>java解析.xlsx或者xls格式数据</h3><a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"><span class="keyword">import</span> java.text.DecimalFormat;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Cell;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Row;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Sheet;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Workbook;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.WorkbookFactory;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@param</span> &lt;E&gt;</div><div class="line"> * <span class="doctag">@ClassName</span> ReadExcelToList</div><div class="line"> * <span class="doctag">@Description</span> 读取xlsx数据返回list集合</div><div class="line"> * <span class="doctag">@Author</span> youtanzhi</div><div class="line"> * <span class="doctag">@Date</span> 2016年12月23日 下午4:09:30 需要注意的是导入的 poi相关jar包版本号要一致</div><div class="line"> * 需要两个jar包:poi和poi-ooxml</div><div class="line"> *       &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</div><div class="line"> *       &lt;artifactId&gt;poi&lt;/artifactId&gt;</div><div class="line"> *       &lt;version&gt;3.10-FINAL&lt;/version&gt; &lt;/dependency&gt; &lt;!--</div><div class="line"> *       https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml --&gt;</div><div class="line"> *       &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;</div><div class="line"> *       &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;</div><div class="line"> *       &lt;version&gt;3.10-FINAL&lt;/version&gt; &lt;/dependency&gt;</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadExcelToList</span>&lt;<span class="title">E</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;E&gt; <span class="title">getList</span><span class="params">(String file_dir, Class&lt;? extends Object&gt; classObj)</span> <span class="keyword">throws</span> IOException,</span></div><div class="line">	    InstantiationException, IllegalAccessException, IllegalArgumentException, InvocationTargetException &#123;</div><div class="line">	List&lt;E&gt; dataList = <span class="keyword">new</span> ArrayList&lt;E&gt;();</div><div class="line">	Method[] methods = classObj.getMethods();</div><div class="line">	Method m = <span class="keyword">null</span>;</div><div class="line">	List&lt;Method&gt; beanMehtodList = <span class="keyword">new</span> ArrayList&lt;Method&gt;();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; methods.length; x++) &#123;</div><div class="line">	    m = methods[x];</div><div class="line">	    beanMehtodList.add(m);</div><div class="line">	&#125;</div><div class="line">	Workbook book = <span class="keyword">null</span>;</div><div class="line">	book = getExcelWorkbook(file_dir);</div><div class="line">	Sheet sheet = getSheetByNum(book, <span class="number">0</span>);</div><div class="line">	<span class="keyword">int</span> lastRowNum = sheet.getLastRowNum(); <span class="comment">// 每一行含有内容的列的数量，如果lastCellNum大于含有内容列数的个数会报错。</span></div><div class="line">	System.out.println(<span class="string">"last number is "</span> + lastRowNum);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= lastRowNum; i++) &#123;</div><div class="line">	    Row row = <span class="keyword">null</span>;</div><div class="line">	    row = sheet.getRow(i);</div><div class="line">	    <span class="keyword">if</span> (row != <span class="keyword">null</span>) &#123;</div><div class="line">		System.out.println(<span class="string">"reading line is "</span> + i);</div><div class="line">		<span class="keyword">int</span> lastCellNum = row.getLastCellNum();</div><div class="line">		System.out.println(<span class="string">"lastCellNum is "</span> + lastCellNum);</div><div class="line">		Cell cell = <span class="keyword">null</span>;</div><div class="line">		<span class="comment">// 创建泛型对象</span></div><div class="line">		Object newInstance = classObj.newInstance();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; lastCellNum; j++) &#123;</div><div class="line">		    cell = row.getCell(j);</div><div class="line">		    String value = getValue(cell);</div><div class="line">		    <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;</div><div class="line">			Method method = beanMehtodList.get(<span class="number">4</span>);</div><div class="line">			method.invoke(newInstance, value);</div><div class="line">		    &#125;</div><div class="line">		&#125;</div><div class="line">		dataList.add((E) newInstance);</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> dataList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sheet <span class="title">getSheetByNum</span><span class="params">(Workbook book, <span class="keyword">int</span> number)</span> </span>&#123;</div><div class="line">	Sheet sheet = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    sheet = book.getSheetAt(number);</div><div class="line">	    <span class="comment">// if(sheet == null)&#123;</span></div><div class="line">	    <span class="comment">// sheet = book.createSheet("Sheet"+number);</span></div><div class="line">	    <span class="comment">// &#125;</span></div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e.getMessage());</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> sheet;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Workbook <span class="title">getExcelWorkbook</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">	Workbook book = <span class="keyword">null</span>;</div><div class="line">	File file = <span class="keyword">null</span>;</div><div class="line">	FileInputStream fis = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    file = <span class="keyword">new</span> File(filePath); <span class="comment">// filePath:E:/f/t.xls</span></div><div class="line">	    <span class="keyword">if</span> (!file.exists()) &#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"文件不存在"</span>);</div><div class="line">	    &#125; <span class="keyword">else</span> &#123;</div><div class="line">		fis = <span class="keyword">new</span> FileInputStream(file);</div><div class="line">		book = WorkbookFactory.create(fis);</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e.getMessage());</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">if</span> (fis != <span class="keyword">null</span>) &#123;</div><div class="line">		fis.close();</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> book;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">(Cell hssfCell)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (hssfCell.getCellType() == hssfCell.CELL_TYPE_BOOLEAN) &#123;</div><div class="line">	    <span class="comment">// 返回布尔类型的值</span></div><div class="line">	    <span class="keyword">return</span> String.valueOf(hssfCell.getBooleanCellValue());</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (hssfCell.getCellType() == hssfCell.CELL_TYPE_NUMERIC) &#123;</div><div class="line">	    <span class="comment">// 返回数值类型的值</span></div><div class="line">	    Object inputValue = <span class="keyword">null</span>;<span class="comment">// 单元格值</span></div><div class="line">	    Long longVal = Math.round(hssfCell.getNumericCellValue());</div><div class="line">	    Double doubleVal = hssfCell.getNumericCellValue();</div><div class="line">	    <span class="keyword">if</span> (Double.parseDouble(longVal + <span class="string">".0"</span>) == doubleVal) &#123; <span class="comment">// 判断是否含有小数位.0</span></div><div class="line">		inputValue = longVal;</div><div class="line">	    &#125; <span class="keyword">else</span> &#123;</div><div class="line">		inputValue = doubleVal;</div><div class="line">	    &#125;</div><div class="line">	    DecimalFormat df = <span class="keyword">new</span> DecimalFormat(<span class="string">"#.####"</span>); <span class="comment">// 格式化为四位小数，按自己需求选择；</span></div><div class="line">	    <span class="keyword">return</span> String.valueOf(df.format(inputValue)); <span class="comment">// 返回String类型</span></div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">	    <span class="comment">// 返回字符串类型的值</span></div><div class="line">	    <span class="keyword">return</span> String.valueOf(hssfCell.getStringCellValue());</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">imporDataFromExcel</span><span class="params">(Map&lt;String, Object&gt; param)</span> </span>&#123;</div><div class="line">	String file = <span class="string">"E:/f/t.xls"</span>;</div><div class="line">	StationRegister stationRegister = <span class="keyword">new</span> StationRegister();</div><div class="line">	ReadExcelToList&lt;StationRegister&gt; readExcelToList = <span class="keyword">new</span> ReadExcelToList&lt;StationRegister&gt;();</div><div class="line">	List&lt;StationRegister&gt; list = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">			list = readExcelToList.getList(file, stationRegister.getClass());</div><div class="line">	    &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">	    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">	    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">	    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="java导出为-xlsx或者xls"><a href="#java导出为-xlsx或者xls" class="headerlink" title="java导出为.xlsx或者xls"></a>java导出为.xlsx或者xls</h3><p>导出.xlsx<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.FileOutputStream;</div><div class="line"><span class="keyword">import</span> org.apache.poi.hssf.util.HSSFColor;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Cell;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.CellStyle;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Font;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Row;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Sheet;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Workbook;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.util.CellRangeAddress;</div><div class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> ReadDataToXlsx2</div><div class="line"> * <span class="doctag">@Description</span> 导出excel.xlsx格式</div><div class="line"> * <span class="doctag">@Author</span> youtanzhi</div><div class="line"> * <span class="doctag">@Date</span> 2016年12月27日 上午10:48:56</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadDataToXlsx2</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 存储路径</span></div><div class="line">    <span class="keyword">private</span> String excelPath = <span class="string">"D:/data.xlsx"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	ReadDataToXlsx2 excel = <span class="keyword">new</span> ReadDataToXlsx2();</div><div class="line">	<span class="keyword">if</span> (excel.createExcelFile()) &#123;</div><div class="line">	    System.out.println(<span class="string">"data.xlsx is created successfully."</span>);</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">createExcelFile</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">boolean</span> isCreateSuccess = <span class="keyword">false</span>;</div><div class="line">	Workbook workbook = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    workbook = <span class="keyword">new</span> XSSFWorkbook();</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	    System.out.println(<span class="string">"It cause Error on CREATING excel workbook: "</span>);</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (workbook != <span class="keyword">null</span>) &#123;</div><div class="line">	    Sheet sheet = workbook.createSheet(Constants.SHEETNAME);</div><div class="line">	    <span class="comment">// 合并单元格(表格标题)</span></div><div class="line">	    CellRangeAddress cra = <span class="keyword">new</span> CellRangeAddress(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">10</span>); <span class="comment">// 合并单元格的首行、最后一行、首列、最后一列</span></div><div class="line">	    sheet.addMergedRegion(cra);</div><div class="line">	    Row row_t = sheet.createRow(<span class="number">0</span>);</div><div class="line">	    Cell cell_t = row_t.createCell(<span class="number">0</span>);</div><div class="line">	    cell_t.setCellValue(<span class="string">"When you're right , no one remembers, when you're wrong ,no one forgets ."</span>);</div><div class="line">	    <span class="comment">// 字段标题</span></div><div class="line">	    Row row0 = sheet.createRow(Constants.TITELHIGHT);</div><div class="line">	    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</div><div class="line">		Cell cell_1 = row0.createCell(i, Cell.CELL_TYPE_STRING);</div><div class="line">		CellStyle style = getStyle(workbook);</div><div class="line">		cell_1.setCellStyle(style);</div><div class="line">		cell_1.setCellValue(<span class="string">"HELLO"</span> + i + <span class="string">"Column"</span>);</div><div class="line">		sheet.autoSizeColumn(i);</div><div class="line">	    &#125;</div><div class="line">	    <span class="comment">// 表格内容</span></div><div class="line">	    <span class="keyword">for</span> (<span class="keyword">int</span> rowNum = Constants.TITELHIGHT + <span class="number">1</span>; rowNum &lt; <span class="number">200</span>; rowNum++) &#123;</div><div class="line">		Row row = sheet.createRow(rowNum);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</div><div class="line">		    Cell cell = row.createCell(i, Cell.CELL_TYPE_STRING);</div><div class="line">		    cell.setCellValue(<span class="string">"cell"</span> + String.valueOf(rowNum + <span class="number">1</span>) + String.valueOf(i + <span class="number">1</span>));</div><div class="line">		&#125;</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">try</span> &#123;</div><div class="line">		FileOutputStream outputStream = <span class="keyword">new</span> FileOutputStream(excelPath);</div><div class="line">		workbook.write(outputStream);</div><div class="line">		outputStream.flush();</div><div class="line">		outputStream.close();</div><div class="line">		isCreateSuccess = <span class="keyword">true</span>;</div><div class="line">	    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">		System.out.println(<span class="string">"It cause Error on WRITTING excel workbook: "</span>);</div><div class="line">		e.printStackTrace();</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	File sss = <span class="keyword">new</span> File(excelPath);</div><div class="line">	System.out.println(sss.getAbsolutePath());</div><div class="line">	<span class="keyword">return</span> isCreateSuccess;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> CellStyle <span class="title">getStyle</span><span class="params">(Workbook workbook)</span> </span>&#123;</div><div class="line">	CellStyle style = workbook.createCellStyle();</div><div class="line">	style.setAlignment(CellStyle.ALIGN_CENTER);</div><div class="line">	style.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">	<span class="comment">// 设置单元格字体</span></div><div class="line">	Font headerFont = workbook.createFont(); <span class="comment">// 字体</span></div><div class="line">	headerFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">14</span>);</div><div class="line">	headerFont.setColor(HSSFColor.RED.index);</div><div class="line">	headerFont.setFontName(<span class="string">"宋体"</span>);</div><div class="line">	style.setFont(headerFont);</div><div class="line">	style.setWrapText(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 设置单元格边框及颜色</span></div><div class="line">	style.setBorderBottom((<span class="keyword">short</span>) <span class="number">1</span>);</div><div class="line">	style.setBorderLeft((<span class="keyword">short</span>) <span class="number">1</span>);</div><div class="line">	style.setBorderRight((<span class="keyword">short</span>) <span class="number">1</span>);</div><div class="line">	style.setBorderTop((<span class="keyword">short</span>) <span class="number">1</span>);</div><div class="line">	style.setWrapText(<span class="keyword">true</span>);</div><div class="line">	<span class="keyword">return</span> style;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getExcelPath</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.excelPath;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExcelPath</span><span class="params">(String excelPath)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.excelPath = excelPath;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@ClassName</span> Constants</div><div class="line">     * <span class="doctag">@Description</span> 表格属性常量</div><div class="line">     * <span class="doctag">@Author</span> youtanzhi</div><div class="line">     * <span class="doctag">@Date</span> 2016年12月27日 上午10:59:06</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Constants</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SHEETNAME = <span class="string">"标题1"</span>; <span class="comment">// 表格1标题</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TITELHIGHT = <span class="number">2</span>; <span class="comment">// 标题高度</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>导出.xls</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.OutputStream;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"><span class="keyword">import</span> java.util.Map.Entry;</div><div class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.HSSFCell;</div><div class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.HSSFRow;</div><div class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.HSSFSheet;</div><div class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.HSSFWorkbook;</div><div class="line"><span class="keyword">import</span> org.apache.poi.hssf.util.CellRangeAddress;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.CellStyle;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.Font;</div><div class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.IndexedColors;</div><div class="line"></div><div class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"deprecation"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelUtil</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HSSFWorkbook wb;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CellStyle titleStyle; <span class="comment">// 标题行样式</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Font titleFont; <span class="comment">// 标题行字体</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CellStyle dateStyle; <span class="comment">// 日期行样式</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Font dateFont; <span class="comment">// 日期行字体</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CellStyle headStyle; <span class="comment">// 表头行样式</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Font headFont; <span class="comment">// 表头行字体</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CellStyle contentStyle; <span class="comment">// 内容行样式</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Font contentFont; <span class="comment">// 内容行字体</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@throws</span> IllegalAccessException</div><div class="line">     * <span class="doctag">@throws</span> IllegalArgumentException</div><div class="line">     * <span class="doctag">@Description</span>: 将Map里的集合对象数据输出Excel数据流</div><div class="line">	 * ExportSetInfo实体类包含表格名称、字段、表格数据</div><div class="line">     */</div><div class="line">    <span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"unchecked"</span> &#125;)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">export2Excel</span><span class="params">(ExportSetInfo setInfo)</span> </span></div><div class="line">	    <span class="keyword">throws</span> IOException, IllegalArgumentException, IllegalAccessException &#123;</div><div class="line">	init();</div><div class="line">	Set&lt;Entry&lt;String, List&gt;&gt; set = setInfo.getObjsMap().entrySet();</div><div class="line">	String[] sheetNames = <span class="keyword">new</span> String[setInfo.getObjsMap().size()];</div><div class="line">	<span class="keyword">int</span> sheetNameNum = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (Entry&lt;String, List&gt; entry : set) &#123;</div><div class="line">	    sheetNames[sheetNameNum] = entry.getKey();</div><div class="line">	    sheetNameNum++;</div><div class="line">	&#125;</div><div class="line">	HSSFSheet[] sheets = getSheets(setInfo.getObjsMap().size(), sheetNames);</div><div class="line">	<span class="keyword">int</span> sheetNum = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (Entry&lt;String, List&gt; entry : set) &#123;</div><div class="line">	    <span class="comment">// Sheet</span></div><div class="line">	    List objs = entry.getValue();</div><div class="line">	    <span class="comment">// 标题行</span></div><div class="line">	    createTableTitleRow(setInfo, sheets, sheetNum);</div><div class="line">	    <span class="comment">// 日期行</span></div><div class="line">	    createTableDateRow(setInfo, sheets, sheetNum);</div><div class="line">	    <span class="comment">// 表头</span></div><div class="line">	    creatTableHeadRow(setInfo, sheets, sheetNum);</div><div class="line">	    <span class="comment">// 表体</span></div><div class="line">	    String[] fieldNames = setInfo.getFieldNames().get(sheetNum);</div><div class="line">	    <span class="keyword">int</span> rowNum = <span class="number">3</span>;</div><div class="line">	    <span class="keyword">for</span> (Object obj : objs) &#123;</div><div class="line">		HSSFRow contentRow = sheets[sheetNum].createRow(rowNum);</div><div class="line">		contentRow.setHeight((<span class="keyword">short</span>) <span class="number">300</span>);</div><div class="line">		HSSFCell[] cells = getCells(contentRow, setInfo.getFieldNames().get(sheetNum).length);</div><div class="line">		<span class="keyword">int</span> cellNum = <span class="number">1</span>; <span class="comment">// 去掉一列序号，因此从1开始</span></div><div class="line">		<span class="keyword">if</span> (fieldNames != <span class="keyword">null</span>) &#123;</div><div class="line">		    <span class="keyword">for</span> (<span class="keyword">int</span> num = <span class="number">0</span>; num &lt; fieldNames.length; num++) &#123;</div><div class="line">			Object value = ReflectionUtils.invokeGetterMethod(obj, fieldNames[num]);</div><div class="line">			cells[cellNum].setCellValue(value == <span class="keyword">null</span> ? <span class="string">""</span> : value.toString());</div><div class="line">			cellNum++;</div><div class="line">		    &#125;</div><div class="line">		&#125;</div><div class="line">		rowNum++;</div><div class="line">	    &#125;</div><div class="line">	    adjustColumnSize(sheets, sheetNum, fieldNames); <span class="comment">// 自动调整列宽</span></div><div class="line">	    sheetNum++;</div><div class="line">	&#125;</div><div class="line">	wb.write(setInfo.getOut());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">	wb = <span class="keyword">new</span> HSSFWorkbook();</div><div class="line"></div><div class="line">	titleFont = wb.createFont();</div><div class="line">	titleStyle = wb.createCellStyle();</div><div class="line">	dateStyle = wb.createCellStyle();</div><div class="line">	dateFont = wb.createFont();</div><div class="line">	headStyle = wb.createCellStyle();</div><div class="line">	headFont = wb.createFont();</div><div class="line">	contentStyle = wb.createCellStyle();</div><div class="line">	contentFont = wb.createFont();</div><div class="line"></div><div class="line">	initTitleCellStyle();</div><div class="line">	initTitleFont();</div><div class="line">	initDateCellStyle();</div><div class="line">	initDateFont();</div><div class="line">	initHeadCellStyle();</div><div class="line">	initHeadFont();</div><div class="line">	initContentCellStyle();</div><div class="line">	initContentFont();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 自动调整列宽</div><div class="line">     */</div><div class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">adjustColumnSize</span><span class="params">(HSSFSheet[] sheets, <span class="keyword">int</span> sheetNum, String[] fieldNames)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fieldNames.length + <span class="number">1</span>; i++) &#123;</div><div class="line">	    sheets[sheetNum].autoSizeColumn(i, <span class="keyword">true</span>);</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 创建标题行(需合并单元格)</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createTableTitleRow</span><span class="params">(ExportSetInfo setInfo, HSSFSheet[] sheets, <span class="keyword">int</span> sheetNum)</span> </span>&#123;</div><div class="line">	CellRangeAddress titleRange = <span class="keyword">new</span> CellRangeAddress(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, setInfo.getFieldNames().get(sheetNum).length);</div><div class="line">	sheets[sheetNum].addMergedRegion(titleRange);</div><div class="line">	HSSFRow titleRow = sheets[sheetNum].createRow(<span class="number">0</span>);</div><div class="line">	titleRow.setHeight((<span class="keyword">short</span>) <span class="number">800</span>);</div><div class="line">	HSSFCell titleCell = titleRow.createCell(<span class="number">0</span>);</div><div class="line">	titleCell.setCellStyle(titleStyle);</div><div class="line">	titleCell.setCellValue(setInfo.getTitles()[sheetNum]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 创建日期行(需合并单元格)</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createTableDateRow</span><span class="params">(ExportSetInfo setInfo, HSSFSheet[] sheets, <span class="keyword">int</span> sheetNum)</span> </span>&#123;</div><div class="line">	CellRangeAddress dateRange = <span class="keyword">new</span> CellRangeAddress(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, setInfo.getFieldNames().get(sheetNum).length);</div><div class="line">	sheets[sheetNum].addMergedRegion(dateRange);</div><div class="line">	HSSFRow dateRow = sheets[sheetNum].createRow(<span class="number">1</span>);</div><div class="line">	dateRow.setHeight((<span class="keyword">short</span>) <span class="number">350</span>);</div><div class="line">	HSSFCell dateCell = dateRow.createCell(<span class="number">0</span>);</div><div class="line">	dateCell.setCellStyle(dateStyle);</div><div class="line">	dateCell.setCellValue(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> Date()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 创建表头行(需合并单元格)</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">creatTableHeadRow</span><span class="params">(ExportSetInfo setInfo, HSSFSheet[] sheets, <span class="keyword">int</span> sheetNum)</span> </span>&#123;</div><div class="line">	<span class="comment">// 表头</span></div><div class="line">	HSSFRow headRow = sheets[sheetNum].createRow(<span class="number">2</span>);</div><div class="line">	headRow.setHeight((<span class="keyword">short</span>) <span class="number">350</span>);</div><div class="line">	<span class="comment">// 序号列</span></div><div class="line">	HSSFCell snCell = headRow.createCell(<span class="number">0</span>);</div><div class="line">	snCell.setCellStyle(headStyle);</div><div class="line">	snCell.setCellValue(<span class="string">"序号"</span>);</div><div class="line">	<span class="comment">// 列头名称</span></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> num = <span class="number">1</span>, len = setInfo.getHeadNames().get(sheetNum).length; num &lt;= len; num++) &#123;</div><div class="line">	    HSSFCell headCell = headRow.createCell(num);</div><div class="line">	    headCell.setCellStyle(headStyle);</div><div class="line">	    headCell.setCellValue(setInfo.getHeadNames().get(sheetNum)[num - <span class="number">1</span>]);</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 创建所有的Sheet</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HSSFSheet[] getSheets(<span class="keyword">int</span> num, String[] names) &#123;</div><div class="line">	HSSFSheet[] sheets = <span class="keyword">new</span> HSSFSheet[num];</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</div><div class="line">	    sheets[i] = wb.createSheet(names[i]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> sheets;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 创建内容行的每一列(附加一列序号)</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HSSFCell[] getCells(HSSFRow contentRow, <span class="keyword">int</span> num) &#123;</div><div class="line">	HSSFCell[] cells = <span class="keyword">new</span> HSSFCell[num + <span class="number">1</span>];</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, len = cells.length; i &lt; len; i++) &#123;</div><div class="line">	    cells[i] = contentRow.createCell(i);</div><div class="line">	    cells[i].setCellStyle(contentStyle);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 设置序号列值，因为出去标题行和日期行，所有-2</span></div><div class="line">	cells[<span class="number">0</span>].setCellValue(contentRow.getRowNum() - <span class="number">2</span>);</div><div class="line"></div><div class="line">	<span class="keyword">return</span> cells;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化标题行样式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initTitleCellStyle</span><span class="params">()</span> </span>&#123;</div><div class="line">	titleStyle.setAlignment(CellStyle.ALIGN_CENTER);</div><div class="line">	titleStyle.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">	titleStyle.setFont(titleFont);</div><div class="line">	titleStyle.setFillBackgroundColor(IndexedColors.SKY_BLUE.index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化日期行样式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initDateCellStyle</span><span class="params">()</span> </span>&#123;</div><div class="line">	dateStyle.setAlignment(CellStyle.ALIGN_CENTER_SELECTION);</div><div class="line">	dateStyle.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">	dateStyle.setFont(dateFont);</div><div class="line">	dateStyle.setFillBackgroundColor(IndexedColors.SKY_BLUE.index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化表头行样式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initHeadCellStyle</span><span class="params">()</span> </span>&#123;</div><div class="line">	headStyle.setAlignment(CellStyle.ALIGN_CENTER);</div><div class="line">	headStyle.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">	headStyle.setFont(headFont);</div><div class="line">	headStyle.setFillBackgroundColor(IndexedColors.YELLOW.index);</div><div class="line">	headStyle.setBorderTop(CellStyle.BORDER_MEDIUM);</div><div class="line">	headStyle.setBorderBottom(CellStyle.BORDER_THIN);</div><div class="line">	headStyle.setBorderLeft(CellStyle.BORDER_THIN);</div><div class="line">	headStyle.setBorderRight(CellStyle.BORDER_THIN);</div><div class="line">	headStyle.setTopBorderColor(IndexedColors.BLUE.index);</div><div class="line">	headStyle.setBottomBorderColor(IndexedColors.BLUE.index);</div><div class="line">	headStyle.setLeftBorderColor(IndexedColors.BLUE.index);</div><div class="line">	headStyle.setRightBorderColor(IndexedColors.BLUE.index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化内容行样式</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initContentCellStyle</span><span class="params">()</span> </span>&#123;</div><div class="line">	contentStyle.setAlignment(CellStyle.ALIGN_CENTER);</div><div class="line">	contentStyle.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">	contentStyle.setFont(contentFont);</div><div class="line">	contentStyle.setBorderTop(CellStyle.BORDER_THIN);</div><div class="line">	contentStyle.setBorderBottom(CellStyle.BORDER_THIN);</div><div class="line">	contentStyle.setBorderLeft(CellStyle.BORDER_THIN);</div><div class="line">	contentStyle.setBorderRight(CellStyle.BORDER_THIN);</div><div class="line">	contentStyle.setTopBorderColor(IndexedColors.BLUE.index);</div><div class="line">	contentStyle.setBottomBorderColor(IndexedColors.BLUE.index);</div><div class="line">	contentStyle.setLeftBorderColor(IndexedColors.BLUE.index);</div><div class="line">	contentStyle.setRightBorderColor(IndexedColors.BLUE.index);</div><div class="line">	contentStyle.setWrapText(<span class="keyword">true</span>); <span class="comment">// 字段换行</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化标题行字体</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initTitleFont</span><span class="params">()</span> </span>&#123;</div><div class="line">	titleFont.setFontName(<span class="string">"华文楷体"</span>);</div><div class="line">	titleFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">20</span>);</div><div class="line">	titleFont.setBoldweight(Font.BOLDWEIGHT_BOLD);</div><div class="line">	titleFont.setCharSet(Font.DEFAULT_CHARSET);</div><div class="line">	titleFont.setColor(IndexedColors.BLUE_GREY.index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化日期行字体</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initDateFont</span><span class="params">()</span> </span>&#123;</div><div class="line">	dateFont.setFontName(<span class="string">"隶书"</span>);</div><div class="line">	dateFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">10</span>);</div><div class="line">	dateFont.setBoldweight(Font.BOLDWEIGHT_BOLD);</div><div class="line">	dateFont.setCharSet(Font.DEFAULT_CHARSET);</div><div class="line">	dateFont.setColor(IndexedColors.BLUE_GREY.index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化表头行字体</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initHeadFont</span><span class="params">()</span> </span>&#123;</div><div class="line">	headFont.setFontName(<span class="string">"宋体"</span>);</div><div class="line">	headFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">10</span>);</div><div class="line">	headFont.setBoldweight(Font.BOLDWEIGHT_BOLD);</div><div class="line">	headFont.setCharSet(Font.DEFAULT_CHARSET);</div><div class="line">	headFont.setColor(IndexedColors.BLUE_GREY.index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 初始化内容行字体</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initContentFont</span><span class="params">()</span> </span>&#123;</div><div class="line">	contentFont.setFontName(<span class="string">"宋体"</span>);</div><div class="line">	contentFont.setFontHeightInPoints((<span class="keyword">short</span>) <span class="number">10</span>);</div><div class="line">	contentFont.setBoldweight(Font.BOLDWEIGHT_NORMAL);</div><div class="line">	contentFont.setCharSet(Font.DEFAULT_CHARSET);</div><div class="line">	contentFont.setColor(IndexedColors.BLUE_GREY.index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@Description</span>: 封装Excel导出的设置信息</div><div class="line">     * <span class="doctag">@author</span>: 谭又中</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportSetInfo</span> </span>&#123;</div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">	<span class="keyword">private</span> LinkedHashMap&lt;String, List&gt; objsMap;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> String[] titles;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> List&lt;String[]&gt; headNames;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> List&lt;String[]&gt; fieldNames;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> OutputStream out;</div><div class="line"></div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> LinkedHashMap&lt;String, List&gt; <span class="title">getObjsMap</span><span class="params">()</span> </span>&#123;</div><div class="line">	    <span class="keyword">return</span> objsMap;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> objMap</div><div class="line">	 *            导出数据</div><div class="line">	 * </div><div class="line">	 *            泛型 String : 代表sheet名称 List : 代表单个sheet里的所有行数据</div><div class="line">	 */</div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObjsMap</span><span class="params">(LinkedHashMap&lt;String, List&gt; objsMap)</span> </span>&#123;</div><div class="line">	    <span class="keyword">this</span>.objsMap = objsMap;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> List&lt;String[]&gt; getFieldNames() &#123;</div><div class="line">	    <span class="keyword">return</span> fieldNames;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> clazz</div><div class="line">	 *            对应每个sheet里的每行数据的对象的属性名称</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFieldNames</span><span class="params">(List&lt;String[]&gt; fieldNames)</span> </span>&#123;</div><div class="line">	    <span class="keyword">this</span>.fieldNames = fieldNames;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> String[] getTitles() &#123;</div><div class="line">	    <span class="keyword">return</span> titles;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> titles</div><div class="line">	 *            对应每个sheet里的标题，即顶部大字</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitles</span><span class="params">(String[] titles)</span> </span>&#123;</div><div class="line">	    <span class="keyword">this</span>.titles = titles;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> List&lt;String[]&gt; getHeadNames() &#123;</div><div class="line">	    <span class="keyword">return</span> headNames;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> headNames</div><div class="line">	 *            对应每个页签的表头的每一列的名称</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeadNames</span><span class="params">(List&lt;String[]&gt; headNames)</span> </span>&#123;</div><div class="line">	    <span class="keyword">this</span>.headNames = headNames;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> OutputStream <span class="title">getOut</span><span class="params">()</span> </span>&#123;</div><div class="line">	    <span class="keyword">return</span> out;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> out</div><div class="line">	 *            Excel数据将输出到该输出流</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOut</span><span class="params">(OutputStream out)</span> </span>&#123;</div><div class="line">	    <span class="keyword">this</span>.out = out;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[关于mysql关键字between and，>=<，in，or性能及优化]]></title>
      <url>https://volc1605.github.io/2016/12/22/%E5%85%B3%E4%BA%8Emysql%E5%85%B3%E9%94%AE%E5%AD%97between-and%EF%BC%8C-%EF%BC%8Cin%EF%BC%8Cor%E6%80%A7%E8%83%BD%E5%8F%8A%E4%BC%98%E5%8C%96/</url>
      <content type="html"><![CDATA[<h3 id="关于IN关键字的效率问题"><a href="#关于IN关键字的效率问题" class="headerlink" title="关于IN关键字的效率问题"></a>关于IN关键字的效率问题</h3><a id="more"></a>
<p>查询表<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select count(1) from tk_plan_wait;</div><div class="line">+----------+</div><div class="line">| count(1) |</div><div class="line">+----------+</div><div class="line">|    20312 |</div><div class="line">+----------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>这个表的总记录数为20312行</p>
<p>查询表索引<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show index from tk_plan_wait;</div><div class="line">+--------------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</div><div class="line">| Table        | Non_unique | Key_name        | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |</div><div class="line">+--------------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</div><div class="line">| tk_plan_wait |          0 | PRIMARY         |            1 | idx         | A         |       20703 |     NULL | NULL   |      | BTREE      |         |               |</div><div class="line">| tk_plan_wait |          0 | tk_plan_wait_pk |            1 | PLAN_NUM    | A         |       20703 |     NULL | NULL   |      | BTREE      |         |               |</div><div class="line">+--------------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</div><div class="line">2 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>由于索引PLAN_NUM字段是unique唯一类型，可以看到其散列程度（Cardinality）是非常高的，因此该索引是很有效的。<br>其中字段rows为1，只扫描了一行，含有索引其执行效率很高。  </p>
<blockquote>
<p>使用in关键字根据有索引字段查询  </p>
</blockquote>
<p>使用优化器EXPLAIN执行含有索引的sql请看执行情况<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; EXPLAIN SELECT * FROM `tk_plan_wait` WHERE PLAN_NUM in('367b069a-4f2c-4d6e-899a-9c9690760d19');</div><div class="line">+----+-------------+--------------+------------+-------+-----------------+-----------------+---------+-------+------+----------+-------+</div><div class="line">| id | select_type | table        | partitions | type  | possible_keys   | key             | key_len | ref   | rows | filtered | Extra |</div><div class="line">+----+-------------+--------------+------------+-------+-----------------+-----------------+---------+-------+------+----------+-------+</div><div class="line">|  1 | SIMPLE      | tk_plan_wait | NULL       | const | tk_plan_wait_pk | tk_plan_wait_pk | 152     | const |    1 |   100.00 | NULL  |</div><div class="line">+----+-------------+--------------+------------+-------+-----------------+-----------------+---------+-------+------+----------+-------+</div><div class="line">1 row in set, 1 warning (0.00 sec)</div></pre></td></tr></table></figure></p>
<p style="color:red"><br>其中字段rows为1，只扫描了一行，含有索引其执行效率很高。<br></p>

<blockquote>
<p>使用in关键字根据没有添加索引字段查询  </p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; EXPLAIN SELECT * FROM `tk_plan_wait` WHERE TASK_ARG1 in('t');</div><div class="line">+----+-------------+--------------+------------+------+---------------+------+---------+------+-------+----------+-------------+</div><div class="line">| id | select_type | table        | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra       |</div><div class="line">+----+-------------+--------------+------------+------+---------------+------+---------+------+-------+----------+-------------+</div><div class="line">|  1 | SIMPLE      | tk_plan_wait | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 20703 |    10.00 | Using where |</div><div class="line">+----+-------------+--------------+------------+------+---------------+------+---------+------+-------+----------+-------------+</div><div class="line">1 row in set, 1 warning (0.00 sec)</div></pre></td></tr></table></figure>
<p></p><p style="color:red"><br>其中字段rows为20703，in在不使用含有索引字段查询的情况下是进行了全表扫描的。<br></p><br>待续…<br>参考：<a href="http://amao12580.github.io/post/2016/07/MySQL-in-operator-must-lead-to-full-scan/" target="_blank" rel="external">http://amao12580.github.io/post/2016/07/MySQL-in-operator-must-lead-to-full-scan/</a><p></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[memcache]]></title>
      <url>https://volc1605.github.io/2016/12/12/memcache/</url>
      <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>1.由于memcached是基于libevent的，因此需要安装libevent，libevent-devel<br><a id="more"></a><br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">yum</span> install  libevent libevent-devel -y</div></pre></td></tr></table></figure></p>
<p>下载：<br><a href="http://www.monkey.org/~provos/libevent-2.0.10-stable.tar.gz" target="_blank" rel="external">http://www.monkey.org/~provos/libevent-2.0.10-stable.tar.gz</a><br>2.解压<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">tar</span> zxvf libevent-2.0.10-stable.tar.gz</div></pre></td></tr></table></figure></p>
<p>3.进入目录<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cd</span> libevent-2.0.10-stable</div></pre></td></tr></table></figure></p>
<p>4.切换到root<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">su</span></div></pre></td></tr></table></figure></p>
<p>5.安装gcc<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">yum</span> install gcc</div></pre></td></tr></table></figure></p>
<p>6.设置安装路径<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./configure -prefix=/usr</div></pre></td></tr></table></figure></p>
<p>7.编译<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">make</span></div></pre></td></tr></table></figure></p>
<p>8.安装<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">make</span> install</div></pre></td></tr></table></figure></p>
<p>9.测试libevent是否安装成功  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ls -al /usr/lib | grep libevent</div><div class="line">lrwxrwxrwx 1 root root 21 11?? 12 17:38 libevent-1.2.so.1 -&gt; libevent-1.2.so.1.0.3</div><div class="line">-rwxr-xr-x 1 root root 263546 11?? 12 17:38 libevent-1.2.so.1.0.3</div><div class="line">-rw-r–r– 1 root root 454156 11?? 12 17:38 libevent.a</div><div class="line">-rwxr-xr-x 1 root root 811 11?? 12 17:38 libevent.la</div><div class="line">lrwxrwxrwx 1 root root 21 11?? 12 17:38 libevent.so -&gt; libevent-1.2.so.1.0.3</div></pre></td></tr></table></figure>
<p>还不错，都安装上了。<br>安装libevent参考：<br>    <a href="http://blog.csdn.net/zhangm168/article/details/6272801" target="_blank" rel="external">http://blog.csdn.net/zhangm168/article/details/6272801</a></p>
<p>10.安装gcc<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">yum</span> install gcc* make*</div></pre></td></tr></table></figure></p>
<p>11.下载memcache<br>    地址:<a href="http://www.danga.com/memcached/dist/memcached-1.2.0.tar.gz" target="_blank" rel="external">http://www.danga.com/memcached/dist/memcached-1.2.0.tar.gz</a><br>12.在/tmp解压memcache  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">tar</span> zxvf memcached-1.4.33.tar.gz</div></pre></td></tr></table></figure>
<p>安装memcached，同时需要安装中指定libevent的安装位置：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cd /tmp</div><div class="line">tar zxvf memcached-1.4.33.tar.gz</div><div class="line">cd memcached-1.4.33.tar.gz</div><div class="line">./configure –with-libevent=/usr</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<p>如果中间出现报错，请仔细检查错误信息，按照错误信息来配置或者增加相应的库或者路径。<br>安装完成后会把memcached放到 /usr/local/bin/memcached ，<br>测试是否成功安装memcached：  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ls -al /usr/local/bin/mem*</div><div class="line">-rwxr-xr-x 1 root root 137986 11?? 12 17:39 /usr/local/bin/memcached</div><div class="line">-rwxr-xr-x 1 root root 140179 11?? 12 17:39 /usr/local/bin/memcached-debug</div></pre></td></tr></table></figure>
<p>13.启动memcache<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/bin/memcached -d -m 10 -u root -l 116.62.29.229 -p 12000 -c 256 -P /tmp/memcached.pid</div></pre></td></tr></table></figure></p>
<p>结束memcache<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">kill</span> cat /tmp/memcached.pid</div></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost /]# telnet 192.168.141.64 12000</div><div class="line">Trying 192.168.141.64...</div><div class="line">Connected to 192.168.141.64 (192.168.141.64).</div><div class="line">Escape character is '^]'.</div><div class="line">set key1 0 60 4</div><div class="line">zhou</div><div class="line">STORED</div><div class="line">get key1</div><div class="line">VALUE key1 0 4</div><div class="line">zhou</div><div class="line">END</div></pre></td></tr></table></figure></p>
<p>退出：quit或者ctrl + ] 然后在按q就行了。</p>
<p>把Memcached服务加载到Linux的启动项中.万一机器断电系统重启.那么Memcached就会自动启动了.<br>假如启动Memcache的服务器端的命令为：  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/bin/memcached -d -m 10 -u root -l 192.168.141.64 -p 12000 -c 256 -P</div></pre></td></tr></table></figure>
<p>想开机自动启动的话，只需在/etc/rc.d/rc.local中加入一行，下面命令  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/memcached/bin/memcached -d -m 10 -p 12000 -u apache -c 256</div></pre></td></tr></table></figure>
<p>上面有些东西可以参考一下：即，ip不指定时，默认是本机，用户:最好选择是：apache 或 deamon<br>这样，也就是属于哪个用户的服务，由哪个用户启动。  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">kill</span> -9 <span class="string">"进程号"</span></div></pre></td></tr></table></figure>
<p>参考<br>配置参考：<a href="http://blog.csdn.net/u013615806/article/details/51461759" target="_blank" rel="external">http://blog.csdn.net/u013615806/article/details/51461759</a><br>配置参考:<a href="http://www.itgo.me/a/x2750105529827921816/memcached" target="_blank" rel="external">http://www.itgo.me/a/x2750105529827921816/memcached</a>  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[linux安装JDK]]></title>
      <url>https://volc1605.github.io/2016/12/12/linux%E5%AE%89%E8%A3%85JDK/</url>
      <content type="html"><![CDATA[<h3 id="1-jdk安装"><a href="#1-jdk安装" class="headerlink" title="1 jdk安装"></a>1 jdk安装</h3><a id="more"></a>
<p>下载地址:<br>    <a href="http://www.oracle.com/technetwork/cn/java/javase/downloads/jdk8-downloads-2133151-zhs.html" target="_blank" rel="external">http://www.oracle.com/technetwork/cn/java/javase/downloads/jdk8-downloads-2133151-zhs.html</a><br>修改jdk中bin目录中的访问权限<br><!-- more --></p>
<p>chmod [who] [opt] [mode] 文件/目录名  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">chmod</span> a+rwx java</div></pre></td></tr></table></figure>
<p>1.修改etc/profile文件，追加一下jdk配置并保存<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">export</span> JAVA_HOME=/usr/java/jdk1.6.0_45  </div><div class="line"><span class="attribute">export</span> JAVA_BIN=/usr/java/jdk1.6.0_45/bin  </div><div class="line"><span class="attribute">export</span> PATH=$PATH:$JAVA_HOME/bin  </div><div class="line"><span class="attribute">export</span> CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  </div><div class="line"><span class="attribute">export</span> JAVA_HOME JAVA_BIN PATH CLASSPATH</div></pre></td></tr></table></figure></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">source</span> /etc/profile</div></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">source</span> /etc/profile  # 刷新系统配置文件</div></pre></td></tr></table></figure>
<p>2.在这个目录下/usr/local/java/jdk1.7.0_71/bin/修改java文件权限<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">chmod</span>  777 java </div><div class="line"><span class="attribute">java</span> -version</div></pre></td></tr></table></figure></p>
<p>问题  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Error</span> occurred during initialization of VM  </div><div class="line"><span class="attribute">Could</span> not reserve enough space for object heap</div></pre></td></tr></table></figure>
<p>解决方法<br>    在tomcat的bin目录下，catalina.sh文件的tomcat内存参数配置过大，超过机器可用内存总数造成，修改到适当的值即可，修改的参数   为：JAVA_OPTS=”-Xms50m -Xmx60m”</p>
<h1 id="查看tomcat是否启动"><a href="#查看tomcat是否启动" class="headerlink" title="查看tomcat是否启动"></a>查看tomcat是否启动</h1><p>命令：ps -ef|grep java 或者 ps -aux | grep tomcat<br>如果出现一下情况说明tomcat已启用</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">root</span> 7010 1 0 Apr19 ? 00:30:13 /usr/local/java/bin/java -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties -Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=256m -XX:MaxNewSize=256m -XX:PermSize=256m -XX:MaxPermSize=256m -XX:+DisableExplicitGC -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.endorsed.dirs=/usr/local/tomcat/endorsed -classpath /usr/local/tomcat/bin/bootstrap.jar -Dcatalina.base=/usr/local/tomcat -Dcatalina.home=/usr/local/tomcat -Djava.io.tmpdir=/usr/local/tomcat/temp org.apache.catalina.startup.Bootstrap start</div></pre></td></tr></table></figure>
<p>如果出现一下情况说明tomcat已停用<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">root</span> 7010 1 0 Apr19 ? 00:30:30<span class="meta"> [java]</span></div></pre></td></tr></table></figure></p>
<p>安装JDK和Tomcat参考<br>配置参考：<a href="http://blog.csdn.net/zhuying_linux/article/details/6583096/" target="_blank" rel="external">http://blog.csdn.net/zhuying_linux/article/details/6583096/</a><br>配置参考：<a href="http://www.jb51.net/article/85478.htm" target="_blank" rel="external">http://www.jb51.net/article/85478.htm</a>  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Dubbo+zookeeper]]></title>
      <url>https://volc1605.github.io/2016/12/12/DUBBO+ZOOKEEPER/</url>
      <content type="html"><![CDATA[<h1 id="安装zookeeper"><a href="#安装zookeeper" class="headerlink" title="安装zookeeper"></a>安装zookeeper</h1><p>1.下载安装包<br>下载地址：<a href="http://mirrors.hust.edu.cn/apache/zookeeper/zookeeper-3.4.6/" target="_blank" rel="external">http://mirrors.hust.edu.cn/apache/zookeeper/zookeeper-3.4.6/</a><br><a id="more"></a><br>在/webapp下解压安装文件<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">tar</span> -xzvf zookeeper-3.4.5.tar.gz</div></pre></td></tr></table></figure></p>
<p>/webapp/zookeeper-3.4.5下创建logs文件夹<br>2.zookeeper的环境变量的配置  </p>
<p>在/etc/profile文件中加入如下的内容：  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#set zookeeper environment</span></div><div class="line"><span class="attribute">export</span> ZOOKEEPER_HOME=/home/haduser/zookeeper/zookeeper-3.4.5</div><div class="line"><span class="attribute">export</span> PATH=$PATH:$ZOOKEEPER_HOME/bin:$ZOOKEEPER_HOME/conf</div></pre></td></tr></table></figure>
<p>3.集群部署<br>    在Zookeeper集群环境下只要一半以上的机器正常启动了，那么Zookeeper服务将是可用的。因此，集群上部署Zookeeper最好使用奇数台机器，这样如果有5台机器，只要3台正常工作则服务将正常使用。<br>下面我们将对Zookeeper的配置文件的参数进行设置：</p>
<p>进入zookeeper-3.4.5/conf</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$:cp zoo_sample.cfg zoo.cfg</div><div class="line">$:vim zoo.cfg</div></pre></td></tr></table></figure>
<p><img src="https://volc1605.github.io/images/DUBBO+ZOOKEEPER/1.png" alt="1">   </p>
<p>注意上图的配置中master，slave1分别为主机名，具体的对应的主机可参见之前的Hadoop的安装与配置的博文<br>在上面的配置文件中”server.id=host:port:port”中的第一个port是从机器（follower）连接到主机器（leader）的端口号，第二个port是进行leadership选举的端口号。  </p>
<p>接下来在dataDir所指定的目录下创建一个文件名为myid的文件，文件中的内容只有一行，为本主机对应的id值，也就是上图中server.id中的id。例如：在服务器1中的myid的内容应该写入1。</p>
<p>4.远程复制分发安装文件  </p>
<p>接下来将上面的安装文件拷贝到集群中的其他机器上对应的目录下：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">haduser</span>@master:~/zookeeper$ scp -r zookeeper-3.4.5/ slave1:/home/haduser/zookeeper/zookeeper-3.4.5  </div><div class="line"><span class="attribute">haduser</span>@master:~/zookeeper$ scp -r zookeeper-3.4.5/ slave2:/home/haduser/zookeeper/zookeeper-3.4.5</div></pre></td></tr></table></figure></p>
<p>拷贝完成后修改对应的机器上的myid。例如修改slave1中的myid如下：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">haduser</span>@slave1:~/zookeeper/zookeeper-3.4.5$ echo <span class="string">"2"</span> &gt; data/myid  </div><div class="line"><span class="attribute">haduser</span>@slave1:~/zookeeper/zookeeper-3.4.5$ cat data/myid</div></pre></td></tr></table></figure></p>
<p>内容为：2    </p>
<p>5.启动ZooKeeper集群<br>    在ZooKeeper集群的每个结点上，执行启动ZooKeeper服务的脚本，如下所示：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">haduser</span>@master:~/zookeeper/zookeeper-3.4.5$ bin/zkServer.sh start</div><div class="line"><span class="attribute">haduser</span>@slave1:~/zookeeper/zookeeper-3.4.5$ bin/zkServer.sh start</div><div class="line"><span class="attribute">haduser</span>@slave2:~/zookeeper/zookeeper-3.4.5$ bin/zkServer.sh start</div></pre></td></tr></table></figure></p>
<p><img src="https://volc1605.github.io/images/DUBBO+ZOOKEEPER/2.png" alt="2"><br>其中，QuorumPeerMain是zookeeper进程，启动正常。<br>如上依次启动了所有机器上的Zookeeper之后可以通过ZooKeeper的脚本来查看启动状态，包括集群中各个结点的角色（或是Leader，或是Follower），如下所示，是在ZooKeeper集群中的每个结点上查询的结果：</p>
<p><img src="https://volc1605.github.io/images/DUBBO+ZOOKEEPER/3.png" alt="3"><br>通过上面状态查询结果可见，slave1是集群的Leader，其余的两个结点是Follower。  </p>
<p>另外，可以通过客户端脚本，连接到ZooKeeper集群上。对于客户端来说，ZooKeeper是一个整体（ensemble），连接到ZooKeeper集群实际上感觉在独享整个集群的服务，所以，你可以在任何一个结点上建立到服务集群的连接，例如：<br>查看是否安装启动成功<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">bin</span>/zkCli.sh -server 116.62.2.289:2181</div></pre></td></tr></table></figure></p>
<p><img src="https://volc1605.github.io/images/DUBBO+ZOOKEEPER/4.png" alt="4"> </p>
<p>脚本启动<br>脚本内容：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">aaa</span>=` ps aux| grep <span class="string">"/webapp/zookeeper"</span> | grep -v grep|awk '&#123;print <span class="number">$2</span>&#125;'`</div><div class="line"></div><div class="line"><span class="attribute">if</span><span class="meta"> [ "$aaa" = "" ];</span></div><div class="line">then</div><div class="line">  (/webapp/zookeeper-3.4.5/bin/zkServer.sh start) &amp;&amp; (echo "Start zookeeper  Service  Successful!") || (echo "Start zookeeper Service Fault")</div><div class="line">else</div><div class="line">   echo ""</div><div class="line">   echo "zookeeper is runging"</div><div class="line">   echo ""</div><div class="line"></div><div class="line">fi</div></pre></td></tr></table></figure></p>
<p>启动脚本<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">sh</span> zkServer.sh</div></pre></td></tr></table></figure></p>
<p>启动结果：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@iZbp199af3f3y8j7fr8kolZ bin]# sh stop_zookeeper.sh </div><div class="line"> zookeeper is not runging </div><div class="line">[root@iZbp199af3f3y8j7fr8kolZ bin]# sh start_zookeeper.sh </div><div class="line">JMX enabled by default</div><div class="line">Using config: /webapp/zookeeper-3.4.5/bin/../conf/zoo.cfg</div><div class="line">Starting zookeeper ... STARTED</div><div class="line">Start zookeeper  Service  Successful!</div></pre></td></tr></table></figure></p>
<p>配置参考：<a href="http://www.cnblogs.com/yuyijq/p/3438829.html" target="_blank" rel="external">http://www.cnblogs.com/yuyijq/p/3438829.html</a><br>配置参考：<a href="http://343614597.blog.51cto.com/7056394/1874745" target="_blank" rel="external">http://343614597.blog.51cto.com/7056394/1874745</a><br>启动zookeeper<br>    在zookper-3.3.6/bin目录下执行<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./zkServer.sh start 启动zookeeper</div></pre></td></tr></table></figure></p>
<p>验证zookeeper是否启动<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">netstat</span> -lpn | grep 2181</div></pre></td></tr></table></figure></p>
<h1 id="安装DUBBO"><a href="#安装DUBBO" class="headerlink" title="安装DUBBO"></a>安装DUBBO</h1><p>1.下载dubbo安装包  </p>
<p>2.在根目录创建相应文件夹webapp/deploy/<br>并解压安装文件到deploy文件夹中  </p>
<p>3.配置<br>    /webapp/deploy/dubbo-admin/WEB-INF<br>    中的dubbo.properties文件<br>    内容如下：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">dubbo</span>.registry.address=zookeeper://127.0.0.1:2181  </div><div class="line"><span class="attribute">dubbo</span>.admin.root.password=root  </div><div class="line"><span class="attribute">dubbo</span>.admin.guest.password=guest</div></pre></td></tr></table></figure></p>
<p>4.然后启动tomcat服务，显示登陆页面，说明dubbo-admin部署成功<br>    访问路径：<a href="http://服务器IP:8080/" target="_blank" rel="external">http://服务器IP:8080/</a><br>    账号：root<br>    密码：root  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[linux安装Nginx]]></title>
      <url>https://volc1605.github.io/2016/12/12/Nginx/</url>
      <content type="html"><![CDATA[<h3 id="1-linux下安装Nginx参考"><a href="#1-linux下安装Nginx参考" class="headerlink" title="1 linux下安装Nginx参考"></a>1 linux下安装Nginx参考</h3><a id="more"></a>
<p>1.创建ucenter用户</p>
<p>一般生产环境是不会使用root用户来发布tomcat等应用的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"># 创建linux服务器的普通用户，用户名为ucenter，默认权限目录为home下的ucenter目录</div><div class="line">useradd ucenter</div><div class="line"># 进入根目录的home目录中</div><div class="line">cd home</div><div class="line"># 查看当前用户所处的目录</div><div class="line">pwd</div><div class="line"># ll会列出该文件下的所有文件信息，包括隐藏的文件，而ls -l只列出显式文件</div><div class="line">ll</div><div class="line"># 切换用户到ucenter</div><div class="line">su - ucenter</div><div class="line"># 查看当前用户所处的目录</div><div class="line">pwd</div><div class="line">/home/ucenter</div><div class="line"># 创建用户，用户名为ucenter访问权限为根目录下ucenter目录</div><div class="line">useradd ucenter -d /ucenter</div><div class="line"># 设置ucenter用户的密码为:ucenter</div><div class="line">passwd ucenter</div><div class="line"># 为ucenter用户创建ucenter目录</div><div class="line">mkdir /ucenter</div><div class="line"># 把ucenter目录及其下所有的目录的授权给ucenter用户和其所在的组</div><div class="line">chown ucenter:ucenter /ucenter/ -R</div></pre></td></tr></table></figure></p>
<p>2.更新163 yum源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cd /etc/yum.repos.d/</div><div class="line">mv CentOS-Base.repo CentOS-Base.repo.backup</div><div class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</div><div class="line">[root@localhost ~]# yum clean all</div><div class="line">[root@localhost ~]# yum makecache</div><div class="line">[root@localhost ~]# yum update</div></pre></td></tr></table></figure></p>
<p>或者是：<a href="http://centos.ustc.edu.cn/" target="_blank" rel="external">http://centos.ustc.edu.cn/</a></p>
<p>3.安装rzsz<br>yum -y install lrzsz</p>
<p>4.安装nginx命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">yum -y install gcc-c++  </div><div class="line">yum -y install pcre pcre-devel  </div><div class="line">yum -y install zlib zlib-devel  </div><div class="line">yum -y install openssl openssl—devel</div><div class="line">mkdir /usr/local/src/nginx</div><div class="line">cd /usr/local/src/nginx</div><div class="line"># 线上获取ngin安装包</div><div class="line">wget http://nginx.org/download/nginx-1.7.7.tar.gz</div><div class="line"># 线下获取ngin安装包，使用rz命令会弹出上传选项框，选择下载好的ngin安装包进行上传到当前目录下</div><div class="line">rz</div><div class="line"># 解压.tar.gz安装包</div><div class="line">tar -xvf nginx-1.7.7.tar.gz</div><div class="line"># 删除当前目录下资源</div><div class="line">rm -rf nginx-1.7.7.tar.gz</div><div class="line"># 进入解压的nginx中</div><div class="line">cd nginx-1.7.7</div><div class="line"># 安装到/ucenter/soft/nginx目录下</div><div class="line">mkdir -p /ucenter/soft/nginx</div><div class="line">cd /usr/local/src/nginx/nginx-1.7.7</div><div class="line"># 指定安装路径为/ucenter/soft/nginx用户：ucenter，组：ucenter</div><div class="line">./configure --prefix=/ucenter/soft/nginx --user=ucenter --group=ucenter</div><div class="line"># 源码需要编译,make进行编译</div><div class="line">make</div><div class="line"># 最后安装</div><div class="line">make install</div><div class="line"># 查看是否安装成功</div><div class="line">cd /ucenter/soft/nginx</div><div class="line">ll</div><div class="line"># sbin目录一般都为可执行的文件</div><div class="line">cd sbin</div><div class="line"># ./执行shell脚本文件，启动nginx</div><div class="line">./nginx</div><div class="line"># 停止nginx</div><div class="line">./nginx -s stop</div><div class="line"># 重新加载配置文件，需要重启nginx</div><div class="line">./nginx -s reload</div><div class="line"># 查看nginx是否启动成功， | 为管道命令，管道命令的含义，前面一个命令的输出作为后面一个命令的输入</div><div class="line"># ps -ef查看进程，其输出结果作为grep的输入内容，grep在ps -ef结果中进行查找含有nginx字符的信息再作为输出。</div><div class="line">ps -ef | grep nginx</div><div class="line"># 结果含有两个nginx进程</div><div class="line"># 开放80端口</div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT</div><div class="line"># 浏览器输入服务器IP,回车访问成功</div><div class="line"># 服务器重启后80端口就会关闭，需要将防火墙的规则保存到/etc/rc.d/init.d/iptables，即端口状态保存，服务器重启不关闭防火墙状态下仍然对外开放</div><div class="line">/etc/rc.d/init.d/iptables save</div><div class="line">cd /ucenter</div><div class="line"># 修改普通用户ucenter对nginx的权限,ucenter:ucenter，用户名:所属组名。</div><div class="line"># 修改soft目录的所属，-R为递归操作，将soft及其下面的目录所属修改为ucenter组下面的ucenter用户</div><div class="line">chown ucenter:ucenter ./soft/ -R</div><div class="line"># 切换到普通用户ucenter</div><div class="line">su - ucenter</div><div class="line">cd soft/nginx/sbin</div><div class="line"># 通过普通用户启动nginx</div><div class="line">./ nginx</div><div class="line"># 发现启动失败，原因是linux系统对普通进行了占用80端口的限制</div><div class="line"># 需要类似在window系统中使用以管理员身份运行的操作，普通可以使用root权限来执行脚本</div><div class="line"># 退出当前用户，切换到root用户</div><div class="line">exit</div><div class="line">cd ucenter/soft/nginx/sbin</div><div class="line"># 先将nginx所属改回到root</div><div class="line">chown root nginx</div><div class="line"># 设置nginx可以以root身份执行该文件</div><div class="line">chmod u+s nginx</div><div class="line">su - ucenter</div><div class="line">cd soft/nginx/sbin</div><div class="line">./nginx</div><div class="line"># 发现80端口已经被占用，需要停止nginx</div><div class="line">./nginx -s stop</div><div class="line"># 重新启动nginx</div><div class="line">./nginx</div><div class="line"># 普通户用启动nginx成功</div></pre></td></tr></table></figure></p>
<hr>
<p>之前安装linux的操作详细</p>
<h3 id="2-安装"><a href="#2-安装" class="headerlink" title="2 安装"></a>2 安装</h3><p>1.首先要安装 PCRE<br>    源文件：<a href="http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz" target="_blank" rel="external">http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz</a><br>    参考地址：<a href="http://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="external">http://www.runoob.com/linux/nginx-install-setup.html</a><br><!-- more --><br>2.安装nginx<br>    nginx安装路径/webapp/nginx</p>
<p>启动项目报错<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">SEVERE</span>: StandardServer.await: create[8005]: </div><div class="line"><span class="attribute">java</span>.net.BindException: Address already in use</div><div class="line"><span class="attribute">at</span> java.net.PlainSocketImpl.socketBind(Native Method)</div><div class="line"><span class="attribute">at</span> java.net.PlainSocketImpl.bind(PlainSocketImpl.java:383)</div><div class="line"><span class="attribute">at</span> java.net.ServerSocket.bind(ServerSocket.java:328)</div><div class="line"><span class="attribute">at</span> java.net.ServerSocket.&lt;init&gt;(ServerSocket.java:194)</div><div class="line"><span class="attribute">at</span> org.apache.catalina.core.StandardServer.await(StandardServer.java:404)</div><div class="line"><span class="attribute">at</span> org.apache.catalina.startup.Catalina.await(Catalina.java:676)</div><div class="line"><span class="attribute">at</span> org.apache.catalina.startup.Catalina.start(Catalina.java:628)</div><div class="line"><span class="attribute">at</span> sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</div><div class="line"><span class="attribute">at</span> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)</div><div class="line"><span class="attribute">at</span> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)</div><div class="line"><span class="attribute">at</span> java.lang.reflect.Method.invoke(Method.java:597)</div><div class="line"><span class="attribute">at</span> org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:289)</div><div class="line"><span class="attribute">at</span> org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414)</div><div class="line"><span class="attribute">Dec</span> 10, 2016 10:14:38 AM org.apache.coyote.http11.Http11Protocol pause</div></pre></td></tr></table></figure></p>
<p>解决修改：<br>    8005端口被占用了<br>    /webapp/tomcat_bg/conf<br>    修改server.xml文件中的8005端口<br>    <server port="8007" shutdown="SHUTDOWN"></server></p>
<p>常用命令：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/usr/local/webserver/nginx/sbin/nginx -s reload            # 重新载入配置文件</div><div class="line">/usr/local/webserver/nginx/sbin/nginx -s reopen            # 重启 Nginx</div><div class="line">/usr/local/webserver/nginx/sbin/nginx -s stop              # 停止 Nginx</div></pre></td></tr></table></figure></p>
<h1 id="验证nginx是否安装成功"><a href="#验证nginx是否安装成功" class="headerlink" title="验证nginx是否安装成功"></a>验证nginx是否安装成功</h1><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd  /usr/local/nginx/sbin  </div><div class="line">./nginx -t</div></pre></td></tr></table></figure>
<p>3.nginx.conf配置<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#user  nobody;</div><div class="line">worker_processes  1;</div><div class="line"></div><div class="line">#error_log  logs/error.log;</div><div class="line">#error_log  logs/error.log  notice;</div><div class="line">#error_log  logs/error.log  info;</div><div class="line"></div><div class="line">#pid        logs/nginx.pid;</div><div class="line"></div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line"></div><div class="line">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</div><div class="line">    #                  '$status $body_bytes_sent "$http_referer" '</div><div class="line">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</div><div class="line"></div><div class="line">    #access_log  logs/access.log  main;</div><div class="line"></div><div class="line">    sendfile        on;</div><div class="line">    #tcp_nopush     on;</div><div class="line"></div><div class="line">    #keepalive_timeout  0;</div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line">    #gzip  on;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  localhost;</div><div class="line"></div><div class="line">        #charset koi8-r;</div><div class="line"></div><div class="line">        #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            root   /webapp/webdir/share;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">	location /xx/ &#123;</div><div class="line">	     proxy_pass   http://127.0.0.1:1111/xx/;</div><div class="line">        &#125;</div><div class="line">	location /xx/ &#123;</div><div class="line">	     proxy_pass   http://127.0.0.1:1111/;</div><div class="line">	&#125;</div><div class="line">	location /xx/ &#123;</div><div class="line">	     proxy_pass   http://127.0.0.1:1111/;</div><div class="line">	&#125; </div><div class="line">        #error_page  404              /404.html;</div><div class="line"></div><div class="line">        # redirect server error pages to the static page /50x.html</div><div class="line">        #</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</div><div class="line">        #</div><div class="line">        #location ~ \.php$ &#123;</div><div class="line">        #    proxy_pass   http://127.0.0.1;</div><div class="line">        #&#125;</div><div class="line"></div><div class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</div><div class="line">        #</div><div class="line">        #location ~ \.php$ &#123;</div><div class="line">        #    root           html;</div><div class="line">        #    fastcgi_pass   127.0.0.1:9000;</div><div class="line">        #    fastcgi_index  index.php;</div><div class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</div><div class="line">        #    include        fastcgi_params;</div><div class="line">        #&#125;</div><div class="line"></div><div class="line">        # deny access to .htaccess files, if Apache's document root</div><div class="line">        # concurs with nginx's one</div><div class="line">        #</div><div class="line">        #location ~ /\.ht &#123;</div><div class="line">        #    deny  all;</div><div class="line">        #&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</div><div class="line">    #</div><div class="line">    #server &#123;</div><div class="line">    #    listen       8000;</div><div class="line">    #    listen       somename:8080;</div><div class="line">    #    server_name  somename  alias  another.alias;</div><div class="line"></div><div class="line">    #    location / &#123;</div><div class="line">    #        root   html;</div><div class="line">    #        index  index.html index.htm;</div><div class="line">    #    &#125;</div><div class="line">    #&#125;</div><div class="line"></div><div class="line"></div><div class="line">    # HTTPS server</div><div class="line">    #</div><div class="line">    #server &#123;</div><div class="line">    #    listen       443 ssl;</div><div class="line">    #    server_name  localhost;</div><div class="line"></div><div class="line">    #    ssl_certificate      cert.pem;</div><div class="line">    #    ssl_certificate_key  cert.key;</div><div class="line"></div><div class="line">    #    ssl_session_cache    shared:SSL:1m;</div><div class="line">    #    ssl_session_timeout  5m;</div><div class="line"></div><div class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</div><div class="line">    #    ssl_prefer_server_ciphers  on;</div><div class="line"></div><div class="line">    #    location / &#123;</div><div class="line">    #        root   html;</div><div class="line">    #        index  index.html index.htm;</div><div class="line">    #    &#125;</div><div class="line">    #&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[linux下安装和操作mysql]]></title>
      <url>https://volc1605.github.io/2016/12/12/linux%E6%93%8D%E4%BD%9Cmysql/</url>
      <content type="html"><![CDATA[<h3 id="1-linux下安装mysql衍生版-性能高于原版"><a href="#1-linux下安装mysql衍生版-性能高于原版" class="headerlink" title="1 linux下安装mysql衍生版(性能高于原版)"></a>1 linux下安装mysql衍生版(性能高于原版)</h3><a id="more"></a>
<p>补充：<br>发现navicat连不上服务器上的mysql<br>解决：<br>执行命令<br>grant all privileges on <em>.</em> to ‘root’@’%’ identified by ‘123456’;<br>报错：<br>ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.<br>首先修改当前登录用户的密码:<br>ALTER USER USER() IDENTIFIED BY ‘1234567’;<br>再执行<br>grant all privileges on <em>.</em> to ‘root’@’%’ identified by ‘1234567’;<br>刷新权限：<br>flush  privileges ;</p>
<p>导入sql文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -uroot databasefoo &lt; foo.sql</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; source d:wcnc_db.sql</div></pre></td></tr></table></figure>
<p>导出整个数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqldump -uroot -pmysql sva_rec  &gt; e:\sva_rec.sql</div></pre></td></tr></table></figure></p>
<hr>
<p>1、首先安装cmake<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install cmake</div></pre></td></tr></table></figure></p>
<p>2、安装mysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/src/</div><div class="line">mkdir mysql-percona</div><div class="line">cd mysql-percona/</div><div class="line"># 上传Percona-Server-5.6.21-70.0-r688-el6-x86_64-bundle.tar安装包</div><div class="line">rz</div><div class="line"># 解压</div><div class="line">tar -xvf Percona-Server-5.6.21-70.0-r688-el6-x86_64-bundle.tar</div><div class="line"># linux安装软件有三种，编译安装，yum安装，rpm安装。</div><div class="line"># 安装解压后的shared，这个文件相当于window平台下.exe文件直接安装即可</div><div class="line">rpm -ivh Percona-Server-shared-56-5.6.21-rel70.0.el6.x86_64.rpm</div><div class="line"># 安装client</div><div class="line">rpm -ivh Percona-Server-client-56-5.6.21-rel70.0.el6.x86_64.rpm</div><div class="line"># 安装server</div><div class="line">rpm -ivh Percona-Server-server-56-5.6.21-rel70.0.el6.x86_64.rpm</div><div class="line"># 查看安装后的mysql服务状态</div><div class="line">service mysql status</div><div class="line"># 启动MySQL服务</div><div class="line">service mysql start</div><div class="line"># 登录</div><div class="line">mysql -uroot</div><div class="line"># 登录成功，说明安装成功后root用户是没有密码的</div><div class="line"># 设置root用户密码</div><div class="line">mysqladmin -u root password &quot;root&quot;</div><div class="line"># 再次登录</div><div class="line">mysql -uroot -proot</div><div class="line"># 退出mysql</div><div class="line">exit;</div><div class="line"># 设置mysql端口号3306对外开放</div><div class="line">/sbin/iptables -I INPUT -p tcp --dport 3306 -j ACCEPT</div><div class="line">/etc/rc.d/init.d/iptables save</div><div class="line"># 查看/etc/init.d/iptables状态信息</div><div class="line">/etc/init.d/iptables status</div><div class="line"># 设置远程访问（使用root密码）：</div><div class="line">grant all privileges on *.* to &apos;root&apos; @&apos;%&apos; identified by &apos;root&apos;; </div><div class="line">flush privileges;</div><div class="line"># navicat登录成功</div></pre></td></tr></table></figure></p>
<h3 id="2-解决客户端访问linux系统中mysql慢的问题"><a href="#2-解决客户端访问linux系统中mysql慢的问题" class="headerlink" title="2 解决客户端访问linux系统中mysql慢的问题"></a>2 解决客户端访问linux系统中mysql慢的问题</h3><p>原因是：mysql客户端每次访问时会试图解析访问机器的hostname，并缓存到hostname cache,如果解析不了，会等待一段时间后，才能把数据取出来。<br>解决<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 编辑修改my.cnf，mysql配置文件</div><div class="line">vim /etc/my.cnf</div></pre></td></tr></table></figure></p>
<p>在[mysqld]下面添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 让MySQL跳过解析机器hostname</div><div class="line">skip-name-resolve</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 重启mysql服务</div><div class="line">service mysql restart</div></pre></td></tr></table></figure>
<h3 id="3-linux下运行sql执行文件"><a href="#3-linux下运行sql执行文件" class="headerlink" title="3.linux下运行sql执行文件"></a>3.linux下运行sql执行文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /tmp/</div><div class="line"># 上传sql文件到tmp临时目录</div><div class="line">rz</div><div class="line"># 执行taotao.sql文件,登录mysql使用taotao数据库执行cat输出的数据</div><div class="line">cat taotao.sql | mysql -uroot -proot -Dtaotao</div></pre></td></tr></table></figure>
<hr>
<p>之前安装和操作mysql</p>
<h3 id="linux安装mysql"><a href="#linux安装mysql" class="headerlink" title="linux安装mysql"></a>linux安装mysql</h3><p>1.查看服务器中是否已经安装了mysql  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">ps</span> -aux | grep <span class="string">"mysql"</span>   # 查看有关mysql进程</div><div class="line"><span class="attribute">rpm</span> -qa | grep mysql     # 用于查看linux服务器是否安装了默认的mysql</div><div class="line"><span class="attribute">rpm</span> -e mysql　　         # 普通删除模式</div><div class="line"><span class="attribute">rpm</span> -e --nodeps mysql　　# 强力删除模式，如果使用上面命令删除时，提示有依赖的其它文件，则用该命令可以对其进行强力删除  </div><div class="line"><span class="attribute">rpm</span> -e mysql-5.7.13-linux-glibc2.5-x86_64 --nodeps  # 卸载已经安装的mysql-5.7.13-linux-glibc2.5-x86_64数据库</div></pre></td></tr></table></figure>
<p>2.解压mysql源码文件  </p>
<p>下载mysql：网址:<a href="http://downloads.mysql.com/archives/community/" target="_blank" rel="external">http://downloads.mysql.com/archives/community/</a><br>    这里下载mysql-5.7.12-linux-glibc2.5-x86_64.tar版本<br>    把下载好的mysql安装文件放到/home/mysql中，如果没有mysql文件夹先创建，再放到里面<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cd</span> /home/mysql  # 进入mysql目录准备解压mysql源文件</div><div class="line"><span class="attribute">tar</span> -zxf mysql-5.7.12-linux-glibc2.5-x86_64.tar.gz -C /home/mysql   # 解压到/home/mysql文件夹下</div></pre></td></tr></table></figure></p>
<p>3.创建mysql的用户组/用户, data目录及其用户目录<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">userdel</span> mysql                                           # 删除用户</div><div class="line"><span class="attribute">groupdel</span> mysql                                          # 删除用户组名</div><div class="line"><span class="attribute">mkdir</span> /home/mysql                                       # 在home文件夹下创建文件夹mysql</div><div class="line"><span class="attribute">mkdir</span> /home/mysql/data                                  # 在mysql文件夹下创建文件夹data  </div><div class="line"><span class="attribute">groupadd</span> mysql                                          # 创建一个名为mysql的用户组       </div><div class="line"><span class="attribute">useradd</span> -g mysql -d /home/mysql mysql                   # 在用户组下创建用户</div></pre></td></tr></table></figure></p>
<p>4.初始化mysql数据库<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /home/mysql                                         # 进入安装目录</div><div class="line">./bin/mysql_install_db  --user=mysql --basedir=/home/mysql --datadir=/home/mysql/data</div></pre></td></tr></table></figure></p>
<p>mysql5.7新特性：由上面可以看出， mysql_install_db 已经不再推荐使用了，建议改成 mysqld –initialize 完成实例初始化。  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">./bin/mysqld --user=mysql --basedir=/home/mysql --datadir=/home/mysql/data --initialize</div><div class="line">./mysqld --user=mysql --basedir=/home/mysql --datadir=/home/mysql/data --initialize</div><div class="line">[Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</div><div class="line">[ERROR] --initialize specified but the data directory has files in it. Aborting. 2016-04-08T01:46:53.155879Z 0</div><div class="line">[ERROR] Aborting</div></pre></td></tr></table></figure>
<p>出现上面的错误是因为我们没有清空mysql的data目录， 执行清空命令如下：  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cd /home/mysql/data                        # 进入安装目录下的data目录</div><div class="line">rm -fr *                                   # 清空数据</div><div class="line">cd /home/mysql      </div><div class="line">./bin/mysqld --user=mysql --basedir=/home/mysql --datadir=/home/mysql/data --initialize</div><div class="line">[Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details). 2016-04-08T01:47:59.945537Z 0</div><div class="line">[Warning] InnoDB: New log files created, LSN=45790 2016-04-08T01:48:00.333528Z 0 [Warning] InnoDB: Creating foreign key constraint system tables. 2016-04-08T01:48:00.434908Z 0</div><div class="line">[Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: ece26421-fd2b-11e5-a1e3-00163e001e5c. 2016-04-08T01:48:00.440125Z 0</div><div class="line">[Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened. 2016-04-08T01:48:00.440904Z 1</div><div class="line">[Note] A temporary password is generated for root@localhost: 2EC+qfcossJ=</div></pre></td></tr></table></figure>
<p>牢记上面的随机密码， 如上**mjT,#x_5sW, 下面我们修改密码时需要用到。  </p>
<p>5.检测下是否能启动mysql服务<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /home/mysql</div><div class="line">./support-files/mysql.server start</div><div class="line">Starting MySQL.. OK!</div></pre></td></tr></table></figure></p>
<p>正常<br>如果出现以下问题，需要修改/support-files/mysql.server<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">./support-files/mysql.server start</div><div class="line">./support-files/mysql.server: line 276: cd: /usr/local/mysql: No such file or directory</div><div class="line">Starting MySQL ERROR! Couldn't find MySQL server (/usr/local/mysql/bin/mysqld_safe)</div></pre></td></tr></table></figure></p>
<p>修改/home/mysql/support-files/mysql.server文件中的basedir和datadir路径<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vim support-files/mysql.server</div><div class="line">--------------------------</div><div class="line">...</div><div class="line">basedir=/home/mysql</div><div class="line">datadir=/home/mysql/data</div><div class="line">...</div><div class="line">--------------------------</div><div class="line">./support-files/mysql.server</div><div class="line">start Starting MySQL.. OK!</div></pre></td></tr></table></figure></p>
<p>6.创建软链接<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">ln</span> -s /home/mysql/bin/mysql /usr/bin/mysql</div></pre></td></tr></table></figure></p>
<p>7.创建配置文件<br>    1、将默认生成的my.cnf备份<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">mv</span> /etc/my.cnf /etc/my.cnf.bak</div></pre></td></tr></table></figure></p>
<p>如果这一步报错，没有关系，正常情况下是由于/ect文件夹下没有my.cnf锁引起的，创建一下就可以了，或者你不会创建 ， 直接使用 vim<br>/ect/my.cnf 命令编辑 ，然后直接退出编辑就可以，在执行这个命令就不会出错了，退出编辑命令  esc键  -&gt; (shift键+ ：(冒号键) -&gt; wq! ),然后在执行上面的命令就不会报错了。  </p>
<p>2、进入mysql的安装目录支持文件目录  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cd</span> /home/mysql/support-files</div></pre></td></tr></table></figure>
<p>3、拷贝配置文件模板为新的mysql配置文件</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cp</span> my-default.cnf /etc/my.cnf</div></pre></td></tr></table></figure>
<p>4、设置编码，可按需修改新的配置文件选项， 不修改配置选项， mysql则按默认配置参数运行<br>如下是我修改配置文件/etc/my.cnf， 设置编码为utf8以防乱码  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">vim /etc/my.cnf</div><div class="line"> </div><div class="line">[mysqld]</div><div class="line"> </div><div class="line">basedir = /home/mysql</div><div class="line">datadir = /home/mysql/data</div><div class="line"> </div><div class="line">character_set_server=utf8</div><div class="line">init_connect='SET NAMES utf8'</div><div class="line"> </div><div class="line"> </div><div class="line">[client]</div><div class="line">default-character-set=utf8</div></pre></td></tr></table></figure>
<p>有的时候使用这个命令后，前3步有问题的这里可能my.cnf文件是空的，这个不要紧，既然没有生成，那么你就自己编辑喽！具体编辑怎么实现就参照步骤6  </p>
<p>8.配置mysql服务开机自动启动<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cp</span> /home/mysql/support-files/mysql.server /etc/init.d/mysqld      # 拷贝启动文件到/etc/init.d/下并重命令为mysqld</div><div class="line"><span class="attribute">chmod</span> 755 /etc/init.d/mysqld                                      # 增加执行权限</div><div class="line"><span class="attribute">chkconfig</span> --list mysqld                                           # 检查自启动项列表中没有mysqld这个，</div><div class="line"><span class="attribute">chkconfig</span> --add mysqld                                            # 如果没有就添加mysqld：</div><div class="line"><span class="attribute">chkconfig</span> mysqld <span class="literal">on</span>                                               # 用这个命令设置开机启动：</div></pre></td></tr></table></figure></p>
<p>如果在执行第一步就报错，则说明刚刚在第8步中配置出问题了，那你就重新设置一下  </p>
<p><img src="https://volc1605.github.io/images/linux操作mysql/1.png" alt="1"><br>如果后面的操作中出现以下的问题<br><img src="https://volc1605.github.io/images/linux操作mysql/2.png" alt="2"></p>
<p>这样就是电脑环境的问题了，你就直接把<br><img src="https://volc1605.github.io/images/linux操作mysql/3.png" alt="3"></p>
<p>9.mysql服务的启动/重启/停止<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">service</span> mysqld start                                               # 启动服务</div><div class="line"><span class="attribute">service</span> mysqld restart                                             # 重启服务</div><div class="line"><span class="attribute">service</span> mysqld stop                                                # 停止服务</div></pre></td></tr></table></figure></p>
<p>10.修改mysql登录密码<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">mysql</span>&gt; SET PASSWORD = PASSWORD('123456'); # PASSWORD()里面的123456是我设置的新密码，你也可以设置成你的密码</div><div class="line"><span class="attribute">Query</span> OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line"><span class="attribute">Rows</span> matched: 2 Changed: 0 Warnings: 1</div><div class="line"><span class="attribute">mysql</span>&gt; ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER;</div><div class="line"><span class="attribute">Query</span> OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line"><span class="attribute">Rows</span> matched: 2 Changed: 0 Warnings: 1</div><div class="line"><span class="attribute">mysql</span>&gt; flush privileges;</div><div class="line"><span class="attribute">Query</span> OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line"><span class="attribute">Rows</span> matched: 2 Changed: 0 Warnings: 1</div></pre></td></tr></table></figure></p>
<p>11.mysql远程授权<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@testfornss ~]# mysql -u root -p  </div><div class="line">Enter password:</div><div class="line">Welcome to the MySQL monitor. Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 4</div><div class="line">Server version: 5.7.13 MySQL Community Server (GPL)</div><div class="line"> </div><div class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</div><div class="line"> </div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"> </div><div class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</div><div class="line"> </div><div class="line">mysql&gt; grant all privileges on *.* to 'root'@'%' identified by '123456';</div><div class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line"> </div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<p>12.设置访问mysql数据库不区分大小写<br>    修改目录下/etc的my.cnf<br>    在[mysqld]配置下追加<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">lower_case_table_names</span>=1</div></pre></td></tr></table></figure></p>
<p>0代表区别大小写  </p>
<p>问题：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">mysql</span> -u bg -p # 回车输入密码连不上</div><div class="line"><span class="attribute">mysql</span> -r bg -p # 回车输入密码可以连上</div></pre></td></tr></table></figure></p>
<p>解决方法：<br>properties配置数据库properties配置数据库：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">master</span>.name=csp</div><div class="line"><span class="attribute">master</span>.url=jdbc:mysql://116.62.29.200:3306/bg?characterEncoding=utf-8&amp;allowMultiQueries=true</div><div class="line"><span class="attribute">master</span>.driverClassName=com.mysql.jdbc.Driver</div><div class="line"></div><div class="line"><span class="comment"># \u5f00\u53d1\u73af\u5883</span></div><div class="line"><span class="attribute">master</span>.username=root           # 名称是root，不是bg</div><div class="line"><span class="attribute">master</span>.password=bmx84185858</div></pre></td></tr></table></figure></p>
<p>参考资源：<a href="http://www.cnblogs.com/gaojupeng/p/5727069.html" target="_blank" rel="external">http://www.cnblogs.com/gaojupeng/p/5727069.html</a></p>
<h3 id="登录mysql"><a href="#登录mysql" class="headerlink" title="登录mysql"></a>登录mysql</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">mysql</span> -u root -p  	# 登录</div><div class="line"><span class="attribute">quit</span>;  				# 退出</div></pre></td></tr></table></figure>
<h3 id="开启查询日志"><a href="#开启查询日志" class="headerlink" title="开启查询日志"></a>开启查询日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show variables like &apos;%quer%&apos;;</div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">+----------------------------------------+--------------------------------------------------------+</div><div class="line">| Variable_name                          | Value                                                  |</div><div class="line">+----------------------------------------+--------------------------------------------------------+</div><div class="line">| binlog_rows_query_log_events           | OFF                                                    |</div><div class="line">| ft_query_expansion_limit               | 20                                                     |</div><div class="line">| have_query_cache                       | YES                                                    |</div><div class="line">| log_queries_not_using_indexes          | OFF                                                    |</div><div class="line">| log_throttle_queries_not_using_indexes | 0                                                      |</div><div class="line">| long_query_time                        | 10.000000                                              |</div><div class="line">| query_alloc_block_size                 | 8192                                                   |</div><div class="line">| query_cache_limit                      | 1048576                                                |</div><div class="line">| query_cache_min_res_unit               | 4096                                                   |</div><div class="line">| query_cache_size                       | 1048576                                                |</div><div class="line">| query_cache_type                       | OFF                                                    |</div><div class="line">| query_cache_wlock_invalidate           | OFF                                                    |</div><div class="line">| query_prealloc_size                    | 8192                                                   |</div><div class="line">| slow_query_log                         | OFF                                                    |</div><div class="line">| slow_query_log_file                    | /usr/local/mysql/data/iZbp199af3f3y8j7fr8kolZ-slow.log |</div><div class="line">+----------------------------------------+--------------------------------------------------------+</div><div class="line">15 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>Linux下找到mysql的配置文件my.cnf, 在mysqld下方加入慢查询的配置语句(注意:一定要在[mysqld]下的下方加入)</p>
<h3 id="重启mysql服务的报错"><a href="#重启mysql服务的报错" class="headerlink" title="重启mysql服务的报错"></a>重启mysql服务的报错</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@iZbp199af3f3y8j7fr8kolZ /]# service mysqld start</div><div class="line">Starting MySQL...The server quit without updating PID file [FAILED]cal/mysql/data/iZbp199af3f3y8j7fr8kolZ.pid).</div></pre></td></tr></table></figure>
<p>解决方法:<br>配置my.cnf文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"># 设置不区分大小写</div><div class="line"> lower_case_table_names=1</div><div class="line"> </div><div class="line"># 开启慢查询</div><div class="line">  slow_query_log=on</div><div class="line"></div><div class="line"># 设置多少时长为慢查询</div><div class="line"> long_query_time=0.00001</div><div class="line"> </div><div class="line"># 错误日志</div><div class="line"> log-error=/usr/local/mysql/logs/error.log</div><div class="line"># 慢查寻信息日志</div><div class="line"> slow_query_log_file=/usr/local/mysql/logs/slowquery.log</div><div class="line"> </div><div class="line"># log=/usr/local/mysql/logs/mysql.log</div><div class="line"># log_slow_queries=/usr/local/mysql/logs/slowquery.log</div><div class="line"># mysql5.6版本以上，取消了参数log_slow_queries，更改为slow_query_log_file</div><div class="line"># log_slow_queries=/home/db/madb/log/slow_query.log</div></pre></td></tr></table></figure></p>
<p>mysql获取随机数更新百万数据  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT FLOOR( MAX(NOW()) * RAND()) as r;</div></pre></td></tr></table></figure>
<p>重启mysql服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo /usr/local/mysql/support-files/mysql.server restart</div></pre></td></tr></table></figure></p>
<p>查询多长时间为慢查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show variables like &apos;long_query_time&apos;;</div></pre></td></tr></table></figure>
<p>查询输出记录次数最多的10条SQL语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/mysql/bin/mysqldumpslow -s c -t 10 /usr/local/mysql/logs/slowquery.log</div></pre></td></tr></table></figure></p>
<p>/usr/local/mysql/bin/mysqldumpslow -s t -t 2 -a /usr/local/mysql/logs/slowquery.log</p>
<p>如果正在运行的是线上库，不方便重启   </p>
<p>MySQL从5.1及以后版本支持了 开启slow query in runtime。只需要执行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SET GLOBAL slow_query_log = &apos;ON&apos;;</div></pre></td></tr></table></figure>
<p>如果不生效，试一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; FLUSH LOGS;</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Maven]]></title>
      <url>https://volc1605.github.io/2016/11/26/Maven/</url>
      <content type="html"><![CDATA[<h1 id="Maven项目不显示-Maven-Dependencies"><a href="#Maven项目不显示-Maven-Dependencies" class="headerlink" title="Maven项目不显示 Maven Dependencies"></a>Maven项目不显示 Maven Dependencies</h1><p>从别目录结构正确的项目中复制.classpath文件，覆盖不显示Maven Dependencies的项目目录中的.classpath</p>
<h1 id="去掉dynamic-web-module勾选后，每次更新maven项目都会出现以下结构"><a href="#去掉dynamic-web-module勾选后，每次更新maven项目都会出现以下结构" class="headerlink" title="去掉dynamic web module勾选后，每次更新maven项目都会出现以下结构"></a>去掉dynamic web module勾选后，每次更新maven项目都会出现以下结构</h1><p><img src="https://volc1605.github.io/images/Maven/mavenConstruction2.png" alt="maven"></p>
<p>解决方法：<br>项目properties中maven-&gt;javaee integration去掉勾选<br>去除maven项目中javascript resources引用jar包<br>properties中project facets只选择java，去掉javascript<br>去除maven项目结构目录中含有web app 2.3<br>properties中project facets只选择java 去掉dynamic web module</p>
<h1 id="解决maven项目名称出现个红叉报错"><a href="#解决maven项目名称出现个红叉报错" class="headerlink" title="解决maven项目名称出现个红叉报错"></a>解决maven项目名称出现个红叉报错</h1><p>properties中project facets的java版本号选择不当</p>
<h1 id="目录下的创建普通文件夹"><a href="#目录下的创建普通文件夹" class="headerlink" title="目录下的创建普通文件夹"></a>目录下的创建普通文件夹</h1><p>properties中的javabuild path resource-&gt;excluded **</p>
<h1 id="pom文件war报错"><a href="#pom文件war报错" class="headerlink" title="pom文件war报错"></a>pom文件war报错</h1><p>1.加上webapp中的web.xml文件<br>2.properties中maven deployment assembly(用来配置添加根目录文件夹)不显示<br>    需要在project facets中修改</p>
<h1 id="项目启动报错"><a href="#项目启动报错" class="headerlink" title="项目启动报错"></a>项目启动报错</h1><p>原因jar包冲突<br>D:\java-tools\apache-maven-3.2.3\repo\org\apache\tomcat\servlet-api\6.0.28\servlet-api-6.0.28.jar</p>
<h1 id="xsd文件找不到"><a href="#xsd文件找不到" class="headerlink" title="xsd文件找不到"></a>xsd文件找不到</h1><p>报错提示，要引入jar包。或者手动添加xsd文件或者手动指定(参考：<a href="http://www.ibm.com/developerworks/cn/xml/x-1008dubb/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/xml/x-1008dubb/</a>)</p>
<h2 id="解决pom文件报错和multiple-problems-have-occurred错误"><a href="#解决pom文件报错和multiple-problems-have-occurred错误" class="headerlink" title="解决pom文件报错和multiple problems have occurred错误"></a>解决pom文件报错和multiple problems have occurred错误</h2><p>错误实质上都是jar依赖的问题，只需两步就可解决<br>进入出问题的jar包所在的本地仓库目录<br>1、    删除所有以.lastUpdate结尾的文件<br>a)    1、切换到maven的本地仓库<br>b)    2、在当前目录打开cmd命令行<br>c)    3、执行命令：for /r %i in (*.lastUpdated) do del %i<br>2、    在项目上执行 Maven Update （Alt + F5）</p>
<h2 id="如何避免jar下载不全导致项目报错"><a href="#如何避免jar下载不全导致项目报错" class="headerlink" title="如何避免jar下载不全导致项目报错"></a>如何避免jar下载不全导致项目报错</h2><p>使用相对稳定的私服下载地址：开源中国(<a href="http://maven.oschina.net/help.html" target="_blank" rel="external">http://maven.oschina.net/help.html</a>)<br>在maven指向的setting.xml文件中进行改变私服URL配置。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[java设计模式]]></title>
      <url>https://volc1605.github.io/2016/11/24/java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      <content type="html"><![CDATA[<h1 id="singleton单例模式"><a href="#singleton单例模式" class="headerlink" title="singleton单例模式"></a>singleton单例模式</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> myprogram;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> Singleton</div><div class="line"> * <span class="doctag">@Description</span> 单例模式-懒汉式</div><div class="line"> * 既实现了线程安全，又避免了同步带来的性能影响</div><div class="line"> * <span class="doctag">@Author</span> youtanzhi</div><div class="line"> * <span class="doctag">@Date</span> 2016年11月15日 下午3:58:33</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125; <span class="comment">// 只有当前类可以使用</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">            instance = <span class="keyword">new</span> Singleton();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> myprogram;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> Singleton1</div><div class="line"> * <span class="doctag">@Description</span> 饿汉式单例类.在类初始化时，已经自行实例化</div><div class="line"> * <span class="doctag">@Author</span> youtanzhi</div><div class="line"> * <span class="doctag">@Date</span> 2016年11月15日 下午4:02:31</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton1</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton1</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton1 single = <span class="keyword">new</span> Singleton1();</div><div class="line"></div><div class="line">    <span class="comment">// 静态工厂方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> single;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[linux常用命令]]></title>
      <url>https://volc1605.github.io/2016/11/23/linux/</url>
      <content type="html"><![CDATA[<h1 id="LINUX常用命令"><a href="#LINUX常用命令" class="headerlink" title="LINUX常用命令"></a>LINUX常用命令</h1><blockquote>
<p>ls命令   </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">ls</span> -l                                             # 目录详细结构</div></pre></td></tr></table></figure>
<a id="more"></a>                                        
<blockquote>
<p>mkdir命令                                         </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">mkdir</span> folder1                                     # 创建folder1目录</div></pre></td></tr></table></figure>
<blockquote>
<p>rm命令                                            </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">rm</span> folder1                                        # 删除folder1目录</div><div class="line"><span class="attribute">rm</span> file                                           # 删除文件</div><div class="line"><span class="attribute">rm</span> -rf * 										  # 删除当前文件夹下的所有目录和文件</div></pre></td></tr></table></figure>
<blockquote>
<p>cp命令                                            </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cp</span> file1 file2                                    # 复制file1文件到file2</div></pre></td></tr></table></figure>
<blockquote>
<p>mv命令                                            </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">mv</span> file1.txt file2.txt                            # 重命名</div><div class="line"><span class="attribute">mv</span> folder1 folder2                                # 移动folder1文件夹(包含folder1)到folder2文件夹</div></pre></td></tr></table></figure>
<blockquote>
<p>vi命令  </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">vi</span> file1.txt                                      # 查看file1.txt文件第一页(command mode),trl + f进行翻页</div><div class="line">                                                  <span class="comment"># 按i建进入编辑模式(insert mode)</span></div><div class="line">				                  <span class="comment"># 退出vi命令:</span></div><div class="line">				                  <span class="comment"># Esc按键(command mode) 输入':q'回车退出</span></div><div class="line">				                  <span class="comment"># ':wq'保存退出</span></div><div class="line">				                  <span class="comment"># ':q!'强制退出</span></div><div class="line">				                  <span class="comment"># 输入':/str'回车查找str字符串，按n查看下一个</span></div></pre></td></tr></table></figure>
<blockquote>
<p>cat命令  </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cat</span> file1.txt                                     # 查看file1.txt所有信息</div><div class="line"><span class="attribute">cat</span> file1.txt | grep 'info'                       # 查看file1.txt中匹配'info'所在行信息,并标记'info'字符串</div><div class="line"><span class="attribute">cat</span> file1 file2 &gt; file                            # file1和file2合并到file问价并显示</div><div class="line"><span class="attribute">cat</span> must.txt | tail -n +10 | head -n 10           # 查看must.txt文件，从第10行起显示10行，即'10-19'行</div></pre></td></tr></table></figure>
<blockquote>
<p>tail命令                                          </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">tailf</span> catalina.out | grep 'countTime'             # 只实时显示含有'countTime'所在行的信息</div><div class="line"><span class="attribute">tail</span> -f file1                                     # 实时显示file1文件后十条并进入编辑模式</div><div class="line"><span class="attribute">tail</span> -n 200 -f file1                              # 实时显示file1后200行变化信息，和上面的命令效果相似	</div><div class="line"><span class="attribute">tail</span> -n 200 file1 | grep 'test'                   # 查看file1文件后200行，高亮'test'(最常用)</div><div class="line"><span class="attribute">tail</span> -n 200 -f file1 | grep 'INFO*'               # 实时显示file1后200行变化信息，并标记处'INFO'字符串(最常用)</div></pre></td></tr></table></figure>
<blockquote>
<p>find命令                                          </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">find</span> folder1 -type f -name <span class="string">"*.txt"</span>                # 查询当前目录下的folder1文件夹中匹配'*.txt'的文件或文件夹</div><div class="line"><span class="attribute">find</span> folder1 -name 'must.txt' -ls                 # 查询当前目录下的folder1文件夹中匹配'*.txt'的文件或文件夹，并显示信息</div><div class="line"><span class="attribute">find</span> -type f -name 'must.txt'|xargs grep 'str'    # 查询当前目录下的must.txt文件中匹配'str'所在行的信息</div><div class="line"><span class="attribute">find</span> / -name <span class="string">"memca*"</span>							  # 根据文件名称全局查找</div><div class="line"><span class="attribute">grep</span> -rn <span class="string">"str"</span> *                                  # 查询当前目录下的must.txt文件中匹配'str'所在行的信息</div><div class="line">    <span class="comment"># * : 表示当前目录所有文件，也可以是某个文件名</span></div><div class="line">    <span class="comment"># -r 是递归查找</span></div><div class="line">    <span class="comment"># -n 是显示行号</span></div><div class="line">    <span class="comment"># -R 查找所有文件包含子目录</span></div><div class="line">    <span class="comment"># -i 忽略大小写</span></div></pre></td></tr></table></figure>
<blockquote>
<p>echo命令</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">echo</span> <span class="string">"hello world"</span> &gt; file.txt                     # 当前目录下创建file.txt文件并添加数据</div></pre></td></tr></table></figure>
<h1 id="查看服务器外网ip"><a href="#查看服务器外网ip" class="headerlink" title="查看服务器外网ip"></a>查看服务器外网ip</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">curl</span> http://members.3322.org/dyndns/getip</div></pre></td></tr></table></figure>
<h1 id="查看服务器网络地址"><a href="#查看服务器网络地址" class="headerlink" title="查看服务器网络地址"></a>查看服务器网络地址</h1><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@iZbp199af3f3y8j7fr8kolZ ~]# ifconfig</div><div class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</div><div class="line">        inet 10.27.235.142  netmask 255.255.252.0  broadcast 10.27.235.255</div><div class="line">        ether 00:16:3e:0d:f7:47  txqueuelen 1000  (Ethernet)</div><div class="line">        RX packets 15622862  bytes 1152767495 (1.0 GiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 107645  bytes 7704353 (7.3 MiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div><div class="line"></div><div class="line">eth1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</div><div class="line">        inet 116.62.29.229  netmask 255.255.252.0  broadcast 116.62.31.255</div><div class="line">        ether 00:16:3e:0c:a6:a1  txqueuelen 1000  (Ethernet)</div><div class="line">        RX packets 261064410  bytes 18335028955 (17.0 GiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 5924776  bytes 1812912938 (1.6 GiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div><div class="line"></div><div class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</div><div class="line">        inet 127.0.0.1  netmask 255.0.0.0</div><div class="line">        loop  txqueuelen 0  (Local Loopback)</div><div class="line">        RX packets 18419107  bytes 2800651279 (2.6 GiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 18419107  bytes 2800651279 (2.6 GiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div></pre></td></tr></table></figure>
<p>其中eth0为内网，eth1为外网</p>
<h1 id="更改文件或文件夹权限"><a href="#更改文件或文件夹权限" class="headerlink" title="更改文件或文件夹权限"></a>更改文件或文件夹权限</h1><p>改变一个文件的权限: chmod mode file|dir<br>改变所有子目录的权限: chmod mode dir -R</p>
<p>mode = 777 or 752 and so on.<br>mode的三个数字，分别表示 owner，group,others所具有的权限。<br>1 = x 执行 2 = w 写 4 = r 读，比如owner具有所有权限，1+2+4=7,<br>又比如 group 具有 读 和 执行 权限 1+4 = 5</p>
<h1 id="查看端口使用情况"><a href="#查看端口使用情况" class="headerlink" title="查看端口使用情况"></a>查看端口使用情况</h1><p>查看正在使用的端口号  </p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">netstat</span> -anp</div><div class="line"><span class="attribute">tcp</span>        0      0 114.55.113.160:50358    106.11.68.13:80 ESTABLISHED 1338/AliYunDun</div></pre></td></tr></table></figure>
<h1 id="查看端口号对应的服务名称"><a href="#查看端口号对应的服务名称" class="headerlink" title="查看端口号对应的服务名称"></a>查看端口号对应的服务名称</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">lsof</span> -i:<span class="string">"50358"</span></div><div class="line"><span class="attribute">AliYunDun</span> 1338 root   11u  IPv4 7340009      0t0  TCP 114.55.113.160:50358-&gt;106.11.68.13:http (ESTABLISHED)</div></pre></td></tr></table></figure>
<h1 id="根据pid查看进程信息所在目录"><a href="#根据pid查看进程信息所在目录" class="headerlink" title="根据pid查看进程信息所在目录"></a>根据pid查看进程信息所在目录</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">lsof</span> -p <span class="string">"24619"</span></div></pre></td></tr></table></figure>
<h1 id="根据PID进程号关闭服务"><a href="#根据PID进程号关闭服务" class="headerlink" title="根据PID进程号关闭服务"></a>根据PID进程号关闭服务</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">kill</span> -9 <span class="string">"1338"</span></div></pre></td></tr></table></figure>
<h1 id="根据服务名称查看是否启用"><a href="#根据服务名称查看是否启用" class="headerlink" title="根据服务名称查看是否启用"></a>根据服务名称查看是否启用</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">ps</span> -aux | grep <span class="string">"memcache"</span></div><div class="line"><span class="attribute">root</span>     25899  0.0  0.0 112648   972 pts/0    S+   11:16   0:00 grep --color=auto memcache</div></pre></td></tr></table></figure>
<h1 id="和sh执行脚本的区别"><a href="#和sh执行脚本的区别" class="headerlink" title="./和sh执行脚本的区别"></a>./和sh执行脚本的区别</h1><p>./需要执行权限<br>sh不需要，sh是个软链接，它可能是一个任意的shell，通常默认是bash shell<br>用type命令可以查看<br>./执行调用的是你开头一行定义的shell，不指定系统会调用默认shell程序  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[MySQL]]></title>
      <url>https://volc1605.github.io/2016/11/19/MySQL/</url>
      <content type="html"><![CDATA[<h1 id="部门表dept和员工表empMySQL练习"><a href="#部门表dept和员工表empMySQL练习" class="headerlink" title="部门表dept和员工表empMySQL练习"></a>部门表dept和员工表empMySQL练习</h1><blockquote>
<p>建表</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">Navicat MySQL Data Transfer</div><div class="line"></div><div class="line">Source Server         : 10.1.1.241</div><div class="line">Source Server Version : 50547</div><div class="line">Source Host           : 10.1.1.241:3306</div><div class="line">Source Database       : test</div><div class="line"></div><div class="line">Target Server Type    : MYSQL</div><div class="line">Target Server Version : 50547</div><div class="line">File Encoding         : 65001</div><div class="line"></div><div class="line">Date: 2016-11-15 15:41:17</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">-- Table structure for bonus</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`bonus`</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`bonus`</span> (</div><div class="line">  <span class="string">`empno`</span> <span class="built_in">decimal</span>(<span class="number">4</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`job`</span> <span class="built_in">varchar</span>(<span class="number">9</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`sal`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`comm`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></div><div class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">-- Records of bonus</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">-- Table structure for dept</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`dept`</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`dept`</span> (</div><div class="line">  <span class="string">`deptno`</span> <span class="built_in">decimal</span>(<span class="number">2</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`dname`</span> <span class="built_in">varchar</span>(<span class="number">14</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`loc`</span> <span class="built_in">varchar</span>(<span class="number">13</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></div><div class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">-- Records of dept</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span> <span class="keyword">VALUES</span> (<span class="string">'10'</span>, <span class="string">'ACCOUNTING'</span>, <span class="string">'NEW YORK'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span> <span class="keyword">VALUES</span> (<span class="string">'20'</span>, <span class="string">'RESEARCH'</span>, <span class="string">'DALLAS'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span> <span class="keyword">VALUES</span> (<span class="string">'30'</span>, <span class="string">'SALES'</span>, <span class="string">'CHICAGO'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span> <span class="keyword">VALUES</span> (<span class="string">'40'</span>, <span class="string">'OPERATIONS'</span>, <span class="string">'BOSTON'</span>);</div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">-- Table structure for emp</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`emp`</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`emp`</span> (</div><div class="line">  <span class="string">`empno`</span> <span class="built_in">decimal</span>(<span class="number">4</span>,<span class="number">0</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`ename`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`job`</span> <span class="built_in">varchar</span>(<span class="number">9</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`mgr`</span> <span class="built_in">decimal</span>(<span class="number">4</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`hiredate`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`sal`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`comm`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`deptno`</span> <span class="built_in">decimal</span>(<span class="number">2</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></div><div class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">-- Records of emp</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7369'</span>, <span class="string">'SMITH'</span>, <span class="string">'CLERK'</span>, <span class="string">'7902'</span>, <span class="string">'1980-12-17 00:00:00'</span>, <span class="string">'960.00'</span>, <span class="literal">null</span>, <span class="string">'20'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7499'</span>, <span class="string">'ALLEN'</span>, <span class="string">'SALESMAN'</span>, <span class="string">'7698'</span>, <span class="string">'1981-02-20 00:00:00'</span>, <span class="string">'2764.80'</span>, <span class="string">'300.00'</span>, <span class="string">'30'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7521'</span>, <span class="string">'WARD'</span>, <span class="string">'SALESMAN'</span>, <span class="string">'7698'</span>, <span class="string">'1981-02-22 00:00:00'</span>, <span class="string">'2160.00'</span>, <span class="string">'500.00'</span>, <span class="string">'30'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7566'</span>, <span class="string">'JONES'</span>, <span class="string">'MANAGER'</span>, <span class="string">'7839'</span>, <span class="string">'1981-04-02 00:00:00'</span>, <span class="string">'3570.00'</span>, <span class="literal">null</span>, <span class="string">'20'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7654'</span>, <span class="string">'MARTIN'</span>, <span class="string">'SALESMAN'</span>, <span class="string">'7698'</span>, <span class="string">'1981-09-28 00:00:00'</span>, <span class="string">'2160.00'</span>, <span class="string">'1400.00'</span>, <span class="string">'30'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7698'</span>, <span class="string">'BLAKE'</span>, <span class="string">'MANAGER'</span>, <span class="string">'7839'</span>, <span class="string">'1981-05-01 00:00:00'</span>, <span class="string">'4924.80'</span>, <span class="literal">null</span>, <span class="string">'30'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7782'</span>, <span class="string">'CLARK'</span>, <span class="string">'MANAGER'</span>, <span class="string">'7839'</span>, <span class="string">'1981-06-09 00:00:00'</span>, <span class="string">'2940.00'</span>, <span class="literal">null</span>, <span class="string">'10'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7788'</span>, <span class="string">'SCOTT'</span>, <span class="string">'ANALYST'</span>, <span class="string">'7566'</span>, <span class="string">'1982-12-09 00:00:00'</span>, <span class="string">'3600.00'</span>, <span class="literal">null</span>, <span class="string">'20'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7839'</span>, <span class="string">'KING'</span>, <span class="string">'PRESIDENT'</span>, <span class="literal">null</span>, <span class="string">'1981-11-17 00:00:00'</span>, <span class="string">'6000.00'</span>, <span class="literal">null</span>, <span class="string">'10'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7844'</span>, <span class="string">'TURNER'</span>, <span class="string">'SALESMAN'</span>, <span class="string">'7698'</span>, <span class="string">'1981-09-08 00:00:00'</span>, <span class="string">'2592.00'</span>, <span class="string">'0.00'</span>, <span class="string">'30'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7876'</span>, <span class="string">'ADAMS'</span>, <span class="string">'CLERK'</span>, <span class="string">'7788'</span>, <span class="string">'1983-01-12 00:00:00'</span>, <span class="string">'1320.00'</span>, <span class="literal">null</span>, <span class="string">'20'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7900'</span>, <span class="string">'JAMES'</span>, <span class="string">'CLERK'</span>, <span class="string">'7698'</span>, <span class="string">'1981-12-03 00:00:00'</span>, <span class="string">'1641.60'</span>, <span class="literal">null</span>, <span class="string">'30'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7902'</span>, <span class="string">'FORD'</span>, <span class="string">'ANALYST'</span>, <span class="string">'7566'</span>, <span class="string">'1981-12-03 00:00:00'</span>, <span class="string">'3600.00'</span>, <span class="literal">null</span>, <span class="string">'20'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`emp`</span> <span class="keyword">VALUES</span> (<span class="string">'7934'</span>, <span class="string">'MILLER'</span>, <span class="string">'CLERK'</span>, <span class="string">'7782'</span>, <span class="string">'1982-01-23 00:00:00'</span>, <span class="string">'1560.00'</span>, <span class="literal">null</span>, <span class="string">'10'</span>);</div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">-- Table structure for salgrade</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`salgrade`</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`salgrade`</span> (</div><div class="line">  <span class="string">`grade`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`losal`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`hisal`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></div><div class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">-- Records of salgrade</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`salgrade`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'700'</span>, <span class="string">'1200'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`salgrade`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'1201'</span>, <span class="string">'1400'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`salgrade`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'1401'</span>, <span class="string">'2000'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`salgrade`</span> <span class="keyword">VALUES</span> (<span class="string">'4'</span>, <span class="string">'2001'</span>, <span class="string">'3000'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`salgrade`</span> <span class="keyword">VALUES</span> (<span class="string">'5'</span>, <span class="string">'3001'</span>, <span class="string">'9999'</span>);</div></pre></td></tr></table></figure>
<a id="more"></a>
<blockquote>
<p>练习</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 1.更新名称为'SALES'部门下的所有员工薪水上涨20%</span></div><div class="line"><span class="keyword">UPDATE</span> emp e <span class="keyword">SET</span> e.sal = e.sal * (<span class="number">1</span> + <span class="number">0.2</span>) <span class="keyword">WHERE</span> e.deptno = ( <span class="keyword">SELECT</span> d.deptno <span class="keyword">FROM</span> dept d <span class="keyword">WHERE</span> d.dname = <span class="string">'SALES'</span> );</div><div class="line"><span class="comment">-- 2.找出部门10中所有经理(MANAGER) 和部门20中所有办事员（CLERK）的详细资料</span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> ( e.deptno = <span class="string">'10'</span> <span class="keyword">AND</span> e.job = <span class="string">'MANAGER'</span> ) <span class="keyword">OR</span> ( e.deptno = <span class="string">'20'</span> <span class="keyword">AND</span> e.job = <span class="string">'CLERK'</span>);</div><div class="line"><span class="comment">-- 3.找出部门10中所有经理，部门20中所有的办事员，既不是经理又不是办事员，但是薪金大于或等于2000的所有员工的资料</span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> (deptno = <span class="number">10</span> <span class="keyword">AND</span> job = <span class="string">'MANAGER'</span>) <span class="keyword">OR</span> (deptno = <span class="number">20</span> <span class="keyword">AND</span> job = <span class="string">'CLERK'</span>) <span class="keyword">OR</span> ( job <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">'MANAGER'</span>, <span class="string">'CLERK'</span>) <span class="keyword">AND</span> sal &gt;= <span class="number">2000</span>);</div><div class="line"><span class="comment">-- 4.找出收取佣金（comm）的员工的不同工作：[DISTINCT-&gt;消除重复的关键字]</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> job <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> e.comm <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</div><div class="line"><span class="comment">-- 5.找个各月倒数第三天受雇的所有员工</span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> e.hiredate = <span class="keyword">DATE_FORMAT</span>(<span class="keyword">LAST_DAY</span>(e.hiredate) - <span class="number">2</span>, <span class="string">'%Y-%m-%d %H:%i:%s'</span>);</div><div class="line">	<span class="comment">-- 需要注意的是有两点转换格式的大小写：</span></div><div class="line">	<span class="comment">-- 1.</span></div><div class="line">	<span class="comment">-- LAST_DAY(e.hiredate) 获取到的日期格式：2016-09-30</span></div><div class="line">	<span class="comment">-- LAST_DAY(e.hiredate) - 2 获取到的日期格式：20160928</span></div><div class="line">	<span class="comment">-- 2.转换格式的大小写：</span></div><div class="line">	<span class="comment">-- DATE_FORMAT('2016-11-15', '%Y-%m-%d %H:%i:%s');-&gt;2016-11-15 00:12:00</span></div><div class="line">	<span class="comment">-- DATE_FORMAT('2016-11-15', '%Y-%m-%d %h:%I:%S');-&gt;2016-11-15 12:00:00</span></div><div class="line"><span class="comment">-- 6.找出早于2012年前受雇的员工</span></div><div class="line">	<span class="comment">-- mysql:</span></div><div class="line">	<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> <span class="keyword">DATE_FORMAT</span>(e.hiredate, <span class="string">'%Y%m%d%H%i%s'</span>) &lt; <span class="string">'2012'</span>;</div><div class="line">	<span class="comment">-- oracle:</span></div><div class="line">	<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> MONTHS_BETWEEN(hiredate,<span class="string">'20120000'</span>)&gt;<span class="number">0</span>;</div><div class="line">	<span class="comment">-- MONTHS_BETWEEN('2012-01-01', '2016-11-12');表示2012-01-01到2016-11-12的月数，以小数形式返回</span></div><div class="line"><span class="comment">-- 7.按照首字母大写其余字母小写的方式显示员工姓名</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>( <span class="keyword">UPPER</span>(<span class="keyword">LEFT</span>(e.ename, <span class="number">1</span>)), <span class="keyword">LOWER</span>( ( <span class="keyword">RIGHT</span> (e.ename, <span class="keyword">LENGTH</span>(e.ename) - <span class="number">1</span>) ) ) ) <span class="keyword">as</span> ename <span class="keyword">FROM</span> emp e;	</div><div class="line"><span class="comment">-- 8.显示正好为5个字符的员工的姓名</span></div><div class="line"><span class="keyword">SELECT</span> e.ename ad ename <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> <span class="keyword">LENGTH</span>(e.ename) = <span class="number">5</span>;	</div><div class="line"><span class="comment">-- 9.显示姓名不带'R'的员工的姓名</span></div><div class="line"><span class="keyword">SELECT</span> ename <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> ename <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'%R%'</span>;	</div><div class="line"><span class="comment">-- 10.显示所有员工姓名的前3个字符</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(e.ename, <span class="number">1</span>, <span class="number">3</span>) <span class="keyword">FROM</span> emp e;</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(e.ename, <span class="number">3</span>) <span class="keyword">FROM</span> emp e;</div><div class="line"><span class="comment">-- 11.显示所有员工的姓名，并且用“x” 替换替换所有的 “A”</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">REPLACE</span>(ename,<span class="string">'A'</span>,<span class="string">'x'</span>) <span class="keyword">FROM</span> emp;</div><div class="line"><span class="comment">-- 12.显示员工的姓名和受雇日期，并根据其服务年限，把资料最老的员工排在第在前面</span></div><div class="line"><span class="keyword">SELECT</span> ename,hiredate <span class="keyword">FROM</span> emp <span class="keyword">ORDER</span> <span class="keyword">BY</span> hiredate; <span class="comment">-- mysql默认是ASC升序	</span></div><div class="line"><span class="comment">-- 13.显示所有员工的姓名，加入公司的年份和月份，按受雇日期所在的年排序，若年份相同则讲最早月份的员工排在最前面</span></div><div class="line"><span class="keyword">SELECT</span> e.ename, <span class="keyword">DATE_FORMAT</span>(e.hiredate,<span class="string">'%Y'</span>) <span class="keyword">YEAR</span>, <span class="keyword">DATE_FORMAT</span>(e.hiredate,<span class="string">'%m'</span>) <span class="keyword">MONTH</span> <span class="keyword">FROM</span> emp e <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">YEAR</span>, <span class="keyword">MONTH</span>;</div><div class="line"><span class="comment">-- 14.显示在一个月为30天的情况所有员工的日薪金，并且忽略余数</span></div><div class="line"><span class="keyword">SELECT</span> e.ename, <span class="keyword">ROUND</span>(e.sal/<span class="number">30</span>) 日薪金 <span class="keyword">FROM</span> emp e;	</div><div class="line"><span class="comment">-- 15.找出在（任何年份）的2月受聘的所有员工</span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> <span class="keyword">MONTH</span>(e.hiredate) = <span class="number">2</span>;	</div><div class="line"><span class="comment">-- 16.对于每个员工，显示其加入公司的天数</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">datediff</span>(<span class="keyword">SYSDATE</span>(),<span class="string">'2016-11-15 09:41:18'</span>) 两日期之间天数<span class="number">1</span>, <span class="keyword">TO_DAYS</span>(<span class="keyword">SYSDATE</span>()) - <span class="keyword">TO_DAYS</span>(<span class="string">'2016-11-15 09:41:18'</span>) 两日期之间天数<span class="number">2</span> <span class="keyword">FROM</span> emp e;	</div><div class="line">17.以年月的方式显示所有员工的服务年限</div><div class="line"><span class="keyword">SELECT</span> (<span class="keyword">YEAR</span>(<span class="keyword">SYSDATE</span>())-<span class="keyword">YEAR</span>(e.hiredate)) 年份, (<span class="keyword">YEAR</span>(<span class="keyword">SYSDATE</span>())-<span class="keyword">YEAR</span>(e.hiredate))*<span class="number">12</span> + <span class="keyword">MONTH</span>(<span class="keyword">SYSDATE</span>())-<span class="keyword">MONTH</span>(e.hiredate) 月份 <span class="keyword">FROM</span> emp e;	</div><div class="line"><span class="comment">-- 18.列出至少有三个员工的所有部门和部门信息</span></div><div class="line">	<span class="comment">-- 方式一:</span></div><div class="line">	<span class="keyword">SELECT</span> d.deptno, d.dname, d.loc, <span class="keyword">count</span>(<span class="number">1</span>) 部门人数 <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> d.deptno = e.deptno <span class="keyword">GROUP</span> <span class="keyword">BY</span> e.deptno <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(e.empno) &gt; <span class="number">3</span>;</div><div class="line">	<span class="comment">-- 方式二</span></div><div class="line">	<span class="keyword">SELECT</span> d.*, ed.count 部门人数 <span class="keyword">FROM</span> dept d, (<span class="keyword">SELECT</span> deptno, <span class="keyword">COUNT</span>(empno) <span class="keyword">COUNT</span> <span class="keyword">FROM</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(empno) &gt; <span class="number">3</span>) ed <span class="keyword">WHERE</span> d.deptno = ed.deptno;</div><div class="line"><span class="comment">-- 19.列出薪金比“ALLEN”多的所有员工</span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> e.sal &gt; (<span class="keyword">SELECT</span> e1.sal <span class="keyword">FROM</span> emp e1 <span class="keyword">WHERE</span> e1.ename=<span class="string">'ALLEN'</span>);	</div><div class="line"><span class="comment">-- 20.列出所有员工的姓名及其上级的姓名</span></div><div class="line"><span class="keyword">SELECT</span> e.ename 员工姓名, e1.ename 员工上级姓名 <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> emp e1 <span class="keyword">ON</span> e.mgr=e1.empno;	</div><div class="line"><span class="comment">-- 21.列出受雇日期早于直接上级的所有员工的编号，姓名，部门名称</span></div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> e.hiredate &lt; (<span class="keyword">SELECT</span> e1.hiredate <span class="keyword">FROM</span> emp e1 <span class="keyword">WHERE</span> e1.empno=e.mgr);</div><div class="line"><span class="comment">-- 22.列出部门名称和这些部门员工的信息，同时列出那些没有员工的部门</span></div><div class="line"><span class="keyword">SELECT</span> d.dname, e.* <span class="keyword">FROM</span> dept d <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> emp e <span class="keyword">ON</span> e.deptno = d.deptno;	</div><div class="line"><span class="comment">-- 23.列出“CLERK”的姓名和部门名称，部门人数</span></div><div class="line"><span class="keyword">SELECT</span> e.ename, d.dname, ep.cou <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> d.deptno=e.deptno <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> e1.deptno, <span class="keyword">COUNT</span>(empno) cou <span class="keyword">FROM</span> emp e1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno) ep <span class="keyword">ON</span> ep.deptno=d.deptno <span class="keyword">WHERE</span> e.job = <span class="string">'CLERK'</span>;	</div><div class="line"><span class="comment">-- 24.列出最低薪金大于1500的各种工作以及从事此工作的全部雇员人数</span></div><div class="line"><span class="keyword">SELECT</span> e.job, ep.count <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> e1.job, <span class="keyword">count</span>(e1.job) <span class="keyword">COUNT</span> <span class="keyword">FROM</span> emp e1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> e1.job) ep <span class="keyword">ON</span> e.job=ep.job <span class="keyword">WHERE</span> e.sal&gt;<span class="number">1500</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> e.job;	</div><div class="line"><span class="comment">-- 25.列出薪金高于工资平均薪金的所有员工，所在部门，上级领导，公司的工资等级</span></div><div class="line"><span class="keyword">SELECT</span> e.empno, d.dname 所在部门名称,e1.ename 上级领导,e.sal 工资, s.grade 工资等级 <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> d.deptno=e.deptno <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> emp e1 <span class="keyword">ON</span> e.mgr=e1.empno <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> salgrade s <span class="keyword">ON</span> e.sal <span class="keyword">BETWEEN</span> s.losal <span class="keyword">AND</span> s.hisal <span class="keyword">WHERE</span> e.sal&gt; (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(e1.sal) <span class="keyword">FROM</span> emp e1);</div><div class="line"><span class="comment">-- 26.列出和“SCOTT”从事相同工作的所有员工及部门名称</span></div><div class="line"><span class="keyword">SELECT</span> e1.empno, e1.job, e1.deptno, d.dname <span class="keyword">FROM</span> emp e1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> d.deptno=e1.deptno <span class="keyword">WHERE</span> e1.job= (<span class="keyword">SELECT</span> e.job <span class="keyword">FROM</span> emp e <span class="keyword">WHERE</span> e.ename=<span class="string">'SCOTT'</span>);	</div><div class="line"><span class="comment">-- 27.列出薪金等于部门30中员工薪金的所有员工的姓名和薪金</span></div><div class="line"><span class="keyword">SELECT</span> ename, sal <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> sal <span class="keyword">IN</span> (<span class="keyword">SELECT</span> sal <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> deptno=<span class="string">'30'</span>) <span class="keyword">AND</span> deptno!=<span class="string">'30'</span>;</div><div class="line"><span class="comment">-- 28.列出薪金高于在部门30工作的所有员工的薪金的员工姓名和薪金、部门名称</span></div><div class="line"><span class="keyword">SELECT</span> e.ename 员工姓名, e.sal 薪金, d.dname <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> d.deptno=e.deptno <span class="keyword">WHERE</span> e.sal&gt; (<span class="keyword">SELECT</span> <span class="keyword">max</span>(e1.sal) <span class="keyword">FROM</span> emp e1 <span class="keyword">WHERE</span> e1.deptno=<span class="string">'30'</span>);</div><div class="line"><span class="comment">-- 29.列出每个部门工作的员工数量、平均工资和平均服务期限</span></div><div class="line"><span class="keyword">SELECT</span> d.dname 部门名称, <span class="keyword">count</span>(e.deptno) 员工数量, <span class="keyword">AVG</span>(e.sal) 平均工资, <span class="keyword">AVG</span>(((<span class="keyword">YEAR</span> (<span class="keyword">SYSDATE</span>()) - <span class="keyword">YEAR</span> (e.hiredate)) * <span class="number">12</span> + <span class="keyword">MONTH</span> (<span class="keyword">SYSDATE</span>()) - <span class="keyword">MONTH</span> (e.hiredate)) / <span class="number">12</span>) 工作平均年限 <span class="keyword">FROM</span> dept d <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> emp e <span class="keyword">ON</span> e.deptno = d.deptno <span class="keyword">GROUP</span> <span class="keyword">BY</span> e.deptno;	</div><div class="line"><span class="comment">-- 30.列出各个部门的MANAGER 的最低薪金</span></div><div class="line"><span class="keyword">SELECT</span> ep.*, <span class="keyword">MIN</span>(ep.sal) 部门最低薪水 <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> d.dname 部门名称,e.* <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">ON</span> d.deptno=e.deptno <span class="keyword">WHERE</span> e.job=<span class="string">'MANAGER'</span>) ep <span class="keyword">GROUP</span> <span class="keyword">BY</span> ep.部门名称;</div><div class="line"><span class="comment">-- 31.查询出某个员工的上级主管，并要求这些主管中的薪水超过3000</span></div><div class="line"><span class="keyword">SELECT</span> e.* <span class="keyword">FROM</span> emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> emp e1 <span class="keyword">ON</span> e1.deptno=e.mgr <span class="keyword">WHERE</span> e.sal&gt;<span class="number">3000</span>;</div><div class="line"><span class="comment">-- 32.求出部门名称中带有’S‘字符的部门员工的工资合计，部门人数</span></div><div class="line"><span class="keyword">SELECT</span> d.dname 部门名称, <span class="keyword">sum</span>(e.sal) 工资合计, <span class="keyword">count</span>(e.deptno) <span class="keyword">FROM</span> dept d <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> emp e <span class="keyword">ON</span> e.deptno=d.deptno <span class="keyword">WHERE</span> d.dname <span class="keyword">LIKE</span> <span class="string">'%S%'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> d.deptno;	</div><div class="line"><span class="comment">-- 33.给任职日期超过10年的人加薪10%</span></div><div class="line"><span class="keyword">UPDATE</span> emp e <span class="keyword">SET</span> e.sal=e.sal*<span class="number">1.1</span> <span class="keyword">WHERE</span> (<span class="keyword">TIMESTAMPDIFF</span>(<span class="keyword">MONTH</span>,e.hiredate,<span class="keyword">SYSDATE</span>()))/<span class="number">12</span> &gt; <span class="number">10</span>;	</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">TIMESTAMPDIFF</span>(<span class="keyword">DAY</span>,<span class="string">'2012-10-01'</span>,<span class="string">'2013-01-13'</span>); <span class="comment">-- 获取两日期之间天数</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">DATEDIFF</span>(<span class="string">'2013-01-13'</span>,<span class="string">'2012-10-01'</span>) <span class="keyword">FROM</span> dual; <span class="comment">-- 获取两日期之间天数</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">TIMESTAMPDIFF</span>(<span class="keyword">MONTH</span>,<span class="string">'2012-10-01'</span>,<span class="string">'2013-01-13'</span>); <span class="comment">-- 获取两日期月数</span></div></pre></td></tr></table></figure>
<h1 id="EXISTS和IN"><a href="#EXISTS和IN" class="headerlink" title="EXISTS和IN"></a>EXISTS和IN</h1><p>效率差<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	<span class="number">1</span></div><div class="line"><span class="keyword">FROM</span></div><div class="line">	tp_parcel_info f</div><div class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tp_station_info s <span class="keyword">ON</span> s.f_station_id = f.f_station_id</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	<span class="number">1</span> = <span class="number">1</span></div><div class="line"><span class="keyword">AND</span> f.f_parcel_status <span class="keyword">IN</span> (<span class="number">0</span>)</div><div class="line"><span class="keyword">AND</span> f.f_last_time &gt;= <span class="string">'20160901000000'</span></div><div class="line"><span class="keyword">AND</span> f.f_last_time &lt;= <span class="string">'20161131235959'</span></div><div class="line"><span class="keyword">AND</span> f.f_company_id = <span class="string">'108'</span></div><div class="line"><span class="keyword">AND</span> <span class="keyword">EXISTS</span> (</div><div class="line">	<span class="keyword">SELECT</span></div><div class="line">		<span class="number">1</span></div><div class="line">	<span class="keyword">FROM</span></div><div class="line">		tp_express_branch_com_dz d</div><div class="line">	<span class="keyword">WHERE</span></div><div class="line">		d.f_exp_id = <span class="string">'2729'</span></div><div class="line">	<span class="keyword">AND</span> f.f_station_id = d.f_station_id</div><div class="line">	<span class="keyword">AND</span> d.f_branch_state = <span class="number">0</span></div><div class="line">)</div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></div><div class="line">	f.f_last_time <span class="keyword">DESC</span></div></pre></td></tr></table></figure></p>
<p>效率高<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">	f.f_parcel_id,</div><div class="line">	f.f_exp_id,</div><div class="line">	f.f_branch_id,</div><div class="line">	f.f_station_id,</div><div class="line">	f.f_mail_no,</div><div class="line">	f.f_company_id,</div><div class="line">	f.f_company_name,</div><div class="line">	f.f_recipient_name,</div><div class="line">	f.f_recipient_mobile,</div><div class="line">	f.f_frame_code,</div><div class="line">	f.f_take_code,</div><div class="line">	f.f_num,</div><div class="line">	f.f_input_way,</div><div class="line">	f.f_input_source,</div><div class="line">	f.f_arrive_time,</div><div class="line">	f.f_parcel_status,</div><div class="line">	f.f_is_detention,</div><div class="line">	f.f_out_way,</div><div class="line">	f.f_out_source,</div><div class="line">	f.f_app_notice_status,</div><div class="line">	f.f_weixin_notice_status,</div><div class="line">	f.f_sms_notice_status,</div><div class="line">	f.f_out_time,</div><div class="line">	f.f_last_time,</div><div class="line">	f.f_type,</div><div class="line">	f.f_comment,</div><div class="line">	s.f_station_name</div><div class="line"><span class="keyword">FROM</span></div><div class="line">	tp_parcel_info f</div><div class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tp_station_info s <span class="keyword">ON</span> s.f_station_id = f.f_station_id</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">	<span class="number">1</span> = <span class="number">1</span></div><div class="line"><span class="keyword">AND</span> f.f_parcel_status <span class="keyword">IN</span> (<span class="number">0</span>)</div><div class="line"><span class="keyword">AND</span> f.f_last_time &gt;= <span class="string">'20160901000000'</span></div><div class="line"><span class="keyword">AND</span> f.f_last_time &lt;= <span class="string">'20161131235959'</span></div><div class="line"><span class="keyword">AND</span> f.f_company_id = <span class="string">'108'</span></div><div class="line"><span class="keyword">AND</span> f.f_station_id <span class="keyword">IN</span> (</div><div class="line">	<span class="keyword">SELECT</span></div><div class="line">		d.f_station_id</div><div class="line">	<span class="keyword">FROM</span></div><div class="line">		tp_express_branch_com_dz d</div><div class="line">	<span class="keyword">WHERE</span></div><div class="line">		d.f_exp_id = <span class="string">'2729'</span></div><div class="line">	<span class="keyword">AND</span> d.f_branch_state = <span class="number">0</span></div><div class="line">)</div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></div><div class="line">	f.f_last_time <span class="keyword">DESC</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>例如</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 例如：表A（小表），表B（大表）</span></div><div class="line"><span class="comment">-- 1：</span></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> A <span class="keyword">where</span> cc <span class="keyword">in</span> (<span class="keyword">select</span> cc <span class="keyword">from</span> B)</div><div class="line"><span class="comment">-- 效率低，用到了A表上cc列的索引；</span></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> A <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> cc <span class="keyword">from</span> B <span class="keyword">where</span> cc=A.cc)</div><div class="line"><span class="comment">-- 效率高，用到了B表上cc列的索引。</span></div><div class="line"><span class="comment">-- 相反的</span></div><div class="line"><span class="comment">-- 2：</span></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> B <span class="keyword">where</span> cc <span class="keyword">in</span> (<span class="keyword">select</span> cc <span class="keyword">from</span> A)</div><div class="line"><span class="comment">-- 效率高，用到了B表上cc列的索引；</span></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> B <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> cc <span class="keyword">from</span> A <span class="keyword">where</span> cc=B.cc)</div><div class="line"><span class="comment">-- 效率低，用到了A表上cc列的索引。</span></div></pre></td></tr></table></figure>
<blockquote>
<p>总结    </p>
</blockquote>
<font color="#FF0000" face="Menlo">in是把外表和内表作hash连接，而exists是对外表作loop循环，每次loop循环再对内表进行查询，一直以来认为exists比in效率高的说法是不准确的。如果查询的两个表大小相当，那么用in和exists差别不大；如果两个表中一个较小一个较大，则子查询表大的用exists(大表)，子查询表小的用in(小表);<br>跟显示字段的多少没有太大区别。<br></font>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Notes]]></title>
      <url>https://volc1605.github.io/2016/11/01/notes/</url>
      <content type="html"><![CDATA[<h1 id="1-查看端口号并关闭相关进程"><a href="#1-查看端口号并关闭相关进程" class="headerlink" title="1.查看端口号并关闭相关进程"></a>1.查看端口号并关闭相关进程</h1><blockquote>
<p>1.查看端口占用</p>
</blockquote>
<p>在windows命令行窗口下执行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">netstat -aon|findstr &quot;8080&quot;</div><div class="line">TCP     127.0.0.1:80         0.0.0.0:0               LISTENING       2448</div></pre></td></tr></table></figure>
<p>端口“8080”被PID（进程号）为2448的进程占用。<br>查看端口“8080”被哪个应用占用，，继续执行下面命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tasklist|findstr &quot;2448&quot;</div><div class="line">notepad.exe                     2016 Console                 0     16,064 K</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<blockquote>
<p>2.关闭进程</p>
</blockquote>
<p>2.1 按进程号关闭进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">taskkill /pid 2152</div></pre></td></tr></table></figure>
<p>多个时格式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">taskkill /pid 2152 /pid 1284</div></pre></td></tr></table></figure></p>
<p>2.2 按进程名关闭进程</p>
<p>如要关闭notepad.exe,格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">taskkill /im notepad.exe</div></pre></td></tr></table></figure>
<p>指定多个时格式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">taskkill /im notepad.exe /im iexplorer.exe</div></pre></td></tr></table></figure></p>
<p>如果是要关闭所有的,则使用通配符*,即：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">taskkill /im *.exe</div></pre></td></tr></table></figure></p>
<p>2.3 有提示的关闭进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">taskkill /t /im notepad.exe</div><div class="line">taskkill /t /pid 2152</div></pre></td></tr></table></figure>
<p>这个效果是提示后在使用者确定后关闭,有提示框。<br>2.4 强行终止进程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">taskkill /f /im notepad.exe</div><div class="line">taskkill /f /pid 2152</div></pre></td></tr></table></figure></p>
<p>2.5 关闭一个.bat文件</p>
<p>为mvnDebug.bat文件添加title为mvn<br>部分内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@echo off</div><div class="line">title mvn</div><div class="line">@REM enable echoing my setting MAVEN_BATCH_ECHO to &apos;on&apos;</div><div class="line">@if &quot;%MAVEN_BATCH_ECHO%&quot; == &quot;on&quot;  echo %MAVEN_BATCH_ECHO%</div></pre></td></tr></table></figure></p>
<p>关闭mvnDebug.bat文件<br>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\Users\Administrator&gt;taskkill /fi  &quot;windowtitle eq mvn&quot;</div></pre></td></tr></table></figure></p>
<p>windowtitle eq mvn<br>eq 后面指定需要关闭的.bat文件的title即可</p>
<blockquote>
<p>3.端口状态</p>
</blockquote>
<p>3.1 LISTENING状态<br>FTP服务启动后首先处于侦听（LISTENING）状态。</p>
<p>3.2 ESTABLISHED状态<br>ESTABLISHED的意思是建立连接。表示两台机器正在通信。<br>3.3 CLOSE_WAIT<br>对方主动关闭连接或者网络异常导致连接中断，这时我方的状态会变成CLOSE_WAIT 此时我方要调用close()来使得连接正确关闭<br>3.4 TIME_WAIT<br>我方主动调用close()断开连接，收到对方确认后状态变为TIME_WAIT。TCP协议规定TIME_WAIT状态会一直持续2MSL(即两倍的分段最大生存期)，以此来确保旧的连接状态不会对新连接产生影响。处于TIME_WAIT状态的连接占用的资源不会被内核释放，所以作为服务器，在可能的情况下，尽量不要主动断开连接，以减少TIME_WAIT状态造成的资源浪费。<br>目前有一种避免TIME_WAIT资源浪费的方法，就是关闭socket的LINGER选项。但这种做法是TCP协议不推荐使用的，在某些情况下这个操作可能会带来错误。<br>3.5 SYN_SENT状态<br>SYN_SENT状态表示请求连接，当你要访问其它的计算机的服务时首先要发个同步信号给该端口，此时状态为SYN_SENT，如果连接成功了就变为ESTABLISHED，此时SYN_SENT状态非常短暂。但如果发现SYN_SENT非常多且在向不同的机器发出，那你的机器可能中了冲击波或震荡波之类的病毒了。这类病毒为了感染别的计算机，它就要扫描别的计算机，在扫描的过程中对每个要扫描的计算机都要发出了同步请求，这也是出现许多SYN_SENT的原因。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[JS]]></title>
      <url>https://volc1605.github.io/2016/11/01/JS/</url>
      <content type="html"><![CDATA[<h3 id="1-windows对象setTimeOut-用于发送验证码倒计时"><a href="#1-windows对象setTimeOut-用于发送验证码倒计时" class="headerlink" title="1 windows对象setTimeOut()用于发送验证码倒计时"></a>1 windows对象setTimeOut()用于发送验证码倒计时</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//短信验证码倒计时</div><div class="line">var wait = 30;</div><div class="line">function time(o) &#123;</div><div class="line">    if (wait == 0) &#123;</div><div class="line">        o.removeAttribute(&quot;disabled&quot;);</div><div class="line">        o.innerHTML = &quot;发送短信验证码&quot;;</div><div class="line">        wait = 30;</div><div class="line">    &#125; else &#123;</div><div class="line">        o.setAttribute(&quot;disabled&quot;, true);  </div><div class="line">        o.innerHTML = &quot;重新发送(&quot; + wait + &quot;)&quot;;</div><div class="line"></div><div class="line">        wait--;  </div><div class="line">        setTimeout(function()&#123;time(o)&#125;, 2)</div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="2-bind-this-用法"><a href="#2-bind-this-用法" class="headerlink" title="2 bind(this)用法"></a>2 bind(this)用法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">//设立一个简单地对象作为“上下文”</div><div class="line"> var context = &#123; foo: &quot;bar&quot; &#125;;</div><div class="line"></div><div class="line"> //一个在this上下文中指向foo变量的函数</div><div class="line"> function returnFoo () &#123;</div><div class="line">   return this.foo;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> // 变量在作用域中不存在，因此显示undefined</div><div class="line"> returnFoo(); // =&gt; undefined</div><div class="line"></div><div class="line"> // 如果我们把它绑定在context上下文中</div><div class="line"> var bound = returnFoo.bind(context);</div><div class="line"></div><div class="line"> // 现在的作用域中有这个变量了</div><div class="line"> bound(); // =&gt; &quot;bar&quot;</div></pre></td></tr></table></figure>
<h3 id="3-js传数组给html"><a href="#3-js传数组给html" class="headerlink" title="3 js传数组给html"></a>3 js传数组给html</h3><p>JS<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> servicePlanList = <span class="built_in">JSON</span>.stringify(canFee);  <span class="comment">// canFee数组</span></div><div class="line"><span class="keyword">this</span>.assign(<span class="string">'servicePlanList'</span>, servicePlanList);</div></pre></td></tr></table></figure></p>
<p>html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">INPUT</span> <span class="attr">ID</span>=<span class="string">"servicePlanList"</span> <span class="attr">NAME</span>=<span class="string">"servicePlanListName"</span> <span class="attr">TYPE</span>=<span class="string">"hidden"</span></span></div><div class="line">  <span class="attr">VALUE</span>=<span class="string">"&lt;?=servicePlanList?&gt;"</span>&gt;<span class="tag">&lt;/<span class="name">INPUT</span>&gt;</span> value的值” [</div><div class="line">&#123;"fState":"1","managerId":123,"serviceFeeId":"5b7627c5ec8d4b96abae3996255f1034","serviceFeeMin":34,"serviceFeeName":"KGKGKA134","serviceFeePer":"12","serviceFeeStart":23,"type":1&#125;,</div><div class="line">&#123;"fState":"1","managerId":123,"serviceFeeId":"5a1248caf9334d77ab04f6a1df68b542","serviceFeeMin":20,"serviceFeeName":"KGKGKA13","serviceFeePer":"12","serviceFeeStart":23,"type":1&#125;]</div><div class="line">”</div><div class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="keyword">var</span> servicePlanList = $(<span class="string">'#servicePlanList'</span>).val();</div><div class="line">servicePlanList = <span class="built_in">eval</span>(<span class="string">"("</span> + servicePlanList +<span class="string">")"</span>); <span class="comment">// eval()语言</span></div><div class="line"><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="4-解决服务器上容器传参到jsp页面出现乱码问题"><a href="#4-解决服务器上容器传参到jsp页面出现乱码问题" class="headerlink" title="4 解决服务器上容器传参到jsp页面出现乱码问题"></a>4 解决服务器上容器传参到jsp页面出现乱码问题</h3><p>1方式.<br>前台：userName : encodeURI(encodeURI($(user.children[1]).text())),<br>后台：userInfoJson = URLDecoder.decode(userInfoJson, “UTF-8”);<br>2方式.<br>后台：keyWords = new String(keyWords.getBytes(“ISO-8859-1”), “UTF-8”);</p>
<h3 id="5-js-全局变量赋值问题"><a href="#5-js-全局变量赋值问题" class="headerlink" title="5 js 全局变量赋值问题"></a>5 js 全局变量赋值问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">注意：全局变量一定要放在使用全局变量方法的上面，</div><div class="line">function setI()&#123;i=0;&#125;</div><div class="line">var i = 7;</div><div class="line">function getI()&#123;console.log(i);&#125; // 打印仍为7</div></pre></td></tr></table></figure>
<h3 id="6-时间戳转换成指定格式字符串"><a href="#6-时间戳转换成指定格式字符串" class="headerlink" title="6 时间戳转换成指定格式字符串"></a>6 时间戳转换成指定格式字符串</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 	2008-07-31 23:01:59</div><div class="line">function formatDate(dateStr) &#123; // long型的   1217516519000</div><div class="line">	var date = new Date(dateStr);</div><div class="line">	Y = date.getFullYear() + &apos;-&apos;;</div><div class="line">	M = (date.getMonth() + 1 &lt; 10 ? &apos;0&apos; + (date.getMonth() + 1) : date.getMonth() + 1) + &apos;-&apos;;</div><div class="line">	D = (date.getDate() &lt; 10 ? &apos;0&apos; + (date.getDate()) : date.getDate()) + &apos; &apos;;</div><div class="line">	h = (date.getHours() &lt; 10 ? &apos;0&apos; + (date.getHours()) : date.getHours()) + &apos;:&apos;;</div><div class="line">	m = (date.getMinutes() &lt; 10 ? &apos;0&apos; + (date.getMinutes()) : date.getMinutes()) + &apos;:&apos;;</div><div class="line">	s = (date.getSeconds() &lt; 10 ? &apos;0&apos; + (date.getSeconds()) : date.getSeconds());</div><div class="line">	return Y + M + D + h + m + s;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var stringTime = &quot;2014-07-10 10:21:12&quot;;</div><div class="line">var timestamp2 = Date.parse(new Date(stringTime)); // long型时间戳</div><div class="line">console.log(&apos;时间&apos;);</div><div class="line">console.log(formatDate(timestamp2));</div></pre></td></tr></table></figure>
<h3 id="7-根据id添加该标签的属性"><a href="#7-根据id添加该标签的属性" class="headerlink" title="7 根据id添加该标签的属性"></a>7 根据id添加该标签的属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 根据id添加该标签的class属性</div><div class="line">$(&quot;#deviceStatusId&quot;)[0].setAttribute(&apos;class&apos;, statusClass);</div></pre></td></tr></table></figure>
<h3 id="8-cookie操作"><a href="#8-cookie操作" class="headerlink" title="8 cookie操作"></a>8 cookie操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// 添加存到cookie中</div><div class="line">document.cookie = &apos;positionValue=1&apos;;</div><div class="line">// 读取cookie</div><div class="line">console.log(getCookie(&apos;positionValue&apos;));</div><div class="line">// 设置cookie		</div><div class="line">setCookie(&apos;positionValue&apos;, &apos;2&apos;, 1); // 有效期1天数</div><div class="line"></div><div class="line">function getCookie(c_name) &#123;</div><div class="line">	if (document.cookie.length &gt; 0) &#123;　　//先查询cookie是否为空，为空就return &quot;&quot;</div><div class="line">		c_start = document.cookie.indexOf(c_name + &quot;=&quot;)　　//通过String对象的indexOf()来检查这个cookie是否存在，不存在就为 -1　　</div><div class="line">		if (c_start != -1) &#123;</div><div class="line">			c_start = c_start + c_name.length + 1　　//最后这个+1其实就是表示&quot;=&quot;号啦，这样就获取到了cookie值的开始位置</div><div class="line">			c_end = document.cookie.indexOf(&quot;;&quot;, c_start)　　//其实我刚看见indexOf()第二个参数的时候猛然有点晕，后来想起来表示指定的开始索引的位置...这句是为了得到值的结束位置。因为需要考虑是否是最后一项，所以通过&quot;;&quot;号是否存在来判断</div><div class="line">			if (c_end == -1) c_end = document.cookie.length</div><div class="line">			return unescape(document.cookie.substring(c_start, c_end))　　//通过substring()得到了值。想了解unescape()得先知道escape()是做什么的，都是很重要的基础，想了解的可以搜索下，在文章结尾处也会进行讲解cookie编码细节</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return &quot;&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">function setCookie(c_name, value, expiredays) &#123;</div><div class="line">	var exdate = new Date();</div><div class="line">	exdate.setDate(exdate.getDate() + expiredays);</div><div class="line">	document.cookie = c_name + &quot;=&quot; + escape(value) + ((expiredays == null) ? &quot;&quot; : &quot;;expires=&quot; + exdate.toGMTString());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="9-js触发a标签"><a href="#9-js触发a标签" class="headerlink" title="9 js触发a标签"></a>9 js触发a标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;a id=&quot;liebiaoid&quot; data-toggle=&quot;tab&quot; style=&quot;cursor:pointer&quot;&gt;&lt;span id=&quot;liebiaosid&quot;&gt;列 表&lt;/span&gt;&lt;/a&gt;</div><div class="line">点击事件中添加跳转路径</div><div class="line">$(&apos;#liebiaoid&apos;).click(function()&#123;</div><div class="line">	$(&apos;#liebiaoid&apos;)[0].setAttribute(&apos;href&apos;, &quot;#rgcs&quot;); // 动态添加</div><div class="line">	$(&apos;#liebiaosid&apos;).click();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="10-jquery树插件"><a href="#10-jquery树插件" class="headerlink" title="10 jquery树插件"></a>10 jquery树插件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;link href=&quot;js/jquery-ztree/3.5.12/css/zTreeStyle/zTreeStyle.min.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;/&gt;</div><div class="line">&lt;script src=&quot;js/jquery-ztree/3.5.12/js/jquery.ztree.all-3.5.min.js&quot;&gt;&lt;/script&gt;</div><div class="line"></div><div class="line">&lt;div class=&quot;modal fade&quot; id=&quot;luxian&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; aria-labelledby=&quot;ModalLabel&quot;&gt;</div><div class="line">    &lt;div class=&quot;modal-dialog2&quot; role=&quot;document&quot;&gt;</div><div class="line">        &lt;div class=&quot;modal-content&quot;&gt;</div><div class="line">            &lt;div class=&quot;modal-header&quot;&gt;</div><div class="line">                &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;modal&quot; aria-label=&quot;Close&quot;&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&amp;times;&lt;/span&gt;</div><div class="line">                &lt;/button&gt;</div><div class="line">                &lt;h4 class=&quot;modal-title&quot; id=&quot;ModalLabel&quot;&gt;选择所在路线&lt;/h4&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">            &lt;div class=&quot;modal-body&quot;&gt;</div><div class="line">                &lt;div class=&quot;row&quot;&gt;</div><div class="line">                    &lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line">                        &lt;div id=&quot;treegs&quot; class=&quot;ztree ztreeg&quot;&gt;&lt;/div&gt;</div><div class="line">                    &lt;/div&gt;</div><div class="line">                &lt;/div&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">            &lt;div class=&quot;modal-footer&quot;&gt;</div><div class="line">                &lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot;&gt;确定&lt;/button&gt;</div><div class="line">                &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; data-dismiss=&quot;modal&quot;&gt;关闭&lt;/button&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">$(function()&#123;</div><div class="line"> var setting = &#123;</div><div class="line">	data: &#123;</div><div class="line">		key: &#123;</div><div class="line">			name: &quot;name&quot;</div><div class="line">		&#125;,</div><div class="line">		simpleData: &#123;</div><div class="line">			enable: true,</div><div class="line">			idKey: &quot;id&quot;,</div><div class="line">			pIdKey: &quot;pId&quot;,</div><div class="line">			rootPId: &apos;0&apos;</div><div class="line">		&#125;,</div><div class="line">		view: &#123;</div><div class="line">			selectedMulti: false</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	callback: &#123;</div><div class="line">		onClick: function (event, treeId, treeNode) &#123;</div><div class="line">			var name = treeNode.name;</div><div class="line">			$(&quot;#lux&quot;).val(name); // 点击赋值</div><div class="line">			$(&quot;#luxian&quot;).modal(&quot;hide&quot;); // 点击后隐藏模态框</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">$.getJSON(&quot;/dhms/sys/device/deviceInfo/getAllLux&quot;, function (data) &#123; // 获取树结构</div><div class="line">	$.fn.zTree.init($(&quot;#treegs&quot;), setting, data).expandAll(true);</div><div class="line">&#125;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="11-引入百度地图"><a href="#11-引入百度地图" class="headerlink" title="11 引入百度地图"></a>11 引入百度地图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;http://api.map.baidu.com/api?v=2.0&amp;amp;ak=ohVowrtf6KyzxGHYWP6DLwDO&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;http://api.map.baidu.com/getscript?v=2.0&amp;amp;ak=ohVowrtf6KyzxGHYWP6DLwDO&amp;amp;services=&amp;amp;t=20170801112042&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;div id=&quot;allmap&quot; style=&quot;overflow: hidden;border:1px solid #ccc;&quot;&gt;</div><div class="line">&lt;/div&gt;</div><div class="line"></div><div class="line"></div><div class="line">$(function()&#123;</div><div class="line">	//初始化地图高度</div><div class="line">	var h = document.documentElement.clientHeight;//可见区域高度</div><div class="line">	var divh = document.getElementById(&apos;allmap&apos;);</div><div class="line">	divh.style.height = (h - 310) + &quot;px&quot;;</div><div class="line">	</div><div class="line">	//加载百度地图</div><div class="line"></div><div class="line">	// 创建Map实例</div><div class="line">	map = new BMap.Map(&quot;allmap&quot;);</div><div class="line">	// 初始化地图,设置中心点坐标和地图级别</div><div class="line">	map.centerAndZoom(new BMap.Point(118.77589, 32.061958), 11);</div><div class="line">	//添加平移缩放控件</div><div class="line">	map.addControl(new BMap.NavigationControl());</div><div class="line">	//添加放大、缩小控件</div><div class="line">	map.addControl(new BMap.ScaleControl());</div><div class="line">	//允许鼠标滑轮操作</div><div class="line">	map.enableScrollWheelZoom();</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="12-echarts图标"><a href="#12-echarts图标" class="headerlink" title="12 echarts图标"></a>12 echarts图标</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&lt;script src=&quot;js/echarts.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;style&gt;</div><div class="line">    .charClass &#123;</div><div class="line">        height: 45px;</div><div class="line">        width: 100%;</div><div class="line">        margin: 0 auto;</div><div class="line">    &#125;</div><div class="line">&lt;/style&gt;</div><div class="line"></div><div class="line">&lt;div id=&quot;shid&quot; class=&apos;charClass&apos;&gt;&lt;/div&gt;</div><div class="line"></div><div class="line">$(function()&#123;</div><div class="line">	var myChartshid = echarts.init(document.getElementById(&apos;shid&apos;));</div><div class="line">	 optionshid = &#123;</div><div class="line">		tooltip : &#123;</div><div class="line">			trigger: &apos;axis&apos;, // 鼠标悬停触发</div><div class="line">			show:true</div><div class="line">		&#125;,</div><div class="line">		grid: &#123;</div><div class="line">			left: &apos;2%&apos;,</div><div class="line">			right: &apos;2%&apos;,</div><div class="line">			bottom: 25, // 可调整图标在div中的位置</div><div class="line">			containLabel: true</div><div class="line">		&#125;,</div><div class="line">		xAxis: &#123;</div><div class="line">			show:false,</div><div class="line">			data : [&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,&apos;10&apos;,&apos;11&apos;,&apos;12&apos;,&apos;13&apos;,&apos;14&apos;,&apos;15&apos;,&apos;16&apos;,&apos;17&apos;,&apos;18&apos;,&apos;19&apos;,&apos;20&apos;,&apos;21&apos;,&apos;22&apos;,&apos;23&apos;,&apos;24&apos;,&apos;25&apos;,&apos;26&apos;,&apos;27&apos;,&apos;28&apos;,&apos;29&apos;,&apos;30&apos;,&apos;31&apos;,&apos;32&apos;,&apos;33&apos;,&apos;34&apos;,&apos;35&apos;,&apos;36&apos;,&apos;37&apos;,&apos;38&apos;,&apos;39&apos;,&apos;40&apos;,&apos;41&apos;,&apos;42&apos;,&apos;43&apos;,&apos;44&apos;,&apos;45&apos;,&apos;46&apos;,&apos;47&apos;,&apos;48&apos;,&apos;49&apos;,&apos;50&apos;] // 50个点</div><div class="line">		&#125;,</div><div class="line">		yAxis: &#123;</div><div class="line">			show: false</div><div class="line">		&#125;,</div><div class="line">		series: [&#123;</div><div class="line">			type: &apos;line&apos;,</div><div class="line">			data: [&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,&apos;10&apos;,&apos;11&apos;,&apos;12&apos;,&apos;13&apos;,&apos;14&apos;,&apos;15&apos;,&apos;16&apos;,&apos;17&apos;,&apos;18&apos;,&apos;19&apos;,&apos;20&apos;,&apos;21&apos;,&apos;22&apos;,&apos;23&apos;,&apos;24&apos;,&apos;25&apos;,&apos;26&apos;,&apos;27&apos;,&apos;28&apos;,&apos;29&apos;,&apos;30&apos;,&apos;31&apos;,&apos;32&apos;,&apos;33&apos;,&apos;34&apos;,&apos;35&apos;,&apos;36&apos;,&apos;37&apos;,&apos;38&apos;,&apos;39&apos;,&apos;40&apos;,&apos;41&apos;,&apos;42&apos;,&apos;43&apos;,&apos;44&apos;,&apos;45&apos;,&apos;46&apos;,&apos;47&apos;,&apos;48&apos;,&apos;49&apos;,&apos;50&apos;] // 50个点的y值，个数要和xAxis的data数量一致</div><div class="line">		&#125;]</div><div class="line">    &#125;;</div><div class="line">	myChartshid.setOption(optionshid);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="13-使用jquery-form-js解决兼容性表单上传文件"><a href="#13-使用jquery-form-js解决兼容性表单上传文件" class="headerlink" title="13. 使用jquery-form.js解决兼容性表单上传文件"></a>13. 使用jquery-form.js解决兼容性表单上传文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-form.js&quot;&gt;&lt;/script&gt;</div><div class="line"></div><div class="line">&lt;form id=&quot;importStationFormId&quot; action=&quot;upload/upload&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;</div><div class="line">	  class=&quot;smart-form&quot;&gt;</div><div class="line">	&lt;div class=&quot;modal-body&quot;&gt;</div><div class="line">		&lt;div class=&quot;widget-body no-padding&quot; style=&quot;margin: 20px;&quot;&gt;</div><div class="line">			&lt;fieldset&gt;</div><div class="line">				&lt;section&gt;</div><div class="line">					&lt;label class=&quot;label&quot;&gt;选择文件&lt;/label&gt;</div><div class="line">					&lt;label for=&quot;fileId&quot; class=&quot;input input-file&quot;&gt;</div><div class="line">						&lt;!--&lt;div class=&quot;button&quot;&gt;--&gt;</div><div class="line">						&lt;input id=&quot;fileId&quot; type=&quot;file&quot; name=&quot;upfile&quot;&gt;</div><div class="line">						&lt;!--浏览--&gt;</div><div class="line">						&lt;!--&lt;/div&gt;--&gt;</div><div class="line">						&lt;!--&lt;input type=&quot;text&quot; placeholder=&quot;请选择文件&quot; readonly=&quot;&quot;&gt;--&gt;</div><div class="line">					&lt;/label&gt;</div><div class="line">				&lt;/section&gt;</div><div class="line">			&lt;/fieldset&gt;</div><div class="line">		&lt;/div&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">	&lt;div class=&quot;modal-footer&quot; style=&quot;padding: 20px;&quot;&gt;</div><div class="line">		&lt;button type=&quot;button&quot; id=&quot;closeId&quot; class=&quot;btn btn-default btntop&quot; data-dismiss=&quot;modal&quot;&gt;关闭&lt;/button&gt;</div><div class="line">		&lt;button type=&quot;button&quot; onclick=&quot;importStationInfo()&quot; class=&quot;btn btn-primary btntop&quot;&gt;保存&lt;/button&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">&lt;/form&gt;</div><div class="line"></div><div class="line"></div><div class="line"> $(&quot;#importStationFormId&quot;).ajaxSubmit(&#123;</div><div class="line">	dataType: &apos;json&apos;,</div><div class="line">	success: function (data) &#123;</div><div class="line">		if (data.success == &apos;0&apos;) &#123;</div><div class="line">			alert(&apos;导入成功&apos;);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">后台：</div><div class="line">@RequestMapping(value = &quot;/upload&quot;)</div><div class="line">@ResponseBody</div><div class="line">public String upload(MultipartFile upfile, HttpServletRequest request, HttpServletResponse response)</div><div class="line">		throws Exception &#123;</div><div class="line">	ReadExcelToList readExcelToList = new ReadExcelToList();</div><div class="line">	List&lt;StationBase&gt; stationList = readExcelToList.getList(upfile);</div><div class="line">	// 保存站点设备数据</div><div class="line">	if (null != stationList &amp;&amp; stationList.size() &gt; 0) &#123;</div><div class="line">		Map&lt;String, Object&gt; paramMap = new HashMap&lt;String, Object&gt;();</div><div class="line">		paramMap.put(&quot;stationDeviceList&quot;, stationList);</div><div class="line">		Map&lt;String, Object&gt; resultMap = stationService.insertBaseStationInfo(paramMap);</div><div class="line">		// 跳转页面</div><div class="line">		return MAPPER.writeValueAsString(resultMap);</div><div class="line">	&#125;</div><div class="line">	return null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[HTML]]></title>
      <url>https://volc1605.github.io/2016/10/18/HTML/</url>
      <content type="html"><![CDATA[<h1 id="1-input中autocomplete"><a href="#1-input中autocomplete" class="headerlink" title="1.input中autocomplete"></a>1.input中autocomplete</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- autocomplete：为on时返回页面时，input中的值仍然存在 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"user_phone"</span> <span class="attr">id</span>=<span class="string">"user_phone"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control required"</span>   <span class="attr">autocomplete</span>=<span class="string">"off"</span> <span class="attr">placeholder</span>=<span class="string">"请填写您注册的手机号码(登录账号)"</span> <span class="attr">required</span> /&gt;</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="2-UEditor使用注意事项"><a href="#2-UEditor使用注意事项" class="headerlink" title="2.UEditor使用注意事项"></a>2.UEditor使用注意事项</h1><h2 id="2-1引入UEditor和回显图片"><a href="#2-1引入UEditor和回显图片" class="headerlink" title="2.1引入UEditor和回显图片"></a>2.1引入UEditor和回显图片</h2><ul>
<li>jsp页面引用：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 文档编辑器 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span></span></div><div class="line">	<span class="attr">src</span>=<span class="string">"$&#123;contextPath&#125;/resource/scripts/ueditor/ueditor.config.js"</span>&gt;<span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span></span></div><div class="line">	<span class="attr">src</span>=<span class="string">"$&#123;contextPath&#125;/resource/scripts/ueditor/ueditor.all.min.js"</span>&gt;<span class="undefined"></span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span></span></div><div class="line">	<span class="attr">src</span>=<span class="string">"$&#123;contextPath&#125;/resource/scripts/ueditor/lang/zh-cn/zh-cn.js"</span>&gt;<span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="built_in">window</span>.UEDITOR_HOME_URL = <span class="string">"$&#123;contextPath&#125;/resource/scripts/ueditor/"</span>;</div><div class="line">	<span class="keyword">var</span> ue = UE.getEditor(<span class="string">'editor'</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">h5</span>&gt;</span>&amp;nbsp;&amp;nbsp;静态页面内容：<span class="tag">&lt;/<span class="name">h5</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"editor"</span> <span class="attr">name</span>=<span class="string">"fContent"</span></span></div><div class="line">	<span class="attr">style</span>=<span class="string">"width: 1500px; height: 400px"</span> <span class="attr">data-options</span>=<span class="string">"required:true"</span>&gt;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>ueditor.config.js配置</li>
</ul>
<p><img src="https://volc1605.github.io/images/html/ueditorConfig.png" alt="ueditorConfig"></p>
<ul>
<li>config.json配置</li>
</ul>
<p><img src="https://volc1605.github.io/images/html/configJson.png" alt="configJson"></p>
<hr>
<h2 id="2-2设置获取ueditor内容"><a href="#2-2设置获取ueditor内容" class="headerlink" title="2.2设置获取ueditor内容"></a>2.2设置获取ueditor内容</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//判断ueditor 编辑器是否创建成功并设置文本内容</span></div><div class="line">ue.addListener(<span class="string">"ready"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">ue.setContent(staticPage.fContent);</div><div class="line">ue.setContent(<span class="string">'hello'</span>);</div><div class="line"><span class="keyword">var</span> html = ue.getContent();</div><div class="line"><span class="keyword">var</span> txt = ue.getContentTxt();</div><div class="line">  alert(txt);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h1 id="3-输入框对齐"><a href="#3-输入框对齐" class="headerlink" title="3.输入框对齐"></a>3.输入框对齐</h1><blockquote>
<p>方式一：</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dl</span> <span class="attr">style</span>=<span class="string">"width:253px;float:left"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dt</span> <span class="attr">style</span>=<span class="string">"width:50px;float:left"</span>&gt;</span>站点名称<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dd</span> <span class="attr">style</span>=<span class="string">"width:200px;float:left"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"stationName"</span> <span class="attr">id</span>=<span class="string">"stationName"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dt</span> <span class="attr">style</span>=<span class="string">"width:50px;float:left"</span>&gt;</span>手机号<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dd</span> <span class="attr">style</span>=<span class="string">"width:200px;float:left"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"tel"</span> <span class="attr">id</span>=<span class="string">"tel"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>方式二：</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">'spanId'</span> <span class="attr">style</span>=<span class="string">"width:200px;float:left;"</span>&gt;</span></div><div class="line">			标签121231：</div><div class="line">		<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">'spanId2'</span> <span class="attr">style</span>=<span class="string">"width:200px;float:left;"</span>&gt;</span></div><div class="line">			标签：</div><div class="line">		<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>方式三：</p>
</blockquote>
<p>放入加入style样式table中</p>
<h1 id="失去焦点事件"><a href="#失去焦点事件" class="headerlink" title="失去焦点事件"></a>失去焦点事件</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">onblur=”validate(this, 0)”</div><div class="line">validate: function(item, index) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="4-html传值遇到的问题"><a href="#4-html传值遇到的问题" class="headerlink" title="4.html传值遇到的问题"></a>4.html传值遇到的问题</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 获取页面之间跳转get方式传过来的值</div><div class="line">function getQueryStr(str) &#123;</div><div class="line">	var rs = new RegExp(&quot;(^|)&quot; + str + &quot;=([^&amp;]*)(&amp;|$)&quot;, &quot;gi&quot;).exec(String(window.document.location.href)), tmp;</div><div class="line">	if (tmp = rs) &#123;</div><div class="line">		return decodeURI(tmp[2]);</div><div class="line">	&#125;</div><div class="line">	return &quot;&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>遇到的问题是有些浏览器编码不同导致传入到另一个html页面时中文参数出现乱码，解决方式是：”&amp;name=” + encodeURI(“中文参数”)<br>在html页面get请求服务器接口时也会出现乱码，解决方式是：”&amp;name=” + encodeURI(encodeURI(“中文参数”))，进行两次encode编码。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Java]]></title>
      <url>https://volc1605.github.io/2016/10/18/Java/</url>
      <content type="html"><![CDATA[<h3 id="1-生成pdf文件"><a href="#1-生成pdf文件" class="headerlink" title="1. 生成pdf文件"></a>1. 生成pdf文件</h3><p>导包：</p>
<ul>
<li>D:\java-tools\apache-maven-3.2.3\repo\com\itextpdf\itextpdf\5.4.3\itextpdf-5.4.3.jar</li>
<li>D:\java-tools\apache-maven-3.2.3\repo\com\itextpdf\itext-asian\5.2.0\itext-asian-5.2.0.jar</li>
</ul>
<p>ReviewInvocation.java<br><a id="more"></a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Component</span>(<span class="string">"INVO_review"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReviewInvocation</span> <span class="keyword">implements</span> <span class="title">BaseInvocation</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(ReviewInvocation.class);</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> IReviewService reviewService;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> InvocationResult <span class="title">queryReviewList</span><span class="params">(InvocationContext context)</span> </span>&#123;</div><div class="line">	<span class="keyword">long</span> begin = System.currentTimeMillis();</div><div class="line">	InvocationResult result = InvocationResult.newInstance();</div><div class="line">	String userNameSearch = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"userNameSearch"</span>, <span class="string">""</span>);</div><div class="line">	String reviewTimeSearch = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"reviewTimeSearch"</span>, <span class="string">""</span>);</div><div class="line">	String fUserMobile = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"fUserMobile"</span>, <span class="string">""</span>);</div><div class="line">	<span class="keyword">int</span> page = RequestUtil.getIntParamterAsDef(context.getRequest(), <span class="string">"page"</span>, <span class="number">1</span>);</div><div class="line">	<span class="keyword">int</span> rows = RequestUtil.getIntParamterAsDef(context.getRequest(), <span class="string">"rows"</span>, <span class="number">0</span>);</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    ReviewBean queryBean = <span class="keyword">new</span> ReviewBean();</div><div class="line">	    queryBean.setReviewTime(reviewTimeSearch);</div><div class="line">	    queryBean.setUserName(userNameSearch);</div><div class="line">	    queryBean.setfUserMobile(fUserMobile);</div><div class="line">	    Map&lt;String, Object&gt; queryMap = reviewService.queryReviewList(queryBean, page, rows);</div><div class="line">	    result.setRetObj(queryMap);</div><div class="line">	    result.setA(ISystemConstants.SYS_SUCCESS);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">	    logger.error(<span class="string">"ReviewInvocation queryReviewList happen execption."</span>, ex);</div><div class="line">	    result.setRetCode(ISystemConstants.SYS_FAILED);</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">long</span> end = System.currentTimeMillis();</div><div class="line">	    logger.info(<span class="string">"ReviewInvocation queryReviewList cost "</span> + (end - begin) + <span class="string">" ms!"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> InvocationResult <span class="title">queryReviewById</span><span class="params">(InvocationContext context)</span> </span>&#123;</div><div class="line">	<span class="keyword">long</span> begin = System.currentTimeMillis();</div><div class="line">	InvocationResult result = InvocationResult.newInstance();</div><div class="line">	String reviewId = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"reviewId"</span>, <span class="string">""</span>);</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    ReviewBean reviewBean = reviewService.queryReviewById(reviewId);</div><div class="line">	    result.setRetObj(reviewBean);</div><div class="line">	    result.setA(ISystemConstants.SYS_SUCCESS);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">	    logger.error(<span class="string">"ReviewInvocation queryReviewList happen execption."</span>, ex);</div><div class="line">	    result.setRetCode(ISystemConstants.SYS_FAILED);</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">long</span> end = System.currentTimeMillis();</div><div class="line">	    logger.info(<span class="string">"ReviewInvocation queryReviewList cost "</span> + (end - begin) + <span class="string">" ms!"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> InvocationResult <span class="title">updateReview</span><span class="params">(InvocationContext context)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	<span class="keyword">long</span> begin = System.currentTimeMillis();</div><div class="line">	InvocationResult result = InvocationResult.newInstance();</div><div class="line">	String reviewId = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"reviewId"</span>, <span class="string">""</span>);</div><div class="line">	String desc = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"desc"</span>, <span class="string">""</span>);</div><div class="line">	String combo = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"combo"</span>, <span class="string">""</span>);</div><div class="line">	String handleType = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"handleType"</span>, <span class="string">""</span>);</div><div class="line">	String userId = RequestUtil.getStrParamterAsDef(context.getRequest(), <span class="string">"userId"</span>, <span class="string">""</span>);</div><div class="line">	ReviewBean reviewBean2 = <span class="keyword">new</span> ReviewBean();</div><div class="line">	String contractContent = <span class="string">""</span>;</div><div class="line">	<span class="keyword">if</span> (<span class="string">"1"</span>.equals(handleType)) &#123;</div><div class="line">	    <span class="comment">// 批量替换异花括号(包含)中的内容，'&#123;name&#125;'为'zhangsan'</span></div><div class="line">	    HashMap&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">	    Map&lt;String, String&gt; tokens = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</div><div class="line">	    param.put(<span class="string">"fContractId"</span>, <span class="string">"1"</span>);</div><div class="line">	    param.put(<span class="string">"fContractType"</span>, <span class="string">"1"</span>);</div><div class="line">	    ReviewBean reviewBeanTemp = reviewService.queryContractContent(param);</div><div class="line">	    contractContent = reviewBeanTemp.getfContractContent();</div><div class="line">	    ReviewBean reviewBean = reviewService.queryReviewById(reviewId);</div><div class="line">	    String userName = reviewBean.getUserName();</div><div class="line">	    String idNo = reviewBean.getIdNo();</div><div class="line">	    String provinceName = reviewBean.getProvinceName();</div><div class="line">	    String city = reviewBean.getCityName();</div><div class="line">	    String areaName = reviewBean.getAreaName();</div><div class="line">	    <span class="keyword">if</span> (userName != <span class="keyword">null</span> &amp;&amp; userName != <span class="string">""</span>) &#123;</div><div class="line">		tokens.put(<span class="string">"name"</span>, userName);</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">if</span> (idNo != <span class="keyword">null</span> &amp;&amp; idNo != <span class="string">""</span>) &#123;</div><div class="line">		tokens.put(<span class="string">"id"</span>, idNo);</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">if</span> (provinceName != <span class="keyword">null</span> &amp;&amp; provinceName != <span class="string">""</span>) &#123;</div><div class="line">		tokens.put(<span class="string">"province"</span>, provinceName);</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">if</span> (city != <span class="keyword">null</span> &amp;&amp; city != <span class="string">""</span>) &#123;</div><div class="line">		city = city.substring(<span class="number">0</span>, city.length() - <span class="number">1</span>);</div><div class="line">		tokens.put(<span class="string">"city"</span>, city);</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">if</span> (areaName != <span class="keyword">null</span> &amp;&amp; areaName != <span class="string">""</span>) &#123;</div><div class="line">		tokens.put(<span class="string">"area"</span>, areaName);</div><div class="line">	    &#125;</div><div class="line">	    String todayYear = DateTimeUtil.getTodayYear();</div><div class="line">	    String todayMonth = DateTimeUtil.getTodayMonth();</div><div class="line">	    String todayDay = DateTimeUtil.getTodayDay();</div><div class="line">	    tokens.put(<span class="string">"year"</span>, todayYear);</div><div class="line">	    tokens.put(<span class="string">"mon"</span>, todayMonth);</div><div class="line">	    tokens.put(<span class="string">"day"</span>, todayDay);</div><div class="line">	    tokens.put(<span class="string">"nyear"</span>, Integer.parseInt(todayYear) + <span class="number">1</span> + <span class="string">""</span>);</div><div class="line">	    tokens.put(<span class="string">"nmon"</span>, todayMonth);</div><div class="line">	    tokens.put(<span class="string">"nday"</span>, todayDay);</div><div class="line">	    String patternString = <span class="string">"\\&#123;("</span> + StringUtils.join(tokens.keySet(), <span class="string">"|"</span>) + <span class="string">")\\&#125;"</span>;</div><div class="line">	    Pattern pattern = Pattern.compile(patternString);</div><div class="line">	    Matcher matcher = pattern.matcher(contractContent);</div><div class="line">	    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</div><div class="line">	    <span class="keyword">while</span> (matcher.find()) &#123;</div><div class="line">		matcher.appendReplacement(sb, tokens.get(matcher.group(<span class="number">1</span>)));</div><div class="line">	    &#125;</div><div class="line">	    matcher.appendTail(sb);</div><div class="line">	    <span class="comment">// 替换后协议内容</span></div><div class="line">	    contractContent = sb.toString();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    <span class="keyword">if</span> (<span class="string">"1"</span>.equals(handleType)) &#123;</div><div class="line">		SystemUserInfoBean userInfo = (SystemUserInfoBean) SessionUtil.getObjectAttribute(context.getRequest(),</div><div class="line">			RequestConstants.ADMIN_SESSION_KEY);</div><div class="line">		reviewService.updateReview(userId, reviewId, desc, combo, handleType,</div><div class="line">			userInfo != <span class="keyword">null</span> &amp;&amp; userInfo.getfUserName() != <span class="keyword">null</span> &amp;&amp; !<span class="string">""</span>.equals(userInfo.getfUserName())</div><div class="line">				? userInfo.getfUserName() : <span class="string">"system"</span>);</div><div class="line">		ReviewBean reviewBeanById = reviewService.queryReviewById(reviewId);</div><div class="line">		String state = reviewBeanById.getState();</div><div class="line">		String fStationId = reviewBeanById.getfStationId();</div><div class="line">		<span class="keyword">if</span> (<span class="string">"1"</span>.equals(state)) &#123;</div><div class="line">		    getPdf(contractContent);</div><div class="line">		    String pdfName = addPic();</div><div class="line">		    Map&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">		    <span class="comment">// pdf访问路径</span></div><div class="line">		    String fContractUrl = BaseWebProperties.PDF_READ + File.separator + pdfName + <span class="string">".pdf"</span>;</div><div class="line">		    param.put(<span class="string">"fStationId"</span>, fStationId);</div><div class="line">		    param.put(<span class="string">"fContractUrl"</span>, fContractUrl);</div><div class="line">		    reviewService.addContractInfo(param);</div><div class="line">		&#125;</div><div class="line">		reviewBean2.setfContractContent(contractContent);</div><div class="line">		result.setD(reviewBean2);</div><div class="line">		result.setA(ISystemConstants.SYS_SUCCESS);</div><div class="line">	    &#125;</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">	    logger.error(<span class="string">"ReviewInvocation updateReview happen execption."</span>, ex);</div><div class="line">	    result.setRetCode(ISystemConstants.SYS_FAILED);</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	    <span class="keyword">long</span> end = System.currentTimeMillis();</div><div class="line">	    logger.info(<span class="string">"ReviewInvocation updateReview cost "</span> + (end - begin) + <span class="string">" ms!"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 创建</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPdf</span><span class="params">(String contractContent)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">	Document document = <span class="keyword">new</span> Document(PageSize.A4, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>);</div><div class="line">	String pdfN = <span class="string">"cachePdf"</span>;</div><div class="line">	File file = <span class="keyword">new</span> File(BaseWebProperties.UPLOAD_PDF_PATH + File.separator + pdfN + <span class="string">".pdf"</span>);</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    PdfWriter.getInstance(document, <span class="keyword">new</span> FileOutputStream(file));</div><div class="line">	    document.open();</div><div class="line">	    BaseFont bf = BaseFont.createFont(<span class="string">"STSong-Light"</span>, <span class="string">"UniGB-UCS2-H"</span>, BaseFont.NOT_EMBEDDED);</div><div class="line">	    Font font = <span class="keyword">new</span> Font(bf, <span class="number">12</span>, Font.NORMAL);</div><div class="line">	    Image png = Image.getInstance(BaseWebProperties.PIC_READ + File.separator + <span class="string">"title.png"</span>);</div><div class="line">	    png.scaleAbsolute(<span class="number">540</span>, <span class="number">70</span>);</div><div class="line">	    png.setAlignment(Image.ALIGN_CENTER);</div><div class="line">	    document.add(png);</div><div class="line">	    document.add(<span class="keyword">new</span> Paragraph(contractContent, font));</div><div class="line">	    document.close();</div><div class="line">	&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125; <span class="keyword">catch</span> (DocumentException e) &#123;</div><div class="line">	    e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 追加图片到pdf</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addPic</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	PdfReader reader = <span class="keyword">new</span> PdfReader(BaseWebProperties.PDF_READ + File.separator + <span class="string">"cachePdf.pdf"</span>);</div><div class="line">	<span class="keyword">int</span> n = reader.getNumberOfPages();</div><div class="line">	Document document = <span class="keyword">new</span> Document(reader.getPageSize(n));</div><div class="line">	<span class="keyword">float</span> width = document.getPageSize().getWidth();</div><div class="line">	String pdfName = DateTimeUtil.getTodayChar14();</div><div class="line">	File file = <span class="keyword">new</span> File(BaseWebProperties.UPLOAD_PDF_PATH + File.separator + pdfName + <span class="string">".pdf"</span>);</div><div class="line">	PdfStamper stamp = <span class="keyword">new</span> PdfStamper(reader, <span class="keyword">new</span> FileOutputStream(file));</div><div class="line">	PdfContentByte over;</div><div class="line">	Image img = Image.getInstance(BaseWebProperties.PIC_READ + File.separator + <span class="string">"sign1.PNG"</span>);</div><div class="line">	img.scaleAbsolute(<span class="number">110</span>, <span class="number">110</span>);</div><div class="line">	img.setAbsolutePosition(width - <span class="number">150</span>, <span class="number">350</span>);</div><div class="line">	img.setAlignment(Image.ALIGN_RIGHT);</div><div class="line">	<span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123;</div><div class="line">	    over = stamp.getOverContent(n);</div><div class="line">	    over.addImage(img);</div><div class="line">	&#125;</div><div class="line">	stamp.close();</div><div class="line">	File file2 = <span class="keyword">new</span> File(BaseWebProperties.UPLOAD_PDF_PATH + File.separator + <span class="string">"cachePdf.pdf"</span>);</div><div class="line">	<span class="keyword">if</span> (file2.exists()) &#123;</div><div class="line">	    file2.delete();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> pdfName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>正则表达式参考资源：<a href="http://jiangzhengjun.iteye.com/blog/513929" target="_blank" rel="external">http://jiangzhengjun.iteye.com/blog/513929</a><h3 id="2-Map排序"><a href="#2-Map排序" class="headerlink" title="2. Map排序"></a>2. Map排序</h3></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">    Student student2 = <span class="keyword">new</span> Student(<span class="string">"b"</span>, <span class="string">"2"</span>);</div><div class="line">    Student student3 = <span class="keyword">new</span> Student(<span class="string">"c"</span>, <span class="string">"3"</span>);</div><div class="line">    Student student1 = <span class="keyword">new</span> Student(<span class="string">"a"</span>, <span class="string">"1"</span>);</div><div class="line">    TreeMap&lt;Integer, Object&gt; treeMap = <span class="keyword">new</span> TreeMap&lt;Integer, Object&gt;();<span class="comment">//true</span></div><div class="line">    treeMap.put(<span class="keyword">new</span> Integer(<span class="number">2</span>), student2);</div><div class="line">    treeMap.put(<span class="keyword">new</span> Integer(<span class="number">3</span>), student3);</div><div class="line">    treeMap.put(<span class="keyword">new</span> Integer(<span class="number">1</span>), student1);</div><div class="line">    <span class="comment">/**</span></div><div class="line">     *</div><div class="line">    Set&lt;String&gt; keySet = map.keySet();</div><div class="line">    for(String key : keySet)&#123;</div><div class="line">    	System.out.println("key:" + key + " | value:" + map.get(key));</div><div class="line">    &#125;</div><div class="line">     */</div><div class="line">    HashMap&lt;Integer, Object&gt; hashMap = <span class="keyword">new</span> HashMap&lt;Integer, Object&gt;();</div><div class="line">    hashMap.put(<span class="keyword">new</span> Integer(<span class="number">2</span>), student2);</div><div class="line">    hashMap.put(<span class="keyword">new</span> Integer(<span class="number">3</span>), student3);</div><div class="line">    hashMap.put(<span class="keyword">new</span> Integer(<span class="number">1</span>), student1);</div><div class="line">    <span class="comment">/**</span></div><div class="line">    Iterator&lt;Object&gt; iterator = map.values().iterator();//排序</div><div class="line">    while(iterator.hasNext())&#123;</div><div class="line">    	int value = (Integer)iterator.next();</div><div class="line">    	System.out.println(value);</div><div class="line">    &#125;</div><div class="line">     */</div><div class="line">    LinkedHashMap&lt;Integer, Object&gt; likedMap = <span class="keyword">new</span> LinkedHashMap&lt;Integer, Object&gt;();<span class="comment">//不排序</span></div><div class="line">    likedMap.put(<span class="keyword">new</span> Integer(<span class="number">2</span>), student2);</div><div class="line">    likedMap.put(<span class="keyword">new</span> Integer(<span class="number">3</span>), student3);</div><div class="line">    likedMap.put(<span class="keyword">new</span> Integer(<span class="number">1</span>), student1);</div><div class="line">    <span class="comment">/**</span></div><div class="line">    Set&lt;String&gt; keySet2 = map.keySet();</div><div class="line">    for(String key : keySet2)&#123;</div><div class="line">    	System.out.println("key:" + key + " | value:" + map.get(key));</div><div class="line">    &#125;</div><div class="line">     */</div><div class="line">    System.out.println(<span class="string">"down"</span>);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-JAVA代理"><a href="#3-JAVA代理" class="headerlink" title="3. JAVA代理"></a>3. JAVA代理</h3><h4 id="3-1-简单代理"><a href="#3-1-简单代理" class="headerlink" title="3.1 简单代理"></a>3.1 简单代理</h4><p>Subject.java接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.bmx.omp.business.invocation.system;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation2</span><span class="params">(String arg)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>RealSubject.java实现类。被代理对象<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.bmx.omp.business.invocation.system;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;<span class="comment">//被代理对象</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</div><div class="line">       System.out.println(<span class="string">"Realer do operation1"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation2</span><span class="params">(String arg)</span> </span>&#123;</div><div class="line">       System.out.println(<span class="string">"Realer do operation2 with "</span> + arg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ProxySubject.java代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.bmx.omp.business.invocation.system;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxySubject</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Subject proxied;<span class="comment">// 被代理对象</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxySubject</span><span class="params">(Subject proxied)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.proxied = proxied;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation1</span><span class="params">()</span> </span>&#123;</div><div class="line">       System.out.println(<span class="string">"Proxyer do operation1"</span>);</div><div class="line">       proxied.operation1();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation2</span><span class="params">(String arg)</span> </span>&#123;</div><div class="line">       System.out.println(<span class="string">"Proxyer do operation2 with "</span> + arg);</div><div class="line">       proxied.operation2(arg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试类SimpleProxyDemo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zj.proxy.client;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.zj.proxy.Subject;</div><div class="line"><span class="keyword">import</span> com.zj.proxy.RealSubject;</div><div class="line"><span class="keyword">import</span> com.zj.proxy.ProxySubject;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleProxyDemo</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">(Subject subject)</span> </span>&#123;</div><div class="line">        subject.operation1();</div><div class="line">        subject.operation2(<span class="string">"ZJ"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        RealSubject real = <span class="keyword">new</span> RealSubject();</div><div class="line">        System.out.println(<span class="string">"===Without Proxy==="</span>);</div><div class="line">        consumer(real);</div><div class="line">        System.out.println(<span class="string">"===Use Proxy==="</span>);</div><div class="line">        consumer(<span class="keyword">new</span> ProxySubject(real));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">结果：</div><div class="line">===Without Proxy===</div><div class="line">Realer do operation1</div><div class="line">Realer do operation2 with ZJ</div><div class="line">===Use Proxy===</div><div class="line">Proxyer do operation1</div><div class="line">Realer do operation1</div><div class="line">Proxyer do operation2 with ZJ</div><div class="line">Realer do operation2 with ZJ</div></pre></td></tr></table></figure></p>
<h4 id="3-2-动态代理"><a href="#3-2-动态代理" class="headerlink" title="3.2 动态代理"></a>3.2 动态代理</h4><p>DynamicProxyHandler.java代理处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.omp.business.invocation.system;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> DynamicProxyHandler</div><div class="line"> * <span class="doctag">@Description</span> 动态代理处理类</div><div class="line"> * <span class="doctag">@Author</span> youtanzhi</div><div class="line"> * <span class="doctag">@Date</span> 2016年8月23日 下午7:01:55</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxyHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;<span class="comment">// 动态代理处理类</span></div><div class="line">  <span class="keyword">private</span> Object proxied;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">DynamicProxyHandler</span><span class="params">(Object RealSubject)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.proxied = RealSubject;<span class="comment">//生成代理对象</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">    System.out.println(<span class="string">"**** proxy: ****\n"</span> + proxy.getClass() + <span class="string">"\nmethod: "</span> + method + <span class="string">"\nargs: "</span> + args);</div><div class="line">    <span class="keyword">if</span> (args != <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="keyword">for</span> (Object arg : args) &#123;</div><div class="line">        System.out.println(<span class="string">"  "</span> + arg);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> method.invoke(proxied, args);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>动态代理测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.omp.business.invocation.system;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@ClassName</span> DynamicProxyDemo</div><div class="line"> * <span class="doctag">@Description</span> 动态代理测试类</div><div class="line"> * <span class="doctag">@Author</span> youtanzhi</div><div class="line"> * <span class="doctag">@Date</span> 2016年8月23日 下午7:24:19</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxyDemo</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">(Subject subject)</span> </span>&#123;</div><div class="line">        subject.operation1();<span class="comment">//执行被代理对象调用的方法时，先执行代理对象的invoke方法</span></div><div class="line">        subject.operation2(<span class="string">"ZJ"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        RealSubject real = <span class="keyword">new</span> RealSubject();</div><div class="line">        System.out.println(<span class="string">"===Without Proxy==="</span>);</div><div class="line">        consumer(real);</div><div class="line">        System.out.println(<span class="string">"===Use Proxy==="</span>);</div><div class="line">        Subject proxy = (Subject) Proxy.newProxyInstance(<span class="comment">//三个参数</span></div><div class="line">                            Subject.class.getClassLoader(), <span class="comment">// 被代理对象类加载器</span></div><div class="line">                            <span class="keyword">new</span> Class[] &#123;Subject.class&#125;, <span class="comment">// 代理类要实现的接口字节码列表(数组)</span></div><div class="line">                            <span class="keyword">new</span> DynamicProxyHandler(real));<span class="comment">// 指派方法调用的处理程序</span></div><div class="line">        consumer(proxy);<span class="comment">// 先处理程序中的invoke方法载执行代理对象执行要执行的方法</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="4-请求头转换成map"><a href="#4-请求头转换成map" class="headerlink" title="4. 请求头转换成map"></a>4. 请求头转换成map</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SortedMap&lt;STRING, STRING&gt; paramMap = <span class="keyword">new</span> TreeMap&lt;STRING, STRING&gt;();</div><div class="line"> Enumeration&lt;STRING&gt; em = request.getParameterNames();</div><div class="line"> <span class="keyword">while</span></div><div class="line"> (em.hasMoreElements()) &#123;</div><div class="line">     String paramKey = em.nextElement();</div><div class="line">     paramMap.put(paramKey, request.getParameter(paramKey));</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="5-list元素去重数组与list转换"><a href="#5-list元素去重数组与list转换" class="headerlink" title="5. list元素去重数组与list转换"></a>5. list元素去重数组与list转换</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Com</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	<span class="comment">// 如何去重list集合中的元素</span></div><div class="line">	<span class="comment">// 方式一：使用for循环</span></div><div class="line">	List&lt;String&gt; arr = <span class="keyword">new</span> ArrayList&lt;String&gt;(); <span class="comment">// aec</span></div><div class="line">	arr.add(<span class="string">"a"</span>);</div><div class="line">	arr.add(<span class="string">"b"</span>);</div><div class="line">	arr.add(<span class="string">"e"</span>);</div><div class="line">	arr.add(<span class="string">"e"</span>);</div><div class="line">	arr.add(<span class="string">"c"</span>);</div><div class="line">	arr.add(<span class="string">"e"</span>);</div><div class="line">	arr.add(<span class="string">"a"</span>);</div><div class="line">	arr.add(<span class="string">"b"</span>);</div><div class="line">	arr.add(<span class="string">"b"</span>);</div><div class="line"><span class="comment">//	for (int i = 0; i &lt; arr.size(); i++) &#123;</span></div><div class="line"><span class="comment">//	    for (int j = i + 1; j &lt; arr.size(); j++) &#123;</span></div><div class="line"><span class="comment">//		if (arr.get(i).equals(arr.get(j))) &#123;</span></div><div class="line"><span class="comment">//		    arr.remove(j);</span></div><div class="line"><span class="comment">//		    if (j != arr.size()) &#123;</span></div><div class="line"><span class="comment">//			j--;</span></div><div class="line"><span class="comment">//		    &#125;</span></div><div class="line"><span class="comment">//		&#125;</span></div><div class="line"><span class="comment">//	    &#125;</span></div><div class="line"><span class="comment">//	&#125;</span></div><div class="line"><span class="comment">//	for (int i = 0; i &lt; arr.size(); i++) &#123;</span></div><div class="line"><span class="comment">//	    System.out.println(arr.get(i));</span></div><div class="line"><span class="comment">//	&#125;</span></div><div class="line">	<span class="comment">// 方式二</span></div><div class="line"><span class="comment">//	for (int i = 0; i &lt; arr.size() - 1; i++) &#123;</span></div><div class="line"><span class="comment">//	    for (int j = arr.size() - 1; j &gt; i; j--) &#123;</span></div><div class="line"><span class="comment">//		if (arr.get(j).equals(arr.get(i))) &#123;</span></div><div class="line"><span class="comment">//		    arr.remove(j);</span></div><div class="line"><span class="comment">//		&#125;</span></div><div class="line"><span class="comment">//	    &#125;</span></div><div class="line"><span class="comment">//	&#125;</span></div><div class="line"><span class="comment">//	System.out.println(arr);</span></div><div class="line">	<span class="comment">// 方式三 放到hashset中</span></div><div class="line"><span class="comment">//	Set h = new HashSet(arr);</span></div><div class="line"><span class="comment">//	arr.clear();</span></div><div class="line"><span class="comment">//	arr.addAll(h);</span></div><div class="line"><span class="comment">//	System.out.println(arr);</span></div><div class="line">	<span class="comment">// String类型list集合转String类型的数组</span></div><div class="line">	String[] arrString = (String[]) arr.toArray(<span class="keyword">new</span> String[] &#123;&#125;);</div><div class="line">	<span class="comment">// String数组转String类型的list集合</span></div><div class="line">	List&lt;String&gt; list = Arrays.asList(arrString);</div><div class="line">	<span class="comment">// 快速打印出数组中元素</span></div><div class="line">	System.out.println(Arrays.toString(arrString));</div><div class="line">	<span class="comment">// int数组转list集合</span></div><div class="line">	Integer[] intA = <span class="keyword">new</span> Integer[] &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</div><div class="line">	List dataList = Arrays.asList(intA); <span class="comment">// 说明了asList()d的参数要的是对象数组，而不是基本类型的数组</span></div><div class="line">	System.out.println(dataList);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="6-SortedMap正序排序"><a href="#6-SortedMap正序排序" class="headerlink" title="6. SortedMap正序排序"></a>6. SortedMap正序排序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"><span class="comment">// SoredMap是正序排序</span></div><div class="line">SortedMap&lt;String, Object&gt; s = <span class="keyword">new</span> TreeMap&lt;String, Object&gt;();</div><div class="line"><span class="comment">// Map&lt;String, Object&gt; s = new HashMap&lt;String, Object&gt;();</span></div><div class="line">s.put(<span class="string">"b"</span>, <span class="number">2</span>);</div><div class="line">s.put(<span class="string">"c"</span>, <span class="number">3</span>);</div><div class="line">s.put(<span class="string">"a"</span>, <span class="number">1</span>);</div><div class="line">Set&lt;Entry&lt;String, Object&gt;&gt; entrySet = s.entrySet();</div><div class="line"><span class="keyword">for</span> (Entry i : entrySet) &#123;</div><div class="line">    System.out.println(<span class="string">"key :"</span> + i.getKey());</div><div class="line">    System.out.println(<span class="string">"value :"</span> + i.getValue());</div><div class="line">&#125;</div><div class="line">   &#125;</div><div class="line">   <span class="comment">/**</span></div><div class="line">    * 结果： </div><div class="line">    * key :a value :1 key :b value :2 key :c value :3</div><div class="line">    */</div></pre></td></tr></table></figure>
<h3 id="7-HashMap可放入TreeMap中进行排序"><a href="#7-HashMap可放入TreeMap中进行排序" class="headerlink" title="7. HashMap可放入TreeMap中进行排序"></a>7. HashMap可放入TreeMap中进行排序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, Object&gt; m = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">m.put(<span class="string">"b"</span>, <span class="number">2</span>);</div><div class="line">m.put(<span class="string">"c"</span>, <span class="number">3</span>);</div><div class="line">m.put(<span class="string">"a"</span>, <span class="number">1</span>);</div><div class="line">SortedMap&lt;String, Object&gt; sort = <span class="keyword">new</span> TreeMap&lt;String, Object&gt;(m);</div><div class="line">Set&lt;Entry&lt;String, Object&gt;&gt; entrySet = sort.entrySet();</div><div class="line"><span class="keyword">for</span> (Entry e : entrySet) &#123;</div><div class="line">    System.out.println(e.getKey());</div><div class="line">    System.out.println(e.getValue());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-ajax返回结果时机"><a href="#8-ajax返回结果时机" class="headerlink" title="8. ajax返回结果时机"></a>8. ajax返回结果时机</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Object retObj = actionDispatcher.dispatchRequest(request, response, <span class="keyword">null</span>);</div><div class="line"> String s = JSONObject.toJSONString(retObj);</div><div class="line"> PrintWriter pw = response.getWriter();</div><div class="line"> pw.print(s); <span class="comment">// 设置返回结果对象，并不返回</span></div><div class="line"> pw.close();  <span class="comment">// (这一步结束之后)PrintWriter对象关闭之后才返回对象，执行ajax的success方法</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="9-请求体以utf8格式转码获取"><a href="#9-请求体以utf8格式转码获取" class="headerlink" title="9. 请求体以utf8格式转码获取"></a>9. 请求体以utf8格式转码获取</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getHttpBodyString</span><span class="params">(HttpServletRequest req)</span> <span class="keyword">throws</span> Exception</span></div><div class="line">&#123;</div><div class="line">	</div><div class="line">	InputStream in = req.getInputStream();</div><div class="line">	<span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">	<span class="keyword">int</span> readLen = <span class="number">0</span>;</div><div class="line">	ByteArrayOutputStream bos = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">	<span class="keyword">while</span> ((readLen = in.read(data)) != -<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		bos.write(data, <span class="number">0</span>, readLen);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> bos.toString(<span class="string">"UTF-8"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="10-报错"><a href="#10-报错" class="headerlink" title="10. 报错"></a>10. 报错</h3><p>Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Could not get JDBC Connection; nested exception is java.sql.SQLException: Timed out waiting for a free available connection.原因有可能是：</p>
<p>You call DB.getConnection() twice. Perhaps because of this the JDBC driver creates 2 connections, but you close only the second one.<br>    创建了两个连接，程序只关闭了第二个<br>    mybatis会自动关闭数据库连接</p>
<h3 id="11-java调用声音"><a href="#11-java调用声音" class="headerlink" title="11. java调用声音"></a>11. java调用声音</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">import</span> sun.audio.AudioPlayer;</div><div class="line"><span class="keyword">import</span> sun.audio.AudioStream;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sounda</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">	    FileInputStream fileau = <span class="keyword">new</span> FileInputStream(<span class="string">"E:/tet/1.wav"</span>);</div><div class="line">	    AudioStream as = <span class="keyword">new</span> AudioStream(fileau);</div><div class="line">	    AudioPlayer.player.start(as);</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="12-数值格式化"><a href="#12-数值格式化" class="headerlink" title="12. 数值格式化"></a>12. 数值格式化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// #.000000 保留六位小数，小数后不够六位会零填充 0.1 -&gt; 0.100000</span></div><div class="line"><span class="comment">// #.###### 保留六位小数，小数后不够六位会把后面的零去掉 0.100 -&gt; 0.1</span></div><div class="line">DecimalFormat df = <span class="keyword">new</span> DecimalFormat(<span class="string">"#.000000"</span>);</div><div class="line">String value = String.valueOf(df.format(inputValue));</div></pre></td></tr></table></figure>
<h3 id="13-枚举-enum"><a href="#13-枚举-enum" class="headerlink" title="13. 枚举 enum"></a>13. 枚举 enum</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">package com.biusoft.core.modules.zhxc.utils;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 缓存字段管理</div><div class="line"> */</div><div class="line">public enum ECacheFields &#123;</div><div class="line">    // 赔补偿标准和轻微违法</div><div class="line">    COMPENSATION(&quot;COMPENSATION&quot;, 0);</div><div class="line">    private String name;</div><div class="line">    private int index;</div><div class="line"></div><div class="line">    private ECacheFields(String name, int index) &#123;</div><div class="line">        this.name = name;</div><div class="line">        this.index = index;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int getIndex() &#123;</div><div class="line">        return index;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setIndex(int index) &#123;</div><div class="line">        this.index = index;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">for (ECacheFields eCacheFields : ECacheFields.values()) &#123;</div><div class="line">	System.out.println(&quot;名称：&quot; + eCacheFields.getName() + &quot; 角标：&quot; + eCacheFields.getIndex());</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[MyBatis]]></title>
      <url>https://volc1605.github.io/2016/10/18/MyBatis/</url>
      <content type="html"><![CDATA[<h1 id="1-判断字段值是否存在并录入数据sql"><a href="#1-判断字段值是否存在并录入数据sql" class="headerlink" title="1.判断字段值是否存在并录入数据sql"></a>1.判断字段值是否存在并录入数据sql</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 录入短信套餐信息 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addSmsPackage"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.Map"</span>&gt;</span></div><div class="line">	INSERT INTO</div><div class="line">	tp_package_info (</div><div class="line">	f_station_id,</div><div class="line">	f_type,</div><div class="line">	f_buy_count,</div><div class="line">	f_package_count,</div><div class="line">	f_cur_count,</div><div class="line">	f_first_month_count,</div><div class="line">	f_sec_month_count,</div><div class="line">	f_third_month_count,</div><div class="line">	f_first_month_surplus,</div><div class="line">	f_sec_month_surplus,</div><div class="line">	f_is_first_accrued,</div><div class="line">	f_is_sec_accrued,</div><div class="line">	f_every_month,</div><div class="line">	f_package_create_time</div><div class="line">	) SELECT</div><div class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"combo != null and combo != '' and combo == 1"</span>&gt;</span></div><div class="line">		#&#123;userId&#125;,#&#123;combo&#125;,0,50000,5000,5000,3000,3000,0,0,0,0,0,#&#123;currentTime&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"combo != null and combo != '' and combo == 2"</span>&gt;</span></div><div class="line">		#&#123;userId&#125;,#&#123;combo&#125;,0,50000,5000,5000,3000,3000,0,0,0,0,0,#&#123;currentTime&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"combo != null and combo != '' and combo == 0"</span>&gt;</span></div><div class="line">		#&#123;userId&#125;,#&#123;combo&#125;,0,0,0,0,0,0,0,0,0,0,0,#&#123;currentTime&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">	FROM</div><div class="line">	DUAL</div><div class="line">	WHERE</div><div class="line">	NOT EXISTS (</div><div class="line">	SELECT</div><div class="line">	*</div><div class="line">	FROM</div><div class="line">	tp_package_info st</div><div class="line">	WHERE</div><div class="line">	st.f_station_id = #&#123;userId&#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="2-sql索引"><a href="#2-sql索引" class="headerlink" title="2.sql索引"></a>2.sql索引</h1><p>创建唯一索引时，可以使用REPLACE INTO 进行修改或新增数据<br>13if判断不能加引号<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">SELECT</div><div class="line"><span class="tag">&lt;<span class="name">INCLUDE</span> <span class="attr">REFID</span>=<span class="string">"Blob_Column_List"</span> /&gt;</span></div><div class="line">FROM txm_publish t WHERE 1 = 1 AND</div><div class="line">t.f_type = "1" OR t.f_type = "2"</div><div class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"fUserTypeId==8 "</span>&gt;</span><span class="tag">&lt;<span class="name">!—不能加引号</span> <span class="attr">--</span>&gt;</span></div><div class="line">	OR t.f_center_id = #&#123;fUserId&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"fUserTypeId != 8 "</span>&gt;</span></div><div class="line">	OR EXISTS (</div><div class="line">	SELECT</div><div class="line">	f_manager_id</div><div class="line">	FROM</div><div class="line">	txm_user_detail d</div><div class="line">	WHERE</div><div class="line">	d.f_user_id = #&#123;fUserId&#125;</div><div class="line">	AND d.f_manager_id = t.f_center_id)</div><div class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">AND t.f_publishstate = #&#123;fPublishState&#125;</div></pre></td></tr></table></figure></p>
<h1 id="3-mybatis分页sql注意数据类型"><a href="#3-mybatis分页sql注意数据类型" class="headerlink" title="3.mybatis分页sql注意数据类型"></a>3.mybatis分页sql注意数据类型</h1><p>一定要BIGINT类型，传进的map中pageStart和pageSize必须将其设置为int<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">IF</span> <span class="attr">TEST</span>=<span class="string">"pageStart !=-1"</span>&gt;</span> LIMIT</div><div class="line">#&#123;pageStart,jdbcType=BIGINT&#125;,#&#123;pageSize,jdbcType=BIGINT&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">IF</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h1 id="4-mybatis日期转换"><a href="#4-mybatis日期转换" class="headerlink" title="4.mybatis日期转换"></a>4.mybatis日期转换</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">SQL</span> <span class="attr">ID</span>=<span class="string">"Base_Column_List"</span>&gt;</span> f_parcel_id, f_exp_id, f_branch_id,</div><div class="line">f_station_id, f_mail_no, f_company_id, f_company_name, f_recipient_name,</div><div class="line">f_recipient_mobile, f_frame_code, f_take_code, f_num, f_input_way,</div><div class="line">f_input_source, date_format(f_arrive_time,'%Y-%c-%d %h:%i:%s') AS</div><div class="line">'f_arrive_time' , f_parcel_status, f_is_detention, f_out_way, f_out_source,</div><div class="line">f_app_notice_status, f_weixin_notice_status, f_sms_notice_status,</div><div class="line">f_out_time, f_last_time, f_type, f_comment</div><div class="line"><span class="tag">&lt;/<span class="name">SQL</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">SELECT</span> <span class="attr">ID</span>=<span class="string">"queryParcleList"</span> <span class="attr">RESULTMAP</span>=<span class="string">"BaseResultMap"</span>&gt;</span>select</div><div class="line">   <span class="tag">&lt;<span class="name">INCLUDE</span> <span class="attr">REFID</span>=<span class="string">"Base_Column_List"</span> /&gt;</span> from tp_parcel_info WHERE 1=1</div><div class="line">   <span class="tag">&lt;<span class="name">IF</span> <span class="attr">TEST</span>=<span class="string">"mi.startTime!='' and mi.startTime!=null"</span>&gt;</span> and</div><div class="line">   date_format(f_arrive_time, '%Y%m%d%') &amp;gt;= date_format(#&#123;mi.startTime&#125;,</div><div class="line">   '%Y%m%d%')</div><div class="line">   <span class="tag">&lt;/<span class="name">IF</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">IF</span> <span class="attr">TEST</span>=<span class="string">"mi.endTime!='' and mi.endTime!=null"</span>&gt;</span> and</div><div class="line">   date_format(f_arrive_time, '%Y%m%d%') &amp;lt;= date_format(#&#123;mi.endTime&#125;,</div><div class="line">   '%Y%m%d%')</div><div class="line">   <span class="tag">&lt;/<span class="name">IF</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">IF</span> <span class="attr">TEST</span>=<span class="string">"mi.fCompanyId!='-1' and mi.fCompanyId!=null"</span>&gt;</span> and f_company_id</div><div class="line">   = #&#123;mi.fCompanyId&#125;</div><div class="line">   <span class="tag">&lt;/<span class="name">IF</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">IF</span> <span class="attr">TEST</span>=<span class="string">"mi.fParcelStatus!='-1' and mi.fParcelStatus!=null and mi.fParcelStatus !=''"</span>&gt;</span></div><div class="line">   and f_parcel_status = #&#123;mi.fParcelStatus&#125;</div><div class="line">   <span class="tag">&lt;/<span class="name">IF</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">IF</span> <span class="attr">TEST</span>=<span class="string">"mi.fStationId !=null and mi.fStationId !=''"</span>&gt;</span> and f_station_id</div><div class="line">   = #&#123;mi.fStationId&#125;</div><div class="line">   <span class="tag">&lt;/<span class="name">IF</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">IF</span> <span class="attr">TEST</span>=<span class="string">"pageNum!='-1' and pageSize!='-1'"</span>&gt;</span> LIMIT #&#123;pageNum&#125;,</div><div class="line">   #&#123;pageSize&#125;</div><div class="line">   <span class="tag">&lt;/<span class="name">IF</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">SELECT</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="5-spring-mybatis"><a href="#5-spring-mybatis" class="headerlink" title="5. spring+mybatis"></a>5. spring+mybatis</h1><pre><code>配置参考：https://my.oschina.net/wangt10/blog/508344
</code></pre><h1 id="6-mybatis插入返回逐渐id"><a href="#6-mybatis插入返回逐渐id" class="headerlink" title="6. mybatis插入返回逐渐id"></a>6. mybatis插入返回逐渐id</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PushMapper</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertReId</span><span class="params">(Record record)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</div><div class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</div><div class="line">&lt;mapper namespace=&quot;com.baomidou.springwind.mapper.PushMapper&quot;&gt;</div><div class="line">    &lt;sql id=&quot;Base_Column_List&quot;&gt;</div><div class="line">      id, content, sys_id, status, create_time</div><div class="line">    &lt;/sql&gt;</div><div class="line">    &lt;insert id=&quot;insertReId&quot; parameterType=&quot;com.baomidou.springwind.entity.push.Record&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;&gt;</div><div class="line">        insert into p_push_record (content,sysId,createTime)</div><div class="line">        VALUES (#&#123;content&#125;,#&#123;sysId&#125;,#&#123;createTime&#125;);</div><div class="line">    &lt;/insert&gt;</div><div class="line">&lt;/mapper&gt;</div><div class="line"></div><div class="line"># 7. 报错记录</div></pre></td></tr></table></figure>
<p>org.apache.ibatis.builder.IncompleteElementException: Could not find result map java.util.LinkedHashMap<br>```<br>所有的xml文件中的方法里存在没有和DAO接口对应的返回类型。<br>DAO接口返回类型为map而xml中方法的返回类型为对象(resultType)，应该为resultMap，否则就会报错</p>
<p>请求参数必须是bean对象，插入成功后，该数据的逐渐id已经写入到请求对象(com.baomidou.springwind.entity.push.Record)中。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Hexo之NexT主题搭建博客详细过程]]></title>
      <url>https://volc1605.github.io/2016/10/03/Hexo%E4%B9%8BNexT%E4%B8%BB%E9%A2%98%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=33856275&auto=0&height=66"></iframe><br><a id="more"></a><br>本站是用hexo来搭建的，使用的是next主题。这里记录一下搭建的整个过程，仅供参考！有什么问题请留言通知，谢谢支持！</p>
<h1 id="更新内容-2017-03-24"><a href="#更新内容-2017-03-24" class="headerlink" title="更新内容 2017-03-24"></a>更新内容 2017-03-24</h1><blockquote>
<ul>
<li>使用友言评论功能</li>
<li>解析域名</li>
</ul>
</blockquote>
<hr>
<h1 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1.环境准备"></a>1.环境准备</h1><p>下载安装nodejs和git(for window)，声明一下我的搭建环境win764</p>
<h2 id="1-1-nodejs安装"><a href="#1-1-nodejs安装" class="headerlink" title="1.1.nodejs安装"></a>1.1.nodejs安装</h2><p>官网下载地址：<a href="https://nodejs.org/en/" target="_blank" rel="external">https://nodejs.org/en/</a> 下载v<em>*</em> LTS Recommended For Most Users</p>
<blockquote>
<p>设置系统变量      </p>
</blockquote>
<p>我把nodejs安装在c盘program files的nodejs目录下<br>编辑系统环境变量path的值，追加C:\Program Files\nodejs</p>
<blockquote>
<p>安装Express开发框架  </p>
</blockquote>
<p>以管理员打开cmd命令窗口，执行命令<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> install -g express</div><div class="line"><span class="attribute">npm</span> install -g express-generator</div></pre></td></tr></table></figure></p>
<p>在C:\Program Files\nodejs\node_modules中会生成express和express-generator两个文件夹表示安装好了</p>
<blockquote>
<p>新建项目  </p>
</blockquote>
<p>进入C:\Program Files\nodejs，新建名称为newproject的项目<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cd</span> C:\Program Files\nodejs</div><div class="line"><span class="attribute">express</span> -t ejs newsproject</div></pre></td></tr></table></figure></p>
<p>新建成功在nodesj目录下会生成newproject目录，其目录下大致有以下文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">bin          相关运行脚本</div><div class="line">public       静态资源</div><div class="line">routes       路由表</div><div class="line">views        试图模板  </div><div class="line">app.js       视图文件夹  </div><div class="line">packge.json  项目依赖说明</div></pre></td></tr></table></figure></p>
<blockquote>
<p>关于执行npm install -g express命令的出现错误的解决方式  </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> config list # 查看以前修改过的命令，针对错误的地方删除掉。</div></pre></td></tr></table></figure>
<p>删除代理<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> config delete proxy</div></pre></td></tr></table></figure></p>
<p>删除注册的目录<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> config delete registry</div></pre></td></tr></table></figure></p>
<p>npm仓库是国外服务器，经常连接不上或安装慢，这里推荐使用 淘宝 NPM 镜像 来安装，设置镜像<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> config set registry https://registry.npm.taobao.org</div></pre></td></tr></table></figure></p>
<p>查看是否修改成功<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> config list</div></pre></td></tr></table></figure></p>
<p>再重新安装express模块<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> install -g express</div></pre></td></tr></table></figure></p>
<blockquote>
<p>安装模块  </p>
</blockquote>
<p>进入newproject目录, 安装模块<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cd</span> newsproject</div><div class="line"><span class="attribute">npm</span> install</div></pre></td></tr></table></figure></p>
<blockquote>
<p>启动项目  </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> start</div></pre></td></tr></table></figure>
<p>在浏览器访问<a href="http://127.0.0.1:3000/" target="_blank" rel="external">http://127.0.0.1:3000/</a> 测试出现下面图视表示nodejs安装成功，并可以正常部署项目<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/result.png" alt="测试"><br>可输入以下命令查看版本号<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">node</span> -v</div><div class="line"><span class="attribute">npm</span> -v</div></pre></td></tr></table></figure></p>
<h2 id="1-2-git安装"><a href="#1-2-git安装" class="headerlink" title="1.2.git安装"></a>1.2.git安装</h2><p>官网下载地址：<a href="https://git-scm.com/downloads/" target="_blank" rel="external">https://git-scm.com/downloads/</a> 这个就不多说了</p>
<h1 id="2-安装Hexo"><a href="#2-安装Hexo" class="headerlink" title="2.安装Hexo"></a>2.安装Hexo</h1><p>git安装成功后在桌面右击选择git bash here, 命令窗口<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/desktop.gif" alt="desktop"></p>
<blockquote>
<p>安装hexo  </p>
</blockquote>
<p>执行命令</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> -g hexo-cli  # g代表全局,npm默认为当前项目安装</div></pre></td></tr></table></figure>
<p>在D盘新建blog文件夹，这个文件夹就是博客的根目录，打开blog空白处右击选择git bash here执行以下命令。首先对blog文件夹进行hexo初始化<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">hexo</span> init</div></pre></td></tr></table></figure></p>
<p>会生成一些文件</p>
<blockquote>
<p>安装依赖包</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> install</div></pre></td></tr></table></figure>
<p>可能会遇到的错误<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> ERR! registry error parsing json # 错误</div></pre></td></tr></table></figure></p>
<p>可能需要设置npm代理,执行命令<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> config set registry http://registry.cnpmjs.org</div></pre></td></tr></table></figure></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">hexo</span>:command not found</div></pre></td></tr></table></figure>
<p>删除刚刚安装的C:\Users\Administrator\AppData\Roaming\npm目录，重新执行命令npm install -g hexo安装hexo</p>
<blockquote>
<p>生成静态资源</p>
</blockquote>
<p>生成public文件夹(浏览器访问资源)<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">hexo</span> g</div></pre></td></tr></table></figure></p>
<blockquote>
<p>启动服务</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">hexo</span> s</div></pre></td></tr></table></figure>
<p>在浏览器访问：<a href="http://localhost:4000/" target="_blank" rel="external">http://localhost:4000/</a> 便可查看hexo默认的主题<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/h.png" alt="hexo"></p>
<blockquote>
<p>clone NexT主题</p>
</blockquote>
<p>在blog根目录执行命令<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">git</span> clone https://github.com/iissnan/hexo-theme-next themes/next</div></pre></td></tr></table></figure></p>
<p>clone完成后打开blog下的themes文件夹就可以看到有两个主题，一个是默认的，一个是刚刚clone的NexT主题<br>站点配置文件D:\blog\_config.yml<br>主题配置文件D:\blog\themes\next\_config.yml<br>在站点配置文件_config.yml中进行搜索key为’theme’，如果没有theme就添加key为theme，其值为next<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Extensions</div><div class="line">## Plugins: https://hexo.io/plugins/</div><div class="line">## Themes: https://hexo.io/themes/</div><div class="line"># theme: landscape</div><div class="line"># 设置主题为next</div><div class="line">theme: next</div></pre></td></tr></table></figure></p>
<p>需要注意的是冒号后面有一个空格<br>在blog目录中右击选择git bash here 分别执行清除静态资源，生成静态资源，启动服务命令<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">hexo</span> clean</div><div class="line"><span class="attribute">hexo</span> g</div><div class="line"><span class="attribute">hexo</span> s</div></pre></td></tr></table></figure></p>
<p>在浏览器中访问<a href="http://localhost:4000/" target="_blank" rel="external">http://localhost:4000/</a> 便可看到效果</p>
<p>打开主题配置文件_config.yml找到Schemes，如下所示有三种方案可选，只需将#去掉就可以了，可以都尝试一下，选择喜欢的风格，修改之后不用重启服务直接刷新浏览器就能看到效果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 切换样式</div><div class="line"># Schemes</div><div class="line">#scheme: Muse</div><div class="line">#scheme: Mist</div><div class="line">scheme: Pisces</div></pre></td></tr></table></figure></p>
<p>到此本地资源基本上完成了，下面贴出站点配置_config.yml和主题配置_config.yml里面注释了信息<strong>仅供</strong>参考</p>
<h2 id="2-1站点配置文件-config-yml"><a href="#2-1站点配置文件-config-yml" class="headerlink" title="2.1站点配置文件_config.yml"></a>2.1站点配置文件_config.yml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"># Hexo Configuration</div><div class="line">## Docs: https://hexo.io/docs/configuration.html</div><div class="line">## Source: https://github.com/hexojs/hexo/</div><div class="line"></div><div class="line"># Site</div><div class="line">title: Blog  # 首页title名称</div><div class="line">subtitle: Volc&apos;s Blog  </div><div class="line">description: volc #作者简介</div><div class="line">author: VOLC # 作者名称</div><div class="line">language: zh-Hans # 修改语言环境为简体汉字</div><div class="line">timezone:</div><div class="line"></div><div class="line"># URL</div><div class="line">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</div><div class="line">url: https://volc1605.github.io/</div><div class="line">root: /</div><div class="line">permalink: :year/:month/:day/:title/</div><div class="line">permalink_defaults:</div><div class="line"></div><div class="line"># Directory</div><div class="line">source_dir: source</div><div class="line">public_dir: public</div><div class="line">tag_dir: tags</div><div class="line">archive_dir: archives</div><div class="line">category_dir: categories</div><div class="line">code_dir: downloads/code</div><div class="line">i18n_dir: :lang</div><div class="line">skip_render:</div><div class="line"></div><div class="line"># Writing</div><div class="line">new_post_name: :title.md # File name of new posts</div><div class="line">default_layout: post</div><div class="line">titlecase: false # Transform title into titlecase</div><div class="line">external_link: true # Open external links in new tab</div><div class="line">filename_case: 0</div><div class="line">render_drafts: false</div><div class="line">post_asset_folder: false</div><div class="line">relative_link: false</div><div class="line">future: true</div><div class="line">highlight:</div><div class="line">  enable: true</div><div class="line">  line_number: true</div><div class="line">  auto_detect: false</div><div class="line">  tab_replace:</div><div class="line"></div><div class="line"># Category &amp; Tag</div><div class="line">default_category: uncategorized</div><div class="line">category_map:</div><div class="line">  编程: programming</div><div class="line">  生活: life</div><div class="line">  其他: other</div><div class="line">tag_map:</div><div class="line"></div><div class="line"># Date / Time format</div><div class="line">## Hexo uses Moment.js to parse and display date</div><div class="line">## You can customize the date format as defined in</div><div class="line">## http://momentjs.com/docs/#/displaying/format/</div><div class="line">date_format: YYYY-MM-DD</div><div class="line">time_format: HH:mm:ss</div><div class="line"></div><div class="line"># Pagination</div><div class="line">## Set per_page to 0 to disable pagination</div><div class="line">per_page: 10</div><div class="line">pagination_dir: page</div><div class="line"></div><div class="line"># Extensions</div><div class="line">## Plugins: https://hexo.io/plugins/</div><div class="line">## Themes: https://hexo.io/themes/</div><div class="line">#theme: landscape</div><div class="line"># 设置主题为next</div><div class="line">theme: next</div><div class="line"></div><div class="line"># Deployment</div><div class="line">## Docs: https://hexo.io/docs/deployment.html</div><div class="line">deploy:</div><div class="line">  type: git</div><div class="line">  repository: git@github.com:volc1605/volc1605.github.io.git</div><div class="line">  branch: master</div><div class="line"></div><div class="line"># 设置头像</div><div class="line">avatar: /images/0.png</div><div class="line"></div><div class="line"># Social links</div><div class="line">social:</div><div class="line">  GitHub: https://github.com/volc1605</div><div class="line">  Twitter: https://twitter.com/volcliu</div><div class="line">  微博: http://weibo.com/2297464654/profile?topnav=1&amp;wvr=6&amp;is_all=1</div><div class="line">  知乎: https://www.zhihu.com/people/volc</div><div class="line"></div><div class="line"># hexo sitemap网站地图</div><div class="line">sitemap:</div><div class="line">  path: sitemap.xml</div><div class="line">baidusitemap:</div><div class="line">  path: baidusitemap.xml</div><div class="line"></div><div class="line">search:</div><div class="line">  path: search.xml</div><div class="line">  field: post</div><div class="line"># 百度站点统计</div><div class="line">baidu_analytics: 87980c**************99ec5e26fb5</div><div class="line"># google统计</div><div class="line">google_analytics: 85*****1</div></pre></td></tr></table></figure>
<h2 id="3-2-主题配置文件-config-yml"><a href="#3-2-主题配置文件-config-yml" class="headerlink" title="3.2.主题配置文件_config.yml"></a>3.2.主题配置文件_config.yml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div></pre></td><td class="code"><pre><div class="line"># ---------------------------------------------------------------</div><div class="line"># Site Information Settings</div><div class="line"># ---------------------------------------------------------------</div><div class="line"></div><div class="line"># Put your favicon.ico into `hexo-site/source/` directory.</div><div class="line">favicon: /favicon.ico</div><div class="line"></div><div class="line"># Set default keywords (Use a comma to separate)</div><div class="line">keywords: &quot;Hexo, NexT&quot;</div><div class="line"></div><div class="line"># Set rss to false to disable feed link.</div><div class="line"># Leave rss as empty to use site&apos;s feed link.</div><div class="line"># Set rss to specific value if you have burned your feed already.</div><div class="line">rss:</div><div class="line"></div><div class="line"># Specify the date when the site was setup</div><div class="line">#since: 2015</div><div class="line"></div><div class="line"># Canonical, set a canonical link tag in your hexo, you could use it for your SEO of blog.</div><div class="line"># See: https://support.google.com/webmasters/answer/139066</div><div class="line"># Tips: Before you open this tag, remeber set up your URL in hexo _config.yml ( ex. url: http://yourdomain.com )</div><div class="line">canonical: true</div><div class="line"></div><div class="line"></div><div class="line"># ---------------------------------------------------------------</div><div class="line"># Menu Settings</div><div class="line"># ---------------------------------------------------------------</div><div class="line"></div><div class="line"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash (/archives -&gt; archives)</div><div class="line">menu:</div><div class="line">  home: /</div><div class="line">  categories: /categories</div><div class="line">  archives: /archives</div><div class="line">  tags: /tags</div><div class="line">  message: /message</div><div class="line">  # search: /search</div><div class="line">  about: /about</div><div class="line">  #commonweal: /404.html</div><div class="line"></div><div class="line"></div><div class="line"># Enable/Disable menu icons.</div><div class="line"># Icon Mapping:</div><div class="line">#   Map a menu item to a specific FontAwesome icon name.</div><div class="line">#   Key is the name of menu item and value is the name of FontAwsome icon. Key is case-senstive.</div><div class="line">#   When an question mask icon presenting up means that the item has no mapping icon.</div><div class="line">menu_icons:</div><div class="line">  enable: true</div><div class="line">  #KeyMapsToMenuItemKey: NameOfTheIconFromFontAwesome</div><div class="line">  home: home</div><div class="line">  categories: th</div><div class="line">  tags: tags</div><div class="line">  archives: archive</div><div class="line">  commonweal: heartbeat</div><div class="line">  message: external-link</div><div class="line">  # search: search</div><div class="line">  about: user</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># ---------------------------------------------------------------</div><div class="line"># Scheme Settings</div><div class="line"># ---------------------------------------------------------------</div><div class="line"></div><div class="line"># 切换样式</div><div class="line"># Schemes</div><div class="line">#scheme: Muse</div><div class="line">scheme: Mist</div><div class="line">#scheme: Pisces</div><div class="line"></div><div class="line"></div><div class="line"># ---------------------------------------------------------------</div><div class="line"># Font Settings</div><div class="line"># - Find fonts on Google Fonts (https://www.google.com/fonts)</div><div class="line"># - All fonts set here will have the following styles:</div><div class="line">#     light, light italic, normal, normal intalic, bold, bold italic</div><div class="line"># - Be aware that setting too much fonts will cause site running slowly</div><div class="line"># - Introduce in 5.0.1</div><div class="line"># ---------------------------------------------------------------</div><div class="line">font:</div><div class="line">  enable: true</div><div class="line"></div><div class="line">  # Uri of fonts host. E.g. //fonts.googleapis.com (Default)</div><div class="line">  host:</div><div class="line"></div><div class="line">  # Global font settings used on &lt;body&gt; element.</div><div class="line">  global:</div><div class="line">    # external: true will load this font family from host.</div><div class="line">    external: true</div><div class="line">    family: Lato</div><div class="line"></div><div class="line">  # Font settings for Headlines (h1, h2, h3, h4, h5, h6)</div><div class="line">  # Fallback to `global` font settings.</div><div class="line">  headings:</div><div class="line">    external: true</div><div class="line">    family:</div><div class="line"></div><div class="line">  # Font settings for posts</div><div class="line">  # Fallback to `global` font settings.</div><div class="line">  posts:</div><div class="line">    external: true</div><div class="line">    family:</div><div class="line"></div><div class="line">  # Font settings for Logo</div><div class="line">  # Fallback to `global` font settings.</div><div class="line">  # The `size` option use `px` as unit</div><div class="line">  logo:</div><div class="line">    external: true</div><div class="line">    family:</div><div class="line">    size: 33</div><div class="line"></div><div class="line">  # Font settings for &lt;code&gt; and code blocks.</div><div class="line">  codes:</div><div class="line">    external: true</div><div class="line">    family:</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># ---------------------------------------------------------------</div><div class="line"># Sidebar Settings</div><div class="line"># ---------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line"># Social Links</div><div class="line"># Key is the link label showing to end users.</div><div class="line"># Value is the target link (E.g. GitHub: https://github.com/iissnan)</div><div class="line">#social:</div><div class="line">  #LinkLabel: Link</div><div class="line"></div><div class="line"></div><div class="line"># Social Links Icons</div><div class="line"># Icon Mapping:</div><div class="line">#   Map a menu item to a specific FontAwesome icon name.</div><div class="line">#   Key is the name of the item and value is the name of FontAwsome icon. Key is case-senstive.</div><div class="line">#   When an globe mask icon presenting up means that the item has no mapping icon.</div><div class="line">social_icons:</div><div class="line">  enable: true</div><div class="line">  # Icon Mappings.</div><div class="line">  # KeyMapsToSocalItemKey: NameOfTheIconFromFontAwesome</div><div class="line">  GitHub: github</div><div class="line">  Twitter: twitter</div><div class="line">  微博: weibo</div><div class="line"></div><div class="line"></div><div class="line"># Sidebar Avatar</div><div class="line"># in theme directory(source/images): /images/avatar.jpg</div><div class="line"># in site  directory(source/uploads): /uploads/avatar.jpg</div><div class="line">#avatar:</div><div class="line"></div><div class="line"></div><div class="line"># Table Of Contents in the Sidebar</div><div class="line">toc:</div><div class="line">  enable: true</div><div class="line"></div><div class="line">  # Automatically add list number to toc.</div><div class="line">  number: true</div><div class="line"></div><div class="line"></div><div class="line"># Creative Commons 4.0 International License.</div><div class="line"># http://creativecommons.org/</div><div class="line"># Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</div><div class="line">#creative_commons: by-nc-sa</div><div class="line">#creative_commons:</div><div class="line"></div><div class="line"></div><div class="line">sidebar:</div><div class="line">  # Sidebar Position, available value: left | right</div><div class="line">  position: left</div><div class="line">  #position: right</div><div class="line"></div><div class="line">  # Sidebar Display, available value:</div><div class="line">  #  - post    expand on posts automatically. Default.</div><div class="line">  #  - always  expand for all pages automatically</div><div class="line">  #  - hide    expand only when click on the sidebar toggle icon.</div><div class="line">  #  - remove  Totally remove sidebar including sidebar toggler.</div><div class="line">  display: post</div><div class="line">  #display: always</div><div class="line">  #display: hide</div><div class="line">  #display: remove</div><div class="line"></div><div class="line"></div><div class="line"># Blogrolls</div><div class="line">links_title: 友情链接</div><div class="line">links_layout: inline</div><div class="line">links_icon: link  # 设置图标</div><div class="line">links:</div><div class="line">  一俗人: http://yisu.ren/index.php/</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># ---------------------------------------------------------------</div><div class="line"># Misc Theme Settings</div><div class="line"># ---------------------------------------------------------------</div><div class="line"></div><div class="line"># Custom Logo.</div><div class="line"># !!Only available for Default Scheme currently.</div><div class="line"># Options:</div><div class="line">#   enabled: [true/false] - Replace with specific image</div><div class="line">#   image: url-of-image   - Images&apos;s url</div><div class="line">custom_logo:</div><div class="line">  enabled: false</div><div class="line">  image:</div><div class="line"></div><div class="line"></div><div class="line"># Code Highlight theme</div><div class="line"># Available value:</div><div class="line">#    normal | night | night eighties | night blue | night bright</div><div class="line"># https://github.com/chriskempson/tomorrow-theme</div><div class="line">highlight_theme: night eighties</div><div class="line"></div><div class="line"></div><div class="line"># Automatically scroll page to section which is under &lt;!-- more --&gt; mark.</div><div class="line">scroll_to_more: true</div><div class="line"></div><div class="line"></div><div class="line"># Automatically Excerpt. Not recommand.</div><div class="line"># Please use &lt;!-- more --&gt; in the post to control excerpt accurately.</div><div class="line">auto_excerpt:</div><div class="line">  enable: true  # 开启文章阅全文</div><div class="line">  length: 2000   # 显示长度</div><div class="line"></div><div class="line"></div><div class="line"># Wechat Subscriber</div><div class="line">#wechat_subscriber:</div><div class="line">  #enabled: true</div><div class="line">  #qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg</div><div class="line">  #description: ex. subscribe to my blog by scanning my public wechat account</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># ---------------------------------------------------------------</div><div class="line"># Third Party Services Settings</div><div class="line"># ---------------------------------------------------------------</div><div class="line"></div><div class="line"># MathJax Support</div><div class="line">mathjax:</div><div class="line">  enable: false</div><div class="line">  cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</div><div class="line"></div><div class="line"></div><div class="line"># Swiftype Search API Key</div><div class="line">#swiftype_key:</div><div class="line"></div><div class="line"># Baidu Analytics ID</div><div class="line">#baidu_analytics:</div><div class="line">baidu_tongji: true</div><div class="line"></div><div class="line"># Duoshuo ShortName</div><div class="line">duoshuo_shortname: *******  # 开启多说评论功能</div><div class="line"></div><div class="line"># Disqus</div><div class="line">#disqus_shortname:</div><div class="line"></div><div class="line"># Baidu Share</div><div class="line"># Available value:</div><div class="line">#    button | slide</div><div class="line">#baidushare: true #</div><div class="line">##  type: button</div><div class="line"></div><div class="line"># Share</div><div class="line">#jiathis:</div><div class="line">#add_this_id:</div><div class="line"></div><div class="line"># Share</div><div class="line">duoshuo_share: true  # 开启多说的文章分享功能</div><div class="line"></div><div class="line"># Google Webmaster tools verification setting</div><div class="line"># See: https://www.google.com/webmasters/</div><div class="line">#google_site_verification:</div><div class="line"></div><div class="line"></div><div class="line"># Google Analytics</div><div class="line">#google_analytics:</div><div class="line"></div><div class="line"># CNZZ count</div><div class="line">#cnzz_siteid:</div><div class="line"></div><div class="line"></div><div class="line"># Make duoshuo show UA</div><div class="line"># user_id must NOT be null when admin_enable is true!</div><div class="line"># you can visit http://dev.duoshuo.com get duoshuo user id.</div><div class="line">duoshuo_info:</div><div class="line">  ua_enable: true</div><div class="line">  admin_enable: false</div><div class="line">  user_id: 0</div><div class="line">  #admin_nickname: Author</div><div class="line"></div><div class="line"></div><div class="line"># Facebook SDK Support.</div><div class="line"># https://github.com/iissnan/hexo-theme-next/pull/410</div><div class="line">facebook_sdk:</div><div class="line">  enable: false</div><div class="line">  app_id:       #&lt;app_id&gt;</div><div class="line">  fb_admin:     #&lt;user_id&gt;</div><div class="line">  like_button:  #true</div><div class="line">  webmaster:    #true</div><div class="line"></div><div class="line"># Facebook comments plugin</div><div class="line"># This plugin depends on Facebook SDK.</div><div class="line"># If facebook_sdk.enable is false, Facebook comments plugin is unavailable.</div><div class="line">facebook_comments_plugin:</div><div class="line">  enable: false</div><div class="line">  num_of_posts: 10  # min posts num is 1</div><div class="line">  width: 100%       # default width is 550px</div><div class="line">  scheme: light     # default scheme is light (light or dark)</div><div class="line"></div><div class="line"></div><div class="line"># Show number of visitors to each article.</div><div class="line"># You can visit https://leancloud.cn get AppID and AppKey.</div><div class="line">leancloud_visitors:</div><div class="line">  enable: true</div><div class="line">  app_id: uSB1*************************Hsz</div><div class="line">  app_key: 98i************************aI5</div><div class="line"></div><div class="line"># Show PV/UV of the website/page with busuanzi.</div><div class="line"># Get more information on http://ibruce.info/2015/04/04/busuanzi/</div><div class="line">busuanzi_count:</div><div class="line">  # count values only if the other configs are false</div><div class="line">  enable: false</div><div class="line">  # custom uv span for the whole site</div><div class="line">  site_uv: true</div><div class="line">  site_uv_header: &lt;i class=&quot;fa fa-user&quot;&gt;&lt;/i&gt;</div><div class="line">  site_uv_footer:</div><div class="line">  # custom pv span for the whole site</div><div class="line">  site_pv: true</div><div class="line">  site_pv_header: &lt;i class=&quot;fa fa-eye&quot;&gt;&lt;/i&gt;</div><div class="line">  site_pv_footer:</div><div class="line">  # custom pv span for one page only</div><div class="line">  page_pv: true</div><div class="line">  page_pv_header: &lt;i class=&quot;fa fa-file-o&quot;&gt;&lt;/i&gt;</div><div class="line">  page_pv_footer:</div><div class="line"></div><div class="line"># Tencent analytics ID</div><div class="line"># tencent_analytics:</div><div class="line"></div><div class="line"># Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO</div><div class="line">baidu_push: false</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#! ---------------------------------------------------------------</div><div class="line">#! DO NOT EDIT THE FOLLOWING SETTINGS</div><div class="line">#! UNLESS YOU KNOW WHAT YOU ARE DOING</div><div class="line">#! ---------------------------------------------------------------</div><div class="line"></div><div class="line"># Motion</div><div class="line">use_motion: true</div><div class="line"></div><div class="line"># Fancybox</div><div class="line">fancybox: true</div><div class="line"></div><div class="line"></div><div class="line"># Script Vendors.</div><div class="line"># Set a CDN address for the vendor you want to customize.</div><div class="line"># For example</div><div class="line">#    jquery: https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js</div><div class="line"># Be aware that you should use the same version as internal ones to avoid potential problems.</div><div class="line">vendors:</div><div class="line">  # Internal path prefix. Please do not edit it.</div><div class="line">  _internal: vendors</div><div class="line"></div><div class="line">  # Internal version: 2.1.3</div><div class="line">  jquery:</div><div class="line"></div><div class="line">  # Internal version: 2.1.5</div><div class="line">  # http://fancyapps.com/fancybox/</div><div class="line">  fancybox:</div><div class="line">  fancybox_css:</div><div class="line"></div><div class="line">  # Internal version: 1.0.6</div><div class="line">  # https://github.com/ftlabs/fastclick</div><div class="line">  fastclick:</div><div class="line"></div><div class="line">  # Internal version: 1.9.7</div><div class="line">  # https://github.com/tuupola/jquery_lazyload</div><div class="line">  lazyload:</div><div class="line"></div><div class="line">  # Internal version: 1.2.1</div><div class="line">  # http://VelocityJS.org</div><div class="line">  velocity:</div><div class="line"></div><div class="line">  # Internal version: 1.2.1</div><div class="line">  # http://VelocityJS.org</div><div class="line">  velocity_ui:</div><div class="line"></div><div class="line">  # Internal version: 0.7.9</div><div class="line">  # https://faisalman.github.io/ua-parser-js/</div><div class="line">  ua_parser:</div><div class="line"></div><div class="line">  # Internal version: 4.4.0</div><div class="line">  # http://fontawesome.io/</div><div class="line">  fontawesome:</div><div class="line"></div><div class="line"></div><div class="line"># Assets</div><div class="line">css: css</div><div class="line">js: js</div><div class="line">images: images</div><div class="line"></div><div class="line"># Theme version</div><div class="line">version: 5.0.1</div><div class="line"></div><div class="line"># Donate 文章末尾显示打赏按钮</div><div class="line">reward_comment: 如果文章对您有用请随意打赏，谢谢支持！</div><div class="line">wechatpay: /images/w.png</div><div class="line">alipay: /images/z.jpg</div></pre></td></tr></table></figure>
<h1 id="3-菜单栏"><a href="#3-菜单栏" class="headerlink" title="3.菜单栏"></a>3.菜单栏</h1><h2 id="3-1-菜单栏为中文简体字"><a href="#3-1-菜单栏为中文简体字" class="headerlink" title="3.1.菜单栏为中文简体字"></a>3.1.菜单栏为中文简体字</h2><p>主题配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">language: zh-Hans</div></pre></td></tr></table></figure></p>
<p>这样就引用了themes\next\languages\zh-Hans.yml文件，打开这个文件就可以看每个key对应的都是中文字体</p>
<h2 id="3-2标签和分类"><a href="#3-2标签和分类" class="headerlink" title="3.2标签和分类"></a>3.2标签和分类</h2><p>在主题配置文件中找到menu，如果想隐藏菜单栏中的某个选项只要在前面加上 # 即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  home: /</div><div class="line">  categories: /categories # 分类</div><div class="line">  archives: /archives     # 归档</div><div class="line">  tags: /tags             # 标签</div><div class="line">  message: /message       # 留言</div><div class="line">  about: /about           # 关于</div><div class="line">  # commonweal: /404.html # 公益</div></pre></td></tr></table></figure></p>
<p>我们将categories 和tags 设为显示<br>再找到menu_icons, 这里是每一个菜单选项前面对应的小图标<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/ioc.png" alt="ioc"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">menu_icons:</div><div class="line">  enable: true</div><div class="line">  #KeyMapsToMenuItemKey: NameOfTheIconFromFontAwesome</div><div class="line">  home: home</div><div class="line">  categories: th</div><div class="line">  tags: tags</div><div class="line">  archives: archive</div><div class="line">  commonweal: heartbeat</div><div class="line">  message: external-link</div><div class="line">  about: user</div></pre></td></tr></table></figure>
<p>我们将categories 和tags 设为显示<br>在blog文件夹中进行git bash here 执行以下命令生成categories 和 tags的页面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hexo n page &quot;categories&quot;</div><div class="line">hexo n page &quot;tags&quot;</div></pre></td></tr></table></figure></p>
<p>会生成source\categories 和 source\tags 两个文件夹，里面都有index.md文件.修改内容为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: categories</div><div class="line">type: categories</div><div class="line">---</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: tags</div><div class="line">type: tags</div><div class="line">---</div></pre></td></tr></table></figure>
<p>再使用命令生成博文文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo n &quot;name&quot;    # name 文章名称</div></pre></td></tr></table></figure></p>
<p>生成文章时，在对应的name.md中可以这样添加标签和分类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: Hexo之NexT主题搭建博客详细过程</div><div class="line">date: 2016-10-03 15:39:31</div><div class="line">update: 2016-10-04 06:19:11</div><div class="line">categories: hexo             # 分类</div><div class="line">tags: [nodejs, hexo, NexT]   # [标签1, 标签2..., 标签n]</div><div class="line">---</div></pre></td></tr></table></figure></p>
<h2 id="3-3-新增留言功能"><a href="#3-3-新增留言功能" class="headerlink" title="3.3.新增留言功能"></a>3.3.新增留言功能</h2><p>主题配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  home: /</div><div class="line">  categories: /categories</div><div class="line">  archives: /archives</div><div class="line">  tags: /tags</div><div class="line">  message: /message       # 新增 message</div><div class="line">  about: /about</div><div class="line">  #commonweal: /404.html</div></pre></td></tr></table></figure></p>
<p>配置图标<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">menu_icons:</div><div class="line">  enable: true</div><div class="line">  home: home</div><div class="line">  categories: th</div><div class="line">  tags: tags</div><div class="line">  archives: archive</div><div class="line">  commonweal: heartbeat</div><div class="line">  message: external-link  # 新增 message</div><div class="line">  about: user</div></pre></td></tr></table></figure></p>
<p>配置对应的中文名称，在themes\next\languages\zh-Hans.yml文件中修改如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  home: 首页</div><div class="line">  archives: 归档</div><div class="line">  categories: 分类</div><div class="line">  tags: 标签</div><div class="line">  about: 关于</div><div class="line">  search: 搜索</div><div class="line">  message: 留言            # 新增 留言</div><div class="line">  commonweal: 公益404</div><div class="line">  udpate: 更新</div></pre></td></tr></table></figure></p>
<p>然后执行如下命令<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">hexo</span> n page <span class="string">"message"</span></div></pre></td></tr></table></figure></p>
<p>重新清除，生成和启动便可看到效果，只不过留言功能什么也没有</p>
<h3 id="3-3-1-引入多说评论功能"><a href="#3-3-1-引入多说评论功能" class="headerlink" title="3.3.1.引入多说评论功能"></a>3.3.1.引入多说评论功能</h3><p>进入官网<a href="http://duoshuo.com/" target="_blank" rel="external">http://duoshuo.com/</a> 进行登录，建议不要使用微信进行登录，容易出现Scope 参数错误或没有 Scope 权限的问题。登录完成在首页进入后台管理，在设置里面包含：域名：zhangsan.duoshuo.com<br>在主题配置文件中<br>修改如下, duoshuo_shortname的值就是域名中的zhangsan<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">duoshuo_shortname: zhangsan  # 开启多说评论功能</div><div class="line"># Share</div><div class="line">duoshuo_share: true          # 开启多说的文章分享功能</div></pre></td></tr></table></figure></p>
<p>留言功能已完成<br>去掉分类和其他的选项的留言功能，只需修改index.md<br>在source\categories\index.md 中修改如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: categories</div><div class="line">type: categories</div><div class="line">comments: false       # 去掉评论功能</div><div class="line">date: 2016-10-01 21:07:35</div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>添加留言邮件提醒功能请参阅：<a href="http://www.tuicool.com/articles/iEN7riZ" target="_blank" rel="external">http://www.tuicool.com/articles/iEN7riZ</a></p>
<h1 id="4-修改头像"><a href="#4-修改头像" class="headerlink" title="4.修改头像"></a>4.修改头像</h1><p>设置菜单栏头像<br>    把头像0.jpg图片放在themes\next\source\images中<br>    在站点的_config.yml，修改字段 avatar<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 设置头像</div><div class="line">avatar: /images/0.jpg</div></pre></td></tr></table></figure></p>
<p>可以指定网址图片url</p>
<h1 id="5-侧边栏社交链接"><a href="#5-侧边栏社交链接" class="headerlink" title="5.侧边栏社交链接"></a>5.侧边栏社交链接</h1><p>侧栏社交链接的修改包含两个部分，第一是链接，第二是链接图标。 两者配置均在 主题配置文件 中。</p>
<blockquote>
<p>链接放置在 social 字段下，一行一个链接。其键值格式是 显示文本: 链接地址</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Social links</div><div class="line">social:</div><div class="line">  GitHub: https://github.com/your-user-name</div><div class="line">  Twitter: https://twitter.com/your-user-name</div><div class="line">  微博: http://weibo.com/your-user-name</div><div class="line">  豆瓣: http://douban.com/people/your-user-name</div><div class="line">  知乎: http://www.zhihu.com/people/your-user-name</div><div class="line">  # 等等</div></pre></td></tr></table></figure>
<p>效果图<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/lin.png" alt="lin"></p>
<blockquote>
<p>设定链接的图标，对应的字段是 social_icons。其键值格式是 匹配键: Font Awesome 图标名称， 匹配键 与上一步所配置的链接的 显示文本 相同（大小写严格匹配），图标名称 是 Font Awesome 图标的名字（不必带 fa- 前缀）。 enable 选项用于控制是否显示图标，你可以设置成 false 来去掉图标。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># Social Icons</div><div class="line">social_icons:</div><div class="line">  enable: true</div><div class="line">  # Icon Mappings</div><div class="line">  GitHub: github</div><div class="line">  Twitter: twitter</div><div class="line">  微博: weibo</div></pre></td></tr></table></figure>
<h1 id="6-友情链接"><a href="#6-友情链接" class="headerlink" title="6.友情链接"></a>6.友情链接</h1><blockquote>
<p>编辑 主题配置文件 添加：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Blogrolls</div><div class="line">links_title: 友情链接</div><div class="line">links_layout: inline</div><div class="line">links_icon: link  # 设置图标</div><div class="line">links:</div><div class="line">  一俗人: http://yisu.ren/index.php/</div></pre></td></tr></table></figure>
<p><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/yl.png" alt="yl"></p>
<h1 id="7-文章配置"><a href="#7-文章配置" class="headerlink" title="7.文章配置"></a>7.文章配置</h1><h2 id="7-1-开启阅读全文"><a href="#7-1-开启阅读全文" class="headerlink" title="7.1.开启阅读全文"></a>7.1.开启阅读全文</h2><blockquote>
<p>方式一：在文章中进行截断(推荐使用)<br>以下给出文章md文件片段内容</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">在浏览器访问：http://localhost:4000/ 便可查看hexo默认的主题</div><div class="line">![hexo](https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/h.png)</div><div class="line">&lt;!-- more --&gt;    # 直接在文章的md文件中添加&lt;!-- more --&gt;标注</div><div class="line">&gt;clone NexT主题</div><div class="line"></div><div class="line">在blog根目录执行命令</div></pre></td></tr></table></figure>
<blockquote>
<p>方式二：修改主题配置文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">auto_excerpt:</div><div class="line">  enable: true  # 开启文章阅全文</div><div class="line">  length: 2000   # 显示长度</div></pre></td></tr></table></figure>
<h2 id="7-2-新增阅读量"><a href="#7-2-新增阅读量" class="headerlink" title="7.2.新增阅读量"></a>7.2.新增阅读量</h2><p>为每一篇文章统计阅读量  </p>
<blockquote>
<p>使用leancloud进行文章变更统计，进入官网<a href="https://leancloud.cn/" target="_blank" rel="external">https://leancloud.cn/</a> 注册</p>
</blockquote>
<p>打开LeanCloud官网，进入注册页面注册。完成邮箱激活后，点击头像，进入控制台页面</p>
<blockquote>
<p>创建新应用</p>
</blockquote>
<p>点击应用创建新应用，应用名称随便起</p>
<blockquote>
<p>创建Class文件</p>
</blockquote>
<p>进入到应用后点击存储，在左侧点击设置，选择”创建Class”，名称必须为Counter</p>
<blockquote>
<p>修改主题配置文件</p>
</blockquote>
<p>主题配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 文章阅读量</div><div class="line">leancloud_visitors:</div><div class="line">  enable: true</div><div class="line">  app_id: **你的app_id**</div><div class="line">  app_key: **你的app_key**</div></pre></td></tr></table></figure></p>
<p>其中，app_id和app_key在你所创建的应用的设置-&gt;应用Key中  </p>
<blockquote>
<p>添加lean-analytics.swig文件</p>
</blockquote>
<p>在主题的 themes\next\layout\_scripts\third-party路径下查看是否有lean-analytics.swig 文件，如果没有新建一个 lean-analytics.swig 文件，并向里面添加以下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line">&#123;% if theme.leancloud_visitors.enable %&#125;</div><div class="line"></div><div class="line">  &#123;# custom analytics part create by xiamo #&#125;</div><div class="line">  &lt;script src=&quot;https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js&quot;&gt;&lt;/script&gt;</div><div class="line">  &lt;script&gt;AV.initialize(&quot;&#123;&#123;theme.leancloud_visitors.app_id&#125;&#125;&quot;, &quot;&#123;&#123;theme.leancloud_visitors.app_key&#125;&#125;&quot;);&lt;/script&gt;</div><div class="line">  &lt;script&gt;</div><div class="line">    function showTime(Counter) &#123;</div><div class="line">      var query = new AV.Query(Counter);</div><div class="line">      var entries = [];</div><div class="line">      var $visitors = $(&quot;.leancloud_visitors&quot;);</div><div class="line"></div><div class="line">      $visitors.each(function () &#123;</div><div class="line">        entries.push( $(this).attr(&quot;id&quot;).trim() );</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      query.containedIn(&apos;url&apos;, entries);</div><div class="line">      query.find()</div><div class="line">        .done(function (results) &#123;</div><div class="line">          var COUNT_CONTAINER_REF = &apos;.leancloud-visitors-count&apos;;</div><div class="line"></div><div class="line">          if (results.length === 0) &#123;</div><div class="line">            $visitors.find(COUNT_CONTAINER_REF).text(0);</div><div class="line">            return;</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          for (var i = 0; i &lt; results.length; i++) &#123;</div><div class="line">            var item = results[i];</div><div class="line">            var url = item.get(&apos;url&apos;);</div><div class="line">            var time = item.get(&apos;time&apos;);</div><div class="line">            var element = document.getElementById(url);</div><div class="line"></div><div class="line">            $(element).find(COUNT_CONTAINER_REF).text(time);</div><div class="line">          &#125;</div><div class="line">          for(var i = 0; i &lt; entries.length; i++) &#123;</div><div class="line">            var url = entries[i];</div><div class="line">            var element = document.getElementById(url);</div><div class="line">            var countSpan = $(element).find(COUNT_CONTAINER_REF);</div><div class="line">            if( countSpan.text() == &apos;&apos;) &#123;</div><div class="line">              countSpan.text(0);</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line">        .fail(function (object, error) &#123;</div><div class="line">          console.log(&quot;Error: &quot; + error.code + &quot; &quot; + error.message);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function addCount(Counter) &#123;</div><div class="line">      var $visitors = $(&quot;.leancloud_visitors&quot;);</div><div class="line">      var url = $visitors.attr(&apos;id&apos;).trim();</div><div class="line">      var title = $visitors.attr(&apos;data-flag-title&apos;).trim();</div><div class="line">      var query = new AV.Query(Counter);</div><div class="line"></div><div class="line">      query.equalTo(&quot;url&quot;, url);</div><div class="line">      query.find(&#123;</div><div class="line">        success: function(results) &#123;</div><div class="line">          if (results.length &gt; 0) &#123;</div><div class="line">            var counter = results[0];</div><div class="line">            counter.fetchWhenSave(true);</div><div class="line">            counter.increment(&quot;time&quot;);</div><div class="line">            counter.save(null, &#123;</div><div class="line">              success: function(counter) &#123;</div><div class="line">                var $element = $(document.getElementById(url));</div><div class="line">                $element.find(&apos;.leancloud-visitors-count&apos;).text(counter.get(&apos;time&apos;));</div><div class="line">              &#125;,</div><div class="line">              error: function(counter, error) &#123;</div><div class="line">                console.log(&apos;Failed to save Visitor num, with error message: &apos; + error.message);</div><div class="line">              &#125;</div><div class="line">            &#125;);</div><div class="line">          &#125; else &#123;</div><div class="line">            var newcounter = new Counter();</div><div class="line">            /* Set ACL */</div><div class="line">            var acl = new AV.ACL();</div><div class="line">            acl.setPublicReadAccess(true);</div><div class="line">            acl.setPublicWriteAccess(true);</div><div class="line">            newcounter.setACL(acl);</div><div class="line">            /* End Set ACL */</div><div class="line">            newcounter.set(&quot;title&quot;, title);</div><div class="line">            newcounter.set(&quot;url&quot;, url);</div><div class="line">            newcounter.set(&quot;time&quot;, 1);</div><div class="line">            newcounter.save(null, &#123;</div><div class="line">              success: function(newcounter) &#123;</div><div class="line">                var $element = $(document.getElementById(url));</div><div class="line">                $element.find(&apos;.leancloud-visitors-count&apos;).text(newcounter.get(&apos;time&apos;));</div><div class="line">              &#125;,</div><div class="line">              error: function(newcounter, error) &#123;</div><div class="line">                console.log(&apos;Failed to create&apos;);</div><div class="line">              &#125;</div><div class="line">            &#125;);</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        error: function(error) &#123;</div><div class="line">          console.log(&apos;Error:&apos; + error.code + &quot; &quot; + error.message);</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $(function() &#123;</div><div class="line">      var Counter = AV.Object.extend(&quot;Counter&quot;);</div><div class="line">      if ($(&apos;.leancloud_visitors&apos;).length == 1) &#123;</div><div class="line">        addCount(Counter);</div><div class="line">      &#125; else if ($(&apos;.post-title-link&apos;).length &gt; 1) &#123;</div><div class="line">        showTime(Counter);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &lt;/script&gt;</div><div class="line"></div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>修改 themes\next\layout_macro\post.swig 文件</p>
</blockquote>
<p>找到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;% if not is_index and theme.facebook_sdk.enable and theme.facebook_sdk.like_button %&#125;</div><div class="line">  &amp;nbsp; | &amp;nbsp;</div><div class="line">  &lt;div class=&quot;fb-like&quot; data-layout=&quot;button_count&quot; data-share=&quot;true&quot;&gt;&lt;/div&gt;</div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure></p>
<p>在其后追加以下代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;# LeanCould PageView #&#125;</div><div class="line">  &#123;% if theme.leancloud_visitors.enable %&#125;</div><div class="line">     &lt;span id=&quot;&#123;&#123; url_for(post.path) &#125;&#125;&quot; class=&quot;leancloud_visitors&quot; data-flag-title=&quot;&#123;&#123; post.title &#125;&#125;&quot;&gt;</div><div class="line">       &amp;nbsp; | &amp;nbsp;</div><div class="line">       &lt;span class=&quot;post-meta-item-icon&quot;&gt;</div><div class="line">         &lt;i class=&quot;fa fa-eye&quot;&gt;&lt;/i&gt;</div><div class="line">       &lt;/span&gt;</div><div class="line">       &lt;span class=&quot;post-meta-item-text&quot;&gt;&#123;&#123;__(&apos;post.visitors&apos;)&#125;&#125; &lt;/span&gt;</div><div class="line">       &lt;span class=&quot;leancloud-visitors-count&quot;&gt;&lt;/span&gt;</div><div class="line">  &#123;% endif %&#125;</div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>配置themes\next\layout\_layout.swig文件</p>
</blockquote>
<p>在最后div标签中查找是否引用了_scripts/third-party/lean-analytics.swig文件，如果没有增加以下代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;% include &apos;_scripts/third-party/comments.swig&apos; %&#125;</div><div class="line">  &#123;% include &apos;_scripts/third-party/tinysou.swig&apos; %&#125;</div><div class="line">  &#123;% include &apos;_scripts/third-party/localsearch.swig&apos; %&#125;</div><div class="line">  &#123;% include &apos;_scripts/third-party/mathjax.swig&apos; %&#125;</div><div class="line">  &#123;% include &apos;_scripts/third-party/lean-analytics.swig&apos; %&#125;  # 新增</div><div class="line">  &#123;% include &apos;_scripts/baidu-push.swig&apos; %&#125;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>修改语言配置文件 themes\next\languages\zh-Hans.yml post字段</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">post:</div><div class="line">  sticky: 置顶</div><div class="line">  posted: 发表于</div><div class="line">  updated: 最近</div><div class="line">  update: 更新于</div><div class="line">  in: 分类于</div><div class="line">  visitors: 阅读量</div><div class="line">  read_more: 阅读全文</div><div class="line">  untitled: 未命名</div><div class="line">  toc_empty: 此文章未包含目录</div></pre></td></tr></table></figure>
<p>其他语言与之类似，将visitors设置成你希望翻译的字段。最后，重新清除并生成你的网站即可。</p>
<blockquote>
<p>Web安全性</p>
</blockquote>
<p>为了保证应用的统计计数功能仅应用于自己的博客系统，你可以在应用-&gt;设置-&gt;安全中心的Web安全域名中加入自己的博客域名，以保证数据的调用安全。直接加上首页地址即可,保存三分之后生效，这时在本地方访问便不会统计。<br>参阅：<a href="http://www.jeyzhang.com/hexo-next-add-post-views.html" target="_blank" rel="external">http://www.jeyzhang.com/hexo-next-add-post-views.html</a></p>
<h2 id="7-3-文章最近访问时间"><a href="#7-3-文章最近访问时间" class="headerlink" title="7.3.文章最近访问时间"></a>7.3.文章最近访问时间</h2><blockquote>
<p>改themes\next\layout_scripts\third-party\lean-analytics.swig文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line">&#123;% if theme.leancloud_visitors.enable %&#125;</div><div class="line">  &#123;# custom analytics part create by xiamo #&#125;</div><div class="line">  &lt;script src=&quot;https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js&quot;&gt;&lt;/script&gt;</div><div class="line">  &lt;script&gt;AV.initialize(&quot;&#123;&#123;theme.leancloud_visitors.app_id&#125;&#125;&quot;, &quot;&#123;&#123;theme.leancloud_visitors.app_key&#125;&#125;&quot;);&lt;/script&gt;</div><div class="line">  &lt;script&gt;</div><div class="line">    function showTime(Counter) &#123;</div><div class="line">      var query = new AV.Query(Counter);</div><div class="line">      var entries = [];</div><div class="line">      var $visitors = $(&quot;.leancloud_visitors&quot;);</div><div class="line">      $visitors.each(function () &#123;</div><div class="line">        entries.push( $(this).attr(&quot;id&quot;).trim() );</div><div class="line">      &#125;);</div><div class="line">      query.containedIn(&apos;url&apos;, entries);</div><div class="line">      query.find()</div><div class="line">        .done(function (results) &#123;</div><div class="line">          var COUNT_CONTAINER_REF = &apos;.leancloud-visitors-count&apos;;</div><div class="line">          var UPDATED_AT = &apos;.leancloud-updated-at&apos;; // 新增代码 定义最近变更时间的class</div><div class="line">          if (results.length === 0) &#123;</div><div class="line">            $visitors.find(COUNT_CONTAINER_REF).text(0);</div><div class="line">            return;</div><div class="line">          &#125;</div><div class="line">          // console.log(results);</div><div class="line">          for(var i = 0; i &lt; results.length; i++) &#123;</div><div class="line">            var item = results[i];</div><div class="line">            var url = item.get(&apos;url&apos;);</div><div class="line">            var time = item.get(&apos;time&apos;);   // 获取阅读量</div><div class="line">            var updatedT = item.updatedAt; // 新增代码 获取最近浏览时间 需要注意的是updateT是对象并不是字符串</div><div class="line">            var element = document.getElementById(url);</div><div class="line">            $(element).find(COUNT_CONTAINER_REF).text(time);</div><div class="line">            // 新增代码 转换日期格式</div><div class="line">            if(updatedT != null &amp;&amp; updatedT != &apos;&apos;) &#123;</div><div class="line">              var a = [updatedT.getFullYear(), updatedT.getMonth() + 1, updatedT.getDate(), updatedT.getHours(), updatedT.getMinutes(), updatedT.getSeconds()];</div><div class="line">              for(var j = 0,len = a.length; j &lt; len; j++) &#123;</div><div class="line">                  if(a[j] &lt; 10) &#123;</div><div class="line">                      a[j] = &apos;0&apos; + a[j];</div><div class="line">                  &#125;</div><div class="line">              &#125;</div><div class="line">              var updateTime = a[0] + &apos;-&apos; + a[1] + &apos;-&apos; + a[2] + &apos; &apos; + a[3] + &apos;:&apos; + a[4] + &apos;:&apos; + a[5];</div><div class="line">              $(element).find(UPDATED_AT).text(updateTime);</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">          for(var i = 0; i &lt; entries.length; i++) &#123;</div><div class="line">            var url = entries[i];</div><div class="line">            var element = document.getElementById(url);</div><div class="line">            var countSpan = $(element).find(COUNT_CONTAINER_REF);</div><div class="line">            var updatedAtContent = $(element).find(UPDATED_AT);</div><div class="line">            if( countSpan.text() == &apos;&apos;) &#123;</div><div class="line">              countSpan.text(0);</div><div class="line">            &#125;</div><div class="line">            // 新增代码 如果首页的文章没有更新侧默认为无人浏览</div><div class="line">            if(updatedAtContent.text() == &apos;&apos;) &#123;</div><div class="line">              updatedAtContent.text(&apos;无人浏览&apos;);</div><div class="line">            &#125;</div><div class="line">            // 结束</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line">        .fail(function (object, error) &#123;</div><div class="line">          console.log(&quot;Error: &quot; + error.code + &quot; &quot; + error.message);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    function addCount(Counter) &#123;</div><div class="line">      var $visitors = $(&quot;.leancloud_visitors&quot;);</div><div class="line">      var url = $visitors.attr(&apos;id&apos;).trim();</div><div class="line">      var title = $visitors.attr(&apos;data-flag-title&apos;).trim();</div><div class="line">      var query = new AV.Query(Counter);</div><div class="line">      query.equalTo(&quot;url&quot;, url);</div><div class="line">      query.find(&#123;</div><div class="line">        success: function(results) &#123;</div><div class="line">          if (results.length &gt; 0) &#123;</div><div class="line">            var counter = results[0];</div><div class="line">            counter.fetchWhenSave(true);</div><div class="line">            counter.increment(&quot;time&quot;);</div><div class="line">            counter.save(null, &#123;</div><div class="line">              success: function(counter) &#123;</div><div class="line">                var $element = $(document.getElementById(url));</div><div class="line">                $element.find(&apos;.leancloud-visitors-count&apos;).text(counter.get(&apos;time&apos;));</div><div class="line">              &#125;,</div><div class="line">              error: function(counter, error) &#123;</div><div class="line">                console.log(&apos;Failed to save Visitor num, with error message: &apos; + error.message);</div><div class="line">              &#125;</div><div class="line">            &#125;);</div><div class="line">          &#125; else &#123;</div><div class="line">            var newcounter = new Counter();</div><div class="line">            /* Set ACL */</div><div class="line">            var acl = new AV.ACL();</div><div class="line">            acl.setPublicReadAccess(true);</div><div class="line">            acl.setPublicWriteAccess(true);</div><div class="line">            newcounter.setACL(acl);</div><div class="line">            /* End Set ACL */</div><div class="line">            newcounter.set(&quot;title&quot;, title);</div><div class="line">            newcounter.set(&quot;url&quot;, url);</div><div class="line">            newcounter.set(&quot;time&quot;, 1);</div><div class="line">            newcounter.save(null, &#123;</div><div class="line">              success: function(newcounter) &#123;</div><div class="line">                var $element = $(document.getElementById(url));</div><div class="line">                $element.find(&apos;.leancloud-visitors-count&apos;).text(newcounter.get(&apos;time&apos;));</div><div class="line">              &#125;,</div><div class="line">              error: function(newcounter, error) &#123;</div><div class="line">                console.log(&apos;Failed to create&apos;);</div><div class="line">              &#125;</div><div class="line">            &#125;);</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        error: function(error) &#123;</div><div class="line">          console.log(&apos;Error:&apos; + error.code + &quot; &quot; + error.message);</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">    $(function() &#123;</div><div class="line">      var Counter = AV.Object.extend(&quot;Counter&quot;);</div><div class="line">      if ($(&apos;.leancloud_visitors&apos;).length == 1) &#123;</div><div class="line">        addCount(Counter);</div><div class="line">      &#125; else if ($(&apos;.post-title-link&apos;).length &gt; 1) &#123;</div><div class="line">        showTime(Counter);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &lt;/script&gt;</div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure>
<h2 id="7-4-添加文章更新时间"><a href="#7-4-添加文章更新时间" class="headerlink" title="7.4.添加文章更新时间"></a>7.4.添加文章更新时间</h2><blockquote>
<p>scaffolds\post.md 文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: &#123;&#123; title &#125;&#125;</div><div class="line">date: &#123;&#123; date &#125;&#125;</div><div class="line">categories:</div><div class="line">tags:</div><div class="line">update: &#123;&#123; date &#125;&#125;  # 新增更新时间</div><div class="line">---</div></pre></td></tr></table></figure>
<blockquote>
<p>themes\next\layout_macro\post.swig 文件</p>
</blockquote>
<p>找到以下代码的位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;span class=&quot;post-time&quot;&gt;</div><div class="line">  &lt;span class=&quot;post-meta-item-icon&quot;&gt;</div><div class="line">    &lt;i class=&quot;fa fa-calendar-o&quot;&gt;&lt;/i&gt;</div><div class="line">  &lt;/span&gt;</div><div class="line">  &lt;span class=&quot;post-meta-item-text&quot;&gt;&#123;&#123; __(&apos;post.posted&apos;) &#125;&#125;&lt;/span&gt;</div><div class="line">  &lt;time itemprop=&quot;dateCreated&quot; datetime=&quot;&#123;&#123; moment(post.date).format() &#125;&#125;&quot; content=&quot;&#123;&#123; date(post.date, config.date_format) &#125;&#125;&quot;&gt;</div><div class="line">    &#123;&#123; date(post.date, config.date_format) &#125;&#125;</div><div class="line">  &lt;/time&gt;</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure>
<p>进行追加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;span class=&quot;post-time&quot;&gt;</div><div class="line">  &lt;span class=&quot;post-meta-item-icon&quot;&gt;</div><div class="line">    &lt;i class=&quot;fa fa-calendar-o&quot;&gt;&lt;/i&gt;</div><div class="line">  &lt;/span&gt;</div><div class="line">  &lt;span class=&quot;post-meta-item-text&quot;&gt;&#123;&#123; __(&apos;post.posted&apos;) &#125;&#125;&lt;/span&gt;</div><div class="line">  &lt;time itemprop=&quot;dateCreated&quot; datetime=&quot;&#123;&#123; moment(post.date).format() &#125;&#125;&quot; content=&quot;&#123;&#123; date(post.date, config.date_format) &#125;&#125;&quot;&gt;</div><div class="line">    &#123;&#123; date(post.date, config.date_format) &#125;&#125;</div><div class="line">  &lt;/time&gt;</div><div class="line">&lt;/span&gt;</div><div class="line">&#123;# 追加代码 #&#125;</div><div class="line">&lt;span&gt;</div><div class="line">    |</div><div class="line">  &lt;span&gt;&#123;&#123; __(&apos;post.update&apos;) &#125;&#125;&lt;/span&gt;</div><div class="line">  &lt;time&gt;</div><div class="line">    &#123;&#123; date(post.update, config.date_format) &#125;&#125;</div><div class="line">    &#123;&#123; date(post.update, config.time_format) &#125;&#125;</div><div class="line">  &lt;/time&gt;</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure></p>
<p>在每次新建文章时，默认更新时间就是发表时间，更新文章时需要手动修改udpate的值。例如source_posts\hexo之next主题.md</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: Hexo之NexT主题搭建博客详细过程</div><div class="line">date: 2016-10-03 15:39:31</div><div class="line">update: 2016-10-03 15:39:31      # 每次更新需手动修改成这样的格式时间</div><div class="line">categories: hexo</div><div class="line">tags: [nodejs, hexo]</div><div class="line">---</div></pre></td></tr></table></figure>
<blockquote>
<p>修改themes\next\languages\zh-Hans.yml</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">post:</div><div class="line">  sticky: 置顶</div><div class="line">  posted: 发表于</div><div class="line">  updated: 最近</div><div class="line">  update: 更新于     # 新增</div><div class="line">  in: 分类于</div><div class="line">  visitors: 阅读量</div><div class="line">  read_more: 阅读全文</div><div class="line">  untitled: 未命名</div><div class="line">  toc_empty: 此文章未包含目录</div></pre></td></tr></table></figure>
<h2 id="7-5-设置阅读全文时不显示最近访问时间"><a href="#7-5-设置阅读全文时不显示最近访问时间" class="headerlink" title="7.5.设置阅读全文时不显示最近访问时间"></a>7.5.设置阅读全文时不显示最近访问时间</h2><blockquote>
<p>修改themes\next\layout_macro\post.swig 文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;# LeanCould PageView #&#125;</div><div class="line">  &#123;% if theme.leancloud_visitors.enable %&#125;</div><div class="line">     &lt;span id=&quot;&#123;&#123; url_for(post.path) &#125;&#125;&quot; class=&quot;leancloud_visitors&quot; data-flag-title=&quot;&#123;&#123; post.title &#125;&#125;&quot;&gt;</div><div class="line">       |</div><div class="line">       &lt;span class=&quot;post-meta-item-icon&quot;&gt;</div><div class="line">         &lt;i class=&quot;fa fa-eye&quot;&gt;&lt;/i&gt;</div><div class="line">       &lt;/span&gt;</div><div class="line">       &lt;span class=&quot;post-meta-item-text&quot;&gt;&#123;&#123;__(&apos;post.visitors&apos;)&#125;&#125; &lt;/span&gt;</div><div class="line">       &lt;span class=&quot;leancloud-visitors-count&quot;&gt;&lt;/span&gt;</div><div class="line">      &#123;% if not is_pv %&#125;    &#123;# 新增is_pv字段判断是否为首页 #&#125;</div><div class="line">        |</div><div class="line">        &lt;span class=&quot;post-meta-item-text&quot;&gt;&#123;&#123;__(&apos;post.updated&apos;)&#125;&#125; &lt;/span&gt;</div><div class="line">        &lt;span class=&quot;leancloud-updated-at&quot;&gt;&lt;/span&gt;</div><div class="line">        &lt;/span&gt;</div><div class="line">      &#123;% endif %&#125;           &#123;# if结束 #&#125;</div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure>
<p>在文件开头修改传进的参数字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% macro render(post, is_index, is_pv, post_extra_class) %&#125;   &#123;# 新增第三个字段is_pv #&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>修改themes/next/layout目录下的post.swig文件</p>
</blockquote>
<p>这个文件是文章的模板<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;% block content %&#125;</div><div class="line">  &lt;div id=&quot;posts&quot; class=&quot;posts-expand&quot;&gt;</div><div class="line">  	#render方法第二个参数is_index为是否为首页</div><div class="line">  	#第三个参数is_pv为我们刚才设置的是否显示计数</div><div class="line">    &#123;&#123; post_template.render(page, false, true) &#125;&#125;</div><div class="line">    &lt;div class=&quot;post-spread&quot;&gt;</div><div class="line">      &#123;% if theme.jiathis %&#125;</div><div class="line">        &#123;% include &apos;_partials/share/jiathis.swig&apos; %&#125;</div><div class="line">      &#123;% elseif theme.duoshuo_shortname and theme.duoshuo_share %&#125;</div><div class="line">        &#123;% include &apos;_partials/share/duoshuo_share.swig&apos; %&#125;</div><div class="line">      &#123;% endif %&#125;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>修改themes/next/layout目录下的index.swig文件</p>
</blockquote>
<p>这个文件是首页的模板<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">找到以下代码，给render方法传入刚才第一步中设置的参数。</div><div class="line">&#123;% block content %&#125;</div><div class="line">  &lt;section id=&quot;posts&quot; class=&quot;posts-expand&quot;&gt;</div><div class="line">    &#123;% for post in page.posts %&#125;</div><div class="line">       #render方法第二个参数is_index为是否为首页</div><div class="line">       #第三个参数is_pv为我们刚才设置的是否显示计数</div><div class="line">      &#123;&#123; post_template.render(post, true, false) &#125;&#125;</div><div class="line">    &#123;% endfor %&#125;</div><div class="line">  &lt;/section&gt;</div><div class="line">  &#123;% include &apos;_partials/pagination.swig&apos; %&#125;</div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure></p>
<p>这样的效果是在首页显示最近阅读时间，阅读全文时文章标题不显示最近阅读时间。</p>
<h2 id="7-6-为文章增加分享"><a href="#7-6-为文章增加分享" class="headerlink" title="7.6.为文章增加分享"></a>7.6.为文章增加分享</h2><blockquote>
<p>使用多说分享</p>
</blockquote>
<p>多说评论在前面的使用留言功能已经介绍了，这里值修改主题配置文件即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 多说热评文章</div><div class="line">duoshuo_hotartical: true # 开启多说热评文章</div></pre></td></tr></table></figure></p>
<h2 id="7-7-为文章增加打赏"><a href="#7-7-为文章增加打赏" class="headerlink" title="7.7.为文章增加打赏"></a>7.7.为文章增加打赏</h2><blockquote>
<p>修改主题配置文件, 收款二维码放在themes\next\source\images 目录下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Donate 文章末尾显示打赏按钮</div><div class="line">reward_comment: 如果文章对您有用请随意打赏，谢谢支持！</div><div class="line">wechatpay: /images/w.png</div><div class="line">alipay: /images/z.jpg</div></pre></td></tr></table></figure>
<h2 id="7-8-设置代码高亮主题"><a href="#7-8-设置代码高亮主题" class="headerlink" title="7.8.设置代码高亮主题"></a>7.8.设置代码高亮主题</h2><p>NexT 使用 Tomorrow Theme 作为代码高亮，共有5款主题供你选择。 NexT 默认使用的是 白色的 normal 主题，可选的值有 normal，night， night blue， night bright， night eighties：<br>在主题配置文件中修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Code Highlight theme</div><div class="line"># Available value:</div><div class="line">#    normal | night | night eighties | night blue | night bright</div><div class="line"># https://github.com/chriskempson/tomorrow-theme</div><div class="line">highlight_theme: night eighties       # 修改即可</div></pre></td></tr></table></figure></p>
<h2 id="7-9-文章添加音乐链接"><a href="#7-9-文章添加音乐链接" class="headerlink" title="7.9.文章添加音乐链接"></a>7.9.文章添加音乐链接</h2><p>Hexo支持解析markdown语法，因此每篇博文都是以.md结尾的文件。而markdown又支持如表格、脚注、内嵌HTML等等，所以在.md文件中直接添加html代码！<br>网音乐云音乐，虾米音乐都可以生成内嵌音乐的html代码，复制粘贴到.md文件中即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;</div><div class="line">	&lt;center&gt;</div><div class="line">		&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=330 height=86</div><div class="line">			src=&quot;https://music.163.com/outchain/player?type=2&amp;id=33856282&amp;auto=0&amp;height=66&quot;&gt;</div><div class="line">		&lt;/iframe&gt;</div><div class="line">	&lt;/center&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<h1 id="8-本地站内搜索"><a href="#8-本地站内搜索" class="headerlink" title="8.本地站内搜索"></a>8.本地站内搜索</h1><p>以前使用的Swiftype现在不能免费使用了，我这里就是用本地配置进行站内搜索</p>
<blockquote>
<p>安装 hexo-generator-search，在站点的根目录下执行以下命令:</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> install hexo-generator-search --save</div></pre></td></tr></table></figure>
<blockquote>
<p>编辑 站点配置文件，新增以下内容到任意位置：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">search:</div><div class="line">  path: search.xml</div><div class="line">  field: post</div></pre></td></tr></table></figure>
<h1 id="9-统计站点访次数和访问量"><a href="#9-统计站点访次数和访问量" class="headerlink" title="9.统计站点访次数和访问量"></a>9.统计站点访次数和访问量</h1><blockquote>
<p>修改themes/next/layout/_partials目录下的footer.swig</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;theme-info&quot;&gt;</div><div class="line">  &#123;&#123; __(&apos;footer.theme&apos;) &#125;&#125; -</div><div class="line">  &lt;a class=&quot;theme-link&quot; href=&quot;https://github.com/iissnan/hexo-theme-next&quot;&gt;</div><div class="line">    NexT.&#123;&#123; theme.scheme &#125;&#125;</div><div class="line">  &lt;/a&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&#123;# 新增代码 #&#125;</div><div class="line">&lt;script async src=&quot;https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;div style=&quot;margin:-20px;position: absolute;right:265px;&quot;&gt;</div><div class="line">&lt;dl style=&quot;float:left&quot;&gt;</div><div class="line">  &lt;dt style=&quot;float:left&quot;&gt;</div><div class="line">    &lt;dd style=&quot;float:left;width:300px&quot;&gt;</div><div class="line">      &lt;span style=&quot;float:right&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|&lt;/span&gt;</div><div class="line">      &lt;span style=&quot;float:right&quot;&gt;本站总访问量&lt;span&gt;&lt;span style=&quot;float:right&quot; id=&quot;busuanzi_value_site_pv&quot;&gt;&lt;/span&gt;</div><div class="line">    &lt;/dd&gt;</div><div class="line">  &lt;/dt&gt;</div><div class="line">  &lt;dt style=&quot;float:left;width:300px&quot;&gt;</div><div class="line">    &lt;dd&gt;</div><div class="line">      &lt;span style=&quot;float:left&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;</div><div class="line">      &lt;span style=&quot;float:left&quot;&gt;您是第&lt;/span&gt;</div><div class="line">      &lt;span style=&quot;float:left&quot; id=&quot;busuanzi_value_site_uv&quot;&gt;&lt;/span&gt;</div><div class="line">      &lt;span style=&quot;float:left&quot;&gt;个小伙伴&lt;/span&gt;</div><div class="line">    &lt;/dd&gt;</div><div class="line">  &lt;/dt&gt;</div><div class="line">&lt;/dl&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&#123;# 结束 #&#125;</div></pre></td></tr></table></figure>
<p>到此本地资源博客搭建已经完成，有些细微调节可根据浏览器控制台找到对应的模板进行调节，比如站点背景(可以指定动画图片，参考资源： <a href="http://michaelxiang.me/2015/11/30/hexo-next-optimize/" target="_blank" rel="external">http://michaelxiang.me/2015/11/30/hexo-next-optimize/</a> )，代码字体字体颜色(参考资源： <a href="http://gniba.com/2016/07/11/next-custom.html" target="_blank" rel="external">http://gniba.com/2016/07/11/next-custom.html</a> )，页面宽度等等</p>
<h1 id="10-博客项目托管到github"><a href="#10-博客项目托管到github" class="headerlink" title="10.博客项目托管到github"></a>10.博客项目托管到github</h1><blockquote>
<p>注册github账号</p>
</blockquote>
<p>网址：<a href="https://github.com/" target="_blank" rel="external">https://github.com/</a><br>点击 new repository<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/g.png" alt="xinjian"></p>
<blockquote>
<p>修改站点配置文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Deployment</div><div class="line">## Docs: https://hexo.io/docs/deployment.html</div><div class="line">deploy:</div><div class="line">  type: git</div><div class="line">  repository: git@github.com:volc1605/volc1605.github.io.git</div><div class="line">  branch: master</div></pre></td></tr></table></figure>
<p>点击进入新建的项目，如图<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/d.png" alt="xj"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">repository： git@github.com:上图划线部分.git</div></pre></td></tr></table></figure></p>
<blockquote>
<p>配置sshkey</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">ssh</span>-keygen -t rsa -C <span class="string">"注册git的邮箱"</span></div></pre></td></tr></table></figure>
<p>连续几个按回车，密码为空，然后在在C:\Users\Administrator.ssh下，得到两个文件id_rsa和id_rsa.pub<br>复制id_rsa.pub中的所有内容</p>
<blockquote>
<p>GitHub上添加SSH密钥</p>
</blockquote>
<p>打开<a href="https://github.com/settings/ssh" target="_blank" rel="external">https://github.com/settings/ssh</a> new SSH key 添加密钥，title随便写，key为刚刚复制的内容</p>
<blockquote>
<p>验证是否能否连接到github</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh -T git@github.com</div></pre></td></tr></table></figure>
<p>如果提示<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">The</span> authenticity of host 'github.com (192.30.253.112)' can't be established.</div><div class="line"><span class="attribute">RSA</span> key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.</div><div class="line"><span class="attribute">Are</span> you sure you want to continue connecting (yes/no)? y</div><div class="line"><span class="attribute">Please</span> type 'yes' or 'no': yes</div></pre></td></tr></table></figure></p>
<p>或者提示覆盖原来的文件，选择yes回车，只要能看到，如下提示就能成功连接到github</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Hi</span> zhangsan! You've successfully authenticated, but GitHub does not provide shell access.</div></pre></td></tr></table></figure>
<h1 id="11-百度-google收录你的站点"><a href="#11-百度-google收录你的站点" class="headerlink" title="11.百度/google收录你的站点"></a>11.百度/google收录你的站点</h1><blockquote>
<p>安装sitemap插件</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> install hexo-generator-sitemap --save        # google</div><div class="line"><span class="attribute">npm</span> install hexo-generator-baidu-sitemap --save  # 百度</div></pre></td></tr></table></figure>
<blockquote>
<p>在站点配置文件_config.yml中添加如下代码：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 自动生成sitemap</div><div class="line">sitemap:</div><div class="line">path: sitemap.xml</div><div class="line">baidusitemap:</div><div class="line">path: baidusitemap.xml</div></pre></td></tr></table></figure>
<p>会在public目录下生成baidusitmap.xml 和 sitemap.xml两个文件  </p>
<blockquote>
<p>安装hexo-deployer-git插件</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">npm</span> install hexo-deployer-git --save</div></pre></td></tr></table></figure>
<blockquote>
<p>部署到github</p>
</blockquote>
<p>在blog目录下执行命令<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">hexo</span> clean # 清除资源</div><div class="line"><span class="attribute">hexo</span> g     # 生成静态资源</div><div class="line"><span class="attribute">hexo</span> d     # 部署</div></pre></td></tr></table></figure></p>
<p>登录在github打开存放博客资源的仓库，就能看到部署的资源文件<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/git.png" alt=""></p>
<blockquote>
<p>分别向google,baidu提交站点地图sitemap.xml,baidusitmap.xml</p>
</blockquote>
<p>百度站长： <a href="http://zhanzhang.baidu.com/site/index" target="_blank" rel="external">http://zhanzhang.baidu.com/site/index</a><br>输入你想添加的网站：你的博客首页地址<br>下一步，下载html文件验证，在原来内容上添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">layout: false</div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">layout: false</div><div class="line">---</div><div class="line">HTYJLXSGJOnjlg</div></pre></td></tr></table></figure></p>
<p>目的是不让站点解析这个baidu_verify_lpmmZiuzEL.html文件，修改完成后放到blog/source目录下重新部署，然后点击完成验证。<br>google站长： <a href="https://www.google.com/webmasters/tools/home?hl=zh-CN" target="_blank" rel="external">https://www.google.com/webmasters/tools/home?hl=zh-CN</a><br>添加网站后，进行左侧抓取站点地图，添加/测试站点地图，填写sitemap.xml。sitemap.xml就在github存放博客仓库的根目录下<br>验证完成后大概过一天时间便可google到你的站点了。<br>而百度的话，就看造化了。</p>
<h1 id="12-关于github访问不到css、js文件"><a href="#12-关于github访问不到css、js文件" class="headerlink" title="12.关于github访问不到css、js文件"></a>12.关于github访问不到css、js文件</h1><p>浏览器控制可以看到问题所在访问不到vendors/source<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/vendors.png" alt="vendors"><br>问题原因不清楚，但通过一下方式可以解决问题<br>根据作者的提示 @iissnan ，首先修改source/vendors为source/lib，然后修改_config.yml， 将 _internal: vendors修改为_internal:lib 然后修改next底下所有引用source/vendors路径为source/lib。这些地方可以通过文件查找找出来。<br>主要集中在这几个文件中。  </p>
<ol>
<li>Hexo\themes\next.bowerrc   </li>
<li>Hexo\themes\next.gitignore   </li>
<li>Hexo\themes\next.javascript_ignore   </li>
<li>Hexo\themes\next\bower.json   </li>
</ol>
<h1 id="13-统计本站运行天数"><a href="#13-统计本站运行天数" class="headerlink" title="13.统计本站运行天数"></a>13.统计本站运行天数</h1><p>修改blog\themes\next\layout_partials\footer.swig文件，在后面追加以下代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">	<span class="keyword">var</span> birthDay = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'09/1/2016'</span>);</div><div class="line">	<span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">	<span class="keyword">var</span> duration = now.getTime() - birthDay.getTime();</div><div class="line">	<span class="keyword">var</span> total= <span class="built_in">Math</span>.floor(duration / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>));</div><div class="line">	<span class="built_in">document</span>.getElementById(<span class="string">'showDays'</span>).innerHTML=<span class="string">'本站已运行'</span> + total + <span class="string">'天'</span>;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>在最后一个div中追加一下代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;span&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;</div><div class="line">&lt;span id=<span class="string">"showDays"</span>&gt;&lt;/span&gt;</div></pre></td></tr></table></figure></p>
<h1 id="14-阿里云解析域名到github"><a href="#14-阿里云解析域名到github" class="headerlink" title="14.阿里云解析域名到github"></a>14.阿里云解析域名到github</h1><p><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/jiexi.png" alt=""><br>在博客根目录添加CNAME文件<br><img src="https://volc1605.github.io/images/Hexo之NexT主题搭建博客详细过程/cname.png" alt=""></p>
<h1 id="15-引入gitment评论"><a href="#15-引入gitment评论" class="headerlink" title="15.引入gitment评论"></a>15.引入gitment评论</h1><p>由于阿里云清除了空壳网站的备案信息，畅言有可能用不了了！！下面使用git自带的评论。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">// http://blog.csdn.net/yanzi1225627/article/details/77890414(hexo集成gitment评论)</div></pre></td></tr></table></figure>
<blockquote>
<p>写博客推荐工具:<br><a href="https://www.zybuluo.com/mdeditor" target="_blank" rel="external">https://www.zybuluo.com/mdeditor</a><br>参考资料：<br>  为NexT主题添加文章阅读量统计功能:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.tuicool.com/articles/YB3EJnz" target="_blank" rel="external">http://www.tuicool.com/articles/YB3EJnz</a><br>git - 简易指南:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.bootcss.com/p/git-guide/" target="_blank" rel="external">http://www.bootcss.com/p/git-guide/</a><br>hexo之next主题优化整理:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://michaelxiang.me/2015/11/30/hexo-next-optimize/" target="_blank" rel="external">http://michaelxiang.me/2015/11/30/hexo-next-optimize/</a><br>自定义NexT.Pisces主题:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://gniba.com/2016/07/11/next-custom.html" target="_blank" rel="external">http://gniba.com/2016/07/11/next-custom.html</a><br>为Hexo博客的每一篇文章自动追加版权信息:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://kuangqi.me/tricks/append-a-copyright-info-after-every-post/" target="_blank" rel="external">http://kuangqi.me/tricks/append-a-copyright-info-after-every-post/</a><br>为Hexo博客添加版权说明和打赏功能:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.tuicool.com/articles/m6bIJfq" target="_blank" rel="external">http://www.tuicool.com/articles/m6bIJfq</a><br>[CSS] 给 HEXO 博客自定义背景图:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://blog.qiji.tech/archives/7854" target="_blank" rel="external">http://blog.qiji.tech/archives/7854</a><br>主题配置:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://theme-next.iissnan.com/theme-settings.html" target="_blank" rel="external">http://theme-next.iissnan.com/theme-settings.html</a><br>多说、RSS和sitemap插件:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://blog.csdn.net/willxue123/article/details/50994854" target="_blank" rel="external">http://blog.csdn.net/willxue123/article/details/50994854</a><br>在Github上面搭建Hexo博客（一）：部署到Github:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.cnblogs.com/cherishzy/p/5694658.html" target="_blank" rel="external">http://www.cnblogs.com/cherishzy/p/5694658.html</a><br>第三方服务集成:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://theme-next.iissnan.com/third-party-services.html#analytics-google" target="_blank" rel="external">http://theme-next.iissnan.com/third-party-services.html#analytics-google</a></p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[jsp页面之间传值]]></title>
      <url>https://volc1605.github.io/2016/06/03/jsp%E9%A1%B5%E9%9D%A2%E4%B9%8B%E9%97%B4%E4%BC%A0%E5%80%BC/</url>
      <content type="html"><![CDATA[<h3 id="1-jsp页面之间传值"><a href="#1-jsp页面之间传值" class="headerlink" title="1 jsp页面之间传值"></a>1 jsp页面之间传值</h3><p>index.jsp<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</div><div class="line">	pageEncoding=&quot;UTF-8&quot;%&gt;</div><div class="line">&lt;%@ page trimDirectiveWhitespaces=&quot;true&quot;%&gt;</div><div class="line">&lt;%@ page session=&quot;false&quot;%&gt;</div><div class="line">&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot;%&gt;</div><div class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;title&gt;&lt;/title&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/js/jquery-1.2.6.min.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;script&gt;</div><div class="line">	$ (document).ready (function () &#123;</div><div class="line">		&lt;%request.getRequestDispatcher(&quot;./success.jsp?a=1&amp;b=2&quot;).forward(request, response);%&gt;</div><div class="line">	&#125;);</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>success.jsp<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</div><div class="line">	pageEncoding=&quot;UTF-8&quot;%&gt;</div><div class="line">&lt;%@ page trimDirectiveWhitespaces=&quot;true&quot;%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</div><div class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/js/jquery-1.2.6.min.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body id=&quot;mainframe&quot;&gt;</div><div class="line">	&lt;div class=&quot;w&quot; id=&quot;headers&quot;&gt;</div><div class="line">		&lt;input id=&quot;pid&quot; type=&quot;hidden&quot; value=&quot;$&#123;param&#125;&quot; /&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;script&gt;</div><div class="line">	$ (document).ready (function () &#123;</div><div class="line">	    alert ($ (&apos;#pid&apos;).val ()); // &#123;b=2, a=1&#125;</div><div class="line">    &#125;);</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<h3 id="2-jsp页面session存取数据"><a href="#2-jsp页面session存取数据" class="headerlink" title="2 jsp页面session存取数据"></a>2 jsp页面session存取数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">存：</div><div class="line">&lt;% request.getSession().setAttribute(&quot;userLoginName&quot;, getUser().getLoginName()); %&gt;</div><div class="line">取：</div><div class="line">console.log(&apos;$&#123;sessionScope.userLoginName &#125;&apos;);</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
  
  
</search>
